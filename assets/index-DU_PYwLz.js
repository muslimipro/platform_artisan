import{a as V,a2 as ue,a3 as ie,r as y,c as te,o as G,G as R,b as a,e as _,h as $,f as v,w as A,t as W,n as ae,q as F,k as C,j as J,F as j,a4 as pe,g as h,x as H,d as we,u as be,s as P,a5 as xe,Q as $e,l as B,C as ve,p as me,D as ke,E as Se,U as se,i as oe,Y as Ce}from"./index-DHVnmQPM.js";import{u as fe,L as Ue,d as Le,_ as Ve}from"./defaultConfirmDeleteOptions-CO4VAVxT.js";import{h as M}from"./http-Dcz7Gd9U.js";import{m as Be}from"./mapLessonFromDto-BxEkOMg4.js";import{U as ee}from"./unitApi-BdRQtE7l.js";import{s as Ie,a as De,b as Te,c as Fe}from"./index-xnFV1lqi.js";import{s as ze}from"./index-COm9ynAh.js";import{_ as ce,T as Ae}from"./CodeEditorView.vue_vue_type_script_setup_true_lang-DhEu2zYO.js";import{s as Re}from"./index-BTL82xS8.js";import{s as Me,a as Ee}from"./index-CoVdCniq.js";import{s as Ne}from"./index-BUJyY_Tq.js";import{s as _e}from"./index-BQXR58SR.js";import{v as ge}from"./v4-CmTdKEVZ.js";import{_ as Pe}from"./CodeEditor.vue_vue_type_script_setup_true_lang-CB3fZ81W.js";import{C as je}from"./cloudStorageApi-HzK0WVk5.js";import{_ as Ge}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{s as Oe}from"./index-D3Cxxuxn.js";import{s as He}from"./index-CBTzXTNN.js";import{s as ye}from"./index-B7xbQbD6.js";import{u as qe}from"./index-CG6SXWyB.js";import{s as Je}from"./index-BM6hZtEV.js";import{s as We}from"./index-0Da1yrVD.js";import{T as Ye}from"./index-D-99ObJy.js";import{s as Ke}from"./index-CKgSSqZR.js";import"./mapUnitFromDto-BXFFFlEW.js";import"./index-C7Peqa67.js";import"./index-DQ6GSfau.js";import"./index-HGiDyU5z.js";import"./index-DimdtQOL.js";import"./index-DRCcxSDj.js";import"./index-BOWzKnTG.js";import"./index-C4F8jACC.js";const z={hideLesson:Qe,modifyLesson:Xe,publishLesson:Ze,sendLessonForReview:et,cancelLessonReview:tt,startLessonReview:st,acceptLesson:ot,rejectLesson:nt,editLesson:lt};async function Qe(c){return await M.patch(`v2/lesson/${c}/hide`)}async function Xe(c){return await M.patch(`v2/lesson/${c}/modify`)}async function Ze(c){return await M.patch(`v2/lesson/${c}/publish`)}async function et(c){return await M.patch(`v2/lesson/${c}/review/send`)}async function tt(c){return await M.patch(`v2/lesson/${c}/review/cancel`)}async function st(c){return await M.patch(`v2/lesson/${c}/review/start`)}async function ot(c){return await M.patch(`v2/lesson/${c}/review/accept`)}async function nt(c){return await M.patch(`v2/lesson/${c}/review/reject`)}async function lt(c){return await M.patch(`v2/lesson/${c}/review/edit`)}const at={class:"flex items-center"},it={class:"flex items-center mr-2"},rt=V({__name:"HighlightEditor",props:ue({index:{},usedSlots:{}},{highlight:{},highlightModifiers:{}}),emits:ue(["remove","save"],["update:highlight"]),setup(c,{emit:r}){const l=c,u=ie(c,"highlight"),n=y(""),t=y(null),e=y(null),s=y(!1),p=te(()=>t.value!=null&&e.value!=null),d=r,b=()=>{d("remove",l.index)};G(()=>{u.value&&(n.value=u.value.id,t.value=u.value.module,e.value=u.value.slot,s.value=u.value.autoPut)}),R([t,e,s],()=>{t.value!=null&&d("save",l.index,n.value,t.value,e.value,s.value)}),R(p,x=>{x||(s.value=!1)});const m=y(["A","B","C","D","E","F"]),S=y(["8","9"]),f=y(["LED","switch","push-button","light-sensor","touch-sensor","potentiometer","encoder","motion-detector","microphone","climate-sensor","gyro-accel","buzzer","color-sensor","joystick","distance-sensor","servo","led-tower"]),g=te(()=>{if(t.value){if(t.value==="servo"||t.value==="led-tower"){const I=S.value.filter(E=>!(l.usedSlots??[]).includes(E));return e.value&&!I.includes(e.value)&&I.unshift(e.value),[null,...I]}const i=m.value.filter(k=>!(l.usedSlots??[]).includes(k));return e.value&&!i.includes(e.value)&&i.unshift(e.value),[null,...i]}const o=[...m.value,...S.value].filter(w=>!(l.usedSlots??[]).includes(w));return e.value&&!o.includes(e.value)&&o.unshift(e.value),[null,...o]}),U=te(()=>e.value?e.value==="8"||e.value==="9"?["servo","led-tower"]:f.value.filter(x=>x!=="servo"&&x!=="led-tower"):f.value);return(x,o)=>{const w=_e,i=Ne,k=Me,I=Ee,E=F;return a(),_("div",at,[$("div",it,[v(w,{modelValue:s.value,"onUpdate:modelValue":o[0]||(o[0]=L=>s.value=L),binary:"","input-id":"autoput",disabled:!p.value},null,8,["modelValue","disabled"]),o[3]||(o[3]=$("label",{for:"autoput",class:"ml-1 text-sm"},"auto",-1))]),v(I,null,{default:A(()=>[v(i,{modelValue:t.value,"onUpdate:modelValue":o[1]||(o[1]=L=>t.value=L),options:U.value,placeholder:"Select module",class:"place-content-center",size:"small"},null,8,["modelValue","options"]),v(k,{class:"h-[35px]"},{default:A(()=>o[4]||(o[4]=[$("div",null,"=>",-1)])),_:1}),v(i,{modelValue:e.value,"onUpdate:modelValue":o[2]||(o[2]=L=>e.value=L),options:g.value,placeholder:"Select slot",size:"small"},{option:A(({option:L})=>[$("span",{class:ae(L===null?"text-gray-400":"")},W(L===null?"[null]":L),3)]),value:A(({value:L})=>[$("span",{class:ae(L===null?"text-gray-400":"")},W(L===null?"[null]":L),3)]),_:1},8,["modelValue","options"])]),_:1}),v(E,{icon:"pi pi-trash",variant:"text",severity:"danger","aria-label":"Remove",onClick:b,class:"ml-2"})])}}}),dt={class:"flex flex-col gap-2"},ut=V({__name:"HighlightPanel",props:{neededModules:{default:[]},neededModulesModifiers:{}},emits:["update:neededModules"],setup(c){const r=ie(c,"neededModules");function l(){r.value=[...r.value,{autoPut:!1,module:null,slot:null,id:ge()}]}function u(t){r.value.splice(t,1)}function n(t,e,s,p,d){r.value[t].id=e,r.value[t].module=s,r.value[t].slot=p,r.value[t].autoPut=d}return(t,e)=>{const s=F,p=Re;return a(),C(p,{header:"Highlight slots & modules"},{default:A(()=>[$("div",dt,[(a(!0),_(j,null,J(r.value,(d,b)=>(a(),_("div",{key:d.id},[v(rt,{highlight:r.value[b],"onUpdate:highlight":m=>r.value[b]=m,index:b,usedSlots:r.value.filter((m,S)=>{var f;return S!==b&&((f=r.value[S])==null?void 0:f.slot)!=null}).map(m=>m.slot),onRemove:u,onSave:n},null,8,["highlight","onUpdate:highlight","index","usedSlots"])]))),128))]),v(s,{icon:"pi pi-plus",variant:"text","aria-label":"Add",class:"self-center mt-2",onClick:l})]),_:1})}}}),ct={class:"flex"},pt={class:"h-[500px] flex flex-col w-full relative"},vt={class:"flex h-full",style:{border:"0.1px solid #808080",borderTopLeftRadius:"12px",borderTopRightRadius:"12px",overflow:"hidden"}},mt={class:"absolute right-2 bottom-2"},ne=!1,ft=V({__name:"PibodyEditor",props:{id:{},content:{},data:{}},emits:["save-content","show-tester"],setup(c,{emit:r}){const l=H(),u=c,n=r,t=y(""),e=y(""),s=y([]);let p=!0;pe(()=>{t.value=u.content.starting,e.value=u.content.answer,s.value=u.data.neededModules??[]}),R([t,e,s],()=>{if(console.log(1),p){p=!1;return}n("save-content",{starting:t.value,answer:e.value,hashed_answer:""},{neededModules:s.value.filter(b=>b.module!=null),tests:u.data.tests,includedCommandsForTests:u.data.includedCommandsForTests})},{deep:!0});function d(){n("show-tester",{lesson_id:l.params.id,unit_id:u.id.split("-")[1]})}return(b,m)=>{const S=F;return a(),_(j,null,[$("div",ct,[$("div",pt,[$("div",vt,[v(ce,{code:t.value,"onUpdate:code":m[0]||(m[0]=f=>t.value=f),runbuttons:!1,connectbuttons:ne,id:u.id+"_",class:"flex-1"},null,8,["code","id"]),v(ce,{code:e.value,"onUpdate:code":m[1]||(m[1]=f=>e.value=f),connectbuttons:ne,"onUpdate:connectbuttons":m[2]||(m[2]=f=>ne=f),id:u.id,class:"flex-1"},null,8,["code","id"])]),$("div",mt,[v(S,{label:"Tests",icon:"pi pi-pen-to-square",class:"w-fit",severity:"info",onClick:d})]),v(h(Ae),{id:u.id,class:"flex-grow max-h-40"},null,8,["id"])])]),v(ut,{neededModules:s.value,"onUpdate:neededModules":m[3]||(m[3]=f=>s.value=f),class:"mb-2"},null,8,["neededModules"])],64)}}}),_t=["article","options","open","video","code","pibody"],O=we("lesson-edit-store",()=>{const c=be(),r=fe(),{lang:l}=P(r),u=y(null),n=y(!1),t=y(!1),e=y(!1),s=y(!1),p=y(!1),d=y(!1);function b(x){e.value=x}async function m(x){try{n.value=!0;const{data:o}=await Ue.getLessonById(x,void 0,l.value);u.value=Be(o)}catch(o){c.add({severity:"error",summary:o.response.data.error,life:2e3})}finally{n.value=!1}}async function S(x,o){try{t.value=!0;const{data:w}=await ee.getUnitByIdandLessonId(x,o,l.value);return w}catch(w){c.add({severity:"error",summary:w.response.data.error,life:2e3})}finally{t.value=!1}}async function f(x){try{s.value=!0;const{data:o}=await ee.createUnitByLessonId(u.value.id,x);c.add({severity:"success",summary:o.message,life:2e3})}catch(o){c.add({severity:"error",summary:o.response.data.error,life:2e3})}finally{s.value=!1}}async function g(x,o,w){try{p.value=!0;const{data:i}=await ee.updateUnitByIdandLessonId(x,o,w,l.value);return i.unit_id}catch(i){c.add({severity:"error",summary:i.response.data.error,life:2e3})}finally{p.value=!1}}async function U(x,o){try{d.value=!0;const{data:w}=await ee.deleteUnitByIdandLessonId(x,o);c.add({severity:"success",summary:w.message,life:2e3})}catch(w){c.add({severity:"error",summary:w.response.data.error,life:2e3})}finally{d.value=!1}}return{selectedLesson:u,isLessonLoading:n,isLessonSaving:e,isUnitLoading:t,isUnitCreating:s,isUnitUpdating:p,isUnitDeleting:d,setLessonSaving:b,loadLessonById:m,loadUnitByIdandLessonId:S,createUnit:f,updateUnitByIdandLessonId:g,deleteUnitByIdandLessonId:U}}),gt={class:"flex items-start"},yt=V({__name:"MdEditor",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(c){const r=ie(c,"modelValue"),l=xe({title:{title:"Title",icon:"v-md-icon-tip",action(n){n.insert(t=>{const e="# <center>",s="</center>",d=t||"Title";return{text:`${e}${d}${s}`,selected:d}})}},icons:{title:"icons",icon:"v-md-icon-tip",menus:[{name:"Attention",text:"Attention",action(n){n.insert(()=>{const t='<span style="font-size: 20px">',e="</span>",s="⚠️";return{text:`${t}${s}${e}`,selected:s}})}},{name:"PiBody",text:"PiBody",action(n){n.insert(()=>{const t="<b>",e="</b>",s='<span style="color: #FF3F85"> Pi</span>Body';return{text:`${t}${s}${e}`,selected:s}})}},{name:"Run",text:"Run",action(n){n.insert(()=>({text:"▶️<b>Run</b>"}))}}]},style:{title:"Style",icon:"v-md-icon-tip",action(n){n.insert(t=>{const e='<span style="">',s="</span>",d=t||"placeholder";return{text:`${e}${d}${s}`,selected:d}})}},underline:{title:"Underline",icon:"v-md-icon-under-line",action(n){n.insert(t=>{const e='<span style="text-decoration: underline">',s="</span>",d=t||"placeholder";return{text:`${e}${d}${s}`,selected:d}})}},tip:{title:"Tip",icon:"v-md-icon-tip",action(n){n.insert(t=>{const e='<div style="background-color:#F3F5F7; padding: 20px; border-left: solid 8px #42B983">',s="</div>",d=t||"placeholder";return{text:`${e}${d}${s}`,selected:d}})}},note:{title:"Note",icon:"v-md-icon-tip",action(n){n.insert(t=>{const e='<div style="background-color:#F3F5F7; padding: 15px; border-left: solid 8px #FFCD6B; margin-bottom: 15px">',s="</div>",d=t||"placeholder";return{text:`${e}${d}${s}`,selected:d}})}}});async function u(n,t,e){const s=e[0],p=new FormData;p.append("file",s);try{const{data:d}=await je.uploadFile(p,"image_"),b=d.source_url;t({url:b,desc:"desc",width:"auto",height:"auto"})}catch(d){console.log(d)}}return(n,t)=>{const e=$e("v-md-editor");return a(),_("div",gt,[v(e,{modelValue:r.value,"onUpdate:modelValue":t[0]||(t[0]=s=>r.value=s),mode:"edit",onChange:t[1]||(t[1]=s=>r.value=s),"left-toolbar":"undo redo clear | tip emoji todo-list | h bold italic strikethrough quote ul ol table hr link code image | title icons style underline tip note","right-toolbar":"",toolbar:l,"disabled-menus":[],onUploadImage:u},null,8,["modelValue","toolbar"])])}}}),he=Ge(yt,[["__scopeId","data-v-52e9f376"]]),ht=V({__name:"ArticleEditor",props:{article:{}},emits:["save-content"],setup(c,{emit:r}){const l=c,u=r,n=y("");let t=!0;return G(()=>{var e;n.value=((e=l.article)==null?void 0:e.text)??""}),R(n,()=>{if(t){t=!1;return}u("save-content",{text:n.value})},{flush:"post"}),(e,s)=>(a(),C(he,{modelValue:n.value,"onUpdate:modelValue":s[0]||(s[0]=p=>n.value=p)},null,8,["modelValue"]))}}),wt={class:"flex flex-col gap-2"},bt={class:"flex gap-1 text-gray-500"},xt={class:"flex flex-col gap-1"},$t=V({__name:"OptionsEditor",props:{optionsData:{}},emits:["save-content"],setup(c,{emit:r}){const l=c,u=r,n=y(!1),t=y(!1),e=y(!1),s=y([]),p=y([]),d=y();let b=!0;G(()=>{var f,g,U,x,o,w;n.value=((f=l.optionsData)==null?void 0:f.shuffle)??!1,t.value=((g=l.optionsData)==null?void 0:g.feedback)??!1,e.value=((U=l.optionsData)==null?void 0:U.single)??!1,s.value=((x=l.optionsData)==null?void 0:x.options)??[],p.value=((o=l.optionsData)==null?void 0:o.answer)??[],d.value=l.optionsData&&l.optionsData.answer&&l.optionsData.answer.length>0?(w=l.optionsData)==null?void 0:w.answer[0]:void 0}),R([n,t,e,s,p,d],()=>{if(b){b=!1;return}u("save-content",{shuffle:n.value,feedback:t.value,single:e.value,options:s.value,answer:e.value?d.value?[d.value]:[]:p.value,hashed_answer:[]})},{deep:!0});function m(){s.value.push({id:ge(),text:""})}function S(f){s.value=s.value.filter(g=>g.id!==f),p.value=p.value.filter(g=>g!==f),d.value==f&&(d.value=void 0)}return(f,g)=>{const U=He,x=Oe,o=_e,w=F;return a(),_("div",wt,[$("div",bt,[g[5]||(g[5]=$("div",null,"shuffle:",-1)),v(U,{modelValue:n.value,"onUpdate:modelValue":g[0]||(g[0]=i=>n.value=i),class:"mr-2"},null,8,["modelValue"]),g[6]||(g[6]=$("div",null,"feedback:",-1)),v(U,{modelValue:t.value,"onUpdate:modelValue":g[1]||(g[1]=i=>t.value=i),class:"mr-2"},null,8,["modelValue"]),g[7]||(g[7]=$("div",null,"single:",-1)),v(U,{modelValue:e.value,"onUpdate:modelValue":g[2]||(g[2]=i=>e.value=i)},null,8,["modelValue"])]),$("div",xt,[(a(!0),_(j,null,J(s.value,i=>(a(),_("div",{key:i.id,class:"flex gap-2 items-center"},[e.value?(a(),C(x,{key:0,modelValue:d.value,"onUpdate:modelValue":g[3]||(g[3]=k=>d.value=k),value:i.id},null,8,["modelValue","value"])):(a(),C(o,{key:1,modelValue:p.value,"onUpdate:modelValue":g[4]||(g[4]=k=>p.value=k),value:i.id},null,8,["modelValue","value"])),v(he,{modelValue:i.text,"onUpdate:modelValue":k=>i.text=k,class:"w-full"},null,8,["modelValue","onUpdate:modelValue"]),v(w,{icon:"pi pi-trash",variant:"text",severity:"danger",size:"small",onClick:k=>S(i.id)},null,8,["onClick"])]))),128))]),v(w,{icon:"pi pi-plus",label:"Add option",variant:"text",size:"small",onClick:m,class:"self-center"})])}}}),kt=V({__name:"OpenEditor",props:{open:{}},emits:["save-content"],setup(c,{emit:r}){const l=c,u=r,n=y("");let t=!0;return G(()=>{var e;n.value=((e=l.open)==null?void 0:e.answer)??""}),R(n,()=>{if(t){t=!1;return}u("save-content",{answer:n.value,hashed_answer:""})}),(e,s)=>{const p=ye;return a(),C(p,{type:"text",modelValue:n.value,"onUpdate:modelValue":s[0]||(s[0]=d=>n.value=d??""),class:"w-full",size:"small"},null,8,["modelValue"])}}}),St=V({__name:"VideoEditor",props:{video:{}},emits:["save-content"],setup(c,{emit:r}){const l=c,u=r,n=y("");let t=!0;return G(()=>{var e;n.value=((e=l.video)==null?void 0:e.url)??""}),R(n,()=>{if(t){t=!1;return}u("save-content",{url:n.value})}),(e,s)=>{const p=ye;return a(),C(p,{type:"text",modelValue:n.value,"onUpdate:modelValue":s[0]||(s[0]=d=>n.value=d??""),class:"w-full",size:"small"},null,8,["modelValue"])}}}),Ct={class:"bg-white rounded-lg border border-gray-200"},Ut={key:1,class:"flex flex-col h-full w-full"},Lt={class:"flex items-center gap-2 px-4 pt-2"},Vt={class:"text-sm"},Bt={class:"text-sm text-gray-500"},It={key:1,class:"flex-grow px-4 py-2"},Dt={class:"flex justify-end"},Tt=V({__name:"UnitCard",props:{unit:{},loading:{type:Boolean}},emits:["delete","update"],setup(c,{emit:r}){const l=c,u=r,n=H(),t=me(),e=O(),{updateUnitByIdandLessonId:s,setLessonSaving:p,loadUnitByIdandLessonId:d}=e,b=y(!1),m=y(null),S=y(null);pe(async()=>{b.value=!0;const o=await d(l.unit.id,Number(n.params.id));o&&(m.value=o.content,S.value=o.data),b.value=!1});function f(o,w){p(!0),U(o,w)}function g(o){t.push({name:"tester2",params:{lesson_id:o.lesson_id,unit_id:o.unit_id}})}const U=qe((o,w)=>{x(o,w)},1e3,{maxWait:5e3});async function x(o,w){const i=await s(l.unit.id,Number(n.params.id),{content:o,data:w});i&&u("update",l.unit,i),p(!1)}return(o,w)=>{const i=ze,k=F;return a(),_("div",Ct,[o.loading?(a(),C(i,{key:0,class:"flex justify-center items-center w-10 h-full"})):(a(),_("div",Ut,[$("div",Lt,[$("div",Vt,W(o.unit.id),1),$("div",Bt,W(`${o.unit.unitType}`),1)]),b.value?(a(),C(i,{key:0,class:"flex justify-center items-center w-10 h-full"})):(a(),_("div",It,[o.unit.unitType=="article"?(a(),C(ht,{key:0,article:m.value,onSaveContent:f},null,8,["article"])):o.unit.unitType=="options"?(a(),C($t,{key:1,"options-data":m.value,onSaveContent:f},null,8,["options-data"])):o.unit.unitType=="open"?(a(),C(kt,{key:2,open:m.value,onSaveContent:f},null,8,["open"])):o.unit.unitType=="video"?(a(),C(St,{key:3,video:m.value,onSaveContent:f},null,8,["video"])):l.unit.unitType=="code"?(a(),C(h(Pe),{key:4,id:`code-${l.unit.id}`,code:m.value,onSaveContent:f,onShowTester:g},null,8,["id","code"])):l.unit.unitType=="pibody"?(a(),C(h(ft),{key:5,id:`code-${l.unit.id}`,content:m.value,data:S.value,onSaveContent:f,onShowTester:g},null,8,["id","content","data"])):B("",!0)])),$("div",Dt,[v(k,{icon:"pi pi-trash",size:"small",severity:"danger",variant:"text",onClick:w[0]||(w[0]=ve(I=>u("delete",l.unit),["stop"]))})])]))])}}}),Ft={class:"group w-full relative"},zt={class:"flex"},le=V({__name:"AddUnitButton",props:{unitId:{},showAddGroup:{type:Boolean},hided:{type:Boolean}},emits:["add-group-divider"],setup(c,{emit:r}){const l=c,u=r,n=H(),t=O(),{loadLessonById:e,createUnit:s}=t,p=y(),d=y(_t.map(m=>({label:m,command:async()=>{await s({unit_type:m,prev_unit_id:l.unitId??void 0}),await e(Number(n.params.id))}}))),b=m=>{p.value.toggle(m)};return(m,S)=>{const f=We,g=F,U=Je;return a(),_(j,null,[$("div",Ft,[S[1]||(S[1]=$("div",{class:"h-3"},null,-1)),$("div",{class:ae(["absolute left-1/2 -translate-x-1/2 -top-5 group-hover:block mt-[9px] w-full",m.hided?"hidden":""])},[$("div",zt,[v(f,{class:"w-7",type:"dashed"}),v(f,{class:"flex-grow",type:"dashed"}),v(g,{icon:"pi pi-plus",class:"flex self-end shadow-xl h-7",size:"small",onClick:b}),v(f,{class:"flex-grow",type:"dashed"}),m.showAddGroup?(a(),C(g,{key:0,icon:"pi pi-arrow-up-right-and-arrow-down-left-from-center",class:"flex self-end h-7",size:"small",variant:"text",onClick:S[0]||(S[0]=x=>u("add-group-divider"))})):(a(),C(f,{key:1,class:"w-7",type:"dashed"}))])],2)]),v(U,{ref_key:"menu",ref:p,model:d.value,popup:!0},null,8,["model"])],64)}}}),At=V({__name:"RemoveGroupButton",emits:["remove-group-divider"],setup(c,{emit:r}){const l=r;return(u,n)=>{const t=F;return a(),C(t,{icon:"pi pi-arrow-down-left-and-arrow-up-right-to-center",severity:"danger",class:"flex self-end h-7 w-7",size:"small",variant:"text",onClick:n[0]||(n[0]=ve(e=>l("remove-group-divider"),["stop"]))})}}}),Rt={class:"flex flex-col gap-2"},Mt={class:"w-full flex justify-between gap-2 mr-4"},Et={class:"flex flex-col p-2 rounded-lg bg-slate-50"},Nt=V({__name:"UnitsView",props:{pages:{}},setup(c){const r=c,l=H(),u=ke(),n=O(),{isUnitDeleting:t}=P(n),{loadLessonById:e,createUnit:s,deleteUnitByIdandLessonId:p}=n,d=y(null);async function b(i){await s({unit_type:"group-divider",prev_unit_id:i.id}),await e(Number(l.params.id))}async function m(){await s({unit_type:"page-divider"}),await e(Number(l.params.id))}async function S(i){await p(i,Number(l.params.id)),await e(Number(l.params.id))}function f(i){d.value=i,u.require({...Le,message:"Are you sure you want to delete this lesson?",accept:async()=>{await p(i.id,Number(l.params.id)),await e(Number(l.params.id))}})}function g(i,k){k>i.id&&(i.id=k)}const U=Number(l.params.id),x=`openedPanels-${U}`,o=y({});G(async()=>{const i=localStorage.getItem(x);i&&(o.value=JSON.parse(i)),await Se(),setTimeout(()=>{const k=localStorage.getItem(`lastOpenedGroup-${U}`);if(k){const I=document.getElementById(`group-${k}`);if(I){I.scrollIntoView({behavior:"smooth"});return}}},1e3)}),R(o,i=>{localStorage.setItem(x,JSON.stringify(i))},{deep:!0});function w(i,k){o.value[k]=i,o.value[k].length>0&&localStorage.setItem(`lastOpenedGroup-${U}`,i[i.length-1])}return(i,k)=>{const I=Ie,E=De,L=Te,Y=Fe,K=F;return a(),_("div",Rt,[(a(!0),_(j,null,J(r.pages,N=>(a(),C(Y,{value:o.value[N.id]||[],"onUpdate:value":D=>w(D,N.id),multiple:"",key:N.id,class:"flex flex-col gap-2 bg-white p-4 rounded-lg shadow-lg"},{default:A(()=>[(a(!0),_(j,null,J(N.groups,(D,Q)=>(a(),C(L,{key:D.id,value:D.id,id:`group-${D.id}`},{default:A(()=>[v(I,null,{default:A(()=>[$("div",Mt,[$("div",null,"Step: "+W(Q),1),D.id!=-1?(a(),C(At,{key:0,onRemoveGroupDivider:T=>S(D.id)},null,8,["onRemoveGroupDivider"])):B("",!0)])]),_:2},1024),v(E,{class:"flex flex-col"},{default:A(()=>[$("div",Et,[(a(!0),_(j,null,J(D.units,(T,X)=>{var q;return a(),_("div",{key:T.id},[X==0?(a(),C(le,{key:0,hided:!0,"unit-id":D.id,"show-add-group":!1},null,8,["unit-id"])):B("",!0),v(Tt,{unit:T,loading:((q=d.value)==null?void 0:q.id)===T.id&&h(t),onDelete:Z=>f(T),onUpdate:g},null,8,["unit","loading","onDelete"]),v(le,{hided:!0,"unit-id":T.id,"show-add-group":!0,onAddGroupDivider:Z=>b(T)},null,8,["unit-id","onAddGroupDivider"])])}),128)),D.units.length==0?(a(),C(le,{key:0,hided:!1,"unit-id":D.id,"show-add-group":!1},null,8,["unit-id"])):B("",!0)])]),_:2},1024)]),_:2},1032,["value","id"]))),128))]),_:2},1032,["value","onUpdate:value"]))),128)),v(K,{id:"newpage",icon:"pi pi-plus",label:"New page",variant:"text",size:"small",class:"flex self-center",onClick:k[0]||(k[0]=N=>m())})])}}}),Pt={class:"w-[24px] h-[24px]"},jt={key:0,class:"flex items-center"},Gt={key:0,class:"material-icons text-gray-500"},Ot={key:1,class:"material-icons text-gray-500"},Ht={key:1},qt={class:"material-icons text-gray-500"},Jt=V({__name:"AutoSaveCloud",setup(c){const r=O(),{selectedLesson:l,isLessonSaving:u}=P(r);return(n,t)=>{var s;const e=Ye;return a(),_("div",Pt,[(s=h(l))!=null&&s.editable?(a(),_("div",jt,[h(u)?se((a(),_("span",Ot,t[1]||(t[1]=[oe("cloud_sync")]))),[[e,"Saving...",void 0,{bottom:!0}]]):se((a(),_("span",Gt,t[0]||(t[0]=[oe("cloud_done")]))),[[e,"Saved",void 0,{bottom:!0}]])])):(a(),_("div",Ht,[se((a(),_("span",qt,t[2]||(t[2]=[oe("cloud_off")]))),[[e,"Save not allowed",void 0,{bottom:!0}]])]))])}}}),Wt={key:0},Yt={key:0},Kt={key:1},Qt={key:0},Xt={key:1},Zt={key:2},es={key:0,class:"flex gap-1"},ts={key:3},ss={key:0},os={key:4},ns={key:0,class:"flex gap-1"},ls={key:5},as={key:0,class:"flex gap-1"},is={key:6},rs={key:0,class:"flex gap-1"},ds=V({__name:"StageButtons",setup(c){const r=H(),l=Ce(),{user:u}=P(l),n=O(),{selectedLesson:t}=P(n),e=y(!1),s=y(!1);async function p(){e.value=!0;try{await z.sendLessonForReview(r.params.id.toString()),window.location.reload()}catch(o){console.log(o)}finally{e.value=!1}}async function d(){e.value=!0;try{await z.cancelLessonReview(r.params.id.toString()),window.location.reload()}catch(o){console.log(o)}finally{e.value=!1}}async function b(){e.value=!0;try{await z.startLessonReview(r.params.id.toString()),window.location.reload()}catch(o){console.log(o)}finally{e.value=!1}}async function m(){e.value=!0;try{await z.acceptLesson(r.params.id.toString()),window.location.reload()}catch(o){console.log(o)}finally{e.value=!1}}async function S(){s.value=!0;try{await z.rejectLesson(r.params.id.toString()),window.location.reload()}catch(o){console.log(o)}finally{s.value=!1}}async function f(){e.value=!0;try{await z.editLesson(r.params.id.toString()),window.location.reload()}catch(o){console.log(o)}finally{e.value=!1}}async function g(){e.value=!0;try{await z.publishLesson(r.params.id.toString()),window.location.reload()}catch(o){console.log(o)}finally{e.value=!1}}async function U(){s.value=!0;try{await z.hideLesson(r.params.id.toString()),window.location.reload()}catch(o){console.log(o)}finally{s.value=!1}}async function x(){e.value=!0;try{await z.modifyLesson(r.params.id.toString()),window.location.reload()}catch(o){console.log(o)}finally{e.value=!1}}return(o,w)=>{var k,I,E,L,Y,K,N,D,Q,T,X,q,Z,re,de;const i=F;return((k=h(t))==null?void 0:k.stage)=="prepare_for_submission"?(a(),_("div",Wt,[((I=h(u))==null?void 0:I.user_type)=="contributor"?(a(),_("div",Yt,[v(i,{label:"Send for review",severity:"info",size:"small",onClick:p,disabled:e.value,loading:e.value},null,8,["disabled","loading"])])):B("",!0)])):((E=h(t))==null?void 0:E.stage)=="waiting_for_review"?(a(),_("div",Kt,[((L=h(u))==null?void 0:L.user_type)=="contributor"?(a(),_("div",Qt,[v(i,{label:"Cancel submission",severity:"danger",size:"small",onClick:d,disabled:e.value,loading:e.value},null,8,["disabled","loading"])])):((Y=h(u))==null?void 0:Y.user_type)=="editor"?(a(),_("div",Xt,[v(i,{label:"Start review",severity:"info",size:"small",onClick:b,disabled:e.value,loading:e.value},null,8,["disabled","loading"])])):B("",!0)])):((K=h(t))==null?void 0:K.stage)=="in_review"?(a(),_("div",Zt,[((N=h(u))==null?void 0:N.user_type)=="editor"?(a(),_("div",es,[v(i,{label:"Reject",severity:"danger",size:"small",onClick:S,disabled:e.value||s.value,loading:s.value},null,8,["disabled","loading"]),v(i,{label:"Accept",size:"small",onClick:m,disabled:e.value||s.value,loading:e.value},null,8,["disabled","loading"])])):B("",!0)])):((D=h(t))==null?void 0:D.stage)=="rejected"?(a(),_("div",ts,[((Q=h(u))==null?void 0:Q.user_type)=="contributor"?(a(),_("div",ss,[v(i,{label:"Edit submission",severity:"info",size:"small",onClick:f,disabled:e.value,loading:e.value},null,8,["disabled","loading"])])):B("",!0)])):((T=h(t))==null?void 0:T.stage)=="ready_for_publish"?(a(),_("div",os,[((X=h(u))==null?void 0:X.user_type)=="editor"?(a(),_("div",ns,[h(t).createdBy!=Number(h(u).user_id)?(a(),C(i,{key:0,label:"Reject",severity:"danger",size:"small",onClick:S,disabled:e.value||s.value,loading:s.value},null,8,["disabled","loading"])):B("",!0),v(i,{label:"Publish",size:"small",onClick:g,disabled:e.value||s.value,loading:e.value},null,8,["disabled","loading"])])):B("",!0)])):((q=h(t))==null?void 0:q.stage)=="published"?(a(),_("div",ls,[((Z=h(u))==null?void 0:Z.user_type)=="editor"?(a(),_("div",as,[v(i,{label:"Hide",severity:"danger",size:"small",onClick:U,disabled:e.value||s.value,loading:s.value},null,8,["disabled","loading"]),v(i,{label:"Modify",size:"small",onClick:x,disabled:e.value||s.value,loading:e.value},null,8,["disabled","loading"])])):B("",!0)])):((re=h(t))==null?void 0:re.stage)=="in_modify"?(a(),_("div",is,[((de=h(u))==null?void 0:de.user_type)=="editor"?(a(),_("div",rs,[v(i,{label:"Hide",severity:"danger",size:"small",onClick:U,disabled:e.value||s.value,loading:s.value},null,8,["disabled","loading"]),v(i,{label:"Publish",size:"small",onClick:g,disabled:e.value||s.value,loading:e.value},null,8,["disabled","loading"])])):B("",!0)])):B("",!0)}}}),us={key:0},cs=V({__name:"StageStatus",setup(c){const r=O(),{selectedLesson:l}=P(r);return(u,n)=>{const t=Ke;return h(l)?(a(),_("div",us,[["prepare_for_submission","waiting_for_review","in_review","in_modify"].includes(h(l).stage)?(a(),C(t,{key:0,label:h(l).stage.replace(/_/g," ").replace(/^./,e=>e.toUpperCase()),icon:"pi pi-clock",pt:{icon:{class:"text-yellow-500"}},class:"h-8 bg-yellow-50 w-fit"},null,8,["label"])):["ready_for_publish","published"].includes(h(l).stage)?(a(),C(t,{key:1,label:h(l).stage.replace(/_/g," ").replace(/^./,e=>e.toUpperCase()),icon:"pi pi-check-circle",pt:{icon:{class:"text-green-500"}},class:"h-8 bg-green-50 w-fit"},null,8,["label"])):["rejected"].includes(h(l).stage)?(a(),C(t,{key:2,label:h(l).stage.replace(/_/g," ").replace(/^./,e=>e.toUpperCase()),icon:"pi pi-times-circle",pt:{icon:{class:"text-red-500"}},class:"h-8 bg-red-50 w-fit"},null,8,["label"])):B("",!0)])):B("",!0)}}}),ps={class:"flex flex-col items-center"},vs={class:"flex justify-between items-center w-full min-h-16 border-b border-gray-200 px-8 shadow-md gap-8"},ms={class:"flex items-center gap-4"},fs={class:"flex items-center gap-4"},_s={class:"w-full h-full max-w-screen-lg px-4 md:px-28 py-8"},gs={class:"fixed top-32 right-0 pl-2 pr-4 py-2 bg-white rounded-tl-lg rounded-bl-lg shadow-md z-50 border border-gray-200 flex flex-col items-center gap-4"},Ks=V({__name:"LessonEditPage",setup(c){const r=H(),l=me(),u=fe(),{lang:n}=P(u),t=O(),{selectedLesson:e}=P(t),{loadLessonById:s}=t;G(()=>s(Number(r.params.id))),R(n,async(b,m)=>{b!==m&&e.value&&await s(e.value.id)});const p=()=>{const b=r.path.endsWith("/edit")?r.path.replace(/\/edit$/,""):"#";l.push(b)};function d(){window.history.length>2?l.go(-1):l.push("/v2/routes")}return(b,m)=>{var f;const S=F;return a(),_("div",ps,[$("div",vs,[$("div",ms,[v(S,{icon:"pi pi-times",variant:"text",severity:"contrast",onClick:d}),v(cs)]),$("div",fs,[v(S,{icon:"pi pi-eye",variant:"text",severity:"contrast",onClick:p}),v(ds)])]),$("div",_s,[(a(),C(Nt,{key:h(n),pages:(f=h(e))==null?void 0:f.pages},null,8,["pages"]))]),$("div",gs,[v(Jt),v(h(Ve))])])}}});export{Ks as default};
