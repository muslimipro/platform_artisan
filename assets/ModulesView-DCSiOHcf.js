import{d as L,u as P,aa as F,g as T,ab as q,r as y,a6 as O,o as t,h as u,w as C,b as R,a as m,e as M,t as U,V as A,j as D,s as N,ac as z,f as G,ad as H,l as J,y as K,c as d,F as b,k,q as Q}from"./index-DxkNwnS6.js";import{s as W}from"./index-DUHCRcVP.js";import{s as X,_ as Y}from"./index-BL4Q1Y7p.js";import{s as Z}from"./logo-B1m1Cn2A.js";import{a as $,t as E}from"./types-C6QlHldy.js";import{P as ee}from"./pibody-BwAjMvHk.js";import{u as te,a as ae,m as oe}from"./useSortable-DjgzQkkb.js";import"./LocaleSwitcher.vue_vue_type_script_setup_true_lang-B3ghzxqy.js";import"./index-DnQmsymo.js";import"./http-DDvZJtkB.js";const se={class:"h-[174px] overflow-hidden"},re={class:"flex justify-between items-center px-4 py-1"},ne={class:"pb-1"},le={class:"flex"},V=L({__name:"ModuleCard",props:{module:{}},emits:["after-remove"],setup(S,{emit:x}){const g=P(),f=F(),B=T(),{user:w}=q(B),l=y(!1),n=S,j=x;function o(){f.require({message:"Are you sure you want to Delete?",header:"Confirmation",icon:"pi pi-exclamation-triangle",rejectProps:{label:"Cancel",severity:"secondary",outlined:!0},acceptProps:{label:"Delete",severity:"danger"},accept:()=>{v()}})}async function v(){l.value=!0;try{await $.deleteModuleByID(n.module.id),j("after-remove")}catch(i){alert(i)}finally{l.value=!1}}function c(){g.push(`/module/${n.module.id}/edit`)}return(i,h)=>{const I=Z,e=N,a=X,s=O("RouterLink");return t(),u(s,{to:l.value?"":`/module/${n.module.id}`},{default:C(()=>[R(a,{style:{width:"300px",height:"234px",overflow:"hidden"},class:"p-0",dt:{body:{padding:"0px",gap:"2px"}}},{header:C(()=>[m("div",se,[R(I,{alt:"user header",src:n.module.cover_image.length>0?n.module.cover_image:M(ee),class:"animate-fadein animate-once animate-duration-1000 animate-ease-in-out"},null,8,["src"])])]),subtitle:C(()=>{var p,_;return[m("div",re,[m("div",ne,U(n.module.title),1),m("div",le,[((p=M(w))==null?void 0:p.user_type)=="editor"?(t(),u(e,{key:0,icon:"pi pi-pen-to-square",severity:"info",variant:"text",rounded:"","aria-label":"Edit",onClick:A(c,["prevent"])})):D("",!0),((_=M(w))==null?void 0:_.user_type)=="editor"?(t(),u(e,{key:1,icon:"pi pi-trash",severity:"danger",variant:"text",rounded:"","aria-label":"Remove",onClick:A(o,["prevent"]),disabled:l.value,loading:l.value},null,8,["disabled","loading"])):D("",!0)])])]}),_:1})]),_:1},8,["to"])}}}),ie={class:"flex flex-col min-h-screen bg-slate-50"},de={class:"border border-dashed rounded-xl border-green-400 overflow-hidden"},ue={key:1,class:"flex flex-wrap justify-center gap-8 px-12 py-6"},we=L({__name:"ModulesView",setup(S){const x=z("el"),g=G(),{locale:f}=H(),B=P(),w=te(),{addLesson:l}=w,n=T(),{user:j}=q(n),o=y([]),v=y(0),c=y(!1),i=y(!1);ae(x,o,{onUpdate:e=>{oe(o.value,e.oldIndex,e.newIndex,e),Q(async()=>{const a=[];o.value.map(s=>{const p=parseInt(s.id,10);a.push(p)});try{await $.changeModulesOrder(a),g.add({severity:"success",summary:"Modules order saved!",life:2e3})}catch(s){g.add({severity:"error",summary:"Order set error!",detail:s,life:2e3})}})}});async function h(){if(!c.value){c.value=!0;try{const{data:e}=await $.getModules();c.value=!1,o.value=[],v.value=e.length;for(const a of e){const s=await E(a,f.value);o.value.push(s)}}catch(e){alert(e)}finally{c.value=!1}}}J(h),K(f,h);async function I(){i.value=!0;try{const{data:e}=await $.createModule(),a=await E(e,f.value);l(a),B.push(`/project/${a.id}/edit`)}catch(e){alert(e)}finally{i.value=!1}}return(e,a)=>{var _;const s=W,p=N;return t(),d("div",ie,[R(Y),((_=M(j))==null?void 0:_.user_type)=="editor"?(t(),d("div",{key:0,ref_key:"el",ref:x,class:"flex flex-wrap justify-center gap-8 px-12 py-6"},[(t(!0),d(b,null,k(o.value,r=>(t(),u(V,{key:r.id,module:r,onAfterRemove:h},null,8,["module"]))),128)),(t(!0),d(b,null,k(v.value-o.value.length,r=>(t(),u(s,{key:r,width:"300px",height:"234px",class:"rounded-xl shadow-sm"}))),128)),m("div",de,[R(p,{variant:"text",style:{width:"300px",height:"234px"},class:"bg-green-50",onClick:I,loading:i.value,disabled:i.value},{icon:C(()=>a[0]||(a[0]=[m("i",{class:"pi pi-plus text-3xl"},null,-1)])),_:1},8,["loading","disabled"])])],512)):(t(),d("div",ue,[(t(!0),d(b,null,k(o.value,r=>(t(),u(V,{key:r.id,module:r,onAfterRemove:h},null,8,["module"]))),128)),(t(!0),d(b,null,k(v.value-o.value.length,r=>(t(),u(s,{key:r,width:"300px",height:"234px",class:"rounded-xl shadow-sm"}))),128))]))])}}});export{we as default};
