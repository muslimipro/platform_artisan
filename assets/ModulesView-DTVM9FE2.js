import{d as V,u as L,ab as F,g as P,ac as T,r as _,a6 as O,o as t,h as u,w as q,a as p,b as B,e as b,t as U,V as S,j as A,s as N,ad as z,f as G,ae as H,l as J,y as K,c as d,F as w,k,q as Q}from"./index-DMYL65Vg.js";import{s as W}from"./index-C6ZoFMA6.js";import{_ as X}from"./AHeader.vue_vue_type_script_setup_true_lang-DPg1eubm.js";import{s as Y}from"./logo-C8dKf__h.js";import{a as C,t as D}from"./types-DKH6yrnu.js";import{P as Z}from"./pibody-BwAjMvHk.js";import{u as ee,a as te,m as ae}from"./useSortable-Dsq5kxUX.js";import"./LocaleSwitcher.vue_vue_type_script_setup_true_lang-DqLnLpbE.js";import"./index-DYLRL3QD.js";import"./http-Coo5Rocp.js";const oe={class:"p-0 w-32 h-40"},se={class:"flex flex-col justify-between items-center px-4 py-1"},re={class:"pb-1 font-medium text-lg text-center line-clamp-2"},ne={class:"flex"},E=V({__name:"ModuleCard",props:{module:{}},emits:["after-remove"],setup(j,{emit:y}){const x=L(),f=F(),M=P(),{user:g}=T(M),l=_(!1),n=j,$=y;function o(){f.require({message:"Are you sure you want to Delete?",header:"Confirmation",icon:"pi pi-exclamation-triangle",rejectProps:{label:"Cancel",severity:"secondary",outlined:!0},acceptProps:{label:"Delete",severity:"danger"},accept:()=>{v()}})}async function v(){l.value=!0;try{await C.deleteModuleByID(n.module.id),$("after-remove")}catch(i){alert(i)}finally{l.value=!1}}function c(){x.push(`/module/${n.module.id}/edit`)}return(i,h)=>{const R=Y,e=N,a=O("RouterLink");return t(),u(a,{to:l.value?"":`/module/${n.module.id}`},{default:q(()=>{var s,m;return[p("div",oe,[B(R,{alt:"user header",src:n.module.cover_image.length>0?n.module.cover_image:b(Z),width:"128",height:"128",class:"animate-fadein animate-once animate-duration-1000 animate-ease-in-out"},null,8,["src"]),p("div",se,[p("div",re,U(n.module.title),1),p("div",ne,[((s=b(g))==null?void 0:s.user_type)=="editor"?(t(),u(e,{key:0,icon:"pi pi-pen-to-square",severity:"info",variant:"text",rounded:"","aria-label":"Edit",onClick:S(c,["prevent"])})):A("",!0),((m=b(g))==null?void 0:m.user_type)=="editor"?(t(),u(e,{key:1,icon:"pi pi-trash",severity:"danger",variant:"text",rounded:"","aria-label":"Remove",onClick:S(o,["prevent"]),disabled:l.value,loading:l.value},null,8,["disabled","loading"])):A("",!0)])])])]}),_:1},8,["to"])}}}),le={class:"flex flex-col min-h-screen bg-slate-50"},ie={class:"border border-dashed rounded-xl border-green-400 overflow-hidden h-fit"},de={key:1,class:"flex flex-wrap justify-center gap-8 px-12 py-6"},ge=V({__name:"ModulesView",setup(j){const y=z("el"),x=G(),{locale:f}=H(),M=L(),g=ee(),{addLesson:l}=g,n=P(),{user:$}=T(n),o=_([]),v=_(0),c=_(!1),i=_(!1);te(y,o,{onUpdate:e=>{ae(o.value,e.oldIndex,e.newIndex,e),Q(async()=>{const a=[];o.value.map(s=>{const m=parseInt(s.id,10);a.push(m)});try{await C.changeModulesOrder(a),x.add({severity:"success",summary:"Modules order saved!",life:2e3})}catch(s){x.add({severity:"error",summary:"Order set error!",detail:s,life:2e3})}})}});async function h(){if(!c.value){c.value=!0;try{const{data:e}=await C.getModules();c.value=!1,o.value=[],v.value=e.length;for(const a of e){const s=await D(a,f.value);o.value.push(s)}}catch(e){alert(e)}finally{c.value=!1}}}J(h),K(f,h);async function R(){i.value=!0;try{const{data:e}=await C.createModule(),a=await D(e,f.value);l(a),M.push(`/project/${a.id}/edit`)}catch(e){alert(e)}finally{i.value=!1}}return(e,a)=>{var I;const s=W,m=N;return t(),d("div",le,[B(X),((I=b($))==null?void 0:I.user_type)=="editor"?(t(),d("div",{key:0,ref_key:"el",ref:y,class:"flex flex-wrap justify-center gap-8 px-12 py-6"},[(t(!0),d(w,null,k(o.value,r=>(t(),u(E,{key:r.id,module:r,onAfterRemove:h},null,8,["module"]))),128)),(t(!0),d(w,null,k(v.value-o.value.length,r=>(t(),u(s,{key:r,width:"128px",height:"128px",class:"rounded-xl shadow-sm"}))),128)),p("div",ie,[B(m,{variant:"text",style:{width:"128px",height:"128px"},class:"bg-green-50",onClick:R,loading:i.value,disabled:i.value},{icon:q(()=>a[0]||(a[0]=[p("i",{class:"pi pi-plus text-xl"},null,-1)])),_:1},8,["loading","disabled"])])],512)):(t(),d("div",de,[(t(!0),d(w,null,k(o.value,r=>(t(),u(E,{key:r.id,module:r,onAfterRemove:h},null,8,["module"]))),128)),(t(!0),d(w,null,k(v.value-o.value.length,r=>(t(),u(s,{key:r,width:"128px",height:"128px",class:"rounded-xl shadow-sm"}))),128))]))])}}});export{ge as default};
