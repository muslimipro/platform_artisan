import{S as te,_ as se,T as ne,s as ae,a as oe}from"./SimulationView-Cf6bGg-Q.js";import{_ as le}from"./IdeHeader.vue_vue_type_script_setup_true_lang-CETYPQH1.js";import{s as ie}from"./index-DyJ6-CMN.js";import{s as ue}from"./index-DGjyTerz.js";import{d as F,h as w,q as U,o as S,c as k,a as u,F as T,n as j,aq as re,aY as ce,l as M,an as O,aZ as E,t as v,ag as de,ad as fe,f as pe,ae as B,i as me,b as l,w as p,u as c,ar as ve,x as ge,s as he,A as _e}from"./index-C34AB3hb.js";import{_ as ye}from"./SavedCloud.vue_vue_type_script_setup_true_lang-B-Xx2JjM.js";import{f as be,d as q,i as we}from"./index-D7dKsk-e.js";import{a as P}from"./index-BgMbSs9W.js";import{u as Se}from"./editor-store-5P99jPoO.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./logo-BUgn1QwI.js";import"./pibody-BwAjMvHk.js";import"./index-CJYgP1SC.js";const ke={class:"relative w-full h-4"},xe=["onClick"],Re={class:"mt-2 flex items-center gap-4"},$e={class:"mt-2 flex items-center gap-4"},Ce=F({__name:"ReplayTimeline",props:{feedback:{}},setup(D){const g=w(0),_=w(0);function z(s){const a=[];if(s.length==0)return a;let f=0,m=s[0].success;for(let r=1;r<s.length;r++)s[r].success!=m&&(a.push({success:m,start:f,finish:r}),f=r,m=s[r].success);return a.push({success:m,start:f,finish:s.length}),a}function x(s){return(s-g.value)/(_.value-g.value)*100}const n=U(()=>{_.value=D.feedback.length;const s=D.feedback.slice(g.value,_.value);return z(s).map(m=>{const r=x(m.start),b=x(m.finish),$=Math.max(b-r,1);return{success:m.success,left:r+"%",width:$+"%",start:m.start,finish:m.finish}})}),h=w({success:!1,left:"0%",width:"0%",start:0,finish:0});function R(s){h.value=s}return(s,a)=>(S(),k(T,null,[u("div",ke,[(S(!0),k(T,null,j(n.value,(f,m)=>(S(),k("div",{key:m,class:re(["absolute h-4 cursor-pointer",f.success?"bg-green-500":"bg-red-500"]),style:ce({left:f.left,width:f.width}),onClick:r=>R(f)},null,14,xe))),128))]),u("div",Re,[u("label",null,[a[2]||(a[2]=M(" Start: ")),O(u("input",{type:"number","onUpdate:modelValue":a[0]||(a[0]=f=>g.value=f),class:"border"},null,512),[[E,g.value]])]),u("label",null,[a[3]||(a[3]=M(" End: ")),O(u("input",{type:"number","onUpdate:modelValue":a[1]||(a[1]=f=>_.value=f),class:"border"},null,512),[[E,_.value]])])]),u("div",$e,v(h.value.start)+", "+v(h.value.finish),1)],64))}}),Te={class:"p-4"},De={class:"flex w-full"},ze={class:"material-icons"},Le={class:"material-icons"},Ve={class:"material-icons"},Ne={class:"material-icons"},Pe={class:"flex justify-end"},Me={class:"flex flex-col gap-4 mt-2"},Be={class:"flex gap-2 w-full"},Fe={class:"material-icons"},Ie={class:"material-icons"},Je=F({__name:"TesterControls",setup(D){const{locale:g}=de(),_=fe(),z=Se(),{setStepSaving:x}=z;let n=w(null);const h=U(()=>n.value?n.value.content.tests:[]);pe(async()=>{const t=ve();try{const{data:e}=await P.getStepTranslationByID(t.params.id.toString(),g.value);if(n.value=e,R.value=n.value.content.solution,n.value.content.highlights)for(const o of n.value.content.highlights)s.newModuleToSlot(o.module,o.slot)}catch(e){console.log(e)}});const{fileContent:R}=B(be()),s=q(),{isLoading:a,isReplaying:f,isReplayTimeout:m}=B(s),r=w({moduleList:[],output:[],input:[]}),b=w({moduleList:[],output:[],input:[]}),$=me();let L=[];function A(){L=[];for(const t of s.getSlots())L.push(t.with.type);r.value.moduleList=L,s.startRecording()}function G(){r.value=s.stopRecording(),r.value.moduleList=L}function W(t,e){const o={},d=Math.min(t.length,e.length);for(let i=0;i<d;i++)JSON.stringify(t[i])!==JSON.stringify(e[i])&&(o[i]={expected:{...t[i]},replayed:{...e[i]}});return o}const V=w([]);function Y(t,e){const o=[],d=Math.min(t.length,e.length);for(let i=0;i<d;i++){let y=!0;JSON.stringify(t[i])!==JSON.stringify(e[i])&&(y=!1),o[i]={success:y,expected:{...t[i]},replayed:{...e[i]}}}return t.length>e.length,o}function I(t){return new Promise(e=>{console.log(t),s.startReplaying(t.input,t.output.length);const o=_e(f,()=>{if(!f.value){b.value=s.getRecordedResults();let d="error";console.log(W(t.output,b.value.output)),V.value=Y(t.output,b.value.output),console.log(V.value),JSON.stringify(t.output)===JSON.stringify(b.value.output)&&(d="success"),$.add({severity:d,summary:"Replayed",life:3e3}),e()}m.value&&($.add({severity:"warn",summary:"Replay timeout",life:3e3}),e()),o.stop()})})}const Z=async()=>{for(const t of h.value)console.log("test start"),await J(t),console.log("test end")},J=async t=>{var o;R.value=((o=n.value)==null?void 0:o.content.solution)??R.value;const e=await fetch(t.url).then(d=>d.json());if(e.moduleList)for(let d=0;d<e.moduleList.length;d++){const i=e.moduleList[d];s.newModuleToSlotIndex(i,d)}await ge(),await I(e),await s.stopPromise()},H=async t=>{const e=await fetch(t.url).then(o=>o.json());I(e)};async function N(){if(n.value!=null){x(!0);try{await P.updateStepTranslationByID(n.value.step,g.value,n.value.name,n.value.content)}catch{$.add({severity:"error",summary:"Failed to save",detail:"I dunno what happened. Go cry to Bekzat; say that saving tests doesn't work",life:3e3})}finally{x(!1)}}}const K=we(()=>{N()},1e3,{maxWait:5e3});async function Q(){if(n.value==null)return;const t={moduleList:r.value.moduleList,output:r.value.output,input:r.value.input},e=JSON.stringify(t),o=new Blob([e],{type:"application/json"}),d=new FormData;d.append("file",o,"default.test.json");const{data:i}=await P.uploadFile(d);n.value.content.tests?n.value.content.tests.push({name:"",url:i.presigned_url}):(n.value.content.tests=[],n.value.content.tests.push({name:"",url:i.presigned_url})),N()}function X(t){_.require({message:"Are you sure you want to Delete?",header:"Confirmation",icon:"pi pi-exclamation-triangle",rejectProps:{label:"Cancel",severity:"secondary",outlined:!0},acceptProps:{label:"Delete",severity:"danger"},accept:()=>{var e;(e=n.value)==null||e.content.tests.splice(t,1),N()}})}return(t,e)=>{const o=he,d=ue,i=ie;return S(),k(T,null,[u("div",Te,[M(" Recorded: "+v(r.value.output.length)+" Replayed: "+v(b.value.output.length)+" ",1),u("div",De,[l(o,{type:"button",class:"w-9 h-9 mr-1",severity:"success",rounded:"",onClick:A,disabled:c(a)||c(s).isRecording},{default:p(()=>[u("span",ze,v(c(a)?"hourglass_top":"play_arrow"),1)]),_:1},8,["disabled"]),l(o,{type:"button",class:"w-9 h-9 mr-1",severity:"danger",rounded:"",onClick:G,disabled:c(a)||!c(s).isRecording},{default:p(()=>[u("span",Le,v(c(a)?"hourglass_top":"stop"),1)]),_:1},8,["disabled"]),l(o,{type:"button",class:"w-9 h-9",severity:"info",rounded:"",onClick:e[0]||(e[0]=y=>Q()),disabled:r.value.output.length<=0||c(n)==null},{default:p(()=>[u("span",Ve,v(c(a)?"hourglass_top":"save"),1)]),_:1},8,["disabled"]),l(o,{type:"button",class:"w-9 h-9",severity:"info",rounded:"",onClick:e[1]||(e[1]=y=>Z()),disabled:c(a)||c(s).isRecording||!h.value},{default:p(()=>[u("span",Ne,v(c(a)?"hourglass_top":"bug_report"),1)]),_:1},8,["disabled"]),u("div",Pe,[l(ye)])]),u("div",Me,[(S(!0),k(T,null,j(h.value,(y,ee)=>(S(),k("div",Be,[l(i,{variant:"on",class:"w-full"},{default:p(()=>[e[3]||(e[3]=u("label",{for:"name"},"Name",-1)),l(d,{id:"name",onInput:e[2]||(e[2]=C=>c(K)()),modelValue:y.name,"onUpdate:modelValue":C=>y.name=C,"aria-describedby":"username-help",class:"w-full",size:"small"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),l(o,{type:"button",class:"w-9 h-9",severity:"info",rounded:"",onClick:C=>J(y),disabled:c(a)||c(s).isRecording},{default:p(()=>[u("span",Fe,v(c(a)?"hourglass_top":"bug_report"),1)]),_:2},1032,["onClick","disabled"]),l(o,{type:"button",class:"w-9 h-9",severity:"warn",rounded:"",onClick:C=>H(y),disabled:c(a)||c(s).isRecording},{default:p(()=>[u("span",Ie,v(c(a)?"hourglass_top":"task"),1)]),_:2},1032,["onClick","disabled"]),l(o,{type:"button",class:"w-9 h-9",severity:"danger",rounded:"",onClick:C=>X(ee)},{default:p(()=>e[4]||(e[4]=[u("span",{class:"material-icons"},v("delete_forever"),-1)])),_:2},1032,["onClick"])]))),256))])]),l(Ce,{feedback:V.value},null,8,["feedback"])],64)}}}),Oe={class:"flex bg-surface-0",style:{height:"calc(100vh - 52px)"}},et=F({__name:"TesterView",setup(D){const g=q(),{isRecording:_}=B(g);return(z,x)=>{const n=ae,h=oe;return S(),k(T,null,[l(le),u("div",Oe,[l(h,{class:"w-full rounded-none"},{default:p(()=>[l(n,{size:50,minSize:10,class:"max-w-[467px] w-full"},{default:p(()=>[l(te)]),_:1}),l(n,{size:50,minSize:10},{default:p(()=>[l(h,{layout:"vertical",class:"h-full w-full"},{default:p(()=>[l(n,{size:65,minSize:10},{default:p(()=>[l(se,{disabled:c(_)},null,8,["disabled"])]),_:1}),l(n,{size:35,minSize:10},{default:p(()=>[l(ne)]),_:1})]),_:1})]),_:1}),l(n,{size:50,minSize:10},{default:p(()=>[l(Je)]),_:1})]),_:1})])],64)}}});export{et as default};
