import{T as se}from"./index-fdmWJyL6.js";import{s as ae}from"./index-rF-8cbWS.js";import{a as re,u as le,B as oe,R as ne,r as d,c as ie,o as ce,b as l,i as f,w as a,e as u,t as o,h as n,f as s,D as m,F as y,k as C,K as z,P as ue,n as I,g as de,q as pe,l as fe,aK as me,m as ge,p as he}from"./index-CjxHu5YN.js";import{s as ve,a as _e}from"./index-Cj3d-VWK.js";import{s as ye}from"./index-CJd01EhZ.js";import{s as be,a as $e}from"./index-BKBTHbJZ.js";import{s as xe}from"./index-VTpbJLjV.js";import{s as we}from"./index-BGhrN2X_.js";import{a as Ce,s as ze}from"./index-BhngfcSD.js";import{s as ke}from"./index-DBXIO6ay.js";import{s as Fe}from"./index-DGh5M2xR.js";import{T}from"./teacherApi-BdRECotQ.js";import{u as je}from"./useTeacherStore-B0ngdrqm.js";import{a as Te}from"./index-ByOnwHrV.js";import"./index-CknO0p2F.js";import"./index-d8-_tEH-.js";import"./index-Drmim8DN.js";import"./index-Duxymste.js";import"./index-CJu7FZxJ.js";import"./index-BL_jzYCU.js";import"./index-B1rk3iTt.js";import"./index-6NqAq9WG.js";import"./index-BLjzxFSN.js";import"./http-InqpyRZI.js";const Se={key:1},De={key:2,class:"flex flex-col items-start px-8 pb-4 gap-4"},Ne={class:"flex items-center justify-between gap-2 w-full"},Pe={class:"flex flex-col gap-2"},Ve={class:"text-3xl"},Ie={class:"text-sm"},Be={class:"flex items-center self-end"},Me={class:"text-xl"},Re={class:"text-gray-500"},Ae={class:"flex items-center"},Ke={class:"flex-grow flex gap-2 items-center"},Ue={class:"text-xl text-gray-500"},qe={class:"w-4 h-4 rounded-md text-[10px] font-semibold flex justify-center items-center bg-gray-300"},Ge={class:"flex flex-col"},Le={class:"text-[10px] text-gray-500"},Oe={class:"flex justify-center text-[124px]"},_t=re({__name:"ClassView",setup(Ee){const S=le(),B=oe(),k=pe(),D=fe(),{t:b}=ne(),M=d(),h=d();(()=>{h.value={global:{value:null,matchMode:me.CONTAINS}}})();const R=je(),{loadClasses:A}=R,g=d(null),N=d([]),$=d([]),x=d(!1),w=d(!1),F=d(!1);async function K(){if(!x.value){x.value=!0;try{const{data:e}=await T.getClass(Number(k.params.id));g.value=e??null}catch(e){console.log(e)}finally{x.value=!1}}}async function U(){if(!w.value){w.value=!0;try{const{data:e}=await T.getClassStudents(Number(k.params.id));N.value=e??null}catch(e){console.log(e)}finally{w.value=!1}}}async function q(){try{const{data:e}=await Te.getProjects();$.value=e}catch(e){console.log(e)}}const G=["secondary","success","info","warn","danger","contrast"],P=ie(()=>{const e={};for(const r of $.value){let p=r.layer;p==0&&(p=999);const v=r.is_guidable?"learn":"practice";e[p]||(e[p]={learn:0,practice:0}),e[p][v]++}return e});ce(()=>{K(),q(),U()});function L(){B.require({message:b("pages.teacher.areYouSureDeleteClass"),header:b("pages.teacher.confirmation"),icon:"pi pi-exclamation-triangle",rejectProps:{label:b("pages.teacher.cancel"),severity:"secondary",outlined:!0},acceptProps:{label:b("pages.teacher.delete"),severity:"danger"},accept:()=>{O(Number(k.params.id))}})}async function O(e){try{const{data:r}=await T.deleteClass(e);await A(),D.go(-1),S.add({severity:"success",summary:r.message,life:2e3})}catch(r){S.add({severity:"error",summary:r.response.data.error,detail:r,life:2e3})}}return(e,r)=>{const p=Fe,v=ge,E=Ce,H=ke,Y=ze,i=ve,J=we,j=be,V=xe,Q=$e,W=ye,X=_e,Z=he,ee=ae,te=se;return l(),f(ee,{class:"flex-grow flex flex-col gap-2"},{default:a(()=>[x.value?(l(),f(p,{key:0,class:"flex justify-center"})):g.value?(l(),u("div",De,[n("div",Ne,[n("div",Pe,[n("div",Ve,o(g.value.name),1),n("div",Ie,o(e.$t("pages.teacher.since"))+" "+o(g.value.created_time.split("T")[0]),1)]),s(v,{icon:"pi pi-hashtag",label:e.$t("pages.teacher.classCode"),severity:"info",onClick:r[0]||(r[0]=t=>F.value=!0)},null,8,["label"])]),n("div",Be,[n("div",Me,[n("span",Re,o(e.$t("pages.teacher.teacher")),1),m(" "+o(g.value.creator_name),1)])]),s(X,{ref_key:"dt",ref:M,filters:h.value,"onUpdate:filters":r[2]||(r[2]=t=>h.value=t),value:N.value,dataKey:"id",loading:w.value,scrollable:"",globalFilterFields:["name","email"],class:"overflow-hidden w-full",paginator:"",rows:25,rowsPerPageOptions:[5,10,25],groupHeader:!0,showGridlines:""},{header:a(()=>[n("div",Ae,[n("div",Ke,[n("div",Ue,o(e.$t("pages.teacher.students")),1)]),s(Y,null,{default:a(()=>[s(E,null,{default:a(()=>r[4]||(r[4]=[n("i",{class:"pi pi-search"},null,-1)])),_:1}),s(H,{modelValue:h.value.global.value,"onUpdate:modelValue":r[1]||(r[1]=t=>h.value.global.value=t),placeholder:e.$t("pages.teacher.search")},null,8,["modelValue","placeholder"])]),_:1})])]),empty:a(()=>[m(o(e.$t("pages.teacher.noStudentsFound")),1)]),loading:a(()=>[m(o(e.$t("pages.teacher.loadingStudents")),1)]),default:a(()=>[s(Q,{type:"header"},{default:a(()=>[s(j,null,{default:a(()=>[s(i,{header:e.$t("pages.teacher.projects"),rowspan:2,colspan:2,frozen:!0,alignFrozen:"left"},null,8,["header"]),(l(!0),u(y,null,C(P.value,(t,c)=>(l(),f(i,{key:c,colspan:t.learn+t.practice},{header:a(()=>[s(J,{class:"w-full text-md px-2",severity:c==999?"secondary":G[c]},{default:a(()=>[m(o(c==999?e.$t("pages.teacher.other"):`${e.$t("pages.teacher.level")} ${c}`),1)]),_:2},1032,["severity"])]),_:2},1032,["colspan"]))),128)),s(i,{header:"",rowspan:2,colspan:2,frozen:!0,alignFrozen:"right"})]),_:1}),s(j,null,{default:a(()=>[(l(!0),u(y,null,C(P.value,(t,c)=>(l(),u(y,{key:c},[t.learn>0?(l(),f(i,{key:0,colspan:t.learn},{header:a(()=>[s(V,{class:"w-full flex justify-center",size:"small",severity:"success"},{default:a(()=>[m(o(e.$t("pages.projects.learn")),1)]),_:1})]),_:2},1032,["colspan"])):z("",!0),t.practice>0?(l(),f(i,{key:1,colspan:t.practice},{header:a(()=>[s(V,{class:"w-full flex justify-center",size:"small",severity:"info"},{default:a(()=>[m(o(e.$t("pages.projects.practice")),1)]),_:1})]),_:2},1032,["colspan"])):z("",!0)],64))),128))]),_:1}),s(j,null,{default:a(()=>[s(i,{header:e.$t("pages.teacher.avatar"),frozen:!0,alignFrozen:"left"},null,8,["header"]),s(i,{header:e.$t("pages.teacher.name"),frozen:!0,alignFrozen:"left",sortable:"",field:"name"},null,8,["header"]),(l(!0),u(y,null,C($.value,(t,c)=>(l(),f(i,{key:t.id,field:t.id},{header:a(()=>[ue((l(),u("div",qe,[m(o(c+1),1)])),[[te,{value:t.name.toString()},void 0,{top:!0}]])]),body:a(({data:_})=>[_.projects[c].student_progress>0?(l(),u("div",{key:0,class:I(["w-4 h-4 mx-4 rounded-full text-[10px] flex justify-center items-center text-white",_.projects[c].student_progress==100?"bg-green-400":"bg-orange-400"])},null,2)):z("",!0)]),_:2},1032,["field"]))),128)),s(i,{header:e.$t("pages.teacher.xp"),frozen:!0,alignFrozen:"right",sortable:"",field:"xp"},null,8,["header"]),s(i,{header:"",frozen:!0,alignFrozen:"right"})]),_:1})]),_:1}),s(i,{field:"small_avatar_url",header:e.$t("pages.teacher.avatar"),sortable:"",frozen:!0,alignFrozen:"left"},{body:a(({data:t})=>[s(W,{image:t.small_avatar_url},null,8,["image"])]),_:1},8,["header"]),s(i,{field:"name",header:e.$t("pages.teacher.name"),sortable:"",frozen:!0,alignFrozen:"left"},{body:a(({data:t})=>[n("div",Ge,[n("div",null,o(`${t.name.length>0?t.name:t.email}`),1),n("div",Le,o(`Last visited: ${t.last_activity_time.split("T")[0]}`),1)])]),_:1},8,["header"]),(l(!0),u(y,null,C($.value,(t,c)=>(l(),f(i,{key:t.id,field:t.id},{body:a(({data:_})=>[_.projects[c].student_progress>0?(l(),u("div",{key:0,class:I(["w-4 h-4 rounded-full text-[10px] flex justify-center items-center text-white",_.projects[c].student_progress==100?"bg-green-400":"bg-orange-400"])},null,2)):z("",!0)]),_:2},1032,["field"]))),128)),s(i,{field:"xp",header:e.$t("pages.teacher.xp"),sortable:"",frozen:!0,alignFrozen:"right"},{body:a(({data:t})=>[n("div",null,o(`${t.xp}xp`),1)]),_:1},8,["header"]),s(i,{exportable:!1,frozen:!0,alignFrozen:"right"},{body:a(({data:t})=>[s(v,{icon:"pi pi-angle-right",outlined:"",rounded:"",severity:"info",onClick:c=>de(D).push({name:"teacher-student",params:{id:t.id}})},null,8,["onClick"])]),_:1})]),_:1},8,["filters","value","loading"]),s(v,{icon:"pi pi-trash",label:e.$t("pages.teacher.removeClass"),severity:"danger",onClick:L,class:"self-end"},null,8,["label"])])):(l(),u("div",Se,o(e.$t("pages.teacher.noData")),1)),s(Z,{visible:F.value,"onUpdate:visible":r[3]||(r[3]=t=>F.value=t),modal:"",header:e.$t("pages.teacher.classCode")},{default:a(()=>{var t;return[n("div",Oe,o((t=g.value)==null?void 0:t.code),1)]}),_:1},8,["visible","header"])]),_:1})}}});export{_t as default};
