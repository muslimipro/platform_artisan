import{s as ae,S as le,_ as oe,T as ne,a as ie}from"./SimulationView-Yglt2jWL.js";import{u as A,a as q,t as re,b as ce,c as ue}from"./store-CdCGEHTc.js";import{d as G,ae as H,u as J,af as Q,g as pe,ac as T,r as D,l as X,y as Z,o as a,c as $,a as m,b as n,e as s,h as d,F as K,k as de,ag as ee,j as C,w as S,ah as fe,t as Y,s as te,ai as me,f as ve,n as _e,aj as ye,ak as ge}from"./index-DwxPZ37a.js";import{s as he}from"./index-YrFBf5xg.js";import{s as be,a as we,t as ke}from"./types-DZ0BvDR1.js";import{L as xe,s as Se}from"./logo-DQGB7EJE.js";import{_ as $e}from"./LocaleSwitcher.vue_vue_type_script_setup_true_lang-DqVVrcXT.js";import{_ as je,a as Ce,M as Pe,b as ze,c as Ie}from"./QuestionStep.vue_vue_type_script_setup_true_lang-ChKRY-hy.js";import"./pibody-BwAjMvHk.js";import"./http-IhYw4CSM.js";import"./index-BJ8cUkRK.js";import"./index-8t4aaF2A.js";const Le={class:"mx-auto flex items-center justify-between p-2 px-6 w-full bg-white"},Be={class:"flex flex-1 items-center"},De={key:1,class:"flex items-center gap-1"},Ve={class:"flex items-center gap-1"},Fe={class:"flex flex-1 justify-end items-center gap-2"},Ne={class:"relative overflow-hidden w-full border-0 bg-transparent flex items-start p-2 pl-4 rounded-none cursor-pointer transition-colors duration-200"},Ue={class:"inline-flex flex-col items-start"},qe={class:"font-bold"},Ee={class:"text-sm"},Me=G({__name:"LessonHeader",setup(O){const{locale:b}=H(),V=J(),P=Q(),z=pe(),{user:v}=T(z),i=A(),{lesson:F,stepIndex:j,stepLoading:_,firstUncompletedIndex:I}=T(i),{changeStep:y,setSteps:L,setStepIndex:f,setFirstUncompletedIndex:e}=i,N=D(!1),B=D(!1);function M(t,l){if(l)return"info";if(t!="completed")return t=="attempted"?"warn":(t=="started","secondary")}function p(t,l){if(!l&&t!="completed")return t=="attempted"||t=="started"?"outlined":void 0}function R(t){switch(t){case"article":return"pi pi-align-left";case"code":return"pi pi-code";case"question":return"pi pi-question";case"matching":return"pi pi-arrows-h";case"open":return"pi pi-pencil";default:return"pi pi-align-left"}}async function E(){if(!N.value){N.value=!0;try{const{data:t}=await q.getStudentProjectStepsByID(P.params.id.toString()),l=[];for(const[u,k]of t.steps.entries())if(k.id==t.last_step_id){f(u);const U=await re(k,b.value);l.push(U)}else{const U={id:k.id.toString(),title:"",type:k.step_type,progress:k.status,inner:{contents:[]},answer:{}};l.push(U)}L(l);let w=0;for(let u=0;u<l.length;u++)if(l[u].progress!="completed"||u==l.length-1){w=u;break}e(w)}catch(t){alert(t)}finally{N.value=!1}}}X(E),Z(b,E,{immediate:!1});const r=D(),c=D([{label:"Log out",icon:"pi pi-sign-out",command:()=>{z.logout(),V.replace({name:"login"})}}]),o=t=>{r.value.toggle(t)};async function g(){if(!B.value){B.value=!0;try{await q.resetStepsProgress(P.params.id.toString()),window.location.reload()}catch(t){alert(t)}finally{B.value=!1}}}return(t,l)=>{var W;const w=Se,u=te,k=be,U=he,se=me;return a(),$("div",Le,[m("div",Be,[n(w,{src:s(xe),width:"32"},null,8,["src"]),l[1]||(l[1]=m("p",{class:"text-xl font-semibold px-2 mr-4"},"Artisan",-1)),n(u,{id:"#projects",icon:"pi pi-angle-left",label:t.$t("projects"),severity:"secondary",variant:"text",onClick:l[0]||(l[0]=h=>s(V).push({name:"projects"})),size:"small"},null,8,["label"])]),N.value||s(F)==null?(a(),d(k,{key:0,shape:"circle",size:"2rem",class:"mr-2"})):(a(),$("div",De,[m("div",Ve,[(a(!0),$(K,null,de(s(F).steps,(h,x)=>(a(),d(u,{key:h.id,icon:R(h.type),rounded:"",severity:M(h.progress,x==s(j)),variant:p(h.progress,x==s(j)),class:ee([{"bg-orange-100":h.progress=="attempted"&&x!=s(j)},"h-8 w-8"]),onClick:Je=>s(y)(x),disabled:s(_)||h.progress!="completed"&&x!=s(I),loading:x==s(j)&&s(_)},null,8,["icon","severity","variant","class","onClick","disabled","loading"]))),128))])])),m("div",Fe,[((W=s(v))==null?void 0:W.user_type)=="editor"?(a(),d(u,{key:0,label:"Reset",icon:"pi pi-refresh",severity:"info",variant:"outlined",size:"small",onClick:g,disabled:B.value,loading:B.value},null,8,["disabled","loading"])):C("",!0),n($e),n(u,{type:"button",icon:"pi pi-ellipsis-v",onClick:o,"aria-haspopup":"true","aria-controls":"overlay_menu",size:"small",variant:"outlined",severity:"secondary",class:"border border-slate-300 bg-slate-50",style:{width:"34px"}}),n(U,{ref_key:"menu",ref:r,id:"overlay_menu",model:c.value,popup:!0},{start:S(()=>{var h,x;return[fe((a(),$("button",Ne,[m("span",Ue,[m("span",qe,Y((h=s(v))==null?void 0:h.email),1),m("span",Ee,Y((x=s(v))==null?void 0:x.user_type),1)])])),[[se]])]}),_:1},8,["model"])])])}}}),Re={class:"flex flex-col p-4 gap-4 overflow-scroll h-full justify-between bg-white"},Te={key:0},Ae={key:1,class:"flex"},Ge={class:"flex justify-end gap-2"},He=G({__name:"LessonDiv",setup(O){const{locale:b}=H(),V=J(),P=ve(),z=A(),{lesson:v,stepIndex:i,userCode:F,firstUncompletedIndex:j,submitEnabled:_}=T(z),{changeStep:I,updateStatus:y,incrementFirstUncompletedIndex:L}=z,f=D(!1),e=_e(()=>{var r;return i.value==null?null:((r=v.value)==null?void 0:r.steps[i.value])??null});async function N(){i.value!=null&&I(i.value-1)}async function B(){var r,c;if(i.value!=null){if(((r=e.value)==null?void 0:r.type)=="article"&&e.value.progress!="completed"){p.value=!0;try{const{data:o}=await q.submitStep(((c=e.value)==null?void 0:c.id)??"",b.value,{});y(o.status),L()}catch(o){console.log(o)}finally{p.value=!1}}i.value+1<=j.value&&I(i.value+1)}}async function M(){var r,c,o;if(i.value!=null){if(((r=e.value)==null?void 0:r.progress)=="completed"){f.value=!0;return}if(((c=e.value)==null?void 0:c.type)=="article"){p.value=!0;try{const{data:g}=await q.submitStep(((o=e.value)==null?void 0:o.id)??"",b.value,{});y(g.status),f.value=!0}catch(g){console.log(g)}finally{p.value=!1}}}}const p=D(!1);async function R(){var r,c,o,g;p.value=!0;try{let t;switch((r=e.value)==null?void 0:r.type){case"code":t={code:F.value};break;case"open":t={open:e.value.answer.open};break;case"question":const u=[];(c=e.value.inner.options)==null||c.forEach(k=>{u.push(k.correct)}),t={question:u};break;case"matching":t={match:[{key:"dog",value:"b"},{key:"a",value:"animal"},{key:"c",value:"d"}]};break;default:t={};break}const l=((o=e.value)==null?void 0:o.progress)=="completed",{data:w}=await q.submitStep(((g=e.value)==null?void 0:g.id)??"",b.value,t);l||y(w.status),w.status=="completed"?(l||L(),P.add({severity:"success",summary:"Correct, good job!",detail:"Completed successfully",life:5e3})):w.status=="attempted"&&P.add({severity:"error",summary:"Wrong answer!",detail:"Keep trying",life:5e3}),console.log(w.status)}catch(t){alert(t)}finally{p.value=!1}}function E(){f.value=!1,V.push({name:"projects"})}return(r,c)=>{const o=te,g=ye;return a(),$(K,null,[m("div",Re,[e.value?(a(),$("div",Te,[e.value.type=="article"?(a(),d(s(je),{key:0,step:e.value,isPreview:!1},null,8,["step"])):e.value.type=="code"?(a(),d(s(Ce),{key:1,step:e.value,isPreview:!1},null,8,["step"])):e.value.type=="matching"?(a(),d(s(Pe),{key:2,step:e.value,isPreview:!1},null,8,["step"])):e.value.type=="open"?(a(),d(s(ze),{key:3,step:e.value,isPreview:!1},null,8,["step"])):e.value.type=="question"?(a(),d(s(Ie),{key:4,step:e.value,isPreview:!1},null,8,["step"])):C("",!0)])):C("",!0),s(v)!=null&&s(v).steps!=null&&s(v).steps.length>0&&e.value?(a(),$("div",Ae,[s(i)!==0?(a(),d(o,{key:0,label:"Previous",icon:"pi pi-angle-left",size:"small",onClick:N})):C("",!0),e.value.type!="article"&&e.value.progress!="completed"?(a(),d(o,{key:1,label:"Submit",icon:"pi pi-check",iconPos:"right",severity:"info",size:"small",class:"ml-auto self-end",onClick:R,disabled:p.value||!s(_),loading:p.value},null,8,["disabled","loading"])):C("",!0),s(i)<s(v).steps.length-1&&(e.value.progress=="completed"||e.value.type=="article")?(a(),d(o,{key:2,label:"Next",icon:"pi pi-angle-right",iconPos:"right",size:"small",class:"ml-auto self-end",onClick:B,disabled:p.value||e.value.progress!="completed"&&(e.value.type!="article"||!s(_)),loading:p.value},null,8,["disabled","loading"])):s(i)==s(v).steps.length-1&&(e.value.progress=="completed"||e.value.type=="article")?(a(),d(o,{key:3,label:"Finish ðŸ¥³",size:"small",class:"ml-auto self-end",onClick:M,disabled:p.value||e.value.progress!="completed"&&(e.value.type!="article"||!s(_)),loading:p.value},null,8,["disabled","loading"])):C("",!0)])):C("",!0)]),n(g,{visible:f.value,"onUpdate:visible":c[0]||(c[0]=t=>f.value=t),modal:"",header:"CongratulationsðŸ¥³ðŸŽ‰",style:{width:"25rem"}},{default:S(()=>[c[1]||(c[1]=m("span",{class:"text-surface-500 dark:text-surface-400 block mb-8"},"You successfully completed this project",-1)),m("div",Ge,[n(o,{type:"button",label:"Go to next Project âž¡ï¸",onClick:E})])]),_:1},8,["visible"])],64)}}}),Ke={key:1,class:"h-[51px]"},Oe={class:"flex bg-surface-0",style:{height:"calc(100vh - 52px)"}},We={class:"flex justify-center h-full"},Ye={class:"max-w-[400px] w-full"},ct=G({__name:"LessonView",setup(O){const{locale:b}=H(),V=Q(),P=A(),{setLesson:z}=P,v=ce(),{clearSlots:i}=v,F=ue(),{setCode:j}=F,_=D(!1);async function I(){if(!_.value){_.value=!0;try{const{data:y}=await we.getProjectByID(V.params.id.toString()),L=await ke(y,b.value);z(L)}catch(y){alert(y)}finally{_.value=!1}}}return X(I),Z(b,I),ge(()=>{i(),j("")}),(y,L)=>{const f=ie,e=ae;return a(),$(K,null,[_.value?(a(),$("div",Ke)):(a(),d(Me,{key:0})),m("div",Oe,[n(e,{class:"w-full rounded-none"},{default:S(()=>[n(f,{size:33,minSize:10,class:"max-w-[467px] w-full"},{default:S(()=>[n(le)]),_:1}),n(f,{size:34,minSize:10},{default:S(()=>[n(e,{layout:"vertical",class:"h-full w-full"},{default:S(()=>[n(f,{size:65,minSize:10},{default:S(()=>[n(oe)]),_:1}),n(f,{size:35,minSize:10},{default:S(()=>[n(ne)]),_:1})]),_:1})]),_:1}),n(f,{size:33,minSize:10,class:ee(["max-w-md mx-auto",{"animate-fadeinright animate-once animate-duration-1000 animate-ease-in-out":!0}])},{default:S(()=>[m("div",We,[m("div",Ye,[_.value?C("",!0):(a(),d(He,{key:0}))])])]),_:1})]),_:1})])],64)}}});export{ct as default};
