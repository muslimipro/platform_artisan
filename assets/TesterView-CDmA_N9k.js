import{s as Se,a as Te}from"./index-BwClWKCP.js";import{_ as Ie}from"./IdeHeader.vue_vue_type_script_setup_true_lang-BfG-hdPp.js";import{s as oe}from"./index-Dpjxsf2v.js";import{s as Fe}from"./index-Ca8xVF3P.js";import{s as Me}from"./index-c-XKspjc.js";import{a as G,b as a,e as r,g as e,h as t,t as o,J as u,c as ae,F as j,D as N,K as R,k as X,r as O,i as B,w as g,n as Q,f as m,m as be,u as De,B as Re,s as ce,o as Ve,E as ie,q as Ne}from"./index-n3daKGCc.js";import{s as Be}from"./index-Gwbo46K_.js";import{O as D,o as z,v as de,p as A,M as te,q as ue,P as se,s as me,t as Z,w as je,x as P,y as F,z as ze,a as Ae,b as _e,u as Oe,e as Ge,g as Ue,h as Ee,n as Le,I as We,m as ve,R as ee}from"./CodeEditorView.vue_vue_type_script_setup_true_lang-BqDbFO8I.js";import{_ as Je,a as Ke}from"./Inputs.vue_vue_type_script_setup_true_lang-D63I3hH3.js";import{u as He}from"./stores-NzHUuBHZ.js";import{a as fe,f as Qe,d as pe,c as Xe,i as I,b as Ye,e as Ze,r as ge}from"./index-C5Do69yt.js";import{C as H}from"./cloudStorageApi-B-_uvuoj.js";import{u as et}from"./editor-store-Yih_evRb.js";import{_ as tt}from"./SavedCloud.vue_vue_type_script_setup_true_lang-LwbzR-wk.js";import{a as st}from"./index-CV0mxHXi.js";import{t as ot}from"./types-81Qs7ZwA.js";import{u as at}from"./index-D57r3cjp.js";import{_ as nt}from"./PibodyViewer.vue_vue_type_script_setup_true_lang-l9tZWOMG.js";import"./index-eM3voxb6.js";import"./index-Cxe1QBz0.js";import"./logo-D1-3uCnC.js";import"./index-Uwvuv9oP.js";import"./index-C2oRp5Ga.js";import"./index-ChwKPPkr.js";import"./index-BTdhpGXM.js";import"./index-C9Jq8BwU.js";import"./index-DvRfzZCT.js";import"./index-BRSnIgLR.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-BqbdjUlk.js";import"./http-BEt-6spR.js";import"./v4-CmTdKEVZ.js";import"./index-D4py3QaC.js";import"./SimulationView-Cg4peqrM.js";const lt={key:0,class:"text-nowrap"},rt={key:0,class:"text-white"},ct={key:1,class:"text-white"},it={key:2,class:"text-white"},dt={key:3,class:"text-white"},ut={key:4,class:"text-white"},mt={key:5,class:"text-black w-full"},vt={class:"text-center font-mono px-1 text-white bg-black"},ft={key:6,class:"text-black w-full"},pt={class:"text-center font-mono px-1 text-white bg-black"},gt={key:7,class:"text-black w-full p-3"},xt={key:8,class:"text-white w-full"},yt={key:9,class:"text-white w-full"},ht={key:10,class:"text-white w-full"},bt={key:11,class:"text-white w-full"},_t={key:12,class:"text-black w-full"},wt={class:"text-center font-mono px-1 text-white bg-black"},kt={key:13,class:"text-white"},$t={key:14,class:"text-black w-full"},Ct={key:1,class:"text-center p-3"},xe=G({__name:"FeedbackNode",props:{message:{type:Object,required:!0}},setup(s){return(p,f)=>s.message?(a(),r("div",lt,[s.message.command===e(D).PinSetValue?(a(),r("div",rt,[t("div",{style:u({background:e(z)}),class:"text-center font-mono px-1"},"Pin "+o(s.message.request.pin)+" set value",5),t("div",{style:u(e(A)(s.message.request.value)),class:"text-center font-mono px-1"}," Value "+o(e(de)(s.message.request.value)),5)])):s.message.command===e(D).PinSetMode?(a(),r("div",ct,[t("div",{style:u({background:e(z)}),class:"text-center font-mono px-1"},"Pin "+o(s.message.request.pin)+" set mode",5),t("div",{style:u({background:e(ue)[s.message.request.mode]}),class:"text-center font-mono px-1"}," Mode "+o(e(te)[s.message.request.mode]),5)])):s.message.command===e(D).PinSetPull?(a(),r("div",it,[t("div",{style:u({background:e(z)}),class:"text-center font-mono px-1"},"Pin "+o(s.message.request.pin)+" set pull",5),t("div",{style:u({background:e(me)[s.message.request.pull]}),class:"text-center font-mono px-1"}," Pull "+o(e(se)[s.message.request.pull]),5)])):s.message.command===e(D).PwmDutyU16?(a(),r("div",dt,[t("div",{style:u({background:e(z)}),class:"text-center font-mono px-1"},"PWM "+o(s.message.request.pin)+" set duty",5),t("div",{style:u(e(A)(s.message.request.duty_u16/e(Z))),class:"text-center font-mono px-1"}," u16 "+o(s.message.request.duty_u16),5)])):s.message.command===e(D).PwmFreq?(a(),r("div",ut,[t("div",{style:u({background:e(z)}),class:"text-center font-mono px-1"},"PWM "+o(s.message.request.pin)+" set freq",5),t("div",{style:u(e(A)(s.message.request.freq/e(Z))),class:"text-center font-mono px-1"}," Freq "+o(s.message.request.freq),5)])):s.message.command===e(D).Output?(a(),r("div",mt,[f[0]||(f[0]=t("div",{class:"text-center px-1"},"Print",-1)),t("div",vt,o(s.message.request.output),1)])):s.message.command===e(D).Sleep?(a(),r("div",ft,[f[1]||(f[1]=t("div",{class:"text-center px-1"},"Sleep",-1)),t("div",pt,o(s.message.request.time_ms)+" ms",1)])):s.message.command===e(je).Timeout?(a(),r("div",gt," Timeout ")):s.message.command===e(P).PinGetValue?(a(),r("div",xt,[t("div",{style:u({background:e(F)}),class:"text-center font-mono px-1"},"Pin "+o(s.message.request.pin)+" get value",5),t("div",{style:u(e(A)(s.message.result)),class:"text-center font-mono px-1"}," Value "+o(e(de)(s.message.result)),5)])):s.message.command===e(P).PinGetMode?(a(),r("div",yt,[t("div",{style:u({background:e(F)}),class:"text-center font-mono px-1"},"Pin "+o(s.message.request.pin)+" get mode",5),t("div",{style:u({background:e(ue)[s.message.result]}),class:"text-center font-mono px-1"}," Mode "+o(e(te)[s.message.result]),5)])):s.message.command===e(P).PinGetPull?(a(),r("div",ht,[t("div",{style:u({background:e(F)}),class:"text-center font-mono px-1"},"Pin "+o(s.message.request.pin)+" get pull",5),t("div",{style:u({background:e(me)[s.message.result]}),class:"text-center font-mono px-1"}," Pull "+o(e(se)[s.message.result]),5)])):s.message.command===e(P).AdcReadU16?(a(),r("div",bt,[t("div",{style:u({background:e(F)}),class:"text-center font-mono px-1"},"ADC "+o(s.message.request.pin)+" read",5),t("div",{style:u(e(A)(s.message.result/e(Z))),class:"text-center font-mono px-1"}," u16 "+o(s.message.result),5)])):s.message.command===e(P).Input?(a(),r("div",_t,[f[2]||(f[2]=t("div",{class:"text-center px-1"},"Input",-1)),t("div",wt,o(s.message.result),1)])):s.message.command===e(D).NeoPixelWrite?(a(),r("div",kt,[t("div",{style:u({background:e(z)}),class:"text-center font-mono px-1"},"Pin "+o(s.message.request.pin)+" write pixels",5),t("div",{style:u(e(A)(0)),class:"text-center font-mono px-1"}," pixels("+o(s.message.request.pixels.length)+") ",5)])):(a(),r("div",$t," Todo: "+o(s.message.command),1))])):(a(),r("div",Ct," Nothing "))}}),Pt={class:"flex-col overflow-auto"},qt={class:"flex"},St={key:0,class:"flex text-white border-2 border-blue-500"},Tt={class:"text-black text-nowrap"},It={key:1,class:"flex text-white border-2 border-blue-500"},Ft={class:"text-black text-nowrap"},Mt={key:2,class:"flex text-white border-2 border-blue-500"},Dt={class:"text-black text-nowrap"},Rt={key:3,class:"flex text-white border-2 border-blue-500"},Vt={class:"text-black text-nowrap"},Nt={key:4,class:"flex text-white border-2 border-blue-500"},Bt={class:"text-black text-nowrap"},jt={key:5,class:"flex text-black border-2 border-blue-500"},zt=G({__name:"Inputs",props:{inputs:{}},setup(s){const p=ae(()=>{const f=[];for(const[w,i]of s.inputs){const k=ze(w);f.push({...k,result:i})}return f});return(f,w)=>(a(),r(j,null,[p.value.length===0?(a(),r(j,{key:0},[N("Nothing")],64)):R("",!0),t("div",Pt,[(a(!0),r(j,null,X(p.value,i=>(a(),r("div",qt,[i.command===e(P).PinGetValue?(a(),r("div",St,[t("div",{style:u({background:e(F)}),class:"text-center text-nowrap font-mono px-1"},"Pin "+o(i.request.pin)+" get values:",5),t("div",Tt,o(i.result),1)])):i.command===e(P).PinGetMode?(a(),r("div",It,[t("div",{style:u({background:e(F)}),class:"text-center text-nowrap font-mono px-1"},"Pin "+o(i.request.pin)+" get values:",5),t("div",Ft,o(i.result.map(k=>e(te)[k])),1)])):i.command===e(P).PinGetPull?(a(),r("div",Mt,[t("div",{style:u({background:e(F)}),class:"text-center text-nowrap font-mono px-1"},"Pin "+o(i.request.pin)+" get values:",5),t("div",Dt,o(i.result.map(k=>e(se)[k])),1)])):i.command===e(P).AdcReadU16?(a(),r("div",Rt,[t("div",{style:u({background:e(F)}),class:"text-center text-nowrap font-mono px-1"},"ADC "+o(i.request.pin)+" read u16:",5),t("div",Vt,o(i.result),1)])):i.command===e(P).Input?(a(),r("div",Nt,[t("div",{style:u({background:e(F)}),class:"text-center text-nowrap font-mono px-1"},"Console input:",4),t("div",Bt,o(i.result),1)])):(a(),r("div",jt,"TODO: "+o(i.command),1))]))),256))])],64))}}),At={class:"flex items-center gap-2"},Ot={class:"font-bold"},Gt={class:"flex"},Ut=["onClick"],Et={class:"text-center"},Lt={key:0,class:"text-center"},Wt={key:0,class:"flex items-center justify-center h-20"},Jt=G({__name:"FeedbackTimeline",props:{id:{},result:{}},setup(s){const p=s,{selectNode:f,selectedIndex:w,firstError:i}=Ae(p.id,p.result),k=ae(()=>_e(p.result.replayed)),l=O(null),x=O([]);return(C,q)=>{const U=be,Y=oe;return a(),B(Y,null,{header:g(()=>[t("div",At,[t("div",Ot,o(C.$t("result")),1),p.result.success===!1?(a(),B(U,{key:0,severity:"danger",onClick:q[0]||(q[0]=S=>e(i)(x.value))},{default:g(()=>[N(o(C.$t("first error")),1)]),_:1})):R("",!0)])]),default:g(()=>[t("div",{ref_key:"scrollContainer",ref:l,class:"flex overflow-auto mb-2"},[(a(!0),r(j,null,X(p.result.feedback,(S,h)=>{var M,E;return a(),r("div",Gt,[t("button",{class:Q(["flex",e(w)===h?"border border-blue-500":""]),onClick:V=>e(f)(h),ref_for:!0,ref:V=>x.value[h]=V},[t("div",Et,[N(o(S.correct?C.$t("correct"):C.$t("incorrect"))+" ",1),m(xe,{message:(M=S.replayed)==null?void 0:M.content,class:Q(["border-4 rounded-md",S.correct?"border-green-500":"border-red-500"])},null,8,["message","class"])]),S.correct?R("",!0):(a(),r("div",Lt,[q[1]||(q[1]=N(o("Expected")+" ")),m(xe,{message:(E=S.expected)==null?void 0:E.content,class:Q(["border-4 rounded-md",S.correct?"border-red-500":"border-green-500"])},null,8,["message","class"])]))],10,Ut),h+1<p.result.feedback.length?(a(),r("div",Wt,"→")):R("",!0)])}),256))],512),q[2]||(q[2]=N(" Input used: ")),m(zt,{inputs:k.value},null,8,["inputs"])]),_:1})}}}),Kt={class:"flex overflow-auto mb-2"},Ht={class:"flex"},Qt={class:"text-center"},Xt={key:0,class:"flex items-center justify-center h-12"},ye=G({__name:"TestDataTimeline",props:{data:{}},setup(s){const p=ae(()=>_e(s.data));return(f,w)=>{const i=oe;return a(),B(i,{header:"Expected"},{default:g(()=>[t("div",Kt,[(a(!0),r(j,null,X(f.data,(k,l)=>(a(),r("div",Ht,[t("div",Qt,[m(e(Je),{message:k.content,class:"border-4 border-blue-500"},null,8,["message"])]),l+1<f.data.length?(a(),r("div",Xt,"→")):R("",!0)]))),256))]),w[0]||(w[0]=N(" Inputs: ")),m(e(Ke),{inputs:p.value},null,8,["inputs"])]),_:1})}}}),Yt={class:"h-full flex flex-col"},Zt={class:"p-4"},es={class:"flex w-full gap-1"},ts={class:"material-icons"},ss={class:"material-icons"},os={class:"material-icons"},as={class:"material-icons"},ns={class:"material-icons"},ls={class:"flex flex-col gap-2 m-2 h-full overflow-auto"},rs={class:"flex gap-2 w-full"},cs=["for"],is={class:"material-icons"},ds={class:"material-icons"},us=G({__name:"TesterControls",props:{id:{}},setup(s){const p=s,f=De(),w=Re(),i=et(),k=ce(i),l=O(null),x=O([]);Ve(async()=>{const c=Ne();try{const n=c.params.lesson_id;if(!k.lesson.value||k.lesson.value.id!=n){const{data:d}=await st.getProjectByID(n.toString()),$=await ot(d);i.setLesson($)}const{data:b}=await fe.getStepTranslationByID(c.params.step_id.toString());if(l.value=b,h.value=l.value.content.solution??h.value,V.setCode(h.value),l.value.content.highlights)for(const d of l.value.content.highlights)d.module&&d.slot&&M.newModuleToSlot(d.module,d.slot);l.value&&(l.value.content.tests&&(x.value=await Qe(l.value.content.tests)),l.value.content.includedCommandsForTests=l.value.content.includedCommandsForTests??[...pe])}catch(n){console.log(n)}});async function C(){if(l.value!=null){i.setStepSaving(!0);try{await fe.updateStepTranslationByID(l.value.step,l.value.name,l.value.content)}catch(c){let n="";c instanceof Error?n=c.message:n=String(c),f.add({severity:"error",summary:"Failed to save",detail:n,life:3e3})}finally{i.setStepSaving(!1)}}}const q=at(()=>{C()},1e3,{maxWait:5e3});async function U(c){const n=JSON.stringify(c),b=new Blob([n],{type:"application/json"}),d=new FormData;d.append("file",b,"default.test.json");const{data:$}=await H.uploadFile(d,"tests1");return $.source_url}async function Y(){if(l.value==null)return;let c="";try{c=await U(T.value)}catch(n){f.add({severity:"error",summary:n.response.data.error,life:2e3});return}l.value.content.tests?l.value.content.tests.push({name:"",url:c}):(l.value.content.tests=[],l.value.content.tests.push({name:"",url:c})),x.value.push({data:T.value,test:{name:"",url:c}}),T.value=[],C()}function S(c){w.require({message:"Are you sure you want to Delete?",header:"Confirmation",icon:"pi pi-exclamation-triangle",rejectProps:{label:"Cancel",severity:"secondary",outlined:!0},acceptProps:{label:"Delete",severity:"danger"},accept:async()=>{var n,b;try{const d=x.value[c].test.url;await H.deleteFile(d),(b=(n=l.value)==null?void 0:n.content.tests)==null||b.splice(c,1),x.value.splice(c,1),C()}catch(d){f.add({severity:"error",summary:d.response.data.error,life:2e3})}}})}const{fileContent:h}=ce(He()),M=Oe(p.id),E=Ge(p.id),V=Ue(p.id),ne=Ee(p.id),v=Le(E,E.write,ne.writeText,ne.clearDisplay,M.setPin,M.getPin,M.getI2C),{isLoading:_,isRunning:le}=v;M.addNeededModules([]);const T=O(ve),we=O(ve);ie(V.code,c=>{typeof c=="string"&&c!==h.value&&(h.value=c,l.value&&(l.value.content.solution=c))});function ke(){v.recorder.start();const c=typeof V.code.value=="string"?V.code.value:"";v.run(c);const n=ie(v.recorder.state,()=>{(v.replayer.state.value==ee.Finish||v.replayer.state.value==ee.Timeout)&&(v.recorder.stop(),T.value=v.recorder.getRecords()),n.stop()})}function $e(){v.replayer.state.value==ee.Continue?(v.recorder.stop(),v.replayer.stop(),we.value=v.recorder.getRecords()):(v.recorder.stop(),T.value=v.recorder.getRecords()),v.stop()}function K(){var c;return((c=l.value)==null?void 0:c.content.includedCommandsForTests)??pe}const Ce=async()=>{if(!(!l.value||!l.value.content.tests)){I.value=!0;for(const[c,n]of x.value.entries()){const b=await ge(v,h.value,n.data,K());await v.stopPromise();const d=l.value.content.tests[c].url,$=await U(b);l.value.content.tests[c].url=$,x.value[c].test.url=$,x.value[c].data=b;try{await H.deleteFile(d)}catch(L){f.add({severity:"error",summary:L.response.data.error,life:2e3})}}await C(),I.value=!1}},Pe=async(c,n)=>{if(!l.value||!l.value.content.tests)return;I.value=!0;const b=await ge(v,h.value,c.data,K());await v.stopPromise();const d=l.value.content.tests[n].url,$=await U(b);l.value.content.tests[n].url=$,x.value[n].test.url=$,x.value[n].data=b,C();try{await H.deleteFile(d)}catch(L){f.add({severity:"error",summary:L.response.data.error,life:2e3})}I.value=!1};return(c,n)=>{const b=Be,d=be,$=Me,L=Fe,qe=oe;return a(),r("div",Yt,[t("div",Zt,[n[4]||(n[4]=N(" Include Commands: ")),l.value?(a(),B(b,{key:0,onChange:e(q),modelValue:l.value.content.includedCommandsForTests,"onUpdate:modelValue":n[0]||(n[0]=y=>l.value.content.includedCommandsForTests=y),options:We,filter:"",placeholder:"Select commands",class:"w-full md:w-80 mb-2 mt-1",maxSelectedLabels:3},null,8,["onChange","modelValue","options"])):R("",!0),t("div",es,[m(d,{type:"button",class:"w-9 h-9",severity:"success",rounded:"",onClick:ke,disabled:e(_)||e(le)},{default:g(()=>[t("span",ts,o(e(_)?"hourglass_top":"play_arrow"),1)]),_:1},8,["disabled"]),m(d,{type:"button",class:"w-9 h-9",severity:"danger",rounded:"",onClick:$e,disabled:e(_)||!e(le)},{default:g(()=>[t("span",ss,o(e(_)?"hourglass_top":"stop"),1)]),_:1},8,["disabled"]),m(d,{type:"button",class:"w-9 h-9",severity:"info",rounded:"",onClick:n[1]||(n[1]=y=>Y()),disabled:T.value.length<=0||l.value==null},{default:g(()=>[t("span",os,o(e(_)?"hourglass_top":"save"),1)]),_:1},8,["disabled"]),m(d,{type:"button",class:"w-9 h-9",severity:"info",rounded:"",onClick:n[2]||(n[2]=y=>e(Xe)(e(v),e(h),x.value,K())),disabled:e(_)||e(I)},{default:g(()=>[t("span",as,o(e(_)?"hourglass_top":"bug_report"),1)]),_:1},8,["disabled"]),m(d,{type:"button",class:"w-9 h-9",rounded:"",onClick:n[3]||(n[3]=y=>Ce()),disabled:e(_)||!x.value||e(I)},{default:g(()=>[t("span",ns,o(e(_)?"hourglass_top":"restart_alt"),1)]),_:1},8,["disabled"]),m(tt)])]),T.value.length>0?(a(),B(ye,{key:0,data:T.value,class:"mt-2"},null,8,["data"])):R("",!0),t("div",ls,[(a(!0),r(j,null,X(x.value,(y,W)=>{var re;return a(),B(qe,{toggleable:"",key:y.test.url,class:Q(["border-4",e(Ze)((re=y.result)==null?void 0:re.success)])},{header:g(()=>[t("div",rs,[m(L,{variant:"on",class:"w-full"},{default:g(()=>[t("label",{for:`name ${W+1}`},"Test "+o(W+1),9,cs),m($,{id:`name ${W+1}`,onInput:e(q),modelValue:y.test.name,"onUpdate:modelValue":J=>y.test.name=J,class:"w-full",size:"small"},null,8,["id","onInput","modelValue","onUpdate:modelValue"])]),_:2},1024),m(d,{type:"button",class:"w-9 h-9",severity:"info",rounded:"",onClick:J=>e(Ye)(e(v),e(h),y,K()),disabled:e(_)||e(I)},{default:g(()=>[t("span",is,o(e(_)?"hourglass_top":"bug_report"),1)]),_:2},1032,["onClick","disabled"]),m(d,{type:"button",class:"w-9 h-9",severity:"danger",rounded:"",onClick:J=>S(W)},{default:g(()=>n[5]||(n[5]=[t("span",{class:"material-icons"},o("delete_forever"),-1)])),_:2},1032,["onClick"]),m(d,{type:"button",class:"w-9 h-9",rounded:"",onClick:J=>Pe(y,W),disabled:e(_)||!x.value||e(I)},{default:g(()=>[t("span",ds,o(e(_)?"hourglass_top":"restart_alt"),1)]),_:2},1032,["onClick","disabled"]),m(d,{type:"button",class:"w-9 h-9",severity:"warn",rounded:"",onClick:J=>y.result=void 0,disabled:!x.value||e(I)},{default:g(()=>n[6]||(n[6]=[t("span",{class:"material-icons"}," cleaning_services ",-1)])),_:2},1032,["onClick","disabled"])])]),default:g(()=>[m(ye,{data:y.data,class:"mt-2"},null,8,["data"]),y.result?(a(),B(Jt,{key:0,result:y.result,id:p.id},null,8,["result","id"])):R("",!0)]),_:2},1032,["class"])}),128))])])}}}),ms={class:"flex bg-surface-0",style:{height:"calc(100vh - 52px)"}},he="tester",Js=G({__name:"TesterView",setup(s){return(p,f)=>{const w=Se,i=Te;return a(),r(j,null,[m(Ie),t("div",ms,[m(i,{class:"w-full rounded-none"},{default:g(()=>[m(w,{size:50,minSize:10,class:"h-full"},{default:g(()=>[m(us,{id:he})]),_:1}),m(w,{size:67,minSize:10,class:"w-full h-full"},{default:g(()=>[m(e(nt),{id:he,class:"w-full h-full",horizontal:!1})]),_:1})]),_:1})])],64)}}});export{Js as default};
