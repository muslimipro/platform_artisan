import{s as oe}from"./index-BqbdjUlk.js";import{a as se,U as re,u as le,R as ae,Q as ne,s as ie,r as l,o as ue,E as de,c as G,b as a,e as u,f as n,h as c,w as v,g as C,K as H,F as L,k as $,i as I,l as pe,C as ce,m as me}from"./index-n3daKGCc.js";import{s as fe}from"./index-BDWHL-kk.js";import{s as ve}from"./index-Gwbo46K_.js";import{s as ge,a as ye}from"./index-D-Z5GZGB.js";import{s as he}from"./index-c-XKspjc.js";import{_ as we}from"./AHeader.vue_vue_type_script_setup_true_lang-DwbVwjwX.js";import{_ as q}from"./ProjectCard.vue_vue_type_script_setup_true_lang-C9VZAUVu.js";import{a as P}from"./index-CV0mxHXi.js";import{u as _e}from"./editor-store-Yih_evRb.js";import{t as z}from"./types-81Qs7ZwA.js";import{u as be,m as xe}from"./useSortable-DxtzBs2C.js";import"./index-ChwKPPkr.js";import"./index-BTdhpGXM.js";import"./index-C9Jq8BwU.js";import"./index-Uwvuv9oP.js";import"./index-DvRfzZCT.js";import"./index-BRSnIgLR.js";import"./index-eM3voxb6.js";import"./index-Cxe1QBz0.js";import"./logo-D1-3uCnC.js";import"./StudentViewToggle.vue_vue_type_script_setup_true_lang-DQygniFN.js";import"./index-xAwojxg2.js";import"./index-DKyGrjq1.js";import"./index-DHuZLmic.js";import"./index-D57r3cjp.js";import"./index-B39dc3Cm.js";import"./http-BEt-6spR.js";import"./profile-CU0o5RSC.js";import"./index-D4py3QaC.js";import"./index-Bx3v-khi.js";import"./index-BK3uw03o.js";import"./pibody-BwAjMvHk.js";import"./v4-CmTdKEVZ.js";import"./sortable.esm-FZSyJVGy.js";const je={class:"flex flex-col min-h-screen bg-slate-50"},Ve={class:"flex items-center py-4 px-4 sm:px-12 gap-8"},ke={class:"flex-grow flex flex-col gap-1 sm:gap-4 bg-slate-50"},Ce={class:"relative flex flex-col justify-between w-[500px] min-h-28 bg-purple-100 border border-gray-100 rounded-3xl p-2 gap-2 shadow-md shadow-purple-300"},Le={class:"absolute right-5 bottom-5"},$e={key:0,class:"flex flex-col sm:flex-row gap-1 sm:gap-4 bg-slate-50 py-0 px-4 sm:px-12 items-end justify-end"},Ie={key:1,class:"border border-dashed rounded-xl border-green-400 overflow-hidden"},Pe={key:0,class:"flex flex-wrap justify-center gap-8 px-4 sm:px-12 pb-8 pt-4"},mt=se({__name:"ProjectsView",setup(Se){const S=re("el"),T=le(),{locale:K}=ae(),U=pe(),O=_e(),{addLesson:Q}=O,J=ne(),{user:B}=ie(J),m=l([]),b=l([]),x=l([]),E=l([0,0,0,0,0,0]),M=l([0,0,0,0,0,0]),g=l(!1),y=l(!1),j=l("");be(S,m,{onUpdate:t=>{xe(m.value,t.oldIndex,t.newIndex,t),ce(async()=>{const e=[];m.value.map(o=>{const i=parseInt(o.id,10);e.push(i)});try{const{data:o}=await P.changeProjectsOrder(e);T.add({severity:"success",summary:o.message,life:2e3})}catch(o){T.add({severity:"error",summary:o.response.data.error,detail:o,life:2e3})}})}});async function h(){if(!g.value){g.value=!0;try{const{data:t}=await P.getProjects();m.value=[],b.value=[],x.value=[],E.value=[0,0,0,0,0,0],M.value=[0,0,0,0,0,0];for(const e of t)e.lego||(e.is_guidable?E.value[e.layer]++:M.value[e.layer]++);for(const e of t){if(e.lego)continue;const o=await z(e);if(e.layer==0){m.value.push(o);const i=o.creator_name??o.created_by;!V.value.includes(i)&&i.length>0&&V.value.push(o.creator_name??o.created_by)}o.is_guidable?b.value.push(o):x.value.push(o)}}catch(t){console.log(t)}finally{g.value=!1}}}ue(h),de(K,h);async function W(){y.value=!0;try{const{data:t}=await P.createProject(),e=await z(t);Q(e),U.push(`/project/${e.id}/edit`)}catch(t){console.log(t)}finally{y.value=!1}}const X=G(()=>{var i,f;const t=new Map,e=new Map;for(const s of b.value)t.has(s.layer)||t.set(s.layer,[]),t.get(s.layer).push(s);for(const s of x.value)e.has(s.layer)||e.set(s.layer,[]),e.get(s.layer).push(s);const o=[];return o.push({id:0,guided:((i=t.get(0))==null?void 0:i.filter(s=>(!p.value.length||p.value.includes(k(s.level)))&&(!d.value||s.title.toLowerCase().includes(d.value.toLowerCase()))))||[],unguided:((f=e.get(0))==null?void 0:f.filter(s=>(!p.value.length||p.value.includes(k(s.level)))&&(!d.value||s.title.toLowerCase().includes(d.value.toLowerCase()))))||[]}),o}),Y=G(()=>m.value.filter(t=>(!_.value.length||_.value.includes(t.creator_name??t.created_by))&&(!w.value.length||w.value.includes(t.stage))&&(!p.value.length||p.value.includes(k(t.level)))&&(!d.value||t.title.toLowerCase().includes(d.value.toLowerCase())))),d=l(""),p=l(""),Z=l(["Easy","Medium","Hard"]),w=l(""),D=l(["prepare_for_submission","waiting_for_review","in_review","rejected","ready_for_publish","published","in_modify"]),_=l(""),V=l([]);function k(t){return t==0?"":t<3?"Easy":t<5?"Medium":t==5?"Hard":""}return(t,e)=>{var A,N;const o=ge,i=he,f=ye,s=ve,ee=fe,R=me,te=oe;return a(),u("div",je,[n(we,{class:"sticky top-0 z-10 mb-4"}),c("div",Ve,[c("div",ke,[n(f,{class:"min-w-60"},{default:v(()=>[n(o,{class:"text-primary border-gray-100"},{default:v(()=>e[6]||(e[6]=[c("i",{class:"pi pi-search"},null,-1)])),_:1}),n(i,{type:"text",modelValue:d.value,"onUpdate:modelValue":e[0]||(e[0]=r=>d.value=r),placeholder:t.$t("pages.projects.search"),variant:"filled",class:"h-fit bg-white border-gray-100 shadow-none"},null,8,["modelValue","placeholder"])]),_:1}),n(f,{class:"min-w-60"},{default:v(()=>[n(o,{class:"text-primary border-gray-100"},{default:v(()=>e[7]||(e[7]=[c("i",{class:"pi pi-filter"},null,-1)])),_:1}),n(s,{modelValue:p.value,"onUpdate:modelValue":e[1]||(e[1]=r=>p.value=r),options:Z.value,placeholder:t.$t("pages.projects.filterByLevel"),display:"chip",variant:"filled",class:"bg-white min-w-0 lg:min-w-80 border-gray-100 shadow-none"},null,8,["modelValue","options","placeholder"])]),_:1})]),c("div",Ce,[n(ee,{modelValue:j.value,"onUpdate:modelValue":e[2]||(e[2]=r=>j.value=r),placeholder:"Я хочу сделать ...",variant:"filled",rows:"5",cols:"30",class:"bg-purple-50 w-full rounded-2xl h-28"},null,8,["modelValue"]),c("div",Le,[n(R,{label:"Получить план",severity:"help",class:"rounded-2xl bg-purple-400 border border-purple-400",onClick:e[3]||(e[3]=r=>C(U).push({name:"creator",query:{message:j.value}}))})])])]),["editor","contributor"].includes(((A=C(B))==null?void 0:A.user_type)??"")?(a(),u("div",$e,[n(s,{modelValue:w.value,"onUpdate:modelValue":e[4]||(e[4]=r=>w.value=r),options:D.value,placeholder:"Select stage",display:"chip",variant:"filled",class:"bg-white min-w-0 lg:min-w-80 border-gray-100 shadow-none"},null,8,["modelValue","options"]),n(s,{modelValue:_.value,"onUpdate:modelValue":e[5]||(e[5]=r=>_.value=r),options:V.value,placeholder:"Select creator",display:"chip",variant:"filled",class:"bg-white min-w-0 lg:min-w-80 border-gray-100 shadow-none"},null,8,["modelValue","options"])])):H("",!0),["editor","contributor"].includes(((N=C(B))==null?void 0:N.user_type)??"")?(a(),u("div",{key:1,ref_key:"el",ref:S,class:"flex flex-wrap justify-center gap-8 px-4 sm:px-12 pb-8 pt-4"},[(a(!0),u(L,null,$(Y.value,r=>(a(),I(q,{key:r.id,project:r,onAfterRemove:h},null,8,["project"]))),128)),g.value?(a(),I(te,{key:0})):(a(),u("div",Ie,[n(R,{variant:"text",style:{width:"300px",height:"234px"},class:"bg-green-50",onClick:W,loading:y.value,disabled:y.value},{icon:v(()=>e[8]||(e[8]=[c("i",{class:"pi pi-plus text-3xl"},null,-1)])),_:1},8,["loading","disabled"])]))],512)):(a(!0),u(L,{key:2},$(X.value,r=>(a(),u("div",{key:r.id,class:"flex flex-col gap-2"},[r.unguided.length>0?(a(),u("div",Pe,[(a(!0),u(L,null,$(r.unguided,F=>(a(),I(q,{key:F.id,project:F,onAfterRemove:h},null,8,["project"]))),128))])):H("",!0)]))),128))])}}});export{mt as default};
