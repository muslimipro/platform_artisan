import{d as Z,u as I,r as h,G as ee,I as L,m as te,o,c as n,b as se,e as r,t as d,j as g,F as v,i as D,C as S,h as $,D as j}from"./index-CzSOBzMf.js";import{h as C}from"./index-vq9KqxT3.js";import{_ as ae}from"./AHeader.vue_vue_type_script_setup_true_lang-Ez6e2ciX.js";import"./logo-DOVQBN0O.js";import"./index-D_qJJHtk.js";import"./LocaleSwitcher.vue_vue_type_script_setup_true_lang-BoNEDSNx.js";import"./index-BLxi64Y2.js";import"./index-DGyM8AsC.js";import"./index-DTQp-zAo.js";import"./index-BfOAvlfV.js";import"./index-Z26c4h7H.js";import"./StudentViewToggle.vue_vue_type_script_setup_true_lang-DKaSDWfw.js";import"./index-ZW_N6k_8.js";import"./index-BXrpJlkX.js";import"./index-C2IpVnMo.js";import"./profile-CeTrgZbw.js";import"./index-CuFuuspi.js";const T={fetchAllBookings:oe,fetchStudentBookings:ne,bookSlot:re,cancelBooking:le,fetchAll:de,fetchMine:ie};async function oe(){const{data:p}=await C.get("/v2/booking");return p}async function ne(p){const{data:f}=await C.get(`/v2/booking/list/student/${p}`);return f}async function re(p){return C.post(`/v2/booking/${p}/student`)}async function le(p){return C.delete(`/v2/booking/${p}/student`)}async function de(){return await C.get("/v2/booking")}async function ie(){return await C.get("/v2/booking/list/student")}const ce={class:"flex flex-col min-h-screen bg-slate-50 gap-6"},ue={class:"flex-grow flex flex-col content-start gap-4 bg-slate-50 px-10 mb-6"},ge={class:"p-6"},ye={class:"text-2xl font-bold mb-4"},pe={class:"hidden md:flex items-center justify-center gap-4 mb-4"},_e={class:"font-semibold text-lg"},ve={class:"md:hidden flex items-center justify-center gap-4 mb-4"},he={class:"font-semibold text-lg"},fe={class:"max-w-6xl mx-auto flex flex-col items-center"},me={class:"hidden md:block overflow-x-auto w-full relative"},xe={class:"min-w-full text-center border border-slate-300"},ke={class:"text-xs text-slate-500"},be={class:"px-2 py-1 font-semibold bg-slate-50 sticky left-0 z-10 border border-slate-300"},we={key:0,class:"text-gray-400"},De={key:0},Se={class:"text-xs font-bold"},$e={key:0,class:"text-xs text-emerald-700 mt-1"},Ce={key:1,class:"text-xs text-emerald-700 mt-1"},Be={class:"flex gap-1 mt-1"},Le=["disabled","onClick"],Me={key:0},ze={key:1},Ae=["disabled","onClick"],Ee={key:0},We={key:1},je={key:1,class:"text-gray-300 text-xs"},Te={class:"md:hidden w-full"},Fe={class:"w-full text-center border border-slate-300"},Ve={class:"text-xs text-slate-500"},Ne={class:"px-2 py-1 font-semibold bg-slate-50 sticky left-0 z-10 border border-slate-300"},Ye={key:0,class:"text-gray-400"},Ge={key:0},Pe={class:"text-xs font-bold"},Re={key:0,class:"text-xs text-emerald-700 mt-1"},qe={key:1,class:"text-xs text-emerald-700 mt-1"},He={class:"flex gap-1 mt-1"},Je=["disabled","onClick"],Ke={key:0},Oe={key:1},Qe=["disabled","onClick"],Ue={key:0},Xe={key:1},Ze={key:1,class:"text-gray-300 text-xs"},ht=Z({__name:"StudentScheduleView",setup(p){const f=I(),M=h([]),N=h([]),z=h(!1),m=h({}),x=h({}),{t:i}=ee();function q(s){const a=new Date(s),t=a.getDay(),e=a.getDate()-(t+6)%7;return new Date(a.setDate(e))}const B=h(q(new Date)),c=h(0);function A(s){const a=new Date(B.value);a.setDate(B.value.getDate()+s*7),B.value=a}function H(){A(-1)}function J(){A(1)}function K(){c.value>0?c.value--:(A(-1),c.value=6)}function O(){c.value<6?c.value++:(A(1),c.value=0)}const u=L(()=>{const s=[];for(let a=0;a<7;a++){const t=new Date(B.value);t.setDate(B.value.getDate()+a),s.push({date:t,label:i(`pages.schedule.weekDay${a+1}`),dateLabel:`${t.getDate().toString().padStart(2,"0")}.${(t.getMonth()+1).toString().padStart(2,"0")}`})}return s}),Q=L(()=>{const s=u.value[0].date,a=u.value[6].date;return`${s.getDate().toString().padStart(2,"0")}.${(s.getMonth()+1).toString().padStart(2,"0")} - ${a.getDate().toString().padStart(2,"0")}.${(a.getMonth()+1).toString().padStart(2,"0")}`}),U=L(()=>{const s=u.value[c.value];return`${s.label}, ${s.dateLabel}`}),Y=L(()=>{const s=new Date,a=u.value[c.value].date;return E(s,a)}),G=L(()=>{const s=u.value[0].date,a=u.value[6].date,t=new Set;return M.value.forEach(e=>{const w=new Date(e.starts_at);if(w>=s&&w<=a){const l=k(e.starts_at);t.add(l)}}),t.size===0&&t.add("09:00"),Array.from(t).sort()});function E(s,a){const t=new Date(s);return t.getFullYear()===a.getFullYear()&&t.getMonth()===a.getMonth()&&t.getDate()===a.getDate()}function W(s,a){return M.value.filter(t=>{const e=new Date(t.starts_at);return E(e,s)&&k(t.starts_at)===a})}function k(s){return new Date(s).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1})}function _(s){const a=M.value.find(t=>t.id===s);return a&&a.my_class===!0?!0:N.value.some(t=>t.booking_id===s)}function y(s){return s.active===!1}function b(s){return new Date(s.starts_at)<new Date}async function F(){var s,a;z.value=!0;try{const{data:t}=await T.fetchAll();M.value=t}catch(t){f.add({severity:"error",summary:((a=(s=t==null?void 0:t.response)==null?void 0:s.data)==null?void 0:a.error)||"Error",life:2e3})}finally{z.value=!1}}async function V(){const{data:s}=await T.fetchMine();N.value=s??[]}te(async()=>{await F(),await V()});async function P(s){var a,t;m.value[s]=!0;try{const{data:e}=await T.bookSlot(s);await F(),await V(),f.add({severity:"success",summary:e.message,life:2e3})}catch(e){f.add({severity:"error",summary:((t=(a=e==null?void 0:e.response)==null?void 0:a.data)==null?void 0:t.error)||"Error",life:2e3})}finally{m.value[s]=!1}}async function R(s){var a,t;x.value[s]=!0;try{await T.cancelBooking(s),await F(),await V()}catch(e){f.add({severity:"error",summary:((t=(a=e==null?void 0:e.response)==null?void 0:a.data)==null?void 0:t.error)||"Error",life:2e3})}finally{x.value[s]=!1}}return(s,a)=>(o(),n("div",ce,[se(ae,{class:"sticky top-0 z-10"}),r("div",ue,[r("div",ge,[r("h2",ye,d(g(i)("pages.teacher.schedule")),1),r("div",pe,[r("button",{onClick:H,class:"px-3 py-1 rounded bg-slate-200 hover:bg-slate-300 text-sm"},d(g(i)("pages.schedule.prevWeek")),1),r("span",_e,d(Q.value),1),r("button",{onClick:J,class:"px-3 py-1 rounded bg-slate-200 hover:bg-slate-300 text-sm"},d(g(i)("pages.schedule.nextWeek")),1)]),r("div",ve,[r("button",{onClick:K,class:"px-3 py-1 rounded bg-slate-200 hover:bg-slate-300 text-sm"},"←"),r("span",he,d(U.value),1),r("button",{onClick:O,class:"px-3 py-1 rounded bg-slate-200 hover:bg-slate-300 text-sm"},"→")]),r("div",fe,[r("div",me,[r("table",xe,[r("thead",null,[r("tr",null,[a[0]||(a[0]=r("th",{class:"px-2 py-1 bg-slate-100 sticky left-0 z-10 border border-slate-300"},null,-1)),(o(!0),n(v,null,D(u.value,(t,e)=>(o(),n("th",{key:e,class:S(["px-2 py-1 border border-slate-300",E(t.date,new Date)?"bg-green-100":"bg-slate-100"])},[r("div",null,d(t.label),1),r("div",ke,d(t.dateLabel),1)],2))),128))])]),r("tbody",null,[(o(!0),n(v,null,D(G.value,t=>(o(),n("tr",{key:t},[r("td",be,d(t),1),(o(!0),n(v,null,D(u.value,(e,w)=>(o(),n("td",{key:w,class:S(["px-1 py-1 min-w-[120px] border border-slate-300",E(e.date,new Date)?"bg-green-50":""])},[z.value?(o(),n("div",we)):(o(),n(v,{key:1},[W(e.date,t).length?(o(),n("div",De,[(o(!0),n(v,null,D(W(e.date,t),l=>(o(),n("div",{key:l.id,class:S(["mb-1 p-1 rounded flex flex-col items-center justify-center",[y(l)?"bg-red-100 border-red-300":l.my_class===!0?"bg-orange-100 border-orange-300":_(l.id)?"bg-blue-100 border-blue-300":b(l)?"bg-gray-100 border-gray-300":"bg-emerald-50 border-emerald-200"]])},[r("span",Se,d(k(l.starts_at))+"-"+d(k(l.ends_at))+" ("+d(l.count)+"/"+d(l.max_count)+") ",1),l.my_class===!0&&!y(l)?(o(),n("div",$e,d(g(i)("pages.schedule.fixedLesson")),1)):$("",!0),_(l.id)&&!y(l)&&l.my_class!==!0?(o(),n("div",Ce,d(g(i)("pages.schedule.freeLesson")),1)):$("",!0),r("div",Be,[!_(l.id)&&l.count<l.max_count&&!b(l)&&!y(l)?(o(),n("button",{key:0,type:"button",class:"px-2 py-1 rounded bg-emerald-500 text-white hover:bg-emerald-600 text-xs",disabled:m.value[l.id],onClick:j(X=>P(l.id),["stop"])},[m.value[l.id]?(o(),n("span",Me,"...")):(o(),n("span",ze,d(g(i)("pages.schedule.bookSlot")),1))],8,Le)):l.my_class!==!0&&_(l.id)&&!b(l)&&!y(l)?(o(),n("button",{key:1,type:"button",class:"px-2 py-1 rounded bg-red-500 text-white hover:bg-red-600 text-xs",disabled:x.value[l.id],onClick:j(X=>R(l.id),["stop"])},[x.value[l.id]?(o(),n("span",Ee,"...")):(o(),n("span",We,d(g(i)("pages.schedule.cancelBooking")),1))],8,Ae)):$("",!0)])],2))),128))])):(o(),n("div",je,"—"))],64))],2))),128))]))),128))])])]),r("div",Te,[r("table",Fe,[r("thead",null,[r("tr",null,[a[1]||(a[1]=r("th",{class:"px-2 py-1 bg-slate-100 sticky left-0 z-10 w-1/5 border border-slate-300"},null,-1)),r("th",{class:S(["px-2 py-1 border border-slate-300",Y.value?"bg-green-100":"bg-slate-100"])},[r("div",null,d(u.value[c.value].label),1),r("div",Ve,d(u.value[c.value].dateLabel),1)],2)])]),r("tbody",null,[(o(!0),n(v,null,D(G.value,t=>(o(),n("tr",{key:t},[r("td",Ne,d(t),1),r("td",{class:S(["px-1 py-1 border border-slate-300",Y.value?"bg-green-50":""])},[z.value?(o(),n("div",Ye)):(o(),n(v,{key:1},[W(u.value[c.value].date,t).length?(o(),n("div",Ge,[(o(!0),n(v,null,D(W(u.value[c.value].date,t),e=>(o(),n("div",{key:e.id,class:S(["mb-2 p-2 rounded flex flex-col items-center justify-center",[y(e)?"bg-red-100 border-red-300":e.my_class===!0?"bg-orange-100 border-orange-300":_(e.id)?"bg-blue-100 border-blue-300":b(e)?"bg-gray-100 border-gray-300":"bg-emerald-50 border-emerald-200"]])},[r("span",Pe,d(k(e.starts_at))+"-"+d(k(e.ends_at))+" ("+d(e.count)+"/"+d(e.max_count)+") ",1),e.my_class===!0&&!y(e)?(o(),n("div",Re,d(g(i)("pages.schedule.fixedLesson")),1)):$("",!0),_(e.id)&&!y(e)&&e.my_class!==!0?(o(),n("div",qe,d(g(i)("pages.schedule.freeLesson")),1)):$("",!0),r("div",He,[!_(e.id)&&e.count<e.max_count&&!b(e)&&!y(e)?(o(),n("button",{key:0,type:"button",class:"px-2 py-1 rounded bg-emerald-500 text-white hover:bg-emerald-600 text-xs",disabled:m.value[e.id],onClick:j(w=>P(e.id),["stop"])},[m.value[e.id]?(o(),n("span",Ke,"...")):(o(),n("span",Oe,d(g(i)("pages.schedule.bookSlot")),1))],8,Je)):e.my_class!==!0&&_(e.id)&&!b(e)&&!y(e)?(o(),n("button",{key:1,type:"button",class:"px-2 py-1 rounded bg-red-500 text-white hover:bg-red-600 text-xs",disabled:x.value[e.id],onClick:j(w=>R(e.id),["stop"])},[x.value[e.id]?(o(),n("span",Ue,"...")):(o(),n("span",Xe,d(g(i)("pages.schedule.cancelBooking")),1))],8,Qe)):$("",!0)])],2))),128))])):(o(),n("div",Ze,"—"))],64))],2)]))),128))])])])])])])]))}});export{ht as default};
