import{a as ce}from"./index-CDW3YHqF.js";import{aR as pe,ar as de,ag as fe,i as me,ae as q,h as g,q as E,d as S,o as u,c as d,F as x,n as L,k as V,a as v,m as z,r as ve,t as b,b as w,w as _e,l as he,aH as ge,aG as ye,A as be,f as xe,u as Q}from"./index-BGP5ab1p.js";import{s as we}from"./index-BI8xQpGf.js";import{_ as Se}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{s as $e}from"./index-DWeT7mpX.js";import{b as ke}from"./types-CFhifhSG.js";import{s as Ce}from"./logo-D04MFuCJ.js";import{j as Ae,k as Ve,n as Pe}from"./index-B5zHbzn-.js";import{h as P}from"./index-VH44t3q_.js";const Be={submitStep:Ee,getStudentProjectStepsByID:Ie,getStudentStepTranslationByID:Me,resetStepsProgress:Le,saveStudentStepStateByID:je};async function Ie(t){try{return await P.get(`/student/project/${t}/steps`)}catch(s){throw console.log(s),s}}async function Me(t,s){try{return await P.get(`/student/step/${t}/language/${s}`)}catch(l){throw console.log(l),l}}async function je(t,s,l){try{return await P.put(`/student/step/${t.id}/language/${s}/save`,l)}catch(a){throw console.log(a),a}}async function Ee(t,s,l){try{return await P.put(`/student/step/${t}/language/${s}`,{student_answer:l})}catch(a){throw console.log(a),a}}async function Le(t){try{return await P.delete(`/project/${t}/reset`)}catch(s){throw console.log(s),s}}async function Re(t,s){const{data:l}=await Be.getStudentStepTranslationByID(t.id.toString(),s),a=l;return{id:t.id.toString(),title:a.name,type:t.step_type,progress:t.status,inner:a.content,answer:a.user_answer,state:a.step_state,access_type:t.access_type,accessibility:t.accessibility,skip_submit:t.skip_submit}}const Ne=pe("useLessonStore",()=>{const t=de(),{locale:s}=fe(),l=me(),a=Ae(),{newModuleToSlot:r,clearSlots:i,reset:m}=a,{slots:n,moduleComponents:_,isConnected:$,isLoading:k}=q(a),y=Ve(),{fileContent:R}=q(y),{setCode:C}=y,D=Pe(),{setStdout:J,clear:W}=D,c=g(null),p=g(null),N=g(!1),T=g(!0),I=g(!0),X=E(()=>T.value&&I.value),F=g(!1),G=g(!1),Y=E(()=>R.value);let M=0;function Z(e){e!=null&&(c.value=e)}function O(e){c.value!=null&&(c.value.steps=e,p.value!=null&&H(p.value))}function ee(e){p.value=e}function te(e){c.value==null||p.value==null||(c.value.steps[p.value].progress=e)}function se(e){c.value==null||p.value==null||p.value+1!=c.value.steps.length&&(c.value.steps[p.value+1].accessibility=e)}function ne(e,f){c.value==null||p.value==null||c.value.steps[p.value].inner.options!=null&&(c.value.steps[p.value].inner.options[f].correct=e)}async function H(e){var A,K;if(c.value==null)return;p.value=e;const f=c.value.steps[p.value];if(f.title==""){N.value=!0;const h=await Re({id:f.id,status:f.progress,step_type:f.type,skip_submit:f.skip_submit,access_type:f.access_type,accessibility:f.accessibility},s.value);c.value.steps[e]=h,N.value=!1}const o=c.value.steps[p.value];if(m(),i(),U(),C(""),W(),G.value=!(((A=o.inner.platformActions)==null?void 0:A.includes("hide-ide"))??!1),F.value=!(((K=o.inner.platformActions)==null?void 0:K.includes("hide-sim"))??!1),o.progress=="nothing"&&c.value.is_guidable||t.name=="module"){if(o.inner.platformActions!=null&&o.inner.platformActions!=null&&o.inner.platformActions.length>0)for(const h of o.inner.platformActions){if(h=="code2ide"&&C(o.inner.starting??""),h=="auto-put"&&o.inner.highlights!=null)for(const j of o.inner.highlights)M++,r(j.module,j.slot);h=="auto-run"&&$.value&&!k.value&&(a.run(),l.add({severity:"success",summary:"Run is completed!",detail:"Code has successfully auto run",life:3e3}))}if(o.inner.userActions!=null&&o.inner.userActions!=null&&o.inner.userActions.length>0)for(const h of o.inner.userActions)h=="put-module"&&(T.value=!1,i()),h=="run-code"&&(I.value=!1)}else{if(o.state==null||o.state==null)return;if(o.state.code!=null&&o.state.code!=null&&C(o.state.code),o.state.stdout!=null&&o.state.stdout!=null&&J(o.state.stdout),o.state.slots!=null&&o.state.slots!=null)for(const[h,j]of o.state.slots.entries()){const ue=String.fromCharCode(65+h);r(j,ue)}}}function oe(e){c.value==null||p.value==null||(c.value.steps[p.value].state={code:e.code,stdout:e.stdout,slots:e.slots})}function le(){if(c.value==null||p.value==null)return;const e=c.value.steps[p.value];if(m(),i(),U(),C(""),W(),c.value.steps[p.value].state={code:"",stdout:"",slots:[]},e.inner.platformActions!=null&&e.inner.platformActions!=null&&e.inner.platformActions.length>0)for(const f of e.inner.platformActions){if(f=="code2ide"&&C(e.inner.starting??""),f=="auto-put"&&e.inner.highlights!=null)for(const o of e.inner.highlights)M++,r(o.module,o.slot);f=="auto-run"&&$.value&&!k.value&&(a.run(),l.add({severity:"success",summary:"Run is completed!",detail:"Code has successfully auto run",life:3e3}))}}function re(e,f){const o=(e??"A").charCodeAt(0)-65;n.value[o].class="bg-yellow-200/[0.5] shadow-lg shadow-yellow-500",n.value[o].style={backgroundColor:"rgba(0, 157, 255, 0.26)",boxShadow:"0 0 15px rgb(0, 157, 255)"},_.value.forEach(A=>{A.type==f&&(A.style={animation:"breathing 1s ease-out infinite normal",backgroundColor:"#ff0000",boxShadow:"0 0 15px rgb(0, 157, 255)",borderRadius:"10px"})})}function U(){for(let e=0;e<=5;e++)n.value[e].class="",n.value[e].style="";for(const e of _.value)e.class="",e.style=""}function ae(){I.value=!0}function ie(e,f){M<=0?e===f?l.add({severity:"success",summary:"Correct, good job!",detail:"Module has been put successfully",life:3e3}):l.add({severity:"error",summary:"Wrong!",detail:"Keep trying",life:3e3}):M--}return{lesson:c,stepIndex:p,stepLoading:N,userCode:Y,submitEnabled:X,modulesWerePut:T,codeWasRun:I,simVisible:F,ideVisible:G,setLesson:Z,setSteps:O,setStepIndex:ee,updateStatus:te,updateAccess:se,changeStep:H,runCodePressed:ae,saveOption:ne,lightUp:re,clearSlotsModulesClasses:U,toastModulePut:ie,saveStepStateLocally:oe,restartStep:le}});async function vt(t,s,l){const{data:a}=await ce.getStepTranslationByID(t.id.toString(),s),r=a;return{id:t.id.toString(),title:r.name,type:t.step_type,progress:"nothing",inner:l||r.content.contents==null?{contents:[],modules:[]}:r.content,access_type:t.access_type,skip_submit:t.skip_submit}}const Te={class:"flex flex-col gap-2"},Ue={key:1},qe={key:0,style:{position:"relative",width:"100%",height:"0","padding-bottom":"56.25%"}},ze=["src"],We={key:1,style:{position:"relative","margin-left":"5%",width:"90%",height:"0","padding-bottom":"160%"}},Fe=["src"],B=S({__name:"ContentsView",props:{contents:{}},setup(t){const s=t;function l(a){return a.replace("shorts","embed")}return(a,r)=>{const i=ve("v-md-preview"),m=Ce;return u(),d("div",Te,[(u(!0),d(x,null,L(s.contents,n=>{var _;return u(),d("div",{key:n.id},[n.type=="text"?(u(),V(i,{key:0,text:n.text},null,8,["text"])):n.type=="video"?(u(),d("div",Ue,[(_=n.text)!=null&&_.includes("embed")?(u(),d("div",qe,[v("iframe",{credentialless:"",src:l(n.text),style:{position:"absolute",top:"0",left:"0",width:"100%",height:"100%"},frameborder:"0",allowfullscreen:"",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",referrerpolicy:"strict-origin-when-cross-origin"},null,8,ze),r[0]||(r[0]=v("iframe",null,null,-1))])):(u(),d("div",We,[v("iframe",{credentialless:"",src:l(n.text??""),style:{position:"absolute",top:"0",left:"0",width:"100%",height:"100%"},frameborder:"0",allowfullscreen:"",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",referrerpolicy:"strict-origin-when-cross-origin"},null,8,Fe)]))])):n.type=="image"?(u(),V(m,{key:2,src:n.src,alt:"Image",class:"rounded-xl object-cover h-64"},null,8,["src"])):z("",!0)])}),128))])}}}),Ge={class:"text-[33px] font-semibold mb-4 text-center border-b pb-2"},_t=S({__name:"ArticleStep",props:{step:{},isPreview:{type:Boolean}},setup(t){const s=t;return(l,a)=>(u(),d(x,null,[v("div",Ge,b(s.step.title),1),w(B,{contents:s.step.inner.contents},null,8,["contents"])],64))}}),He={class:"text-[33px] font-semibold mb-4 text-center border-b pb-2"},ht=S({__name:"CodeStep",props:{step:{},isPreview:{type:Boolean}},setup(t){const s=t;return(l,a)=>(u(),d(x,null,[v("div",He,b(s.step.title),1),w(B,{contents:s.step.inner.contents},null,8,["contents"])],64))}}),Ke={class:"flex flex-col gap-4"},Qe={class:"text-[33px] font-semibold mb-4 text-center border-b pb-2"},De={class:"flex w-full justify-between"},Je={class:"flex flex-col gap-2"},Xe={class:"w-40 mb-[29px] border rounded-lg h-[40px] place-items-center bg-white",draggable:"true"},Ye={class:"content-center h-full"},Ze={class:"flex flex-col gap-2"},Oe=S({__name:"MatchStep",props:{step:{},isPreview:{type:Boolean}},setup(t){const s=t,l=E(()=>{var r;return(r=s.step.inner.pairs)==null?void 0:r.map(i=>i.key)}),a=E(()=>{var r;return(r=s.step.inner.pairs)==null?void 0:r.map(i=>i.value)});return(r,i)=>{const m=we;return u(),d("div",Ke,[v("div",Qe,b(s.step.title),1),w(B,{contents:s.step.inner.contents},null,8,["contents"]),v("div",De,[v("div",Je,[(u(!0),d(x,null,L(l.value,n=>(u(),d("div",{key:n,class:"flex flex-col"},[v("div",Xe,[v("div",Ye,b(n),1)])]))),128))]),v("div",Ze,[(u(!0),d(x,null,L(a.value,n=>(u(),d("div",{key:n,class:"flex flex-col"},[i[0]||(i[0]=v("div",{class:"w-40 h-10 border-dashed border-gray-300 rounded-border border-x border-y"},null,-1)),w(m,{size:"small",severity:"warn",variant:"simple",class:"mb-2"},{default:_e(()=>[he(b(n.length>0?n:"..."),1)]),_:2},1024)]))),128))])])])}}}),gt=Se(Oe,[["__scopeId","data-v-265024ce"]]),et={class:"flex flex-col gap-4"},tt={class:"text-[33px] font-semibold mb-4 text-center border-b pb-2"},yt=S({__name:"OpenStep",props:ge({step:{},isPreview:{type:Boolean}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(t){const s=ye(t,"modelValue"),l=t,a=g(null);return(r,i)=>{const m=$e;return u(),d("div",et,[v("div",tt,b(l.step.title),1),w(B,{contents:l.step.inner.contents},null,8,["contents"]),l.isPreview?(u(),V(m,{key:0,type:"text",modelValue:a.value,"onUpdate:modelValue":i[0]||(i[0]=n=>a.value=n),size:"small",placeholder:"Enter your answer"},null,8,["modelValue"])):(u(),V(m,{key:1,type:"text",modelValue:s.value,"onUpdate:modelValue":i[1]||(i[1]=n=>s.value=n),size:"small",placeholder:"Enter your answer"},null,8,["modelValue"]))])}}}),st={class:"flex flex-col gap-4"},nt={key:0,class:"text-[33px] font-semibold mb-4 text-center border-b pb-2"},ot={class:"flex flex-col gap-4 ml-4"},lt=["for"],bt=S({__name:"QuestionStep",props:{step:{},isPreview:{type:Boolean}},setup(t){const s=Ne(),{lesson:l}=q(s),{saveOption:a}=s,r=t,i=g([]);return be([i],()=>{if(!r.isPreview&&!(r.step.inner.options==null||i.value==null))for(const[m,n]of r.step.inner.options.entries())a(i.value.some(_=>_==n.text),m)}),xe(()=>{var m;if(!r.isPreview&&!(r.step.inner.options==null||i.value==null)&&(i.value=[],(m=l.value)!=null&&m.is_guidable&&r.step.answer.question))for(const[n,_]of r.step.inner.options.entries())r.step.answer.question[n]&&i.value.push(_.text)}),(m,n)=>{var $,k;const _=ke;return u(),d("div",st,[($=Q(l))!=null&&$.is_guidable?(u(),d("div",nt,b(r.step.title),1)):z("",!0),(k=Q(l))!=null&&k.is_guidable?(u(),V(B,{key:1,contents:r.step.inner.contents},null,8,["contents"])):z("",!0),v("div",ot,[(u(!0),d(x,null,L(r.step.inner.options,y=>(u(),d("div",{key:y.id,class:"flex items-center gap-2"},[w(_,{modelValue:i.value,"onUpdate:modelValue":n[0]||(n[0]=R=>i.value=R),inputId:y.id,name:"option",value:y.text},null,8,["modelValue","inputId","value"]),v("label",{for:y.id},b(y.text),9,lt)]))),128))])])}}});export{gt as M,_t as _,Be as a,vt as b,ht as c,yt as d,bt as e,Re as t,Ne as u};
