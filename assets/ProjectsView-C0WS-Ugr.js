import{d as L,u as T,aa as M,g as q,ab as N,r as y,a6 as O,o as t,h as u,w as P,b as x,a as d,e as C,t as U,V as A,j as D,s as F,ac as z,f as G,ad as H,l as J,y as K,c,F as b,k,q as Q}from"./index-DxkNwnS6.js";import{s as W}from"./index-DUHCRcVP.js";import{s as X,_ as Y}from"./index-BL4Q1Y7p.js";import{s as Z}from"./index-b5JqTDTC.js";import{s as ee}from"./logo-B1m1Cn2A.js";import{a as $,t as E}from"./types-D2LOaBBR.js";import{P as te}from"./pibody-BwAjMvHk.js";import{u as oe,a as ae,m as se}from"./useSortable-DjgzQkkb.js";import"./LocaleSwitcher.vue_vue_type_script_setup_true_lang-B3ghzxqy.js";import"./index-DnQmsymo.js";import"./http-DDvZJtkB.js";const re={class:"h-[174px] overflow-hidden"},ne={class:"flex justify-between items-center px-4 py-1"},ie={class:"pb-1"},le={class:"flex"},V=L({__name:"ProjectCard",props:{project:{}},emits:["after-remove"],setup(S,{emit:g}){const j=T(),m=M(),R=q(),{user:w}=N(R),i=y(!1),n=S,B=g;function s(){m.require({message:"Are you sure you want to Delete?",header:"Confirmation",icon:"pi pi-exclamation-triangle",rejectProps:{label:"Cancel",severity:"secondary",outlined:!0},acceptProps:{label:"Delete",severity:"danger"},accept:()=>{f()}})}async function f(){i.value=!0;try{await $.deleteProjectByID(n.project.id),B("after-remove")}catch(l){alert(l)}finally{i.value=!1}}function p(){j.push(`/project/${n.project.id}/edit`)}return(l,v)=>{const I=ee,e=Z,o=F,r=X,h=O("RouterLink");return t(),u(h,{to:i.value?"":`/project/${n.project.id}`},{default:P(()=>[x(r,{style:{width:"300px",height:"234px",overflow:"hidden"},class:"p-0",dt:{body:{padding:"0px",gap:"2px"}}},{header:P(()=>[d("div",re,[x(I,{alt:"user header",src:n.project.cover_image.length>0?n.project.cover_image:C(te),class:"animate-fadein animate-once animate-duration-1000 animate-ease-in-out"},null,8,["src"])])]),subtitle:P(()=>{var _,a;return[d("div",ne,[d("div",null,[d("div",ie,U(n.project.title),1),x(e,{"model-value":n.project.level,readonly:""},null,8,["model-value"])]),d("div",le,[((_=C(w))==null?void 0:_.user_type)=="editor"?(t(),u(o,{key:0,icon:"pi pi-pen-to-square",severity:"info",variant:"text",rounded:"","aria-label":"Edit",onClick:A(p,["prevent"])})):D("",!0),((a=C(w))==null?void 0:a.user_type)=="editor"?(t(),u(o,{key:1,icon:"pi pi-trash",severity:"danger",variant:"text",rounded:"","aria-label":"Remove",onClick:A(s,["prevent"]),disabled:i.value,loading:i.value},null,8,["disabled","loading"])):D("",!0)])])]}),_:1})]),_:1},8,["to"])}}}),ce={class:"flex flex-col min-h-screen bg-slate-50"},de={class:"border border-dashed rounded-xl border-green-400 overflow-hidden"},ue={key:1,class:"flex flex-wrap justify-center gap-8 px-12 py-6"},be=L({__name:"ProjectsView",setup(S){const g=z("el"),j=G(),{locale:m}=H(),R=T(),w=oe(),{addLesson:i}=w,n=q(),{user:B}=N(n),s=y([]),f=y(0),p=y(!1),l=y(!1);ae(g,s,{onUpdate:e=>{se(s.value,e.oldIndex,e.newIndex,e),Q(async()=>{const o=[];s.value.map(r=>{const h=parseInt(r.id,10);o.push(h)});try{await $.changeProjectsOrder(o),j.add({severity:"success",summary:"Projects order saved!",life:2e3})}catch(r){j.add({severity:"error",summary:"Order set error!",detail:r,life:2e3})}})}});async function v(){if(!p.value){p.value=!0;try{const{data:e}=await $.getProjects();p.value=!1,s.value=[],f.value=e.length;for(const o of e){const r=await E(o,m.value);s.value.push(r)}}catch(e){alert(e)}finally{p.value=!1}}}J(v),K(m,v);async function I(){l.value=!0;try{const{data:e}=await $.createProject(),o=await E(e,m.value);i(o),R.push(`/project/${o.id}/edit`)}catch(e){alert(e)}finally{l.value=!1}}return(e,o)=>{var _;const r=W,h=F;return t(),c("div",ce,[x(Y),((_=C(B))==null?void 0:_.user_type)=="editor"?(t(),c("div",{key:0,ref_key:"el",ref:g,class:"flex flex-wrap justify-center gap-8 px-12 py-6"},[(t(!0),c(b,null,k(s.value,a=>(t(),u(V,{key:a.id,project:a,onAfterRemove:v},null,8,["project"]))),128)),(t(!0),c(b,null,k(f.value-s.value.length,a=>(t(),u(r,{key:a,width:"300px",height:"234px",class:"rounded-xl shadow-sm"}))),128)),d("div",de,[x(h,{variant:"text",style:{width:"300px",height:"234px"},class:"bg-green-50",onClick:I,loading:l.value,disabled:l.value},{icon:P(()=>o[0]||(o[0]=[d("i",{class:"pi pi-plus text-3xl"},null,-1)])),_:1},8,["loading","disabled"])])],512)):(t(),c("div",ue,[(t(!0),c(b,null,k(s.value,a=>(t(),u(V,{key:a.id,project:a,onAfterRemove:v},null,8,["project"]))),128)),(t(!0),c(b,null,k(f.value-s.value.length,a=>(t(),u(r,{key:a,width:"300px",height:"234px",class:"rounded-xl shadow-sm"}))),128))]))])}}});export{be as default};
