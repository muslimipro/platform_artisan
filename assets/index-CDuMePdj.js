import{s as fe}from"./index-DHNHenM9.js";import{a as V,L as pe,M as ie,r as b,c as se,o as P,E as A,b as n,e as g,h as k,f as c,w as z,t as J,n as ae,m as T,i as U,k as q,F as N,N as re,g as w,q as j,l as de,d as be,u as xe,O as $e,H as ke,K as B,A as _e,B as Se,s as G,C as Ue,P as oe,D as ne,Q as Ce}from"./index-CTzBRDkF.js";import{L as Le,d as Ve}from"./defaultConfirmDeleteOptions-q96e5U6N.js";import{h as E}from"./http-C6s3B4Yp.js";import{m as Be}from"./mapLessonFromDto-Dmd7ExqT.js";import{U as ee}from"./unitApi-Bp4xWL3l.js";import{s as Ie,a as De,b as Te,c as Re}from"./index-CQGPTuZa.js";import{_ as te,T as ge}from"./CodeEditorView.vue_vue_type_script_setup_true_lang-DLz_v5Qt.js";import"./index-C-VH0vPw.js";import{s as Fe}from"./index-DU0mmUNA.js";import{s as ze,a as Ae}from"./index-DfsWqT6l.js";import{s as Ee}from"./index-DMNQpKnn.js";import{s as ye}from"./index-mD0eq9VA.js";import{_ as Me}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{s as Ne}from"./index-rqfrr1V8.js";import{s as Pe,a as je}from"./index-rgxuwZLN.js";import{v as Oe}from"./v4-CmTdKEVZ.js";import{s as he}from"./index-DpB8_Bbd.js";import{u as Ge}from"./index-CWSLGCMt.js";import{s as He}from"./index-CRpkS1LV.js";import{T as qe}from"./index-B2qWy8WJ.js";import{s as Je}from"./index-BRe_uFw9.js";import"./mapUnitFromDto-CYGc5n9V.js";import"./index-DkWsACVf.js";import"./index-CC9cuJlr.js";import"./index-_kVx5MDE.js";import"./index-D1AHcJDk.js";import"./index-ORxR5vCP.js";import"./index-DyBaiWfq.js";import"./index-C7LZT1XK.js";const F={hideLesson:Ke,modifyLesson:Qe,publishLesson:We,sendLessonForReview:Ye,cancelLessonReview:Xe,startLessonReview:Ze,acceptLesson:et,rejectLesson:tt,editLesson:st};async function Ke(a){return await E.patch(`v2/lesson/${a}/hide`)}async function Qe(a){return await E.patch(`v2/lesson/${a}/modify`)}async function We(a){return await E.patch(`v2/lesson/${a}/publish`)}async function Ye(a){return await E.patch(`v2/lesson/${a}/review/send`)}async function Xe(a){return await E.patch(`v2/lesson/${a}/review/cancel`)}async function Ze(a){return await E.patch(`v2/lesson/${a}/review/start`)}async function et(a){return await E.patch(`v2/lesson/${a}/review/accept`)}async function tt(a){return await E.patch(`v2/lesson/${a}/review/reject`)}async function st(a){return await E.patch(`v2/lesson/${a}/review/edit`)}const ot=["article","options","open","video","code","pibody"],nt={class:"flex items-center"},lt={class:"flex items-center mr-2"},at=V({__name:"HighlightEditor",props:pe({index:{},usedSlots:{}},{highlight:{default:[]},highlightModifiers:{}}),emits:pe(["remove","save"],["update:highlight"]),setup(a,{emit:i}){const l=a,v=ie(a,"highlight"),s=b(null),t=b(null),e=b(!1),o=se(()=>s.value!=null&&t.value!=null),p=i,r=()=>{p("remove",l.index)};P(()=>{s.value=v.value.module,t.value=v.value.slot,e.value=v.value.autoPut}),A([s,t,e],()=>{s.value!=null&&p("save",l.index,s.value,t.value,e.value)}),A(o,d=>{d||(e.value=!1)});const y=b(["A","B","C","D","E","F"]),h=b(["8","9"]),x=b(["LED","switch","push-button","light-sensor","touch-sensor","potentiometer","encoder","motion-detector","microphone","climate-sensor","gyro-accel","buzzer","color-sensor","joystick","distance-sensor","servo","led-tower"]),$=se(()=>{if(s.value){if(s.value==="servo"||s.value==="led-tower"){const S=h.value.filter(D=>!(l.usedSlots??[]).includes(D));return t.value&&!S.includes(t.value)&&S.unshift(t.value),[null,...S]}const L=y.value.filter(u=>!(l.usedSlots??[]).includes(u));return t.value&&!L.includes(t.value)&&L.unshift(t.value),[null,...L]}const f=[...y.value,...h.value].filter(_=>!(l.usedSlots??[]).includes(_));return t.value&&!f.includes(t.value)&&f.unshift(t.value),[null,...f]}),m=se(()=>t.value?t.value==="8"||t.value==="9"?["servo","led-tower"]:x.value.filter(d=>d!=="servo"&&d!=="led-tower"):x.value);return(d,f)=>{const _=ye,L=Ee,u=ze,S=Ae,D=T;return n(),g("div",nt,[k("div",lt,[c(_,{modelValue:e.value,"onUpdate:modelValue":f[0]||(f[0]=C=>e.value=C),binary:"","input-id":"autoput",disabled:!o.value},null,8,["modelValue","disabled"]),f[3]||(f[3]=k("label",{for:"autoput",class:"ml-1 text-sm"},"auto",-1))]),c(S,null,{default:z(()=>[c(L,{modelValue:s.value,"onUpdate:modelValue":f[1]||(f[1]=C=>s.value=C),options:m.value,placeholder:"Select module",class:"place-content-center",size:"small"},null,8,["modelValue","options"]),c(u,{class:"h-[35px]"},{default:z(()=>f[4]||(f[4]=[k("div",null,"=>",-1)])),_:1}),c(L,{modelValue:t.value,"onUpdate:modelValue":f[2]||(f[2]=C=>t.value=C),options:$.value,placeholder:"Select slot",size:"small"},{option:z(({option:C})=>[k("span",{class:ae(C===null?"text-gray-400":"")},J(C===null?"[null]":C),3)]),value:z(({value:C})=>[k("span",{class:ae(C===null?"text-gray-400":"")},J(C===null?"[null]":C),3)]),_:1},8,["modelValue","options"])]),_:1}),c(D,{icon:"pi pi-trash",variant:"text",severity:"danger","aria-label":"Remove",onClick:r,class:"ml-2"})])}}}),it={class:"flex flex-col gap-2"},rt=V({__name:"HighlightPanel",props:{neededModules:{default:[]},neededModulesModifiers:{}},emits:["update:neededModules"],setup(a){const i=ie(a,"neededModules");function l(){i.value.push({autoPut:!1,module:null,slot:null})}function v(t){i.value.splice(t,1)}function s(t,e,o,p){i.value[t].module=e,i.value[t].slot=o,i.value[t].autoPut=p}return(t,e)=>{const o=T,p=Fe;return n(),U(p,{header:"Highlight slots & modules"},{default:z(()=>[k("div",it,[(n(!0),g(N,null,q(i.value,(r,y)=>(n(),g("div",{key:String(r==null?void 0:r.module)+String(r==null?void 0:r.slot)},[c(at,{highlight:i.value[y],"onUpdate:highlight":h=>i.value[y]=h,index:y,usedSlots:i.value.filter((h,x)=>{var $;return x!==y&&(($=i.value[x])==null?void 0:$.slot)!=null}).map(h=>h.slot),onRemove:v,onSave:s},null,8,["highlight","onUpdate:highlight","index","usedSlots"])]))),128))]),c(o,{icon:"pi pi-plus",variant:"text","aria-label":"Add",class:"self-center mt-2",onClick:l})]),_:1})}}}),dt={class:"flex"},ut={class:"h-[500px] flex flex-col w-full relative"},ct={class:"flex h-full",style:{border:"0.1px solid #808080",borderTopLeftRadius:"12px",borderTopRightRadius:"12px",overflow:"hidden"}},pt={class:"absolute right-2 bottom-2"},ve=!1,vt=V({__name:"PibodyEditor",props:{id:{},content:{},data:{}},emits:["save-content"],setup(a,{emit:i}){const l=j(),v=de(),s=a,t=i,e=b(""),o=b(""),p=b([]);let r=!0;return re(()=>{e.value=s.content.starting,o.value=s.content.answer,p.value=s.data.neededModules}),A([e,o,p],()=>{if(r){r=!1;return}t("save-content",{starting:e.value,answer:o.value},{neededModules:p.value.filter(y=>y.module!=null),tests:s.data.tests,includedCommandsForTests:s.data.includedCommandsForTests})},{deep:!0}),(y,h)=>{const x=T;return n(),g(N,null,[k("div",dt,[k("div",ut,[k("div",ct,[c(te,{code:e.value,"onUpdate:code":h[0]||(h[0]=$=>e.value=$),runbuttons:!1,id:s.id+"_",class:"flex-1"},null,8,["code","id"]),c(te,{code:o.value,"onUpdate:code":h[1]||(h[1]=$=>o.value=$),connectbuttons:ve,"onUpdate:connectbuttons":h[2]||(h[2]=$=>ve=$),id:s.id,class:"flex-1"},null,8,["code","id"])]),k("div",pt,[c(x,{label:"Tests",icon:"pi pi-pen-to-square",class:"w-fit",severity:"info",onClick:h[3]||(h[3]=$=>w(v).push({name:"tester2",params:{lesson_id:w(l).params.id,unit_id:s.id.split("-")[1]}}))})]),c(w(ge),{id:s.id,class:"flex-grow max-h-40"},null,8,["id"])])]),c(rt,{neededModules:p.value,"onUpdate:neededModules":h[4]||(h[4]=$=>p.value=$),class:"mb-2"},null,8,["neededModules"])],64)}}}),mt={class:"flex"},ft={class:"h-[500px] flex flex-col w-full relative"},_t={class:"flex h-full",style:{border:"0.1px solid #808080",borderTopLeftRadius:"12px",borderTopRightRadius:"12px",overflow:"hidden"}},gt={class:"absolute right-2 bottom-2"},me=!1,yt=V({__name:"CodeEditor",props:{id:{},code:{}},emits:["save-content"],setup(a,{emit:i}){const l=j(),v=de(),s=a,t=i,e=b(""),o=b("");let p=!0;return re(()=>{e.value=s.code.starting,o.value=s.code.answer}),A([e,o],()=>{if(p){p=!1;return}t("save-content",{starting:e.value,answer:o.value})}),(r,y)=>{const h=T;return n(),g("div",mt,[k("div",ft,[k("div",_t,[c(te,{code:e.value,"onUpdate:code":y[0]||(y[0]=x=>e.value=x),runbuttons:!1,id:s.id+"_",class:"flex-1"},null,8,["code","id"]),c(te,{code:o.value,"onUpdate:code":y[1]||(y[1]=x=>o.value=x),connectbuttons:me,"onUpdate:connectbuttons":y[2]||(y[2]=x=>me=x),id:s.id,class:"flex-1"},null,8,["code","id"])]),k("div",gt,[c(h,{label:"Tests",icon:"pi pi-pen-to-square",class:"w-fit",severity:"info",onClick:y[3]||(y[3]=x=>w(v).push({name:"tester2",params:{lesson_id:w(l).params.id,unit_id:s.id.split("-")[1]}}))})]),c(w(ge),{id:s.id,class:"flex-grow max-h-40"},null,8,["id"])])])}}}),O=be("lesson-edit-store",()=>{const a=xe(),i=b(null),l=b(!1),v=b(!1),s=b(!1),t=b(!1),e=b(!1),o=b(!1);function p(m){s.value=m}async function r(m){try{l.value=!0;const{data:d}=await Le.getLessonById(m);i.value=Be(d)}catch(d){a.add({severity:"error",summary:d.response.data.error,life:2e3})}finally{l.value=!1}}async function y(m,d){try{v.value=!0;const{data:f}=await ee.getUnitByIdandLessonId(m,d);return f}catch(f){a.add({severity:"error",summary:f.response.data.error,life:2e3})}finally{v.value=!1}}async function h(m){try{t.value=!0;const{data:d}=await ee.createUnitByLessonId(i.value.id,m);a.add({severity:"success",summary:d.message,life:2e3})}catch(d){a.add({severity:"error",summary:d.response.data.error,life:2e3})}finally{t.value=!1}}async function x(m,d,f){try{e.value=!0;const{data:_}=await ee.updateUnitByIdandLessonId(m,d,f);return _.unit_id}catch(_){a.add({severity:"error",summary:_.response.data.error,life:2e3})}finally{e.value=!1}}async function $(m,d){try{o.value=!0;const{data:f}=await ee.deleteUnitByIdandLessonId(m,d);a.add({severity:"success",summary:f.message,life:2e3})}catch(f){a.add({severity:"error",summary:f.response.data.error,life:2e3})}finally{o.value=!1}}return{selectedLesson:i,isLessonLoading:l,isLessonSaving:s,isUnitLoading:v,isUnitCreating:t,isUnitUpdating:e,isUnitDeleting:o,setLessonSaving:p,loadLessonById:r,loadUnitByIdandLessonId:y,createUnit:h,updateUnitByIdandLessonId:x,deleteUnitByIdandLessonId:$}}),ht={class:"flex items-start"},wt=V({__name:"MdEditor",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(a){const i=ie(a,"modelValue"),l=$e({title:{title:"Title",icon:"v-md-icon-tip",action(s){s.insert(t=>{const e="# <center>",o="</center>",r=t||"Title";return{text:`${e}${r}${o}`,selected:r}})}},icons:{title:"icons",icon:"v-md-icon-tip",menus:[{name:"Attention",text:"Attention",action(s){s.insert(()=>{const t='<span style="font-size: 20px">',e="</span>",o="⚠️";return{text:`${t}${o}${e}`,selected:o}})}},{name:"PiBody",text:"PiBody",action(s){s.insert(()=>{const t="<b>",e="</b>",o='<span style="color: #FF3F85"> Pi</span>Body';return{text:`${t}${o}${e}`,selected:o}})}},{name:"Run",text:"Run",action(s){s.insert(()=>({text:"▶️<b>Run</b>"}))}}]},style:{title:"Style",icon:"v-md-icon-tip",action(s){s.insert(t=>{const e='<span style="">',o="</span>",r=t||"placeholder";return{text:`${e}${r}${o}`,selected:r}})}},underline:{title:"Underline",icon:"v-md-icon-under-line",action(s){s.insert(t=>{const e='<span style="text-decoration: underline">',o="</span>",r=t||"placeholder";return{text:`${e}${r}${o}`,selected:r}})}},tip:{title:"Tip",icon:"v-md-icon-tip",action(s){s.insert(t=>{const e='<div style="background-color:#F3F5F7; padding: 20px; border-left: solid 8px #42B983">',o="</div>",r=t||"placeholder";return{text:`${e}${r}${o}`,selected:r}})}},note:{title:"Note",icon:"v-md-icon-tip",action(s){s.insert(t=>{const e='<div style="background-color:#F3F5F7; padding: 15px; border-left: solid 8px #FFCD6B; margin-bottom: 15px">',o="</div>",r=t||"placeholder";return{text:`${e}${r}${o}`,selected:r}})}}});async function v(s,t,e){const o=e[0];new FormData().append("file",o)}return(s,t)=>{const e=ke("v-md-editor");return n(),g("div",ht,[c(e,{modelValue:i.value,"onUpdate:modelValue":t[0]||(t[0]=o=>i.value=o),mode:"edit","left-toolbar":"undo redo clear | tip emoji todo-list | h bold italic strikethrough quote ul ol table hr link code image | title icons style underline tip note","right-toolbar":"",toolbar:l,"disabled-menus":[],onUploadImage:v},null,8,["modelValue","toolbar"])])}}}),we=Me(wt,[["__scopeId","data-v-ef888c58"]]),bt=V({__name:"ArticleEditor",props:{article:{}},emits:["save-content"],setup(a,{emit:i}){const l=a,v=i,s=b("");let t=!0;return P(()=>{var e;s.value=((e=l.article)==null?void 0:e.text)??""}),A(s,()=>{if(t){t=!1;return}v("save-content",{text:s.value})},{flush:"post"}),(e,o)=>(n(),U(we,{modelValue:s.value,"onUpdate:modelValue":o[0]||(o[0]=p=>s.value=p)},null,8,["modelValue"]))}}),xt={class:"flex flex-col gap-2"},$t={class:"flex gap-1 text-gray-500"},kt={class:"flex flex-col gap-1"},St=V({__name:"OptionsEditor",props:{optionsData:{}},emits:["save-content"],setup(a,{emit:i}){const l=a,v=i,s=b(!1),t=b(!1),e=b(!1),o=b([]),p=b([]),r=b();let y=!0;P(()=>{var $,m,d,f,_,L;s.value=(($=l.optionsData)==null?void 0:$.shuffle)??!1,t.value=((m=l.optionsData)==null?void 0:m.feedback)??!1,e.value=((d=l.optionsData)==null?void 0:d.single)??!1,o.value=((f=l.optionsData)==null?void 0:f.options)??[],p.value=((_=l.optionsData)==null?void 0:_.answer)??[],r.value=l.optionsData&&l.optionsData.answer&&l.optionsData.answer.length>0?(L=l.optionsData)==null?void 0:L.answer[0]:void 0}),A([s,t,e,o,p,r],()=>{if(y){y=!1;return}v("save-content",{shuffle:s.value,feedback:t.value,single:e.value,options:o.value,answer:e.value?r.value?[r.value]:[]:p.value})},{deep:!0});function h(){o.value.push({id:Oe(),text:""})}function x($){o.value=o.value.filter(m=>m.id!==$),p.value=p.value.filter(m=>m!==$),r.value==$&&(r.value=void 0)}return($,m)=>{const d=Pe,f=Ne,_=ye,L=T;return n(),g("div",xt,[k("div",$t,[m[5]||(m[5]=k("div",null,"shuffle:",-1)),c(d,{modelValue:s.value,"onUpdate:modelValue":m[0]||(m[0]=u=>s.value=u),class:"mr-2"},null,8,["modelValue"]),m[6]||(m[6]=k("div",null,"feedback:",-1)),c(d,{modelValue:t.value,"onUpdate:modelValue":m[1]||(m[1]=u=>t.value=u),class:"mr-2"},null,8,["modelValue"]),m[7]||(m[7]=k("div",null,"single:",-1)),c(d,{modelValue:e.value,"onUpdate:modelValue":m[2]||(m[2]=u=>e.value=u)},null,8,["modelValue"])]),k("div",kt,[(n(!0),g(N,null,q(o.value,u=>(n(),g("div",{key:u.id,class:"flex gap-2 items-center"},[e.value?(n(),U(f,{key:0,modelValue:r.value,"onUpdate:modelValue":m[3]||(m[3]=S=>r.value=S),value:u.id},null,8,["modelValue","value"])):(n(),U(_,{key:1,modelValue:p.value,"onUpdate:modelValue":m[4]||(m[4]=S=>p.value=S),value:u.id},null,8,["modelValue","value"])),c(we,{modelValue:u.text,"onUpdate:modelValue":S=>u.text=S,class:"w-full"},null,8,["modelValue","onUpdate:modelValue"]),c(L,{icon:"pi pi-trash",variant:"text",severity:"danger",size:"small",onClick:S=>x(u.id)},null,8,["onClick"])]))),128))]),c(L,{icon:"pi pi-plus",label:"Add option",variant:"text",size:"small",onClick:h,class:"self-center"})])}}}),Ut=V({__name:"OpenEditor",props:{open:{}},emits:["save-content"],setup(a,{emit:i}){const l=a,v=i,s=b("");let t=!0;return P(()=>{var e;s.value=((e=l.open)==null?void 0:e.answer)??""}),A(s,()=>{if(t){t=!1;return}v("save-content",{answer:s.value})}),(e,o)=>{const p=he;return n(),U(p,{type:"text",modelValue:s.value,"onUpdate:modelValue":o[0]||(o[0]=r=>s.value=r),class:"w-full",size:"small"},null,8,["modelValue"])}}}),Ct=V({__name:"VideoEditor",props:{video:{}},emits:["save-content"],setup(a,{emit:i}){const l=a,v=i,s=b("");let t=!0;return P(()=>{var e;s.value=((e=l.video)==null?void 0:e.url)??""}),A(s,()=>{if(t){t=!1;return}v("save-content",{url:s.value})}),(e,o)=>{const p=he;return n(),U(p,{type:"text",modelValue:s.value,"onUpdate:modelValue":o[0]||(o[0]=r=>s.value=r),class:"w-full",size:"small"},null,8,["modelValue"])}}}),Lt={class:"bg-white rounded-lg border border-gray-200"},Vt={key:1,class:"flex flex-col h-full w-full"},Bt={class:"flex items-center gap-2 px-4 pt-2"},It={class:"text-sm"},Dt={class:"text-sm text-gray-500"},Tt={key:1,class:"flex-grow px-4 py-2"},Rt={class:"flex justify-end"},Ft=V({__name:"UnitCard",props:{unit:{},loading:{type:Boolean}},emits:["delete","update"],setup(a,{emit:i}){const l=a,v=i,s=j(),t=O(),{updateUnitByIdandLessonId:e,setLessonSaving:o,loadUnitByIdandLessonId:p}=t,r=b(!1),y=b(null),h=b(null);re(async()=>{r.value=!0;const d=await p(l.unit.id,Number(s.params.id));d&&(y.value=d.content,h.value=d.data),r.value=!1});function x(d,f){o(!0),$(d,f)}const $=Ge((d,f)=>{m(d,f)},1e3,{maxWait:5e3});async function m(d,f){const _=await e(l.unit.id,Number(s.params.id),{content:d,data:f});_&&v("update",l.unit,_),o(!1)}return(d,f)=>{const _=fe,L=T;return n(),g("div",Lt,[d.loading?(n(),U(_,{key:0,class:"flex justify-center items-center w-10 h-full"})):(n(),g("div",Vt,[k("div",Bt,[k("div",It,J(d.unit.id),1),k("div",Dt,J(`${d.unit.unitType}`),1)]),r.value?(n(),U(_,{key:0,class:"flex justify-center items-center w-10 h-full"})):(n(),g("div",Tt,[d.unit.unitType=="article"?(n(),U(bt,{key:0,article:y.value,onSaveContent:x},null,8,["article"])):d.unit.unitType=="options"?(n(),U(St,{key:1,"options-data":y.value,onSaveContent:x},null,8,["options-data"])):d.unit.unitType=="open"?(n(),U(Ut,{key:2,open:y.value,onSaveContent:x},null,8,["open"])):d.unit.unitType=="video"?(n(),U(Ct,{key:3,video:y.value,onSaveContent:x},null,8,["video"])):l.unit.unitType=="code"?(n(),U(w(yt),{key:4,id:`code-${l.unit.id}`,code:y.value,onSaveContent:x},null,8,["id","code"])):l.unit.unitType=="pibody"?(n(),U(w(vt),{key:5,id:`code-${l.unit.id}`,content:y.value,data:h.value,onSaveContent:x},null,8,["id","content","data"])):B("",!0)])),k("div",Rt,[c(L,{icon:"pi pi-trash",size:"small",severity:"danger",variant:"text",onClick:f[0]||(f[0]=_e(u=>v("delete",l.unit),["stop"]))})])]))])}}}),zt={class:"group w-full relative"},At={class:"flex"},le=V({__name:"AddUnitButton",props:{unitId:{},showAddGroup:{type:Boolean},hided:{type:Boolean}},emits:["add-group-divider"],setup(a,{emit:i}){const l=a,v=i,s=j(),t=O(),{loadLessonById:e,createUnit:o}=t,p=b(),r=b(ot.map(h=>({label:h,command:async()=>{await o({unit_type:h,prev_unit_id:l.unitId??void 0}),await e(Number(s.params.id))}}))),y=h=>{p.value.toggle(h)};return(h,x)=>{const $=He,m=T,d=je;return n(),g(N,null,[k("div",zt,[x[1]||(x[1]=k("div",{class:"h-3"},null,-1)),k("div",{class:ae(["absolute left-1/2 -translate-x-1/2 -top-5 group-hover:block mt-[9px] w-full",h.hided?"hidden":""])},[k("div",At,[c($,{class:"w-7",type:"dashed"}),c($,{class:"flex-grow",type:"dashed"}),c(m,{icon:"pi pi-plus",class:"flex self-end shadow-xl h-7",size:"small",onClick:y}),c($,{class:"flex-grow",type:"dashed"}),h.showAddGroup?(n(),U(m,{key:0,icon:"pi pi-arrow-up-right-and-arrow-down-left-from-center",class:"flex self-end h-7",size:"small",variant:"text",onClick:x[0]||(x[0]=f=>v("add-group-divider"))})):(n(),U($,{key:1,class:"w-7",type:"dashed"}))])],2)]),c(d,{ref_key:"menu",ref:p,model:r.value,popup:!0},null,8,["model"])],64)}}}),Et=V({__name:"RemoveGroupButton",emits:["remove-group-divider"],setup(a,{emit:i}){const l=i;return(v,s)=>{const t=T;return n(),U(t,{icon:"pi pi-arrow-down-left-and-arrow-up-right-to-center",severity:"danger",class:"flex self-end h-7 w-7",size:"small",variant:"text",onClick:s[0]||(s[0]=_e(e=>l("remove-group-divider"),["stop"]))})}}}),Mt={class:"flex flex-col gap-2"},Nt={class:"w-full flex justify-between gap-2 mr-4"},Pt={class:"flex flex-col p-2 rounded-lg bg-slate-50"},jt=V({__name:"UnitsView",props:{pages:{}},setup(a){const i=a,l=j(),v=Se(),s=O(),{isUnitDeleting:t}=G(s),{loadLessonById:e,createUnit:o,deleteUnitByIdandLessonId:p}=s,r=b(null);async function y(u){await o({unit_type:"group-divider",prev_unit_id:u.id}),await e(Number(l.params.id))}async function h(){await o({unit_type:"page-divider"}),await e(Number(l.params.id))}async function x(u){await p(u,Number(l.params.id)),await e(Number(l.params.id))}function $(u){r.value=u,v.require({...Ve,message:"Are you sure you want to delete this lesson?",accept:async()=>{await p(u.id,Number(l.params.id)),await e(Number(l.params.id))}})}function m(u,S){S>u.id&&(u.id=S)}const d=Number(l.params.id),f=`openedPanels-${d}`,_=b({});P(async()=>{const u=localStorage.getItem(f);u&&(_.value=JSON.parse(u)),await Ue(),setTimeout(()=>{const S=localStorage.getItem(`lastOpenedGroup-${d}`);if(S){const D=document.getElementById(`group-${S}`);if(D){D.scrollIntoView({behavior:"smooth"});return}}},1e3)}),A(_,u=>{localStorage.setItem(f,JSON.stringify(u))},{deep:!0});function L(u,S){_.value[S]=u,_.value[S].length>0&&localStorage.setItem(`lastOpenedGroup-${d}`,u[u.length-1])}return(u,S)=>{const D=Ie,C=De,K=Te,Q=Re,W=T;return n(),g("div",Mt,[(n(!0),g(N,null,q(i.pages,M=>(n(),U(Q,{value:_.value[M.id]||[],"onUpdate:value":I=>L(I,M.id),multiple:"",key:M.id,class:"flex flex-col gap-2 bg-white p-4 rounded-lg shadow-lg"},{default:z(()=>[(n(!0),g(N,null,q(M.groups,(I,Y)=>(n(),U(K,{key:I.id,value:I.id,id:`group-${I.id}`},{default:z(()=>[c(D,null,{default:z(()=>[k("div",Nt,[k("div",null,"Step: "+J(Y),1),I.id!=-1?(n(),U(Et,{key:0,onRemoveGroupDivider:R=>x(I.id)},null,8,["onRemoveGroupDivider"])):B("",!0)])]),_:2},1024),c(C,{class:"flex flex-col"},{default:z(()=>[k("div",Pt,[(n(!0),g(N,null,q(I.units,(R,X)=>{var H;return n(),g("div",{key:R.id},[X==0?(n(),U(le,{key:0,hided:!0,"unit-id":I.id,"show-add-group":!1},null,8,["unit-id"])):B("",!0),c(Ft,{unit:R,loading:((H=r.value)==null?void 0:H.id)===R.id&&w(t),onDelete:Z=>$(R),onUpdate:m},null,8,["unit","loading","onDelete"]),c(le,{hided:!0,"unit-id":R.id,"show-add-group":!0,onAddGroupDivider:Z=>y(R)},null,8,["unit-id","onAddGroupDivider"])])}),128)),I.units.length==0?(n(),U(le,{key:0,hided:!1,"unit-id":I.id,"show-add-group":!1},null,8,["unit-id"])):B("",!0)])]),_:2},1024)]),_:2},1032,["value","id"]))),128))]),_:2},1032,["value","onUpdate:value"]))),128)),c(W,{id:"newpage",icon:"pi pi-plus",label:"New page",variant:"text",size:"small",class:"flex self-center",onClick:S[0]||(S[0]=M=>h())})])}}}),Ot={class:"w-[24px] h-[24px]"},Gt={key:0,class:"flex items-center"},Ht={key:0,class:"material-icons text-gray-500"},qt={key:1,class:"material-icons text-gray-500"},Jt={key:1},Kt={class:"material-icons text-gray-500"},Qt=V({__name:"AutoSaveCloud",setup(a){const i=O(),{selectedLesson:l,isLessonSaving:v}=G(i);return(s,t)=>{var o;const e=qe;return n(),g("div",Ot,[(o=w(l))!=null&&o.editable?(n(),g("div",Gt,[w(v)?oe((n(),g("span",qt,t[1]||(t[1]=[ne("cloud_sync")]))),[[e,"Saving...",void 0,{bottom:!0}]]):oe((n(),g("span",Ht,t[0]||(t[0]=[ne("cloud_done")]))),[[e,"Saved",void 0,{bottom:!0}]])])):(n(),g("div",Jt,[oe((n(),g("span",Kt,t[2]||(t[2]=[ne("cloud_off")]))),[[e,"Save not allowed",void 0,{bottom:!0}]])]))])}}}),Wt={key:0},Yt={key:0},Xt={key:1},Zt={key:0},es={key:1},ts={key:2},ss={key:0,class:"flex gap-1"},os={key:3},ns={key:0},ls={key:4},as={key:0,class:"flex gap-1"},is={key:5},rs={key:0,class:"flex gap-1"},ds={key:6},us={key:0,class:"flex gap-1"},cs=V({__name:"StageButtons",setup(a){const i=j(),l=Ce(),{user:v}=G(l),s=O(),{selectedLesson:t}=G(s),e=b(!1),o=b(!1);async function p(){e.value=!0;try{await F.sendLessonForReview(i.params.id.toString()),window.location.reload()}catch(_){console.log(_)}finally{e.value=!1}}async function r(){e.value=!0;try{await F.cancelLessonReview(i.params.id.toString()),window.location.reload()}catch(_){console.log(_)}finally{e.value=!1}}async function y(){e.value=!0;try{await F.startLessonReview(i.params.id.toString()),window.location.reload()}catch(_){console.log(_)}finally{e.value=!1}}async function h(){e.value=!0;try{await F.acceptLesson(i.params.id.toString()),window.location.reload()}catch(_){console.log(_)}finally{e.value=!1}}async function x(){o.value=!0;try{await F.rejectLesson(i.params.id.toString()),window.location.reload()}catch(_){console.log(_)}finally{o.value=!1}}async function $(){e.value=!0;try{await F.editLesson(i.params.id.toString()),window.location.reload()}catch(_){console.log(_)}finally{e.value=!1}}async function m(){e.value=!0;try{await F.publishLesson(i.params.id.toString()),window.location.reload()}catch(_){console.log(_)}finally{e.value=!1}}async function d(){o.value=!0;try{await F.hideLesson(i.params.id.toString()),window.location.reload()}catch(_){console.log(_)}finally{o.value=!1}}async function f(){e.value=!0;try{await F.modifyLesson(i.params.id.toString()),window.location.reload()}catch(_){console.log(_)}finally{e.value=!1}}return(_,L)=>{var S,D,C,K,Q,W,M,I,Y,R,X,H,Z,ue,ce;const u=T;return((S=w(t))==null?void 0:S.stage)=="prepare_for_submission"?(n(),g("div",Wt,[((D=w(v))==null?void 0:D.user_type)=="contributor"?(n(),g("div",Yt,[c(u,{label:"Send for review",severity:"info",size:"small",onClick:p,disabled:e.value,loading:e.value},null,8,["disabled","loading"])])):B("",!0)])):((C=w(t))==null?void 0:C.stage)=="waiting_for_review"?(n(),g("div",Xt,[((K=w(v))==null?void 0:K.user_type)=="contributor"?(n(),g("div",Zt,[c(u,{label:"Cancel submission",severity:"danger",size:"small",onClick:r,disabled:e.value,loading:e.value},null,8,["disabled","loading"])])):((Q=w(v))==null?void 0:Q.user_type)=="editor"?(n(),g("div",es,[c(u,{label:"Start review",severity:"info",size:"small",onClick:y,disabled:e.value,loading:e.value},null,8,["disabled","loading"])])):B("",!0)])):((W=w(t))==null?void 0:W.stage)=="in_review"?(n(),g("div",ts,[((M=w(v))==null?void 0:M.user_type)=="editor"?(n(),g("div",ss,[c(u,{label:"Reject",severity:"danger",size:"small",onClick:x,disabled:e.value||o.value,loading:o.value},null,8,["disabled","loading"]),c(u,{label:"Accept",size:"small",onClick:h,disabled:e.value||o.value,loading:e.value},null,8,["disabled","loading"])])):B("",!0)])):((I=w(t))==null?void 0:I.stage)=="rejected"?(n(),g("div",os,[((Y=w(v))==null?void 0:Y.user_type)=="contributor"?(n(),g("div",ns,[c(u,{label:"Edit submission",severity:"info",size:"small",onClick:$,disabled:e.value,loading:e.value},null,8,["disabled","loading"])])):B("",!0)])):((R=w(t))==null?void 0:R.stage)=="ready_for_publish"?(n(),g("div",ls,[((X=w(v))==null?void 0:X.user_type)=="editor"?(n(),g("div",as,[w(t).createdBy!=Number(w(v).user_id)?(n(),U(u,{key:0,label:"Reject",severity:"danger",size:"small",onClick:x,disabled:e.value||o.value,loading:o.value},null,8,["disabled","loading"])):B("",!0),c(u,{label:"Publish",size:"small",onClick:m,disabled:e.value||o.value,loading:e.value},null,8,["disabled","loading"])])):B("",!0)])):((H=w(t))==null?void 0:H.stage)=="published"?(n(),g("div",is,[((Z=w(v))==null?void 0:Z.user_type)=="editor"?(n(),g("div",rs,[c(u,{label:"Hide",severity:"danger",size:"small",onClick:d,disabled:e.value||o.value,loading:o.value},null,8,["disabled","loading"]),c(u,{label:"Modify",size:"small",onClick:f,disabled:e.value||o.value,loading:e.value},null,8,["disabled","loading"])])):B("",!0)])):((ue=w(t))==null?void 0:ue.stage)=="in_modify"?(n(),g("div",ds,[((ce=w(v))==null?void 0:ce.user_type)=="editor"?(n(),g("div",us,[c(u,{label:"Hide",severity:"danger",size:"small",onClick:d,disabled:e.value||o.value,loading:o.value},null,8,["disabled","loading"]),c(u,{label:"Publish",size:"small",onClick:m,disabled:e.value||o.value,loading:e.value},null,8,["disabled","loading"])])):B("",!0)])):B("",!0)}}}),ps={key:0},vs=V({__name:"StageStatus",setup(a){const i=O(),{selectedLesson:l}=G(i);return(v,s)=>{const t=Je;return w(l)?(n(),g("div",ps,[["prepare_for_submission","waiting_for_review","in_review","in_modify"].includes(w(l).stage)?(n(),U(t,{key:0,label:w(l).stage.replace(/_/g," ").replace(/^./,e=>e.toUpperCase()),icon:"pi pi-clock",pt:{icon:{class:"text-yellow-500"}},class:"h-8 bg-yellow-50 w-fit"},null,8,["label"])):["ready_for_publish","published"].includes(w(l).stage)?(n(),U(t,{key:1,label:w(l).stage.replace(/_/g," ").replace(/^./,e=>e.toUpperCase()),icon:"pi pi-check-circle",pt:{icon:{class:"text-green-500"}},class:"h-8 bg-green-50 w-fit"},null,8,["label"])):["rejected"].includes(w(l).stage)?(n(),U(t,{key:2,label:w(l).stage.replace(/_/g," ").replace(/^./,e=>e.toUpperCase()),icon:"pi pi-times-circle",pt:{icon:{class:"text-red-500"}},class:"h-8 bg-red-50 w-fit"},null,8,["label"])):B("",!0)])):B("",!0)}}}),ms={class:"flex flex-col items-center"},fs={class:"flex justify-between items-center w-full min-h-16 border-b border-gray-200 px-8 shadow-md gap-8"},_s={class:"flex items-center gap-4"},gs={class:"flex items-center gap-4"},ys={class:"w-full h-full max-w-screen-lg px-4 md:px-28 py-8"},hs={key:1,class:"flex justify-center"},ws={key:2},Ys=V({__name:"LessonEditPage",setup(a){const i=j(),l=de(),v=O(),{isLessonLoading:s,selectedLesson:t}=G(v),{loadLessonById:e}=v;return P(()=>e(Number(i.params.id))),(o,p)=>{const r=T,y=fe;return n(),g("div",ms,[k("div",fs,[k("div",_s,[c(r,{icon:"pi pi-times",variant:"text",severity:"contrast",onClick:p[0]||(p[0]=h=>w(l).go(-1))}),c(vs)]),k("div",gs,[c(Qt),c(cs)])]),k("div",ys,[w(s)?(n(),U(y,{key:0,class:"flex justify-center"})):w(t)?(n(),g("div",ws,[c(jt,{pages:w(t).pages},null,8,["pages"])])):(n(),g("div",hs,"No lesson found"))])])}}});export{Ys as default};
