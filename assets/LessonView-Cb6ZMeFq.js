import{s as oe,S as ie,_ as re,T as ce,a as ue}from"./SimulationView-5TtRwr8G.js";import{u as W,a as E,t as pe,b as de}from"./store-B8LA9ih-.js";import{d as G,ad as H,g as Z,ae as ee,a as me,ac as U,r as R,l as te,y as se,o as l,c as k,e as f,b as c,f as t,h as d,F as O,k as fe,af as ae,w,ag as ve,t as X,s as le,ah as ye,u as _e,n as ge,j as z,ai as he}from"./index-BYazk7S4.js";import{s as be}from"./index-B4Ps0EoO.js";import{s as we,a as ke,t as xe}from"./types-DUuxNSEx.js";import{L as Se,s as $e}from"./logo-CKBEDWti.js";import{_ as Ce}from"./LocaleSwitcher.vue_vue_type_script_setup_true_lang-CNzS7MVW.js";import{_ as Pe,a as je,M as ze,b as Ie,c as Le}from"./QuestionStep.vue_vue_type_script_setup_true_lang-D_XHKj-X.js";import"./pibody-B70zHXNr.js";import"./http-DYqQOZAS.js";import"./index-iqtJlEIE.js";const Re={class:"mx-auto flex items-center justify-between p-2 px-6 w-full bg-white"},Be={class:"flex flex-1 items-center"},Ve={key:1,class:"flex items-center gap-1"},De={class:"flex items-center gap-1"},Fe={class:"flex flex-1 justify-end items-center gap-2"},Ne={class:"relative overflow-hidden w-full border-0 bg-transparent flex items-start p-2 pl-4 rounded-none cursor-pointer transition-colors duration-200"},Te={class:"inline-flex flex-col items-start"},qe={class:"font-bold"},Ee={class:"text-sm"},Ue=G({__name:"LessonHeader",setup(Y){const{locale:_}=H(),I=Z(),x=ee(),S=me(),{user:p}=U(S),i=W(),{lesson:g,stepIndex:h,stepLoading:m,firstUncompletedIndex:$}=U(i),{changeStep:B,setSteps:D,setStepIndex:M,setFirstUncompletedIndex:F}=i,C=R(!1);function V(n,r){if(r)return"info";if(n!="completed")return n=="attempted"?"warn":(n=="started","secondary")}function A(n,r){if(!r&&n!="completed")return n=="attempted"||n=="started"?"outlined":void 0}function K(n){switch(n){case"article":return"pi pi-align-left";case"code":return"pi pi-code";case"question":return"pi pi-question";case"matching":return"pi pi-arrows-h";case"open":return"pi pi-pencil";default:return"pi pi-align-left"}}async function N(){if(!C.value){C.value=!0;try{const{data:n}=await E.getStudentProjectStepsByID(x.params.id.toString()),r=[];for(const[o,v]of n.steps.entries())if(v.id==n.last_step_id){M(o);const j=await pe(v,_.value);r.push(j)}else{const j={id:v.id.toString(),title:"",type:v.step_type,progress:v.status,inner:{contents:[]},answer:{}};r.push(j)}D(r);let L=0;for(let o=0;o<r.length;o++)if(r[o].progress!="completed"||o==r.length-1){L=o;break}F(L)}catch(n){alert(n)}finally{C.value=!1}}}te(N),se(_,N,{immediate:!1});const T=R(),P=R([{label:"Log out",icon:"pi pi-sign-out",command:()=>{S.logout(),I.replace({name:"login"})}}]),e=n=>{T.value.toggle(n)};return(n,r)=>{const L=$e,o=le,v=we,j=be,u=ye;return l(),k("div",Re,[f("div",Be,[c(L,{src:t(Se),width:"32"},null,8,["src"]),r[1]||(r[1]=f("p",{class:"text-xl font-semibold px-2 mr-4"},"Artisan",-1)),c(o,{id:"#projects",icon:"pi pi-angle-left",label:n.$t("projects"),severity:"secondary",variant:"text",onClick:r[0]||(r[0]=a=>t(I).push({name:"projects"})),size:"small"},null,8,["label"])]),C.value||t(g)==null?(l(),d(v,{key:0,shape:"circle",size:"2rem",class:"mr-2"})):(l(),k("div",Ve,[f("div",De,[(l(!0),k(O,null,fe(t(g).steps,(a,s)=>(l(),d(o,{key:a.id,icon:K(a.type),rounded:"",severity:V(a.progress,s==t(h)),variant:A(a.progress,s==t(h)),class:ae([{"bg-orange-100":a.progress=="attempted"&&s!=t(h)},"h-8 w-8"]),onClick:b=>t(B)(s),disabled:t(m)||a.progress!="completed"&&s!=t($),loading:s==t(h)&&t(m)},null,8,["icon","severity","variant","class","onClick","disabled","loading"]))),128))])])),f("div",Fe,[c(Ce),c(o,{type:"button",icon:"pi pi-ellipsis-v",onClick:e,"aria-haspopup":"true","aria-controls":"overlay_menu",size:"small",variant:"outlined",severity:"secondary",class:"border border-slate-300 bg-slate-50",style:{width:"34px"}}),c(j,{ref_key:"menu",ref:T,id:"overlay_menu",model:P.value,popup:!0},{start:w(()=>{var a,s;return[ve((l(),k("button",Ne,[f("span",Te,[f("span",qe,X((a=t(p))==null?void 0:a.email),1),f("span",Ee,X((s=t(p))==null?void 0:s.user_type),1)])])),[[u]])]}),_:1},8,["model"])])])}}}),Me={class:"flex flex-col p-4 gap-4 overflow-scroll h-full justify-between bg-white"},Ae={key:0},Ke={key:1,class:"flex"},We={class:"flex justify-end gap-2"},Ge=G({__name:"LessonDiv",setup(Y){const{locale:_}=H(),I=Z(),x=_e(),S=W(),{lesson:p,stepIndex:i,userCode:g,firstUncompletedIndex:h,submitEnabled:m}=U(S),{changeStep:$,updateStatus:B,incrementFirstUncompletedIndex:D,runCodePressed:M}=S,F=de(),{isLoading:C,isRunning:V,isConnected:A,isRunError:K}=U(F);async function N(){for(;V.value;)await new Promise(u=>setTimeout(u,100))}async function T(){A.value&&(F.run(),M(),await N(),K.value?x.add({severity:"error",summary:"Wrong answer!",detail:"Keep trying",life:5e3}):v())}const P=R(!1),e=ge(()=>{var u;return i.value==null?null:((u=p.value)==null?void 0:u.steps[i.value])??null});async function n(){i.value!=null&&$(i.value-1)}async function r(){var u,a;if(i.value!=null){if(((u=e.value)==null?void 0:u.type)=="article"&&e.value.progress!="completed")try{const{data:s}=await E.submitStep(((a=e.value)==null?void 0:a.id)??"",_.value,{});B(s.status),D()}catch(s){console.log(s)}i.value+1<=h.value&&$(i.value+1)}}async function L(){var u,a,s;if(i.value!=null){if(((u=e.value)==null?void 0:u.progress)=="completed"){P.value=!0;return}if(((a=e.value)==null?void 0:a.type)=="article")try{const{data:b}=await E.submitStep(((s=e.value)==null?void 0:s.id)??"",_.value,{});B(b.status),P.value=!0}catch(b){console.log(b)}}}const o=R(!1);async function v(){var u,a,s,b;o.value=!0;try{let y;switch((u=e.value)==null?void 0:u.type){case"code":y={code:g.value};break;case"open":y={open:e.value.answer.open};break;case"question":const Q=[];(a=e.value.inner.options)==null||a.forEach(ne=>{Q.push(ne.correct)}),y={question:Q};break;case"matching":y={match:[{key:"dog",value:"b"},{key:"a",value:"animal"},{key:"c",value:"d"}]};break;default:y={};break}const J=((s=e.value)==null?void 0:s.progress)=="completed",{data:q}=await E.submitStep(((b=e.value)==null?void 0:b.id)??"",_.value,y);J||B(q.status),q.status=="completed"?(J||D(),x.add({severity:"success",summary:"Correct, good job!",detail:"Completed successfully",life:5e3})):q.status=="attempted"&&x.add({severity:"error",summary:"Wrong answer!",detail:"Keep trying",life:5e3}),console.log(q.status)}catch(y){alert(y)}finally{o.value=!1}}function j(){P.value=!1,I.push({name:"projects"})}return(u,a)=>{const s=le,b=he;return l(),k(O,null,[f("div",Me,[e.value?(l(),k("div",Ae,[e.value.type=="article"?(l(),d(t(Pe),{key:0,step:e.value,isPreview:!1},null,8,["step"])):e.value.type=="code"?(l(),d(t(je),{key:1,step:e.value,isPreview:!1},null,8,["step"])):e.value.type=="matching"?(l(),d(t(ze),{key:2,step:e.value,isPreview:!1},null,8,["step"])):e.value.type=="open"?(l(),d(t(Ie),{key:3,step:e.value,isPreview:!1},null,8,["step"])):e.value.type=="question"?(l(),d(t(Le),{key:4,step:e.value,isPreview:!1},null,8,["step"])):z("",!0)])):z("",!0),t(p)!=null&&t(p).steps!=null&&t(p).steps.length>0&&e.value?(l(),k("div",Ke,[t(i)!==0?(l(),d(s,{key:0,label:"Previous",icon:"pi pi-angle-left",size:"small",onClick:n})):z("",!0),e.value.type=="code"&&e.value.progress!="completed"?(l(),d(s,{key:1,label:"Run & Submit",icon:"pi pi-play",iconPos:"right",severity:"info",size:"small",class:"ml-auto self-end",onClick:T,disabled:t(C)||t(V)||o.value||!t(m),loading:t(C)||t(V)||o.value},null,8,["disabled","loading"])):e.value.type!="article"&&e.value.progress!="completed"?(l(),d(s,{key:2,label:"Submit",icon:"pi pi-check",iconPos:"right",severity:"info",size:"small",class:"ml-auto self-end",onClick:v,disabled:o.value||!t(m),loading:o.value},null,8,["disabled","loading"])):z("",!0),t(i)<t(p).steps.length-1&&(e.value.progress=="completed"||e.value.type=="article")?(l(),d(s,{key:3,label:"Next",icon:"pi pi-angle-right",iconPos:"right",size:"small",class:"ml-auto self-end",onClick:r,disabled:e.value.progress!="completed"&&(e.value.type!="article"||!t(m)),loading:o.value},null,8,["disabled","loading"])):t(i)==t(p).steps.length-1&&(e.value.progress=="completed"||e.value.type=="article")?(l(),d(s,{key:4,label:"Finish 🥳",size:"small",class:"ml-auto self-end",onClick:L,disabled:e.value.progress!="completed"&&(e.value.type!="article"||!t(m)),loading:o.value},null,8,["disabled","loading"])):z("",!0)])):z("",!0)]),c(b,{visible:P.value,"onUpdate:visible":a[0]||(a[0]=y=>P.value=y),modal:"",header:"Congratulations🥳🎉",style:{width:"25rem"}},{default:w(()=>[a[1]||(a[1]=f("span",{class:"text-surface-500 dark:text-surface-400 block mb-8"},"You successfully completed this project",-1)),f("div",We,[c(s,{type:"button",label:"Go to next Project ➡️",onClick:j})])]),_:1},8,["visible"])],64)}}}),He={key:1,class:"h-[51px]"},Oe={class:"flex bg-surface-0",style:{height:"calc(100vh - 52px)"}},Ye={class:"flex justify-center h-full"},Je={class:"max-w-[400px] w-full"},rt=G({__name:"LessonView",setup(Y){const{locale:_}=H(),I=ee(),x=W(),{setLesson:S}=x,p=R(!1);async function i(){if(!p.value){p.value=!0;try{const{data:g}=await ke.getProjectByID(I.params.id.toString()),h=await xe(g,_.value);S(h)}catch(g){alert(g)}finally{p.value=!1}}}return te(i),se(_,i),(g,h)=>{const m=ue,$=oe;return l(),k(O,null,[p.value?(l(),k("div",He)):(l(),d(Ue,{key:0})),f("div",Oe,[c($,{class:"w-full rounded-none"},{default:w(()=>[c(m,{size:33,minSize:10,class:"max-w-[467px] w-full"},{default:w(()=>[c(ie)]),_:1}),c(m,{size:34,minSize:10},{default:w(()=>[c($,{layout:"vertical",class:"h-full w-full"},{default:w(()=>[c(m,{size:65,minSize:10},{default:w(()=>[c(re)]),_:1}),c(m,{size:35,minSize:10},{default:w(()=>[c(ce)]),_:1})]),_:1})]),_:1}),c(m,{size:33,minSize:10,class:ae(["max-w-md mx-auto",{"animate-fadeinright animate-once animate-duration-1000 animate-ease-in-out":!0}])},{default:w(()=>[f("div",Ye,[f("div",Je,[p.value?z("",!0):(l(),d(Ge,{key:0}))])])]),_:1})]),_:1})])],64)}}});export{rt as default};
