import{s as ie,S as re,_ as ce,T as ue,a as pe}from"./SimulationView-CvCK_UEL.js";import{u as W,a as q,t as de,b as Z,c as me}from"./store-DoWp8HtJ.js";import{d as G,ad as H,g as ee,ae as te,a as fe,ac as M,r as F,l as se,y as ae,o as l,c as k,e as m,b as r,f as t,h as p,F as O,k as ve,af as le,w,ag as ye,t as X,s as oe,ah as _e,u as ge,n as he,j as B,ai as be,aj as we}from"./index-DRZ-B3PQ.js";import{s as ke}from"./index-CY_SPIgv.js";import{s as xe,a as Se,t as $e}from"./types-BUivUqNA.js";import{L as Ce,s as Pe}from"./logo-C4-nlLcK.js";import{_ as je}from"./LocaleSwitcher.vue_vue_type_script_setup_true_lang-RRG0UzA8.js";import{_ as ze,a as Ie,M as Le,b as Be,c as De}from"./QuestionStep.vue_vue_type_script_setup_true_lang-DbkdJhE6.js";import"./pibody-B70zHXNr.js";import"./http-B0ZoMD11.js";import"./index-D-FMpm2b.js";const Re={class:"mx-auto flex items-center justify-between p-2 px-6 w-full bg-white"},Ve={class:"flex flex-1 items-center"},Fe={key:1,class:"flex items-center gap-1"},Ee={class:"flex items-center gap-1"},Ne={class:"flex flex-1 justify-end items-center gap-2"},Te={class:"relative overflow-hidden w-full border-0 bg-transparent flex items-start p-2 pl-4 rounded-none cursor-pointer transition-colors duration-200"},Ue={class:"inline-flex flex-col items-start"},qe={class:"font-bold"},Me={class:"text-sm"},Ae=G({__name:"LessonHeader",setup(Y){const{locale:g}=H(),D=ee(),S=te(),$=fe(),{user:f}=M($),c=W(),{lesson:R,stepIndex:x,stepLoading:d,firstUncompletedIndex:C}=M(c),{changeStep:v,setSteps:P,setStepIndex:h,setFirstUncompletedIndex:j}=c,z=F(!1);function E(o,i){if(i)return"info";if(o!="completed")return o=="attempted"?"warn":(o=="started","secondary")}function A(o,i){if(!i&&o!="completed")return o=="attempted"||o=="started"?"outlined":void 0}function K(o){switch(o){case"article":return"pi pi-align-left";case"code":return"pi pi-code";case"question":return"pi pi-question";case"matching":return"pi pi-arrows-h";case"open":return"pi pi-pencil";default:return"pi pi-align-left"}}async function N(){if(!z.value){z.value=!0;try{const{data:o}=await q.getStudentProjectStepsByID(S.params.id.toString()),i=[];for(const[n,y]of o.steps.entries())if(y.id==o.last_step_id){h(n);const L=await de(y,g.value);i.push(L)}else{const L={id:y.id.toString(),title:"",type:y.step_type,progress:y.status,inner:{contents:[]},answer:{}};i.push(L)}P(i);let V=0;for(let n=0;n<i.length;n++)if(i[n].progress!="completed"||n==i.length-1){V=n;break}j(V)}catch(o){alert(o)}finally{z.value=!1}}}se(N),ae(g,N,{immediate:!1});const T=F(),I=F([{label:"Log out",icon:"pi pi-sign-out",command:()=>{$.logout(),D.replace({name:"login"})}}]),e=o=>{T.value.toggle(o)};return(o,i)=>{const V=Pe,n=oe,y=xe,L=ke,u=_e;return l(),k("div",Re,[m("div",Ve,[r(V,{src:t(Ce),width:"32"},null,8,["src"]),i[1]||(i[1]=m("p",{class:"text-xl font-semibold px-2 mr-4"},"Artisan",-1)),r(n,{id:"#projects",icon:"pi pi-angle-left",label:o.$t("projects"),severity:"secondary",variant:"text",onClick:i[0]||(i[0]=a=>t(D).push({name:"projects"})),size:"small"},null,8,["label"])]),z.value||t(R)==null?(l(),p(y,{key:0,shape:"circle",size:"2rem",class:"mr-2"})):(l(),k("div",Fe,[m("div",Ee,[(l(!0),k(O,null,ve(t(R).steps,(a,s)=>(l(),p(n,{key:a.id,icon:K(a.type),rounded:"",severity:E(a.progress,s==t(x)),variant:A(a.progress,s==t(x)),class:le([{"bg-orange-100":a.progress=="attempted"&&s!=t(x)},"h-8 w-8"]),onClick:b=>t(v)(s),disabled:t(d)||a.progress!="completed"&&s!=t(C),loading:s==t(x)&&t(d)},null,8,["icon","severity","variant","class","onClick","disabled","loading"]))),128))])])),m("div",Ne,[r(je),r(n,{type:"button",icon:"pi pi-ellipsis-v",onClick:e,"aria-haspopup":"true","aria-controls":"overlay_menu",size:"small",variant:"outlined",severity:"secondary",class:"border border-slate-300 bg-slate-50",style:{width:"34px"}}),r(L,{ref_key:"menu",ref:T,id:"overlay_menu",model:I.value,popup:!0},{start:w(()=>{var a,s;return[ye((l(),k("button",Te,[m("span",Ue,[m("span",qe,X((a=t(f))==null?void 0:a.email),1),m("span",Me,X((s=t(f))==null?void 0:s.user_type),1)])])),[[u]])]}),_:1},8,["model"])])])}}}),Ke={class:"flex flex-col p-4 gap-4 overflow-scroll h-full justify-between bg-white"},We={key:0},Ge={key:1,class:"flex"},He={class:"flex justify-end gap-2"},Oe=G({__name:"LessonDiv",setup(Y){const{locale:g}=H(),D=ee(),S=ge(),$=W(),{lesson:f,stepIndex:c,userCode:R,firstUncompletedIndex:x,submitEnabled:d}=M($),{changeStep:C,updateStatus:v,incrementFirstUncompletedIndex:P,runCodePressed:h}=$,j=Z(),{isLoading:z,isRunning:E,isConnected:A,isRunError:K}=M(j);async function N(){for(;E.value;)await new Promise(u=>setTimeout(u,100))}async function T(){A.value&&(j.run(),h(),await N(),K.value?S.add({severity:"error",summary:"Wrong answer!",detail:"Keep trying",life:5e3}):y())}const I=F(!1),e=he(()=>{var u;return c.value==null?null:((u=f.value)==null?void 0:u.steps[c.value])??null});async function o(){c.value!=null&&C(c.value-1)}async function i(){var u,a;if(c.value!=null){if(((u=e.value)==null?void 0:u.type)=="article"&&e.value.progress!="completed")try{const{data:s}=await q.submitStep(((a=e.value)==null?void 0:a.id)??"",g.value,{});v(s.status),P()}catch(s){console.log(s)}c.value+1<=x.value&&C(c.value+1)}}async function V(){var u,a,s;if(c.value!=null){if(((u=e.value)==null?void 0:u.progress)=="completed"){I.value=!0;return}if(((a=e.value)==null?void 0:a.type)=="article")try{const{data:b}=await q.submitStep(((s=e.value)==null?void 0:s.id)??"",g.value,{});v(b.status),I.value=!0}catch(b){console.log(b)}}}const n=F(!1);async function y(){var u,a,s,b;n.value=!0;try{let _;switch((u=e.value)==null?void 0:u.type){case"code":_={code:R.value};break;case"open":_={open:e.value.answer.open};break;case"question":const Q=[];(a=e.value.inner.options)==null||a.forEach(ne=>{Q.push(ne.correct)}),_={question:Q};break;case"matching":_={match:[{key:"dog",value:"b"},{key:"a",value:"animal"},{key:"c",value:"d"}]};break;default:_={};break}const J=((s=e.value)==null?void 0:s.progress)=="completed",{data:U}=await q.submitStep(((b=e.value)==null?void 0:b.id)??"",g.value,_);J||v(U.status),U.status=="completed"?(J||P(),S.add({severity:"success",summary:"Correct, good job!",detail:"Completed successfully",life:5e3})):U.status=="attempted"&&S.add({severity:"error",summary:"Wrong answer!",detail:"Keep trying",life:5e3}),console.log(U.status)}catch(_){alert(_)}finally{n.value=!1}}function L(){I.value=!1,D.push({name:"projects"})}return(u,a)=>{const s=oe,b=be;return l(),k(O,null,[m("div",Ke,[e.value?(l(),k("div",We,[e.value.type=="article"?(l(),p(t(ze),{key:0,step:e.value,isPreview:!1},null,8,["step"])):e.value.type=="code"?(l(),p(t(Ie),{key:1,step:e.value,isPreview:!1},null,8,["step"])):e.value.type=="matching"?(l(),p(t(Le),{key:2,step:e.value,isPreview:!1},null,8,["step"])):e.value.type=="open"?(l(),p(t(Be),{key:3,step:e.value,isPreview:!1},null,8,["step"])):e.value.type=="question"?(l(),p(t(De),{key:4,step:e.value,isPreview:!1},null,8,["step"])):B("",!0)])):B("",!0),t(f)!=null&&t(f).steps!=null&&t(f).steps.length>0&&e.value?(l(),k("div",Ge,[t(c)!==0?(l(),p(s,{key:0,label:"Previous",icon:"pi pi-angle-left",size:"small",onClick:o})):B("",!0),e.value.type=="code"&&e.value.progress!="completed"?(l(),p(s,{key:1,label:"Run & Submit",icon:"pi pi-play",iconPos:"right",severity:"info",size:"small",class:"ml-auto self-end",onClick:T,disabled:t(z)||t(E)||n.value||!t(d),loading:t(z)||t(E)||n.value},null,8,["disabled","loading"])):e.value.type!="article"&&e.value.progress!="completed"?(l(),p(s,{key:2,label:"Submit",icon:"pi pi-check",iconPos:"right",severity:"info",size:"small",class:"ml-auto self-end",onClick:y,disabled:n.value||!t(d),loading:n.value},null,8,["disabled","loading"])):B("",!0),t(c)<t(f).steps.length-1&&(e.value.progress=="completed"||e.value.type=="article")?(l(),p(s,{key:3,label:"Next",icon:"pi pi-angle-right",iconPos:"right",size:"small",class:"ml-auto self-end",onClick:i,disabled:e.value.progress!="completed"&&(e.value.type!="article"||!t(d)),loading:n.value},null,8,["disabled","loading"])):t(c)==t(f).steps.length-1&&(e.value.progress=="completed"||e.value.type=="article")?(l(),p(s,{key:4,label:"Finish 🥳",size:"small",class:"ml-auto self-end",onClick:V,disabled:e.value.progress!="completed"&&(e.value.type!="article"||!t(d)),loading:n.value},null,8,["disabled","loading"])):B("",!0)])):B("",!0)]),r(b,{visible:I.value,"onUpdate:visible":a[0]||(a[0]=_=>I.value=_),modal:"",header:"Congratulations🥳🎉",style:{width:"25rem"}},{default:w(()=>[a[1]||(a[1]=m("span",{class:"text-surface-500 dark:text-surface-400 block mb-8"},"You successfully completed this project",-1)),m("div",He,[r(s,{type:"button",label:"Go to next Project ➡️",onClick:L})])]),_:1},8,["visible"])],64)}}}),Ye={key:1,class:"h-[51px]"},Je={class:"flex bg-surface-0",style:{height:"calc(100vh - 52px)"}},Qe={class:"flex justify-center h-full"},Xe={class:"max-w-[400px] w-full"},ut=G({__name:"LessonView",setup(Y){const{locale:g}=H(),D=te(),S=W(),{setLesson:$}=S,f=Z(),{clearSlots:c}=f,R=me(),{setCode:x}=R,d=F(!1);async function C(){if(!d.value){d.value=!0;try{const{data:v}=await Se.getProjectByID(D.params.id.toString()),P=await $e(v,g.value);$(P)}catch(v){alert(v)}finally{d.value=!1}}}return se(C),ae(g,C),we(()=>{c(),x("")}),(v,P)=>{const h=pe,j=ie;return l(),k(O,null,[d.value?(l(),k("div",Ye)):(l(),p(Ae,{key:0})),m("div",Je,[r(j,{class:"w-full rounded-none"},{default:w(()=>[r(h,{size:33,minSize:10,class:"max-w-[467px] w-full"},{default:w(()=>[r(re)]),_:1}),r(h,{size:34,minSize:10},{default:w(()=>[r(j,{layout:"vertical",class:"h-full w-full"},{default:w(()=>[r(h,{size:65,minSize:10},{default:w(()=>[r(ce)]),_:1}),r(h,{size:35,minSize:10},{default:w(()=>[r(ue)]),_:1})]),_:1})]),_:1}),r(h,{size:33,minSize:10,class:le(["max-w-md mx-auto",{"animate-fadeinright animate-once animate-duration-1000 animate-ease-in-out":!0}])},{default:w(()=>[m("div",Qe,[m("div",Xe,[d.value?B("",!0):(l(),p(Oe,{key:0}))])])]),_:1})]),_:1})])],64)}}});export{ut as default};
