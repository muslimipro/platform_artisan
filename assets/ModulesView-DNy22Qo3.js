import{d as P,ad as F,j as L,ae as T,h as x,o as e,k as c,w as V,a as u,u as g,c as r,m as I,b as j,t as O,Y as S,e as N,s as q,r as U,af as Y,i as z,ag as G,f as H,A as J,F as b,n as C,x as K}from"./index-CN0vLODe.js";import{s as Q}from"./index-CclE1hzq.js";import{_ as W}from"./AHeader.vue_vue_type_script_setup_true_lang-CRBPjxWD.js";import{s as X}from"./logo-Qfc1U5yA.js";import{a as M,t as D}from"./types-CQVSShDx.js";import{P as Z}from"./pibody-BwAjMvHk.js";import{u as ee}from"./editor-store-JGYx2I6W.js";import{u as te,m as oe}from"./useSortable-CaKfWN2q.js";import"./LocaleSwitcher.vue_vue_type_script_setup_true_lang-B1X0D0G8.js";import"./index-LWceEU3M.js";import"./index-B8UTu9zp.js";const se={class:"p-0 w-32 h-40 relative"},ae={key:0,class:"absolute top-0 right-0"},re={key:0,class:"bg-yellow-500 text-white text-sm w-full px-2 py-[1px] rounded-tr-xl"},ne={key:1,class:"bg-green-500 text-white text-sm px-2 py-[1px] rounded-tr-xl"},le={class:"w-32 h-32 overflow-clip"},ie={class:"flex flex-col justify-between items-center px-4 py-1"},de={class:"pb-1 font-medium text-lg text-center line-clamp-2"},ue={class:"flex"},E=P({__name:"ModuleCard",props:{module:{}},emits:["after-remove"],setup(A,{emit:w}){const k=N(),f=F(),$=L(),{user:v}=T($),i=x(!1),n=A,R=w;function s(){f.require({message:"Are you sure you want to Delete?",header:"Confirmation",icon:"pi pi-exclamation-triangle",rejectProps:{label:"Cancel",severity:"secondary",outlined:!0},acceptProps:{label:"Delete",severity:"danger"},accept:()=>{h()}})}async function h(){i.value=!0;try{await M.deleteModuleByID(n.module.id),R("after-remove")}catch(d){console.log(d)}finally{i.value=!1}}function m(){k.push(`/module/${n.module.id}/edit`)}return(d,_)=>{const B=X,t=q,o=U("RouterLink");return e(),c(o,{to:i.value?"":`/module/${n.module.id}`},{default:V(()=>{var a,p,y;return[u("div",se,[((a=g(v))==null?void 0:a.user_type)=="editor"?(e(),r("div",ae,[n.module.editing_status=="inreview"?(e(),r("div",re," In review")):(e(),r("div",ne,"Published"))])):I("",!0),u("div",le,[j(B,{alt:"user header",src:n.module.cover_image.length>0?n.module.cover_image:g(Z),width:"128",height:"128",class:"animate-fadein animate-once animate-duration-1000 animate-ease-in-out"},null,8,["src"])]),u("div",ie,[u("div",de,O(n.module.title),1),u("div",ue,[((p=g(v))==null?void 0:p.user_type)=="editor"?(e(),c(t,{key:0,icon:"pi pi-pen-to-square",severity:"info",variant:"text",rounded:"","aria-label":"Edit",onClick:S(m,["prevent"])})):I("",!0),((y=g(v))==null?void 0:y.user_type)=="editor"?(e(),c(t,{key:1,icon:"pi pi-trash",severity:"danger",variant:"text",rounded:"","aria-label":"Remove",onClick:S(s,["prevent"]),disabled:i.value,loading:i.value},null,8,["disabled","loading"])):I("",!0)])])])]}),_:1},8,["to"])}}}),ce={class:"flex flex-col min-h-screen bg-slate-50"},me={class:"border border-dashed rounded-xl border-green-400 overflow-hidden h-fit"},pe={key:1,class:"flex flex-wrap justify-center gap-8 px-12 py-6"},Me=P({__name:"ModulesView",setup(A){const w=Y("el"),k=z(),{locale:f}=G(),$=N(),v=ee(),{addLesson:i}=v,n=L(),{user:R}=T(n),s=x([]),h=x(0),m=x(!1),d=x(!1);te(w,s,{onUpdate:t=>{oe(s.value,t.oldIndex,t.newIndex,t),K(async()=>{const o=[];s.value.map(a=>{const p=parseInt(a.id,10);o.push(p)});try{await M.changeModulesOrder(o),k.add({severity:"success",summary:"Modules order saved!",life:2e3})}catch(a){k.add({severity:"error",summary:"Order set error!",detail:a,life:2e3})}})}});async function _(){if(!m.value){m.value=!0;try{const{data:t}=await M.getModules();m.value=!1,s.value=[],h.value=t.length;for(const o of t){const a=await D(o,f.value);s.value.push(a)}}catch(t){console.log(t)}finally{m.value=!1}}}H(_),J(f,_);async function B(){d.value=!0;try{const{data:t}=await M.createModule(),o=await D(t,f.value);i(o),$.push(`/project/${o.id}/edit`)}catch(t){console.log(t)}finally{d.value=!1}}return(t,o)=>{var y;const a=Q,p=q;return e(),r("div",ce,[j(W),((y=g(R))==null?void 0:y.user_type)=="editor"?(e(),r("div",{key:0,ref_key:"el",ref:w,class:"flex flex-wrap justify-center gap-8 px-12 py-6"},[(e(!0),r(b,null,C(s.value,l=>(e(),c(E,{key:l.id,module:l,onAfterRemove:_},null,8,["module"]))),128)),(e(!0),r(b,null,C(h.value-s.value.length,l=>(e(),c(a,{key:l,width:"128px",height:"128px",class:"rounded-xl shadow-sm"}))),128)),u("div",me,[j(p,{variant:"text",style:{width:"128px",height:"128px"},class:"bg-green-50",onClick:B,loading:d.value,disabled:d.value},{icon:V(()=>o[0]||(o[0]=[u("i",{class:"pi pi-plus text-xl"},null,-1)])),_:1},8,["loading","disabled"])])],512)):(e(),r("div",pe,[(e(!0),r(b,null,C(s.value,l=>(e(),c(E,{key:l.id,module:l,onAfterRemove:_},null,8,["module"]))),128)),(e(!0),r(b,null,C(h.value-s.value.length,l=>(e(),c(a,{key:l,width:"128px",height:"128px",class:"rounded-xl shadow-sm"}))),128))]))])}}});export{Me as default};
