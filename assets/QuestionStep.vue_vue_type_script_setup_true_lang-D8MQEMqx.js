import{h as v}from"./index-D8v7f4pp.js";import{as as pe,n as de,p as fe,u as me,C as K,r as w,I as V,d as k,o as i,c as d,F as S,i as A,f as E,e as h,h as ve,v as G,t as x,b,w as ye,g as he,ar as ge,ap as _e,H as Q,m as we}from"./index-06dapWEh.js";import{s as be}from"./index-XkW4Jefx.js";import{_ as xe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{s as Se}from"./index-Db1rzZhZ.js";import{a as $e,s as ke}from"./index-CB6brtM2.js";import{s as Ie}from"./logo-DIHTJwoc.js";import{u as Ce,a as Be,b as Ve}from"./store-zh0bWUqn.js";const Ae={submitStep:Te,getStudentProjectStepsByID:Pe,getStudentStepTranslationByID:Me,resetStepsProgress:De,saveStudentStepStateByID:je};async function Pe(t){try{return await v.get(`/student/project/${t}/steps`)}catch(e){throw console.log(e),e}}async function Me(t,e){try{return await v.get(`/student/step/${t}/language/${e}`)}catch(n){throw console.log(n),n}}async function je(t,e,n){try{return await v.put(`/student/step/${t.id}/language/${e}/save`,n)}catch(s){throw console.log(s),s}}async function Te(t,e,n){try{return await v.put(`/student/step/${t}/language/${e}`,{student_answer:n})}catch(s){throw console.log(s),s}}async function De(t){try{return await v.delete(`/project/${t}/reset`)}catch(e){throw console.log(e),e}}async function Ee(t,e){const{data:n}=await Ae.getStudentStepTranslationByID(t.id.toString(),e),s=n;return{id:t.id.toString(),title:s.name,type:t.step_type,progress:t.status,inner:s.content,answer:s.user_answer,state:s.step_state,access_type:t.access_type,accessibility:t.accessibility,skip_submit:t.skip_submit}}const Le=pe("useLessonStore",()=>{const t=de(),{locale:e}=fe(),n=me(),s=Ce(),{newModuleToSlot:a,clearSlots:c,reset:y}=s,{slots:l,helpArrows:m,moduleComponents:$,isConnected:I,isLoading:M}=K(s),g=Be(),{fileContent:C}=K(g),{setCode:B}=g,J=Ve(),{setStdout:X,clear:N}=J,u=w(null),f=w(null),L=w(!1),R=w(!0),j=w(!0),Y=V(()=>R.value&&j.value),z=w(!1),F=w(!1),Z=V(()=>C.value);let T=0;function O(o){o!=null&&(u.value=o)}function ee(o){u.value!=null&&(u.value.steps=o,f.value!=null&&W(f.value))}function te(o){f.value=o}function se(o){u.value==null||f.value==null||(u.value.steps[f.value].progress=o)}function ne(o){u.value==null||f.value==null||f.value+1!=u.value.steps.length&&(u.value.steps[f.value+1].accessibility=o)}function oe(o,p){u.value==null||f.value==null||u.value.steps[f.value].inner.options!=null&&(u.value.steps[f.value].inner.options[p].correct=o)}async function W(o){var q,H;if(u.value==null)return;f.value=o;const p=u.value.steps[f.value];if(p.title==""){L.value=!0;const _=await Ee({id:p.id,status:p.progress,step_type:p.type,skip_submit:p.skip_submit,access_type:p.access_type,accessibility:p.accessibility},e.value);u.value.steps[o]=_,L.value=!1}const r=u.value.steps[f.value];if(y(),c(),U(),B(""),N(),F.value=!(((q=r.inner.platformActions)==null?void 0:q.includes("hide-ide"))??!1),z.value=!(((H=r.inner.platformActions)==null?void 0:H.includes("hide-sim"))??!1),r.progress=="nothing"||t.name=="module"){if(r.inner.platformActions!=null&&r.inner.platformActions!=null&&r.inner.platformActions.length>0)for(const _ of r.inner.platformActions){if(_=="code2ide"&&B(r.inner.starting??""),_=="auto-put"&&r.inner.highlights!=null)for(const D of r.inner.highlights)T++,a(D.module,D.slot);_=="auto-run"&&I.value&&!M.value&&(s.run(),n.add({severity:"success",summary:"Run is completed!",detail:"Code has successfully auto run",life:3e3}))}if(r.inner.userActions!=null&&r.inner.userActions!=null&&r.inner.userActions.length>0)for(const _ of r.inner.userActions)_=="put-module"&&(R.value=!1,c()),_=="run-code"&&(j.value=!1)}else{if(r.state==null||r.state==null)return;if(r.state.code!=null&&r.state.code!=null&&B(r.state.code),r.state.stdout!=null&&r.state.stdout!=null&&X(r.state.stdout),r.state.slots!=null&&r.state.slots!=null)for(const[_,D]of r.state.slots.entries()){const ue=String.fromCharCode(65+_);a(D,ue)}}}function re(o){u.value==null||f.value==null||(u.value.steps[f.value].state={code:o.code,stdout:o.stdout,slots:o.slots})}function le(){if(u.value==null||f.value==null)return;const o=u.value.steps[f.value];if(y(),c(),U(),B(""),N(),u.value.steps[f.value].state={code:"",stdout:"",slots:[]},o.inner.platformActions!=null&&o.inner.platformActions!=null&&o.inner.platformActions.length>0)for(const p of o.inner.platformActions){if(p=="code2ide"&&B(o.inner.starting??""),p=="auto-put"&&o.inner.highlights!=null)for(const r of o.inner.highlights)T++,a(r.module,r.slot);p=="auto-run"&&I.value&&!M.value&&(s.run(),n.add({severity:"success",summary:"Run is completed!",detail:"Code has successfully auto run",life:3e3}))}}function ae(o,p){if(o==="8"||o==="9")m.value[o].style={color:"rgba(0, 157, 255)"},m.value[o].visible=!0;else{const r=(o??"A").charCodeAt(0)-65;l.value[r].style={backgroundColor:"rgba(0, 157, 255, 0.26)",boxShadow:"0 0 15px rgb(0, 157, 255)"}}$.value.forEach(r=>{if(r.type==p){r.style={animation:"breathing 1s ease-out infinite normal",boxShadow:"0 0 15px rgb(0, 157, 255)",borderRadius:"10px"};return}})}function U(){for(let o=0;o<=5;o++)l.value[o].class="",l.value[o].style={};for(const o of $.value)o.class="",o.style={};for(const o in m.value){const p=m.value[o];p.visible=!1,p.style={},p.class=""}}function ie(){j.value=!0}function ce(o,p){T<=0?o===p?n.add({severity:"success",summary:"Correct, good job!",detail:"Module has been put successfully",life:3e3}):n.add({severity:"error",summary:"Wrong!",detail:"Keep trying",life:3e3}):T--}return{lesson:u,stepIndex:f,stepLoading:L,userCode:Z,submitEnabled:Y,modulesWerePut:R,codeWasRun:j,simVisible:z,ideVisible:F,setLesson:O,setSteps:ee,setStepIndex:te,updateStatus:se,updateAccess:ne,changeStep:W,runCodePressed:ie,saveOption:oe,lightUp:ae,clearSlotsModulesClasses:U,toastModulePut:ce,saveStepStateLocally:re,restartStep:le}}),Re={getSteps:Ue,createStep:Ne,getStepByID:ze,updateStepByID:Fe,deleteStepByID:We,getStepTranslationByID:qe,updateStepTranslationByID:He,getProjectStepsByID:Ke,linkStepToProjectByID:Qe,getModuleStepsByID:Ge,linkStepToModuleByID:Je,uploadFile:Xe,uploadImage:Ye,changeStepsOrder:Ze};async function Ue(){try{return await v.get("/steps")}catch(t){throw console.log(t),t}}async function Ne(t){try{return await v.post("/step",{last_edited_by:0,step_type:t,access_type:"freemium",skip_submit:!1})}catch(e){throw console.log(e),e}}async function ze(t){try{return await v.get(`/step/${t}`)}catch(e){throw console.log(e),e}}async function Fe(t,e,n,s){try{return await v.put(`/step/${t}`,{access_type:e,skip_submit:n,step_type:s})}catch(a){throw console.log(a),a}}async function We(t){try{return await v.delete(`/step/${t}`)}catch(e){throw console.log(e),e}}async function qe(t,e){try{return await v.get(`/step/${t}/translation/${e}`)}catch(n){throw console.log(n),n}}async function He(t,e,n,s){try{return await v.put(`/step/${t}/translation/${e}`,{content:s,name:n})}catch(a){throw console.log(a),a}}async function Ke(t){try{return await v.get(`/project/${t}/steps`)}catch(e){throw console.log(e),e}}async function Qe(t,e){try{return await v.post(`/project/${t}/step/${e}/link`)}catch(n){throw console.log(n),n}}async function Ge(t){try{return await v.get(`/module/${t}/steps`)}catch(e){throw console.log(e),e}}async function Je(t,e){try{return await v.post(`/module/${t}/step/${e}/link`)}catch(n){throw console.log(n),n}}async function Xe(t){try{return await v.post("/upload-file",t,{headers:{"Content-Type":"multipart/form-data"}})}catch(e){throw console.log(e),e}}async function Ye(t,e){try{return await v.post(`/upload-image?preview=${e}`,t,{headers:{"Content-Type":"multipart/form-data"}})}catch(n){throw console.log(n),n}}async function Ze(t){try{return await v.patch("/steps/order",{order:t})}catch(e){throw console.log(e),e}}async function Vt(t,e,n){const{data:s}=await Re.getStepTranslationByID(t.id.toString(),e),a=s;return{id:t.id.toString(),title:a.name,type:t.step_type,progress:"nothing",inner:n||a.content.contents==null?{contents:[],modules:[]}:a.content,access_type:t.access_type,skip_submit:t.skip_submit}}const Oe={class:"flex flex-col gap-2"},et={key:1},tt={key:0,style:{position:"relative",width:"100%",height:"0","padding-bottom":"56.25%"}},st=["src"],nt={key:1,style:{position:"relative","margin-left":"5%",width:"90%",height:"0","padding-bottom":"160%"}},ot=["src"],P=k({__name:"ContentsView",props:{contents:{}},setup(t){const e=t;function n(s){return s.replace("shorts","embed")}return(s,a)=>{const c=G("v-md-preview"),y=Ie;return i(),d("div",Oe,[(i(!0),d(S,null,A(e.contents,l=>{var m;return i(),d("div",{key:l.id},[l.type=="text"?(i(),E(c,{key:0,text:l.text},null,8,["text"])):l.type=="video"?(i(),d("div",et,[(m=l.text)!=null&&m.includes("embed")?(i(),d("div",tt,[h("iframe",{credentialless:"",src:n(l.text),style:{position:"absolute",top:"0",left:"0",width:"100%",height:"100%"},frameborder:"0",allowfullscreen:"",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",referrerpolicy:"strict-origin-when-cross-origin"},null,8,st),a[0]||(a[0]=h("iframe",null,null,-1))])):(i(),d("div",nt,[h("iframe",{credentialless:"",src:n(l.text??""),style:{position:"absolute",top:"0",left:"0",width:"100%",height:"100%"},frameborder:"0",allowfullscreen:"",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",referrerpolicy:"strict-origin-when-cross-origin"},null,8,ot)]))])):l.type=="image"?(i(),E(y,{key:2,src:l.src,alt:"Image",class:"rounded-xl object-cover h-64"},null,8,["src"])):ve("",!0)])}),128))])}}}),rt={class:"text-[33px] font-semibold mb-4 text-center border-b pb-2"},At=k({__name:"ArticleStep",props:{step:{},isPreview:{type:Boolean}},setup(t){const e=t;return(n,s)=>(i(),d(S,null,[h("div",rt,x(e.step.title),1),b(P,{contents:e.step.inner.contents},null,8,["contents"])],64))}}),lt={class:"text-[33px] font-semibold mb-4 text-center border-b pb-2"},Pt=k({__name:"CodeStep",props:{step:{},isPreview:{type:Boolean}},setup(t){const e=t;return(n,s)=>(i(),d(S,null,[h("div",lt,x(e.step.title),1),b(P,{contents:e.step.inner.contents},null,8,["contents"])],64))}}),at={class:"flex flex-col gap-4"},it={class:"text-[33px] font-semibold mb-4 text-center border-b pb-2"},ct={class:"flex w-full justify-between"},ut={class:"flex flex-col gap-2"},pt={class:"w-40 mb-[29px] border rounded-lg h-[40px] place-items-center bg-white",draggable:"true"},dt={class:"content-center h-full"},ft={class:"flex flex-col gap-2"},mt=k({__name:"MatchStep",props:{step:{},isPreview:{type:Boolean}},setup(t){const e=t,n=V(()=>{var a;return(a=e.step.inner.pairs)==null?void 0:a.map(c=>c.key)}),s=V(()=>{var a;return(a=e.step.inner.pairs)==null?void 0:a.map(c=>c.value)});return(a,c)=>{const y=be;return i(),d("div",at,[h("div",it,x(e.step.title),1),b(P,{contents:e.step.inner.contents},null,8,["contents"]),h("div",ct,[h("div",ut,[(i(!0),d(S,null,A(n.value,l=>(i(),d("div",{key:l,class:"flex flex-col"},[h("div",pt,[h("div",dt,x(l),1)])]))),128))]),h("div",ft,[(i(!0),d(S,null,A(s.value,l=>(i(),d("div",{key:l,class:"flex flex-col"},[c[0]||(c[0]=h("div",{class:"w-40 h-10 border-dashed border-gray-300 rounded-border border-x border-y"},null,-1)),b(y,{size:"small",severity:"warn",variant:"simple",class:"mb-2"},{default:ye(()=>[he(x(l.length>0?l:"..."),1)]),_:2},1024)]))),128))])])])}}}),Mt=xe(mt,[["__scopeId","data-v-265024ce"]]),vt={class:"flex flex-col gap-4"},yt={class:"text-[33px] font-semibold mb-4 text-center border-b pb-2"},jt=k({__name:"OpenStep",props:ge({step:{},isPreview:{type:Boolean}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(t){const e=_e(t,"modelValue"),n=t,s=w(null);return(a,c)=>{const y=Se;return i(),d("div",vt,[h("div",yt,x(n.step.title),1),b(P,{contents:n.step.inner.contents},null,8,["contents"]),n.isPreview?(i(),E(y,{key:0,type:"text",modelValue:s.value,"onUpdate:modelValue":c[0]||(c[0]=l=>s.value=l),size:"small",placeholder:"Enter your answer"},null,8,["modelValue"])):(i(),E(y,{key:1,type:"text",modelValue:e.value,"onUpdate:modelValue":c[1]||(c[1]=l=>e.value=l),size:"small",placeholder:"Enter your answer"},null,8,["modelValue"]))])}}}),ht={class:"flex flex-col gap-4"},gt={class:"text-[33px] font-semibold mb-4 text-center border-b pb-2"},_t={key:0,class:"flex flex-col gap-4 ml-4"},wt={key:1,class:"flex flex-col gap-4 ml-4"},Tt=k({__name:"QuestionStep",props:{step:{},isPreview:{type:Boolean}},setup(t){const e=Le(),{saveOption:n}=e,s=t,a=V(()=>s.step.inner.single),c=w(null),y=w([]);return Q([y],()=>{if(!s.isPreview&&s.step.inner.options!=null&&!s.step.inner.single)for(const[l,m]of s.step.inner.options.entries())n(y.value.some($=>$==m.text),l)}),Q([c],()=>{if(!s.isPreview&&s.step.inner.options!=null&&s.step.inner.single)for(const[l,m]of s.step.inner.options.entries())n(c.value==m.text,l)}),we(()=>{if(!s.isPreview&&s.step.inner.options!=null&&(c.value=null,y.value=[],s.step.answer.question))for(const[l,m]of s.step.inner.options.entries())s.step.answer.question[l]&&(y.value.push(m.text),c.value=m.text)}),(l,m)=>{const $=$e,I=G("v-md-preview"),M=ke;return i(),d("div",ht,[h("div",gt,x(s.step.title),1),b(P,{contents:s.step.inner.contents},null,8,["contents"]),a.value?(i(),d("div",_t,[(i(!0),d(S,null,A(s.step.inner.options,g=>(i(),d("div",{key:g.id,class:"flex gap-2"},[b($,{modelValue:c.value,"onUpdate:modelValue":m[0]||(m[0]=C=>c.value=C),inputId:g.id,name:"dynamic",value:g.text,class:"mt-1"},null,8,["modelValue","inputId","value"]),b(I,{text:g.text},null,8,["text"])]))),128))])):(i(),d("div",wt,[(i(!0),d(S,null,A(s.step.inner.options,g=>(i(),d("div",{key:g.id,class:"flex gap-2"},[b(M,{modelValue:y.value,"onUpdate:modelValue":m[1]||(m[1]=C=>y.value=C),inputId:g.id,name:"option",value:g.text,class:"mt-1"},null,8,["modelValue","inputId","value"]),b(I,{text:g.text},null,8,["text"])]))),128))]))])}}});export{Mt as M,At as _,Ae as a,Re as b,Vt as c,Pt as d,jt as e,Tt as f,Ee as t,Le as u};
