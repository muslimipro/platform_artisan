import{d as L,ad as F,j as P,ae as T,h as _,o as t,k as u,w as V,a as c,b as B,u as b,t as O,Y as A,m as S,e as N,s as q,r as U,af as Y,i as z,ag as G,f as H,A as J,c as d,F as w,n as k,x as K}from"./index-F0pUg8he.js";import{s as Q}from"./index-PwjCpPjq.js";import{_ as W}from"./AHeader.vue_vue_type_script_setup_true_lang-C9pEPMfQ.js";import{s as X}from"./logo-Dz7jfZKw.js";import{a as C,t as D}from"./types-s68REKEc.js";import{P as Z}from"./pibody-BwAjMvHk.js";import{u as ee,a as te,m as oe}from"./useSortable-0qs7pghJ.js";import"./LocaleSwitcher.vue_vue_type_script_setup_true_lang-BKXHChUD.js";import"./index-VUcTiFhv.js";import"./index-2f9_IIyA.js";const se={class:"p-0 w-32 h-40"},ae={class:"w-32 h-32 overflow-clip"},ne={class:"flex flex-col justify-between items-center px-4 py-1"},re={class:"pb-1 font-medium text-lg text-center line-clamp-2"},le={class:"flex"},E=L({__name:"ModuleCard",props:{module:{}},emits:["after-remove"],setup(j,{emit:y}){const g=N(),f=F(),M=P(),{user:x}=T(M),l=_(!1),r=j,$=y;function s(){f.require({message:"Are you sure you want to Delete?",header:"Confirmation",icon:"pi pi-exclamation-triangle",rejectProps:{label:"Cancel",severity:"secondary",outlined:!0},acceptProps:{label:"Delete",severity:"danger"},accept:()=>{v()}})}async function v(){l.value=!0;try{await C.deleteModuleByID(r.module.id),$("after-remove")}catch(i){console.log(i)}finally{l.value=!1}}function m(){g.push(`/module/${r.module.id}/edit`)}return(i,h)=>{const R=X,e=q,o=U("RouterLink");return t(),u(o,{to:l.value?"":`/module/${r.module.id}`},{default:V(()=>{var a,p;return[c("div",se,[c("div",ae,[B(R,{alt:"user header",src:r.module.cover_image.length>0?r.module.cover_image:b(Z),width:"128",height:"128",class:"animate-fadein animate-once animate-duration-1000 animate-ease-in-out"},null,8,["src"])]),c("div",ne,[c("div",re,O(r.module.title),1),c("div",le,[((a=b(x))==null?void 0:a.user_type)=="editor"?(t(),u(e,{key:0,icon:"pi pi-pen-to-square",severity:"info",variant:"text",rounded:"","aria-label":"Edit",onClick:A(m,["prevent"])})):S("",!0),((p=b(x))==null?void 0:p.user_type)=="editor"?(t(),u(e,{key:1,icon:"pi pi-trash",severity:"danger",variant:"text",rounded:"","aria-label":"Remove",onClick:A(s,["prevent"]),disabled:l.value,loading:l.value},null,8,["disabled","loading"])):S("",!0)])])])]}),_:1},8,["to"])}}}),ie={class:"flex flex-col min-h-screen bg-slate-50"},de={class:"border border-dashed rounded-xl border-green-400 overflow-hidden h-fit"},ce={key:1,class:"flex flex-wrap justify-center gap-8 px-12 py-6"},we=L({__name:"ModulesView",setup(j){const y=Y("el"),g=z(),{locale:f}=G(),M=N(),x=ee(),{addLesson:l}=x,r=P(),{user:$}=T(r),s=_([]),v=_(0),m=_(!1),i=_(!1);te(y,s,{onUpdate:e=>{oe(s.value,e.oldIndex,e.newIndex,e),K(async()=>{const o=[];s.value.map(a=>{const p=parseInt(a.id,10);o.push(p)});try{await C.changeModulesOrder(o),g.add({severity:"success",summary:"Modules order saved!",life:2e3})}catch(a){g.add({severity:"error",summary:"Order set error!",detail:a,life:2e3})}})}});async function h(){if(!m.value){m.value=!0;try{const{data:e}=await C.getModules();m.value=!1,s.value=[],v.value=e.length;for(const o of e){const a=await D(o,f.value);s.value.push(a)}}catch(e){console.log(e)}finally{m.value=!1}}}H(h),J(f,h);async function R(){i.value=!0;try{const{data:e}=await C.createModule(),o=await D(e,f.value);l(o),M.push(`/project/${o.id}/edit`)}catch(e){console.log(e)}finally{i.value=!1}}return(e,o)=>{var I;const a=Q,p=q;return t(),d("div",ie,[B(W),((I=b($))==null?void 0:I.user_type)=="editor"?(t(),d("div",{key:0,ref_key:"el",ref:y,class:"flex flex-wrap justify-center gap-8 px-12 py-6"},[(t(!0),d(w,null,k(s.value,n=>(t(),u(E,{key:n.id,module:n,onAfterRemove:h},null,8,["module"]))),128)),(t(!0),d(w,null,k(v.value-s.value.length,n=>(t(),u(a,{key:n,width:"128px",height:"128px",class:"rounded-xl shadow-sm"}))),128)),c("div",de,[B(p,{variant:"text",style:{width:"128px",height:"128px"},class:"bg-green-50",onClick:R,loading:i.value,disabled:i.value},{icon:V(()=>o[0]||(o[0]=[c("i",{class:"pi pi-plus text-xl"},null,-1)])),_:1},8,["loading","disabled"])])],512)):(t(),d("div",ce,[(t(!0),d(w,null,k(s.value,n=>(t(),u(E,{key:n.id,module:n,onAfterRemove:h},null,8,["module"]))),128)),(t(!0),d(w,null,k(v.value-s.value.length,n=>(t(),u(a,{key:n,width:"128px",height:"128px",class:"rounded-xl shadow-sm"}))),128))]))])}}});export{we as default};
