import{T as fe}from"./index-DkaXnnPS.js";import{s as me}from"./index-BbIkPId2.js";import{b as ge}from"./index-B3L0Koby.js";import{d as he,u as ve,A as ye,p as _e,r as d,C as be,I as $e,m as we,o,f as h,w as t,c as f,t as r,e as n,b as a,g as v,j as I,h as C,F as x,i as D,P as Ce,D as O,n as xe,k as ke,aF as Te,s as ze,_ as Fe}from"./index-CFTsbYyj.js";import{s as je,a as Se}from"./index-Ich0pWJy.js";import{s as De}from"./index-BEfUyxdS.js";import{s as Ve,a as Ne}from"./index-C6RtEiRg.js";import{s as Pe}from"./index-ShhDbwX4.js";import{s as Ie}from"./index-DSxAlNAa.js";import{a as Be,s as Re}from"./index-Bh2w5Fai.js";import{s as Me}from"./index-jL52Hg50.js";import{s as Ue}from"./index-Ctb6zsXk.js";import{u as Ae,S as k}from"./useSchoolStore-f2J2IaZl.js";import{a as He}from"./index-DiMhF6O9.js";import"./index-B3U6P8R9.js";import"./index-DM2DgLdl.js";import"./index-rUX6T0Ty.js";import"./index-zHRJOT5a.js";import"./index-UAtXboEB.js";import"./index-BBwnMfvS.js";const qe={key:1},Ge={key:2,class:"flex flex-col items-start px-8 pb-4 gap-4"},Le={class:"flex items-center justify-between gap-2 w-full"},Oe={class:"flex flex-col gap-2"},Ee={class:"text-3xl"},Ke={class:"text-sm"},Je={class:"flex items-center px-4 self-end"},Qe={class:"text-xl mr-2"},We={class:"text-gray-500"},Xe={class:"flex items-center"},Ye={class:"flex-grow flex gap-2 items-center"},Ze={class:"text-xl text-gray-500"},es={class:"w-4 h-4 rounded-md text-[10px] font-semibold flex justify-center items-center bg-gray-300"},ss={class:"flex justify-center text-[124px]"},as={class:"flex justify-between items-center mb-8"},ts={class:"flex justify-end gap-2"},Ts=he({__name:"ClassView",setup(ls){const T=ve(),B=ye(),y=xe(),R=ke(),{t:u}=_e(),E=d(),_=d();(()=>{_.value={global:{value:null,matchMode:Te.CONTAINS}}})();const M=Ae(),{teachers:U,school:K}=be(M),{loadClasses:J}=M,g=d(null),A=d([]),z=d([]),F=d(!1),j=d(!1),S=d(!1),V=d(!1),b=d(!1),$=d(null);async function N(){if(!F.value){F.value=!0;try{const{data:e}=await k.getClass(Number(y.params.id));g.value=e??null,$.value=U.value.find(l=>{var p;return l.teacher_id==((p=g.value)==null?void 0:p.creator)})??null}catch(e){console.log(e)}finally{F.value=!1}}}async function Q(){if(!j.value){j.value=!0;try{const{data:e}=await k.getClassStudents(Number(y.params.id));A.value=e??null}catch(e){console.log(e)}finally{j.value=!1}}}async function W(){try{const{data:e}=await He.getProjects();z.value=e}catch(e){console.log(e)}}const X=["secondary","success","info","warn","danger","contrast"],H=$e(()=>{const e={};for(const l of z.value){let p=l.layer;p==0&&(p=999);const m=l.is_guidable?"learn":"practice";e[p]||(e[p]={learn:0,practice:0}),e[p][m]++}return e});we(()=>{N(),W(),Q()});function Y(){B.require({message:u("pages.school.confirmDeleteClass"),header:u("pages.school.confirmHeader"),icon:"pi pi-exclamation-triangle",rejectProps:{label:u("pages.school.confirmCancel"),severity:"secondary",outlined:!0},acceptProps:{label:u("pages.school.confirmDeleteBtn"),severity:"danger"},accept:()=>{Z(Number(y.params.id))}})}async function Z(e){try{await k.deleteClass(e),await J(),R.go(-1),T.add({severity:"success",summary:u("pages.school.classRemoved"),life:2e3})}catch(l){T.add({severity:"error",summary:u("pages.school.removeClassFailed"),detail:l,life:2e3})}}async function ee(){if($.value){S.value=!0;try{await k.assignTeacherToClass(Number(y.params.id),$.value.teacher_id),await N()}catch(e){console.log(e)}finally{S.value=!1,b.value=!1}}}function se(){B.require({message:u("pages.school.confirmDeleteTeacher"),header:u("pages.school.confirmHeader"),icon:"pi pi-exclamation-triangle",rejectProps:{label:u("pages.school.confirmCancel"),severity:"secondary",outlined:!0},acceptProps:{label:u("pages.school.confirmDeleteBtn"),severity:"danger"},accept:()=>{ae()}})}async function ae(){try{await k.assignTeacherToClass(Number(y.params.id)),await N(),T.add({severity:"success",summary:u("pages.school.teacherRemoved"),life:2e3})}catch(e){T.add({severity:"error",summary:u("pages.school.removeTeacherFailed"),detail:e,life:2e3})}}return(e,l)=>{const p=Ue,m=ze,te=Be,le=Me,oe=Re,i=je,re=Ie,P=Ve,q=Pe,ne=Ne,ie=De,ce=Se,G=Fe,ue=ge,de=me,pe=fe;return o(),h(de,{class:"min-w-0 flex-grow flex flex-col gap-2"},{default:t(()=>{var L;return[F.value?(o(),h(p,{key:0,class:"flex justify-center"})):g.value?(o(),f("div",Ge,[n("div",Le,[n("div",Oe,[n("div",Ee,r(g.value.name),1),n("div",Ke,r(e.$t("pages.school.since"))+" "+r(g.value.created_time.split("T")[0]),1)]),a(m,{icon:"pi pi-hashtag",label:e.$t("pages.school.classCode"),severity:"info",onClick:l[0]||(l[0]=s=>V.value=!0)},null,8,["label"])]),n("div",Je,[n("div",Qe,[n("span",We,r(e.$t("pages.school.classTeacher")),1),v(": "+r(g.value.creator_name),1)]),a(m,{icon:"pi pi-pencil",severity:"info",variant:"text",rounded:"",onClick:l[1]||(l[1]=s=>b.value=!0)}),g.value.creator!=((L=I(K))==null?void 0:L.manager_id)?(o(),h(m,{key:0,icon:"pi pi-trash",severity:"danger",variant:"text",rounded:"",onClick:se})):C("",!0)]),a(ce,{ref_key:"dt",ref:E,filters:_.value,"onUpdate:filters":l[3]||(l[3]=s=>_.value=s),value:A.value,dataKey:"id",loading:j.value,scrollable:"",globalFilterFields:["name","email"],class:"overflow-hidden w-full",paginator:"",rows:25,rowsPerPageOptions:[5,10,25],groupHeader:!0,showGridlines:""},{header:t(()=>[n("div",Xe,[n("div",Ye,[n("div",Ze,r(e.$t("pages.school.students")),1)]),a(oe,null,{default:t(()=>[a(te,null,{default:t(()=>l[8]||(l[8]=[n("i",{class:"pi pi-search"},null,-1)])),_:1}),a(le,{modelValue:_.value.global.value,"onUpdate:modelValue":l[2]||(l[2]=s=>_.value.global.value=s),placeholder:e.$t("pages.school.search")},null,8,["modelValue","placeholder"])]),_:1})])]),empty:t(()=>[v(r(e.$t("pages.school.noStudentsFound")),1)]),loading:t(()=>[v(r(e.$t("pages.school.loadingStudents")),1)]),default:t(()=>[a(ne,{type:"header"},{default:t(()=>[a(P,null,{default:t(()=>[a(i,{header:e.$t("pages.school.projects"),rowspan:2,colspan:2,frozen:!0,alignFrozen:"left"},null,8,["header"]),(o(!0),f(x,null,D(H.value,(s,c)=>(o(),h(i,{key:c,colspan:s.learn+s.practice},{header:t(()=>[a(re,{class:"w-full text-md px-2",severity:c==999?"secondary":X[c]},{default:t(()=>[v(r(c==999?e.$t("pages.school.other"):`${e.$t("pages.school.level")} ${c}`),1)]),_:2},1032,["severity"])]),_:2},1032,["colspan"]))),128)),a(i,{header:"",rowspan:2,colspan:2,frozen:!0,alignFrozen:"right"})]),_:1}),a(P,null,{default:t(()=>[(o(!0),f(x,null,D(H.value,(s,c)=>(o(),f(x,{key:c},[s.learn>0?(o(),h(i,{key:0,colspan:s.learn},{header:t(()=>[a(q,{class:"w-full flex justify-center",size:"small",severity:"success"},{default:t(()=>[v(r(e.$t("pages.projects.learn")),1)]),_:1})]),_:2},1032,["colspan"])):C("",!0),s.practice>0?(o(),h(i,{key:1,colspan:s.practice},{header:t(()=>[a(q,{class:"w-full flex justify-center",size:"small",severity:"info"},{default:t(()=>[v(r(e.$t("pages.projects.practice")),1)]),_:1})]),_:2},1032,["colspan"])):C("",!0)],64))),128))]),_:1}),a(P,null,{default:t(()=>[a(i,{header:e.$t("pages.school.avatar"),frozen:!0,alignFrozen:"left"},null,8,["header"]),a(i,{header:e.$t("pages.school.name"),frozen:!0,alignFrozen:"left",sortable:"",field:"name"},null,8,["header"]),(o(!0),f(x,null,D(z.value,(s,c)=>(o(),h(i,{key:s.id,field:s.id},{header:t(()=>[Ce((o(),f("div",es,[v(r(c+1),1)])),[[pe,{value:s.id.toString()},void 0,{top:!0}]])]),body:t(({data:w})=>[w.projects[c].student_progress>0?(o(),f("div",{key:0,class:O(["w-4 h-4 mx-4 rounded-full text-[10px] flex justify-center items-center text-white",w.projects[c].student_progress==100?"bg-green-400":"bg-orange-400"])},null,2)):C("",!0)]),_:2},1032,["field"]))),128)),a(i,{header:e.$t("pages.school.xp"),frozen:!0,alignFrozen:"right",sortable:"",field:"xp"},null,8,["header"]),a(i,{header:"",frozen:!0,alignFrozen:"right"})]),_:1})]),_:1}),a(i,{field:"small_avatar_url",header:e.$t("pages.school.avatar"),sortable:"",frozen:!0,alignFrozen:"left"},{body:t(({data:s})=>[a(ie,{image:s.small_avatar_url},null,8,["image"])]),_:1},8,["header"]),a(i,{field:"name",header:e.$t("pages.school.name"),sortable:"",frozen:!0,alignFrozen:"left"},{body:t(({data:s})=>[n("div",null,r(`${s.name.length>0?s.name:s.email}`),1)]),_:1},8,["header"]),(o(!0),f(x,null,D(z.value,(s,c)=>(o(),h(i,{key:s.id,field:s.id},{body:t(({data:w})=>[w.projects[c].student_progress>0?(o(),f("div",{key:0,class:O(["w-4 h-4 rounded-full text-[10px] flex justify-center items-center text-white",w.projects[c].student_progress==100?"bg-green-400":"bg-orange-400"])},null,2)):C("",!0)]),_:2},1032,["field"]))),128)),a(i,{field:"xp",header:e.$t("pages.school.xp"),sortable:"",frozen:!0,alignFrozen:"right"},{body:t(({data:s})=>[n("div",null,r(`${s.xp}xp`),1)]),_:1},8,["header"]),a(i,{exportable:!1,frozen:!0,alignFrozen:"right"},{body:t(({data:s})=>[a(m,{icon:"pi pi-angle-right",outlined:"",rounded:"",severity:"info",onClick:c=>I(R).push({name:"school-student",params:{id:s.id}})},null,8,["onClick"])]),_:1})]),_:1},8,["filters","value","loading"]),a(m,{icon:"pi pi-trash",label:e.$t("pages.school.remove"),severity:"danger",onClick:Y,class:"self-end"},null,8,["label"])])):(o(),f("div",qe,r(e.$t("pages.school.noData")),1)),a(G,{visible:V.value,"onUpdate:visible":l[4]||(l[4]=s=>V.value=s),modal:"",header:e.$t("pages.school.classCode")},{default:t(()=>{var s;return[n("div",ss,r((s=g.value)==null?void 0:s.code),1)]}),_:1},8,["visible","header"]),a(G,{visible:b.value,"onUpdate:visible":l[7]||(l[7]=s=>b.value=s),modal:"",header:e.$t("pages.school.assignTeacher"),closable:!1},{default:t(()=>[n("div",as,[a(ue,{modelValue:$.value,"onUpdate:modelValue":l[5]||(l[5]=s=>$.value=s),options:I(U),"option-label":"email",placeholder:e.$t("pages.school.selectTeacher")},null,8,["modelValue","options","placeholder"])]),n("div",ts,[a(m,{type:"button",label:e.$t("pages.school.cancel"),severity:"secondary",onClick:l[6]||(l[6]=s=>b.value=!1)},null,8,["label"]),a(m,{type:"button",label:e.$t("pages.school.assign"),onClick:ee,loading:S.value,disabled:S.value},null,8,["label","loading","disabled"])])]),_:1},8,["visible","header"])]}),_:1})}}});export{Ts as default};
