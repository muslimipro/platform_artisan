import{s as he,S as be,_ as ke,T as we,a as xe}from"./SimulationView-T0mx162f.js";import{u as R,a as O,t as Se,L as $e,s as je,p as Ce,l as ze,b as Pe,e as Ie,c as Be,d as Le,f as De}from"./store-DEjHWkQz.js";import{d as A,af as K,u as J,ag as Q,g as le,ad as E,r as M,l as ee,y as te,o as t,c as m,a as h,b as g,e,h as n,F as Z,k as se,ah as H,j as y,w as q,ai as ie,t as X,s as W,aj as re,f as Ve,n as ce,ak as qe,al as Me}from"./index-CFuF3Kxc.js";import{s as ue,a as pe}from"./index-CHXGTgEl.js";import{L as de,s as ae}from"./logo-Btmn_lIa.js";import{_ as me}from"./LocaleSwitcher.vue_vue_type_script_setup_true_lang-B0Z-hDOF.js";import{a as oe,t as Fe,_ as fe,b as ve,M as _e,c as ge,d as Y}from"./QuestionStep.vue_vue_type_script_setup_true_lang-HRY4jtkf.js";import{a as Ne,t as Ee}from"./types-CPztcyMg.js";import{a as Te,t as Ue}from"./types-DOv1F9Ha.js";import"./pibody-BwAjMvHk.js";import"./http-PPAb52Uj.js";import"./index-Do9Zfnqk.js";import"./index-BqSliFxk.js";const Oe={class:"mx-auto flex items-center justify-between p-2 px-6 w-full bg-white"},Re={class:"flex flex-1 items-center"},Ae={key:1,class:"flex items-center gap-1"},Ze={class:"flex items-center gap-1"},Ge={class:"flex flex-1 justify-end items-center gap-2"},He={class:"relative overflow-hidden w-full border-0 bg-transparent flex items-start p-2 pl-4 rounded-none cursor-pointer transition-colors duration-200"},Xe={class:"inline-flex flex-col items-start"},Ke={class:"font-bold"},Qe={class:"text-sm"},We=A({__name:"LessonHeader",setup(G){const{locale:S}=K(),f=J(),$=Q(),d=le(),{user:l}=E(d),c=R(),{lesson:i,stepIndex:j,stepLoading:P,firstUncompletedIndex:B}=E(c),{changeStep:D,setSteps:z,setStepIndex:b,setFirstUncompletedIndex:s}=c,C=M(!1),k=M(!1);function I(a,_){if(_)return"info";if(a!="completed")return a=="attempted"?"warn":(a=="started","secondary")}function v(a,_){if(!_&&a!="completed")return a=="attempted"||a=="started"?"outlined":void 0}function N(a){switch(a){case"article":return"pi pi-align-left";case"code":return"pi pi-code";case"question":return"pi pi-question";case"matching":return"pi pi-arrows-h";case"open":return"pi pi-pencil";default:return"pi pi-align-left"}}async function T(){if(!C.value){C.value=!0;try{const{data:a}=await O.getStudentProjectStepsByID($.params.id.toString()),_=[];for(const[u,x]of a.steps.entries())if(x.id==a.last_step_id){b(u);const U=await Se(x,S.value);_.push(U)}else{const U={id:x.id.toString(),title:"",type:x.step_type,progress:x.status,inner:{contents:[],modules:[]},answer:{}};_.push(U)}z(_);let L=0;for(let u=0;u<_.length;u++)if(_[u].progress!="completed"||u==_.length-1){L=u;break}s(L)}catch(a){alert(a)}finally{C.value=!1}}}ee(T),te(S,T,{immediate:!1});const o=M(),r=M([{label:"Log out",icon:"pi pi-sign-out",command:()=>{d.logout(),f.replace({name:"login"})}}]),p=a=>{o.value.toggle(a)};async function w(){if(!k.value){k.value=!0;try{await O.resetStepsProgress($.params.id.toString()),window.location.reload()}catch(a){alert(a)}finally{k.value=!1}}}return(a,_)=>{var ne;const L=ae,u=W,x=ue,U=pe,ye=re;return t(),m("div",Oe,[h("div",Re,[g(L,{src:e(de),width:"32"},null,8,["src"]),_[1]||(_[1]=h("p",{class:"text-xl font-semibold px-2 mr-4"},"Artisan",-1)),g(u,{icon:"pi pi-angle-left",label:"Back",severity:"secondary",variant:"text",onClick:_[0]||(_[0]=V=>e(f).go(-1)),size:"small"})]),C.value||e(i)==null?(t(),n(x,{key:0,shape:"circle",size:"2rem",class:"mr-2"})):(t(),m("div",Ae,[h("div",Ze,[(t(!0),m(Z,null,se(e(i).steps,(V,F)=>(t(),n(u,{key:V.id,icon:N(V.type),rounded:"",severity:I(V.progress,F==e(j)),variant:v(V.progress,F==e(j)),class:H([{"bg-orange-100":V.progress=="attempted"&&F!=e(j)},"h-8 w-8"]),onClick:It=>e(D)(F),disabled:e(P)||V.progress!="completed"&&F!=e(B),loading:F==e(j)&&e(P)},null,8,["icon","severity","variant","class","onClick","disabled","loading"]))),128))])])),h("div",Ge,[((ne=e(l))==null?void 0:ne.user_type)=="editor"?(t(),n(u,{key:0,label:"Reset",icon:"pi pi-refresh",severity:"info",variant:"outlined",size:"small",onClick:w,disabled:k.value,loading:k.value},null,8,["disabled","loading"])):y("",!0),g(me),g(u,{type:"button",icon:"pi pi-ellipsis-v",onClick:p,"aria-haspopup":"true","aria-controls":"overlay_menu",size:"small",variant:"outlined",severity:"secondary",class:"border border-slate-300 bg-slate-50",style:{width:"34px"}}),g(U,{ref_key:"menu",ref:o,id:"overlay_menu",model:r.value,popup:!0},{start:q(()=>{var V,F;return[ie((t(),m("button",He,[h("span",Xe,[h("span",Ke,X((V=e(l))==null?void 0:V.email),1),h("span",Qe,X((F=e(l))==null?void 0:F.user_type),1)])])),[[ye]])]}),_:1},8,["model"])])])}}}),Ye={class:"mx-auto flex items-center justify-between p-2 px-6 w-full bg-white"},Je={class:"flex flex-1 items-center"},et={key:1,class:"flex items-center gap-1"},tt={class:"flex items-center gap-1"},st={class:"flex flex-1 justify-end items-center gap-2"},at={class:"relative overflow-hidden w-full border-0 bg-transparent flex items-start p-2 pl-4 rounded-none cursor-pointer transition-colors duration-200"},nt={class:"inline-flex flex-col items-start"},ot={class:"font-bold"},lt={class:"text-sm"},it=A({__name:"OpenLessonHeader",setup(G){const{locale:S}=K(),f=J(),$=Q(),d=le(),{user:l}=E(d),c=R(),{lesson:i,stepIndex:j,stepLoading:P}=E(c),{changeStep:B,setSteps:D,setStepIndex:z}=c,b=M(!1);function s(o){return o?"info":"secondary"}function C(o){}function k(o){switch(o){case"article":return"pi pi-align-left";case"code":return"pi pi-code";case"question":return"pi pi-question";case"matching":return"pi pi-arrows-h";case"open":return"pi pi-pencil";default:return"pi pi-align-left"}}async function I(){if(!b.value){b.value=!0;try{const{data:o}=await($.name=="module"?oe.getModuleStepsByID($.params.id.toString()):oe.getProjectStepsByID($.params.id.toString())),r=[];for(const[p,w]of o.entries())if(p==0){z(p);const a=await Fe(w,S.value,!1);r.push(a)}else{const a={id:w.id.toString(),title:"",type:w.step_type,progress:"nothing",inner:{contents:[],modules:[]},answer:{}};r.push(a)}D(r)}catch(o){alert(o)}finally{b.value=!1}}}ee(I),te(S,I,{immediate:!1});const v=M(),N=M([{label:"Log out",icon:"pi pi-sign-out",command:()=>{d.logout(),f.replace({name:"login"})}}]),T=o=>{v.value.toggle(o)};return(o,r)=>{const p=ae,w=W,a=ue,_=pe,L=re;return t(),m("div",Ye,[h("div",Je,[g(p,{src:e(de),width:"32"},null,8,["src"]),r[1]||(r[1]=h("p",{class:"text-xl font-semibold px-2 mr-4"},"Artisan",-1)),g(w,{icon:"pi pi-angle-left",label:"Back",severity:"secondary",variant:"text",onClick:r[0]||(r[0]=u=>e(f).go(-1)),size:"small"})]),b.value||e(i)==null?(t(),n(a,{key:0,shape:"circle",size:"2rem",class:"mr-2"})):(t(),m("div",et,[h("div",tt,[(t(!0),m(Z,null,se(e(i).steps,(u,x)=>(t(),n(w,{key:u.id,icon:k(u.type),rounded:"",severity:s(x==e(j)),variant:(x==e(j),void 0),class:H([{"bg-orange-100":u.progress=="attempted"&&x!=e(j)},"h-8 w-8"]),onClick:U=>e(B)(x),disabled:e(P),loading:x==e(j)&&e(P)},null,8,["icon","severity","variant","class","onClick","disabled","loading"]))),128))])])),h("div",st,[g(me),g(w,{type:"button",icon:"pi pi-ellipsis-v",onClick:T,"aria-haspopup":"true","aria-controls":"overlay_menu",size:"small",variant:"outlined",severity:"secondary",class:"border border-slate-300 bg-slate-50",style:{width:"34px"}}),g(_,{ref_key:"menu",ref:v,id:"overlay_menu",model:N.value,popup:!0},{start:q(()=>{var u,x;return[ie((t(),m("button",at,[h("span",nt,[h("span",ot,X((u=e(l))==null?void 0:u.email),1),h("span",lt,X((x=e(l))==null?void 0:x.user_type),1)])])),[[L]])]}),_:1},8,["model"])])])}}}),rt={class:"flex flex-col p-4 gap-4 overflow-scroll h-full justify-between bg-white"},ct={key:0},ut={key:1,class:"flex"},pt={class:"flex justify-end gap-2"},dt=A({__name:"LessonDiv",setup(G){const{locale:S}=K(),f=J(),$=Ve(),d=R(),{lesson:l,stepIndex:c,userCode:i,firstUncompletedIndex:j,submitEnabled:P}=E(d),{changeStep:B,updateStatus:D,incrementFirstUncompletedIndex:z}=d,b=M(!1),s=ce(()=>{var o;return c.value==null?null:((o=l.value)==null?void 0:o.steps[c.value])??null});async function C(){c.value!=null&&B(c.value-1)}async function k(){var o,r;if(c.value!=null){if(((o=s.value)==null?void 0:o.type)=="article"&&s.value.progress!="completed"){v.value=!0;try{const{data:p}=await O.submitStep(((r=s.value)==null?void 0:r.id)??"",S.value,{});D(p.status),z()}catch(p){console.log(p)}finally{v.value=!1}}c.value+1<=j.value&&B(c.value+1)}}async function I(){var o,r,p;if(c.value!=null){if(((o=s.value)==null?void 0:o.progress)=="completed"){b.value=!0;return}if(((r=s.value)==null?void 0:r.type)=="article"){v.value=!0;try{const{data:w}=await O.submitStep(((p=s.value)==null?void 0:p.id)??"",S.value,{});D(w.status),b.value=!0}catch(w){console.log(w)}finally{v.value=!1}}}}const v=M(!1);async function N(){var o,r,p,w;v.value=!0;try{let a;switch((o=s.value)==null?void 0:o.type){case"code":a={code:i.value};break;case"open":a={open:s.value.answer.open};break;case"question":const u=[];(r=s.value.inner.options)==null||r.forEach(x=>{u.push(x.correct)}),a={question:u};break;case"matching":a={match:[{key:"dog",value:"b"},{key:"a",value:"animal"},{key:"c",value:"d"}]};break;default:a={};break}const _=((p=s.value)==null?void 0:p.progress)=="completed",{data:L}=await O.submitStep(((w=s.value)==null?void 0:w.id)??"",S.value,a);_||D(L.status),L.status=="completed"?(_||z(),$.add({severity:"success",summary:"Correct, good job!",detail:"Completed successfully",life:5e3})):L.status=="attempted"&&$.add({severity:"error",summary:"Wrong answer!",detail:"Keep trying",life:5e3}),console.log(L.status)}catch(a){alert(a)}finally{v.value=!1}}function T(){b.value=!1,f.push({name:"projects"})}return(o,r)=>{const p=W,w=qe;return t(),m(Z,null,[h("div",rt,[s.value?(t(),m("div",ct,[s.value.type=="article"?(t(),n(e(fe),{key:0,step:s.value,isPreview:!1},null,8,["step"])):s.value.type=="code"?(t(),n(e(ve),{key:1,step:s.value,isPreview:!1},null,8,["step"])):s.value.type=="matching"?(t(),n(e(_e),{key:2,step:s.value,isPreview:!1},null,8,["step"])):s.value.type=="open"?(t(),n(e(ge),{key:3,step:s.value,isPreview:!1},null,8,["step"])):s.value.type=="question"?(t(),n(e(Y),{key:4,step:s.value,isPreview:!1},null,8,["step"])):y("",!0)])):y("",!0),e(l)!=null&&e(l).steps!=null&&e(l).steps.length>0&&s.value?(t(),m("div",ut,[e(c)!==0?(t(),n(p,{key:0,label:"Previous",icon:"pi pi-angle-left",size:"small",onClick:C})):y("",!0),s.value.type!="article"&&s.value.progress!="completed"?(t(),n(p,{key:1,label:"Submit",icon:"pi pi-check",iconPos:"right",severity:"info",size:"small",class:"ml-auto self-end",onClick:N,disabled:v.value||!e(P),loading:v.value},null,8,["disabled","loading"])):y("",!0),e(c)<e(l).steps.length-1&&(s.value.progress=="completed"||s.value.type=="article")?(t(),n(p,{key:2,label:"Next",icon:"pi pi-angle-right",iconPos:"right",size:"small",class:"ml-auto self-end",onClick:k,disabled:v.value||s.value.progress!="completed"&&(s.value.type!="article"||!e(P)),loading:v.value},null,8,["disabled","loading"])):e(c)==e(l).steps.length-1&&(s.value.progress=="completed"||s.value.type=="article")?(t(),n(p,{key:3,label:"Finish 🥳",size:"small",class:"ml-auto self-end",onClick:I,disabled:v.value||s.value.progress!="completed"&&(s.value.type!="article"||!e(P)),loading:v.value},null,8,["disabled","loading"])):y("",!0)])):y("",!0)]),g(w,{visible:b.value,"onUpdate:visible":r[0]||(r[0]=a=>b.value=a),modal:"",header:"Congratulations🥳🎉",style:{width:"25rem"}},{default:q(()=>[r[1]||(r[1]=h("span",{class:"text-surface-500 dark:text-surface-400 block mb-8"},"You successfully completed this project",-1)),h("div",pt,[g(p,{type:"button",label:"Go to next Project ➡️",onClick:T})])]),_:1},8,["visible"])],64)}}}),mt="/assets/touch_sensor-CfCsQfvI.jpg",ft="/assets/motion_detector-5Zx7-09a.jpg",vt="/assets/microphone-BjeZeCno.jpg",_t="/assets/climate_sensor-BFoyC3X2.jpg",gt="/assets/gyro-B0eg3n6B.jpg",yt="/assets/color_sensor-BfpGiqXy.jpg",ht="/assets/joystick-Ok9Z0V--.jpg",bt="/assets/distance_sensor-Blgz6iVF.jpg",kt={class:"flex flex-col p-4 gap-4 overflow-scroll h-full justify-between bg-white"},wt={key:0},xt={key:0,class:"flex gap-2"},St={key:1,class:"flex"},$t=A({__name:"OpenLessonDiv",setup(G){const S={LED:$e,switch:je,"push-button":Ce,"light-sensor":ze,"touch-sensor":mt,potentiometer:Pe,encoder:Ie,"motion-detector":ft,microphone:vt,climate_sensor:_t,"gyro-accel":gt,buzzer:Be,"color-sensor":yt,joystick:ht,"distance-sensor":bt},f=Q(),$=R(),{lesson:d,stepIndex:l}=E($),{changeStep:c}=$,i=ce(()=>{var B;return l.value==null?null:((B=d.value)==null?void 0:B.steps[l.value])??null});async function j(){l.value!=null&&c(l.value-1)}async function P(){l.value!=null&&c(l.value+1)}return(B,D)=>{var s,C,k;const z=ae,b=W;return t(),m("div",kt,[i.value?(t(),m("div",wt,[e(f).name=="project"&&!((s=e(d))!=null&&s.is_guidable)?(t(),m("div",xt,[(t(!0),m(Z,null,se(i.value.inner.modules,I=>(t(),m("div",{key:I},[S[I]?(t(),n(z,{key:0,src:S[I],width:"80"},null,8,["src"])):y("",!0)]))),128))])):y("",!0),i.value.type=="article"?(t(),n(e(fe),{key:1,step:i.value,isPreview:!1},null,8,["step"])):i.value.type=="code"?(t(),n(e(ve),{key:2,step:i.value,isPreview:!1},null,8,["step"])):i.value.type=="matching"?(t(),n(e(_e),{key:3,step:i.value,isPreview:!1},null,8,["step"])):i.value.type=="open"?(t(),n(e(ge),{key:4,step:i.value,isPreview:!1},null,8,["step"])):i.value.type=="question"?(t(),n(e(Y),{key:5,step:i.value,isPreview:!1},null,8,["step"])):y("",!0),e(f).name=="project"&&!((C=e(d))!=null&&C.is_guidable)?(t(),n(e(Y),{key:6,step:i.value,isPreview:!1},null,8,["step"])):y("",!0)])):y("",!0),e(d)!=null&&e(d).steps!=null&&e(d).steps.length>0&&i.value?(t(),m("div",St,[e(l)!==0?(t(),n(b,{key:0,label:"Previous",icon:"pi pi-angle-left",size:"small",onClick:j})):y("",!0),e(l)<e(d).steps.length-1?(t(),n(b,{key:1,label:e(f).name=="project"&&!((k=e(d))!=null&&k.is_guidable)?"Start":"Next",icon:"pi pi-angle-right",iconPos:"right",size:"small",class:"ml-auto self-end",onClick:P},null,8,["label"])):y("",!0)])):y("",!0)])}}}),jt={key:0},Ct={key:1,class:"h-[51px]"},zt={key:2,class:"flex bg-surface-0",style:{height:"calc(100vh - 52px)"}},Pt={class:"flex justify-center h-full"},At=A({__name:"LessonView",setup(G){const{locale:S}=K(),f=Q(),$=R(),{simVisible:d,ideVisible:l,lesson:c}=E($),{setLesson:i}=$,j=Le(),{clearSlots:P}=j,B=De(),{setCode:D}=B,z=M(!1);async function b(){if(!z.value){z.value=!0;try{if(f.name=="project"){const{data:s}=await Ne.getProjectByID(f.params.id.toString()),C=await Ee(s,S.value);i(C)}else if(f.name=="module"){const{data:s}=await Te.getModuleByID(f.params.id.toString()),C=await Ue(s,S.value);i(C)}}catch(s){alert(s)}finally{z.value=!1}}}return ee(b),te(S,b),Me(()=>{P(),D("")}),(s,C)=>{var v;const k=xe,I=he;return t(),m(Z,null,[z.value?(t(),m("div",Ct)):(t(),m("div",jt,[e(f).name=="module"||!((v=e(c))!=null&&v.is_guidable)?(t(),n(it,{key:0})):e(f).name=="project"?(t(),n(We,{key:1})):y("",!0)])),z.value?y("",!0):(t(),m("div",zt,[g(I,{class:"w-full rounded-none"},{default:q(()=>[e(d)?(t(),n(k,{key:0,size:33,minSize:10,class:"max-w-[467px] w-full"},{default:q(()=>[g(be)]),_:1})):y("",!0),e(l)?(t(),n(k,{key:1,size:34,minSize:10},{default:q(()=>[g(I,{layout:"vertical",class:"h-full w-full"},{default:q(()=>[g(k,{size:65,minSize:10},{default:q(()=>[g(ke)]),_:1}),g(k,{size:35,minSize:10},{default:q(()=>[g(we)]),_:1})]),_:1})]),_:1})):y("",!0),g(k,{size:33,minSize:10,class:H(["mx-auto",{"max-w-md":e(d)||e(l)}])},{default:q(()=>{var N;return[h("div",Pt,[h("div",{class:H(["w-full",e(d)||e(l)?"max-w-[400px]":"max-w-4xl"])},[e(f).name=="module"||!((N=e(c))!=null&&N.is_guidable)?(t(),n($t,{key:0})):e(f).name=="project"?(t(),n(dt,{key:1})):y("",!0)],2)])]}),_:1},8,["class"])]),_:1})]))],64)}}});export{At as default};
