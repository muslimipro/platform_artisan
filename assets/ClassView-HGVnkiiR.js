import{T as ae}from"./index-CUUP1TJQ.js";import{s as se}from"./index-B8BKAoaq.js";import{d as re,u as le,A as oe,p as ne,r as d,I as ie,m as ce,o as r,f,w as s,c as u,t as l,e as c,b as a,g as m,F as b,i as C,h as z,P as ue,D as I,j as de,n as pe,k as fe,aF as me,s as ge,_ as he}from"./index-DTnuYjp0.js";import{s as ve,a as _e}from"./index-CmI3ZCZK.js";import{s as ye}from"./index-scisPgfR.js";import{s as be,a as $e}from"./index-Da9zUkmQ.js";import{s as xe}from"./index-Bna-x6D_.js";import{s as we}from"./index-BK3SZ35v.js";import{a as Ce,s as ze}from"./index-DKAMWqgV.js";import{s as Fe}from"./index-DeD98j8u.js";import{s as ke}from"./index-ayxY1mEP.js";import{T as S}from"./teacherApi-dDsdsD_Z.js";import{u as je}from"./useTeacherStore-CDesGaXp.js";import{a as Se}from"./index-CSKfK0qp.js";import"./index-w0PRQ70c.js";import"./index-ZfuqqY-H.js";import"./index-BhkdwvDF.js";import"./index-0pkJ3brC.js";import"./index-BbbGb17v.js";import"./index-CipLcOlO.js";import"./index-Cn1av5Rm.js";const Te={key:1},De={key:2,class:"flex flex-col items-start px-8 pb-4 gap-4"},Ne={class:"flex items-center justify-between gap-2 w-full"},Pe={class:"flex flex-col gap-2"},Ve={class:"text-3xl"},Ie={class:"text-sm"},Be={class:"flex items-center self-end"},Me={class:"text-xl"},Ae={class:"text-gray-500"},Re={class:"flex items-center"},Ue={class:"flex-grow flex gap-2 items-center"},Ge={class:"text-xl text-gray-500"},Oe={class:"w-4 h-4 rounded-md text-[10px] font-semibold flex justify-center items-center bg-gray-300"},qe={class:"flex justify-center text-[124px]"},ft=re({__name:"ClassView",setup(Ee){const T=le(),B=oe(),F=pe(),D=fe(),{t:g}=ne(),M=d(),v=d();(()=>{v.value={global:{value:null,matchMode:me.CONTAINS}}})();const A=je(),{loadClasses:R}=A,h=d(null),N=d([]),$=d([]),x=d(!1),w=d(!1),k=d(!1);async function U(){if(!x.value){x.value=!0;try{const{data:e}=await S.getClass(Number(F.params.id));h.value=e??null}catch(e){console.log(e)}finally{x.value=!1}}}async function G(){if(!w.value){w.value=!0;try{const{data:e}=await S.getClassStudents(Number(F.params.id));N.value=e??null}catch(e){console.log(e)}finally{w.value=!1}}}async function O(){try{const{data:e}=await Se.getProjects();$.value=e}catch(e){console.log(e)}}const q=["secondary","success","info","warn","danger","contrast"],P=ie(()=>{const e={};for(const o of $.value){let p=o.layer;p==0&&(p=999);const _=o.is_guidable?"learn":"practice";e[p]||(e[p]={learn:0,practice:0}),e[p][_]++}return e});ce(()=>{U(),O(),G()});function E(){B.require({message:g("pages.teacher.areYouSureDeleteClass"),header:g("pages.teacher.confirmation"),icon:"pi pi-exclamation-triangle",rejectProps:{label:g("pages.teacher.cancel"),severity:"secondary",outlined:!0},acceptProps:{label:g("pages.teacher.delete"),severity:"danger"},accept:()=>{H(Number(F.params.id))}})}async function H(e){try{await S.deleteClass(e),await R(),D.go(-1),T.add({severity:"success",summary:g("pages.teacher.classRemoved"),life:2e3})}catch(o){T.add({severity:"error",summary:g("pages.teacher.removeClassFailed"),detail:o,life:2e3})}}return(e,o)=>{const p=ke,_=ge,K=Ce,L=Fe,Y=ze,n=ve,J=we,j=be,V=xe,Q=$e,W=ye,X=_e,Z=he,ee=se,te=ae;return r(),f(ee,{class:"flex-grow flex flex-col gap-2"},{default:s(()=>[x.value?(r(),f(p,{key:0,class:"flex justify-center"})):h.value?(r(),u("div",De,[c("div",Ne,[c("div",Pe,[c("div",Ve,l(h.value.name),1),c("div",Ie,l(e.$t("pages.teacher.since"))+" "+l(h.value.created_time.split("T")[0]),1)]),a(_,{icon:"pi pi-hashtag",label:e.$t("pages.teacher.classCode"),severity:"info",onClick:o[0]||(o[0]=t=>k.value=!0)},null,8,["label"])]),c("div",Be,[c("div",Me,[c("span",Ae,l(e.$t("pages.teacher.teacher")),1),m(" "+l(h.value.creator_name),1)])]),a(X,{ref_key:"dt",ref:M,filters:v.value,"onUpdate:filters":o[2]||(o[2]=t=>v.value=t),value:N.value,dataKey:"id",loading:w.value,scrollable:"",globalFilterFields:["name","email"],class:"overflow-hidden w-full",paginator:"",rows:25,rowsPerPageOptions:[5,10,25],groupHeader:!0,showGridlines:""},{header:s(()=>[c("div",Re,[c("div",Ue,[c("div",Ge,l(e.$t("pages.teacher.students")),1)]),a(Y,null,{default:s(()=>[a(K,null,{default:s(()=>o[4]||(o[4]=[c("i",{class:"pi pi-search"},null,-1)])),_:1}),a(L,{modelValue:v.value.global.value,"onUpdate:modelValue":o[1]||(o[1]=t=>v.value.global.value=t),placeholder:e.$t("pages.teacher.search")},null,8,["modelValue","placeholder"])]),_:1})])]),empty:s(()=>[m(l(e.$t("pages.teacher.noStudentsFound")),1)]),loading:s(()=>[m(l(e.$t("pages.teacher.loadingStudents")),1)]),default:s(()=>[a(Q,{type:"header"},{default:s(()=>[a(j,null,{default:s(()=>[a(n,{header:e.$t("pages.teacher.projects"),rowspan:2,colspan:2,frozen:!0,alignFrozen:"left"},null,8,["header"]),(r(!0),u(b,null,C(P.value,(t,i)=>(r(),f(n,{key:i,colspan:t.learn+t.practice},{header:s(()=>[a(J,{class:"w-full text-md px-2",severity:i==999?"secondary":q[i]},{default:s(()=>[m(l(i==999?e.$t("pages.teacher.other"):`${e.$t("pages.teacher.level")} ${i}`),1)]),_:2},1032,["severity"])]),_:2},1032,["colspan"]))),128)),a(n,{header:"",rowspan:2,colspan:2,frozen:!0,alignFrozen:"right"})]),_:1}),a(j,null,{default:s(()=>[(r(!0),u(b,null,C(P.value,(t,i)=>(r(),u(b,{key:i},[t.learn>0?(r(),f(n,{key:0,colspan:t.learn},{header:s(()=>[a(V,{class:"w-full flex justify-center",size:"small",severity:"success"},{default:s(()=>[m(l(e.$t("pages.projects.learn")),1)]),_:1})]),_:2},1032,["colspan"])):z("",!0),t.practice>0?(r(),f(n,{key:1,colspan:t.practice},{header:s(()=>[a(V,{class:"w-full flex justify-center",size:"small",severity:"info"},{default:s(()=>[m(l(e.$t("pages.projects.practice")),1)]),_:1})]),_:2},1032,["colspan"])):z("",!0)],64))),128))]),_:1}),a(j,null,{default:s(()=>[a(n,{header:e.$t("pages.teacher.avatar"),frozen:!0,alignFrozen:"left"},null,8,["header"]),a(n,{header:e.$t("pages.teacher.name"),frozen:!0,alignFrozen:"left",sortable:"",field:"name"},null,8,["header"]),(r(!0),u(b,null,C($.value,(t,i)=>(r(),f(n,{key:t.id,field:t.id},{header:s(()=>[ue((r(),u("div",Oe,[m(l(i+1),1)])),[[te,{value:t.id.toString()},void 0,{top:!0}]])]),body:s(({data:y})=>[y.projects[i].student_progress>0?(r(),u("div",{key:0,class:I(["w-4 h-4 mx-4 rounded-full text-[10px] flex justify-center items-center text-white",y.projects[i].student_progress==100?"bg-green-400":"bg-orange-400"])},null,2)):z("",!0)]),_:2},1032,["field"]))),128)),a(n,{header:e.$t("pages.teacher.xp"),frozen:!0,alignFrozen:"right",sortable:"",field:"xp"},null,8,["header"]),a(n,{header:"",frozen:!0,alignFrozen:"right"})]),_:1})]),_:1}),a(n,{field:"small_avatar_url",header:e.$t("pages.teacher.avatar"),sortable:"",frozen:!0,alignFrozen:"left"},{body:s(({data:t})=>[a(W,{image:t.small_avatar_url},null,8,["image"])]),_:1},8,["header"]),a(n,{field:"name",header:e.$t("pages.teacher.name"),sortable:"",frozen:!0,alignFrozen:"left"},{body:s(({data:t})=>[c("div",null,l(`${t.name.length>0?t.name:t.email}`),1)]),_:1},8,["header"]),(r(!0),u(b,null,C($.value,(t,i)=>(r(),f(n,{key:t.id,field:t.id},{body:s(({data:y})=>[y.projects[i].student_progress>0?(r(),u("div",{key:0,class:I(["w-4 h-4 rounded-full text-[10px] flex justify-center items-center text-white",y.projects[i].student_progress==100?"bg-green-400":"bg-orange-400"])},null,2)):z("",!0)]),_:2},1032,["field"]))),128)),a(n,{field:"xp",header:e.$t("pages.teacher.xp"),sortable:"",frozen:!0,alignFrozen:"right"},{body:s(({data:t})=>[c("div",null,l(`${t.xp}xp`),1)]),_:1},8,["header"]),a(n,{exportable:!1,frozen:!0,alignFrozen:"right"},{body:s(({data:t})=>[a(_,{icon:"pi pi-angle-right",outlined:"",rounded:"",severity:"info",onClick:i=>de(D).push({name:"teacher-student",params:{id:t.id}})},null,8,["onClick"])]),_:1})]),_:1},8,["filters","value","loading"]),a(_,{icon:"pi pi-trash",label:e.$t("pages.teacher.removeClass"),severity:"danger",onClick:E,class:"self-end"},null,8,["label"])])):(r(),u("div",Te,l(e.$t("pages.teacher.noData")),1)),a(Z,{visible:k.value,"onUpdate:visible":o[3]||(o[3]=t=>k.value=t),modal:"",header:e.$t("pages.teacher.classCode")},{default:s(()=>{var t;return[c("div",qe,l((t=h.value)==null?void 0:t.code),1)]}),_:1},8,["visible","header"])]),_:1})}}});export{ft as default};
