import{s as H,a as J}from"./index-B0sN1kbj.js";import{s as Q}from"./index-DqVuGC-f.js";import{a as W,s as Y}from"./index-C4F8jACC.js";import{s as Z}from"./index-B7xbQbD6.js";import{a as D,a2 as P,a3 as E,u as q,r,G as z,b as g,k as h,w as o,f as l,q as N,v as L,s as ee,e as S,h as m,t as b,g as B,i as $,l as A,F as le,aP as se}from"./index-DHVnmQPM.js";import{u as F,A as O}from"./useAdminStore-Br27ufRd.js";import{s as R}from"./index-BUJyY_Tq.js";import"./index-Dg1hJ63t.js";import"./index-BOWzKnTG.js";import"./index-HGiDyU5z.js";import"./index-C7Peqa67.js";import"./index-BQXR58SR.js";import"./index-DimdtQOL.js";import"./index-D3Cxxuxn.js";import"./index-DRCcxSDj.js";import"./http-Dcz7Gd9U.js";const oe=D({__name:"UpdateUserTypeDialog",props:P({userId:{},userType:{}},{modelValue:{type:Boolean,required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(V){const d=E(V,"modelValue"),c=V,v=q(),f=F(),{loadUsers:y}=f,a=r(null),w=r(["student","teacher","school_manager","contributor","editor"]);z(()=>c.userType,s=>{a.value=s},{immediate:!0});const n=r(!1);async function k(){if(!(c.userId==null||a.value==null)){n.value=!0;try{const{data:s}=await O.updateUserRole(Number(c.userId),a.value);v.add({severity:"success",summary:s.message,life:2e3}),y(),d.value=!1}catch(s){v.add({severity:"error",summary:s.response.data.error,detail:s,life:2e3})}finally{n.value=!1}}}return(s,i)=>{const U=R,_=N,C=L;return g(),h(C,{visible:d.value,"onUpdate:visible":i[2]||(i[2]=u=>d.value=u),modal:"",draggable:!1,class:"m-4 max-w-md",header:"Change user type"},{footer:o(()=>[l(_,{label:s.$t("close"),severity:"secondary",onClick:i[1]||(i[1]=u=>d.value=!1)},null,8,["label"]),l(_,{label:s.$t("save"),onClick:k,disabled:n.value,loading:n.value},null,8,["label","disabled","loading"])]),default:o(()=>[l(U,{modelValue:a.value,"onUpdate:modelValue":i[0]||(i[0]=u=>a.value=u),options:w.value,class:"w-full",placeholder:"Select user type"},null,8,["modelValue","options"])]),_:1},8,["visible"])}}}),te=D({__name:"UpdateVerificationDialog",props:P({userId:{},verification:{type:[Boolean,null]}},{modelValue:{type:Boolean,required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(V){const d=E(V,"modelValue"),c=V,v=q(),f=F(),{loadUsers:y}=f,a=r(null),w=r(["verified","unverified"]);z(()=>c.verification,s=>{a.value=s?"verified":"unverified"},{immediate:!0});const n=r(!1);async function k(){if(!(c.userId==null||a.value==null)){n.value=!0;try{const{data:s}=await O.verifyUser(a.value=="verified",Number(c.userId));v.add({severity:"success",summary:s.message,life:2e3}),y(),d.value=!1}catch(s){v.add({severity:"error",summary:s.response.data.error,detail:s,life:2e3})}finally{n.value=!1}}}return(s,i)=>{const U=R,_=N,C=L;return g(),h(C,{visible:d.value,"onUpdate:visible":i[2]||(i[2]=u=>d.value=u),modal:"",draggable:!1,class:"m-4 max-w-md",header:"Change verification"},{footer:o(()=>[l(_,{label:s.$t("close"),severity:"secondary",onClick:i[1]||(i[1]=u=>d.value=!1)},null,8,["label"]),l(_,{label:s.$t("save"),onClick:k,disabled:n.value,loading:n.value},null,8,["label","disabled","loading"])]),default:o(()=>[l(U,{modelValue:a.value,"onUpdate:modelValue":i[0]||(i[0]=u=>a.value=u),options:w.value,class:"w-full",placeholder:"Select verification"},null,8,["modelValue","options"])]),_:1},8,["visible"])}}}),ae={class:"flex-grow min-w-0 pb-4 mb-4 bg-white rounded-md border"},ie={class:"flex items-center"},re={class:"flex-grow text-2xl"},ne={class:"w-44 overflow-scroll"},de={class:"w-44"},ue={class:"flex"},ce={class:"flex"},pe={key:0,class:"w-40"},me={key:1,class:"w-40"},Se=D({__name:"UsersView",setup(V){const d=F(),{users:c,isLoading:v}=ee(d),f=r(!1),y=r(!1),a=r(null),w=r(null),n=r(null),k=r(),s=r();(()=>{s.value={global:{value:null,matchMode:se.CONTAINS}}})();const U=T=>{console.log(T)},_=()=>{k.value.exportCSV()},C=(T,t)=>{f.value=!0,a.value=T,w.value=t},u=(T,t)=>{y.value=!0,a.value=T,n.value=t};return(T,t)=>{const x=N,G=W,K=Z,X=Y,p=H,I=Q,j=J;return g(),S(le,null,[m("div",ae,[l(j,{ref_key:"dt",ref:k,filters:s.value,"onUpdate:filters":t[1]||(t[1]=e=>s.value=e),value:B(c),dataKey:"id",loading:B(v),scrollable:"",globalFilterFields:["name","email"],class:"rounded-md overflow-hidden w-full",paginator:"",rows:10,rowsPerPageOptions:[5,10,25]},{header:o(()=>[m("div",ie,[m("div",re,"Users - "+b(B(c).length),1),l(x,{label:"Export",icon:"pi pi-upload",severity:"info",variant:"outlined",class:"mr-2",onClick:_}),l(X,null,{default:o(()=>[l(G,null,{default:o(()=>t[4]||(t[4]=[m("i",{class:"pi pi-search"},null,-1)])),_:1}),l(K,{modelValue:s.value.global.value,"onUpdate:modelValue":t[0]||(t[0]=e=>s.value.global.value=e),placeholder:"Search"},null,8,["modelValue"])]),_:1})])]),empty:o(()=>t[5]||(t[5]=[$(" No users found. ")])),loading:o(()=>t[6]||(t[6]=[$(" Loading users data. Please wait. ")])),default:o(()=>[l(p,{field:"email",header:"Email",frozen:"",sortable:""},{body:o(({data:e})=>[m("div",ne,b(e.email),1)]),_:1}),l(p,{field:"id",header:"ID",sortable:""},{body:o(({data:e})=>[$(b(e.id),1)]),_:1}),l(p,{field:"created_time",header:"Created time",sortable:""},{body:o(({data:e})=>[m("div",de,b(e.created_time.split("T")[0]+" "+e.created_time.split(".")[0].split("T")[1]),1)]),_:1}),l(p,{field:"name",header:"Name",sortable:""},{body:o(({data:e})=>[$(b(`${e.name} ${e.surname}`),1)]),_:1}),l(p,{field:"user_type",header:"Type",sortable:""},{body:o(({data:e})=>[m("div",ue,[l(I,{value:e.user_type,severity:"secondary"},null,8,["value"]),e.user_type!="super_admin"?(g(),h(x,{key:0,icon:"pi pi-pencil",variant:"link",size:"small",onClick:M=>C(e.id,e.user_type)},null,8,["onClick"])):A("",!0)])]),_:1}),l(p,{field:"access_type",header:"Access",sortable:""},{body:o(({data:e})=>[l(I,{value:e.access_type,severity:e.access_type=="premium"?"success":"info"},null,8,["value","severity"])]),_:1}),l(p,{field:"verified",header:"Verified",sortable:""},{body:o(({data:e})=>[m("div",ce,[l(I,{value:e.verified?"verified":"unverified",severity:e.verified?"success":"warn"},null,8,["value","severity"]),e.user_type!="super_admin"?(g(),h(x,{key:0,icon:"pi pi-pencil",variant:"link",size:"small",onClick:M=>u(e.id,e.verified)},null,8,["onClick"])):A("",!0)])]),_:1}),l(p,{field:"xp",header:"XP",sortable:""},{body:o(({data:e})=>[$(b(e.xp),1)]),_:1}),l(p,{field:"subscription_end",header:"Expire date",sortable:""},{body:o(({data:e})=>[e.subscription_end?(g(),S("div",pe,b(e.subscription_end.split("T")[0]+" : "+e.subscription_end.split(".")[0].split("T")[1]),1)):(g(),S("div",me,"-"))]),_:1}),l(p,{exportable:!1},{body:o(e=>[l(x,{icon:"pi pi-trash",outlined:"",rounded:"",severity:"danger",onClick:M=>U(e.data)},null,8,["onClick"])]),_:1})]),_:1},8,["filters","value","loading"])]),l(oe,{modelValue:f.value,"onUpdate:modelValue":t[2]||(t[2]=e=>f.value=e),userId:a.value,userType:w.value},null,8,["modelValue","userId","userType"]),l(te,{modelValue:y.value,"onUpdate:modelValue":t[3]||(t[3]=e=>y.value=e),userId:a.value,verification:n.value},null,8,["modelValue","userId","verification"])],64)}}});export{Se as default};
