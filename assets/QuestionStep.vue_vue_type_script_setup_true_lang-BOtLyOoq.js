import{a as de}from"./index-BKnpv2yJ.js";import{aN as fe,n as me,p as ve,u as _e,ah as W,r as b,L as A,d as k,o as a,c,F as S,i as P,f as B,e as g,h as q,H as ge,t as w,b as $,w as ye,g as he,aC as be,aB as xe,Q as J,m as we,j as X}from"./index-CYUYDN2E.js";import{s as Se}from"./index-BanUC7cS.js";import{_ as $e}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{s as ke}from"./index-n8pVcVr8.js";import{s as Ce}from"./index-FlwI1bds.js";import{s as Ve}from"./index-BUdA093k.js";import{a as Ae}from"./logo-DKAx4-BV.js";import{j as Pe,k as Be,n as Ie}from"./index-DpQYPDuI.js";import{h as I}from"./index-CVg5t83u.js";const Me={submitStep:Re,getStudentProjectStepsByID:je,getStudentStepTranslationByID:Le,resetStepsProgress:Ne,saveStudentStepStateByID:Ee};async function je(t){try{return await I.get(`/student/project/${t}/steps`)}catch(n){throw console.log(n),n}}async function Le(t,n){try{return await I.get(`/student/step/${t}/language/${n}`)}catch(r){throw console.log(r),r}}async function Ee(t,n,r){try{return await I.put(`/student/step/${t.id}/language/${n}/save`,r)}catch(i){throw console.log(i),i}}async function Re(t,n,r){try{return await I.put(`/student/step/${t}/language/${n}`,{student_answer:r})}catch(i){throw console.log(i),i}}async function Ne(t){try{return await I.delete(`/project/${t}/reset`)}catch(n){throw console.log(n),n}}async function Ue(t,n){const{data:r}=await Me.getStudentStepTranslationByID(t.id.toString(),n),i=r;return{id:t.id.toString(),title:i.name,type:t.step_type,progress:t.status,inner:i.content,answer:i.user_answer,state:i.step_state,access_type:t.access_type,accessibility:t.accessibility,skip_submit:t.skip_submit}}const Te=fe("useLessonStore",()=>{const t=me(),{locale:n}=ve(),r=_e(),i=Pe(),{newModuleToSlot:s,clearSlots:f,reset:v}=i,{slots:l,helpArrows:_,moduleComponents:y,isConnected:x,isLoading:j}=W(i),C=Be(),{fileContent:L}=W(C),{setCode:m}=C,V=Ie(),{setStdout:Y,clear:F}=V,u=b(null),d=b(null),U=b(!1),T=b(!0),E=b(!0),Z=A(()=>T.value&&E.value),Q=b(!1),H=b(!1),O=A(()=>L.value);let R=0;function ee(e){e!=null&&(u.value=e)}function te(e){u.value!=null&&(u.value.steps=e,d.value!=null&&K(d.value))}function se(e){d.value=e}function ne(e){u.value==null||d.value==null||(u.value.steps[d.value].progress=e)}function oe(e){u.value==null||d.value==null||d.value+1!=u.value.steps.length&&(u.value.steps[d.value+1].accessibility=e)}function le(e,p){u.value==null||d.value==null||u.value.steps[d.value].inner.options!=null&&(u.value.steps[d.value].inner.options[p].correct=e)}async function K(e){var D,G;if(u.value==null)return;d.value=e;const p=u.value.steps[d.value];if(p.title==""){U.value=!0;const h=await Ue({id:p.id,status:p.progress,step_type:p.type,skip_submit:p.skip_submit,access_type:p.access_type,accessibility:p.accessibility},n.value);u.value.steps[e]=h,U.value=!1}const o=u.value.steps[d.value];if(v(),f(),z(),m(""),F(),H.value=!(((D=o.inner.platformActions)==null?void 0:D.includes("hide-ide"))??!1),Q.value=!(((G=o.inner.platformActions)==null?void 0:G.includes("hide-sim"))??!1),o.progress=="nothing"&&u.value.is_guidable||t.name=="module"){if(o.inner.platformActions!=null&&o.inner.platformActions!=null&&o.inner.platformActions.length>0)for(const h of o.inner.platformActions){if(h=="code2ide"&&m(o.inner.starting??""),h=="auto-put"&&o.inner.highlights!=null)for(const N of o.inner.highlights)R++,s(N.module,N.slot);h=="auto-run"&&x.value&&!j.value&&(i.run(),r.add({severity:"success",summary:"Run is completed!",detail:"Code has successfully auto run",life:3e3}))}if(o.inner.userActions!=null&&o.inner.userActions!=null&&o.inner.userActions.length>0)for(const h of o.inner.userActions)h=="put-module"&&(T.value=!1,f()),h=="run-code"&&(E.value=!1)}else{if(o.state==null||o.state==null)return;if(o.state.code!=null&&o.state.code!=null&&m(o.state.code),o.state.stdout!=null&&o.state.stdout!=null&&Y(o.state.stdout),o.state.slots!=null&&o.state.slots!=null)for(const[h,N]of o.state.slots.entries()){const pe=String.fromCharCode(65+h);s(N,pe)}}}function re(e){u.value==null||d.value==null||(u.value.steps[d.value].state={code:e.code,stdout:e.stdout,slots:e.slots})}function ie(){if(u.value==null||d.value==null)return;const e=u.value.steps[d.value];if(v(),f(),z(),m(""),F(),u.value.steps[d.value].state={code:"",stdout:"",slots:[]},e.inner.platformActions!=null&&e.inner.platformActions!=null&&e.inner.platformActions.length>0)for(const p of e.inner.platformActions){if(p=="code2ide"&&m(e.inner.starting??""),p=="auto-put"&&e.inner.highlights!=null)for(const o of e.inner.highlights)R++,s(o.module,o.slot);p=="auto-run"&&x.value&&!j.value&&(i.run(),r.add({severity:"success",summary:"Run is completed!",detail:"Code has successfully auto run",life:3e3}))}}function ae(e,p){if(e==="8"||e==="9")_.value[e].style={color:"rgba(0, 157, 255)"},_.value[e].visible=!0;else{const o=(e??"A").charCodeAt(0)-65;l.value[o].style={backgroundColor:"rgba(0, 157, 255, 0.26)",boxShadow:"0 0 15px rgb(0, 157, 255)"}}y.value.forEach(o=>{if(o.type==p){o.style={animation:"breathing 1s ease-out infinite normal",boxShadow:"0 0 15px rgb(0, 157, 255)",borderRadius:"10px"};return}})}function z(){for(let e=0;e<=5;e++)l.value[e].class="",l.value[e].style={};for(const e of y.value)e.class="",e.style={};for(const e in _.value){const p=_.value[e];p.visible=!1,p.style={},p.class=""}}function ue(){E.value=!0}function ce(e,p){R<=0?e===p?r.add({severity:"success",summary:"Correct, good job!",detail:"Module has been put successfully",life:3e3}):r.add({severity:"error",summary:"Wrong!",detail:"Keep trying",life:3e3}):R--}return{lesson:u,stepIndex:d,stepLoading:U,userCode:O,submitEnabled:Z,modulesWerePut:T,codeWasRun:E,simVisible:Q,ideVisible:H,setLesson:ee,setSteps:te,setStepIndex:se,updateStatus:ne,updateAccess:oe,changeStep:K,runCodePressed:ue,saveOption:le,lightUp:ae,clearSlotsModulesClasses:z,toastModulePut:ce,saveStepStateLocally:re,restartStep:ie}});async function bt(t,n,r){const{data:i}=await de.getStepTranslationByID(t.id.toString(),n),s=i;return{id:t.id.toString(),title:s.name,type:t.step_type,progress:"nothing",inner:r||s.content.contents==null?{contents:[],modules:[]}:s.content,access_type:t.access_type,skip_submit:t.skip_submit}}const ze={class:"flex flex-col gap-2"},We={key:1},qe={key:0,style:{position:"relative",width:"100%",height:"0","padding-bottom":"56.25%"}},Fe=["src"],Qe={key:1,style:{position:"relative","margin-left":"5%",width:"90%",height:"0","padding-bottom":"160%"}},He=["src"],M=k({__name:"ContentsView",props:{contents:{}},setup(t){const n=t;function r(i){return i.replace("shorts","embed")}return(i,s)=>{const f=ge("v-md-preview"),v=Ae;return a(),c("div",ze,[(a(!0),c(S,null,P(n.contents,l=>{var _;return a(),c("div",{key:l.id},[l.type=="text"?(a(),B(f,{key:0,text:l.text},null,8,["text"])):l.type=="video"?(a(),c("div",We,[(_=l.text)!=null&&_.includes("embed")?(a(),c("div",qe,[g("iframe",{credentialless:"",src:r(l.text),style:{position:"absolute",top:"0",left:"0",width:"100%",height:"100%"},frameborder:"0",allowfullscreen:"",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",referrerpolicy:"strict-origin-when-cross-origin"},null,8,Fe),s[0]||(s[0]=g("iframe",null,null,-1))])):(a(),c("div",Qe,[g("iframe",{credentialless:"",src:r(l.text??""),style:{position:"absolute",top:"0",left:"0",width:"100%",height:"100%"},frameborder:"0",allowfullscreen:"",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",referrerpolicy:"strict-origin-when-cross-origin"},null,8,He)]))])):l.type=="image"?(a(),B(v,{key:2,src:l.src,alt:"Image",class:"rounded-xl object-cover h-64"},null,8,["src"])):q("",!0)])}),128))])}}}),Ke={class:"text-[33px] font-semibold mb-4 text-center border-b pb-2"},xt=k({__name:"ArticleStep",props:{step:{},isPreview:{type:Boolean}},setup(t){const n=t;return(r,i)=>(a(),c(S,null,[g("div",Ke,w(n.step.title),1),$(M,{contents:n.step.inner.contents},null,8,["contents"])],64))}}),De={class:"text-[33px] font-semibold mb-4 text-center border-b pb-2"},wt=k({__name:"CodeStep",props:{step:{},isPreview:{type:Boolean}},setup(t){const n=t;return(r,i)=>(a(),c(S,null,[g("div",De,w(n.step.title),1),$(M,{contents:n.step.inner.contents},null,8,["contents"])],64))}}),Ge={class:"flex flex-col gap-4"},Je={class:"text-[33px] font-semibold mb-4 text-center border-b pb-2"},Xe={class:"flex w-full justify-between"},Ye={class:"flex flex-col gap-2"},Ze={class:"w-40 mb-[29px] border rounded-lg h-[40px] place-items-center bg-white",draggable:"true"},Oe={class:"content-center h-full"},et={class:"flex flex-col gap-2"},tt=k({__name:"MatchStep",props:{step:{},isPreview:{type:Boolean}},setup(t){const n=t,r=A(()=>{var s;return(s=n.step.inner.pairs)==null?void 0:s.map(f=>f.key)}),i=A(()=>{var s;return(s=n.step.inner.pairs)==null?void 0:s.map(f=>f.value)});return(s,f)=>{const v=Se;return a(),c("div",Ge,[g("div",Je,w(n.step.title),1),$(M,{contents:n.step.inner.contents},null,8,["contents"]),g("div",Xe,[g("div",Ye,[(a(!0),c(S,null,P(r.value,l=>(a(),c("div",{key:l,class:"flex flex-col"},[g("div",Ze,[g("div",Oe,w(l),1)])]))),128))]),g("div",et,[(a(!0),c(S,null,P(i.value,l=>(a(),c("div",{key:l,class:"flex flex-col"},[f[0]||(f[0]=g("div",{class:"w-40 h-10 border-dashed border-gray-300 rounded-border border-x border-y"},null,-1)),$(v,{size:"small",severity:"warn",variant:"simple",class:"mb-2"},{default:ye(()=>[he(w(l.length>0?l:"..."),1)]),_:2},1024)]))),128))])])])}}}),St=$e(tt,[["__scopeId","data-v-265024ce"]]),st={class:"flex flex-col gap-4"},nt={class:"text-[33px] font-semibold mb-4 text-center border-b pb-2"},$t=k({__name:"OpenStep",props:be({step:{},isPreview:{type:Boolean}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(t){const n=xe(t,"modelValue"),r=t,i=b(null);return(s,f)=>{const v=ke;return a(),c("div",st,[g("div",nt,w(r.step.title),1),$(M,{contents:r.step.inner.contents},null,8,["contents"]),r.isPreview?(a(),B(v,{key:0,type:"text",modelValue:i.value,"onUpdate:modelValue":f[0]||(f[0]=l=>i.value=l),size:"small",placeholder:"Enter your answer"},null,8,["modelValue"])):(a(),B(v,{key:1,type:"text",modelValue:n.value,"onUpdate:modelValue":f[1]||(f[1]=l=>n.value=l),size:"small",placeholder:"Enter your answer"},null,8,["modelValue"]))])}}}),ot={class:"flex flex-col gap-4"},lt={key:0,class:"text-[33px] font-semibold mb-4 text-center border-b pb-2"},rt={key:2,class:"flex flex-col gap-4 ml-4"},it=["for"],at={key:3,class:"flex flex-col gap-4 ml-4"},ut=["for"],kt=k({__name:"QuestionStep",props:{step:{},isPreview:{type:Boolean}},setup(t){const n=Te(),{lesson:r}=W(n),{saveOption:i}=n,s=t,f=A(()=>s.step.inner.single),v=b(null),l=b([]);return J([l],()=>{if(!s.isPreview&&s.step.inner.options!=null&&!s.step.inner.single)for(const[_,y]of s.step.inner.options.entries())i(l.value.some(x=>x==y.text),_)}),J([v],()=>{if(!s.isPreview&&s.step.inner.options!=null&&s.step.inner.single)for(const[_,y]of s.step.inner.options.entries())i(v.value==y.text,_)}),we(()=>{var _;if(!s.isPreview&&s.step.inner.options!=null&&(v.value=null,l.value=[],(_=r.value)!=null&&_.is_guidable&&s.step.answer.question))for(const[y,x]of s.step.inner.options.entries())s.step.answer.question[y]&&(l.value.push(x.text),v.value=x.text)}),(_,y)=>{var C,L;const x=Ve,j=Ce;return a(),c("div",ot,[(C=X(r))!=null&&C.is_guidable?(a(),c("div",lt,w(s.step.title),1)):q("",!0),(L=X(r))!=null&&L.is_guidable?(a(),B(M,{key:1,contents:s.step.inner.contents},null,8,["contents"])):q("",!0),f.value?(a(),c("div",rt,[(a(!0),c(S,null,P(s.step.inner.options,m=>(a(),c("div",{key:m.id,class:"flex items-center gap-2"},[$(x,{modelValue:v.value,"onUpdate:modelValue":y[0]||(y[0]=V=>v.value=V),inputId:m.id,name:"dynamic",value:m.text},null,8,["modelValue","inputId","value"]),g("label",{for:m.id},w(m.text),9,it)]))),128))])):(a(),c("div",at,[(a(!0),c(S,null,P(s.step.inner.options,m=>(a(),c("div",{key:m.id,class:"flex items-center gap-2"},[$(j,{modelValue:l.value,"onUpdate:modelValue":y[1]||(y[1]=V=>l.value=V),inputId:m.id,name:"option",value:m.text},null,8,["modelValue","inputId","value"]),g("label",{for:m.id},w(m.text),9,ut)]))),128))]))])}}});export{St as M,xt as _,Me as a,bt as b,wt as c,$t as d,kt as e,Ue as t,Te as u};
