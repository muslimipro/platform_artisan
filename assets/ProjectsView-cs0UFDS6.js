import{s as oe}from"./index-COm9ynAh.js";import{a as re,a7 as se,u as ae,a6 as le,Y as ne,s as ie,r as a,o as ue,G as de,c as q,b as l,e as u,f as n,h as c,w as v,g as L,l as F,F as C,j as $,k as I,p as pe,E as ce,q as me}from"./index-DHVnmQPM.js";import{s as fe}from"./index-BHR8iGiG.js";import{s as ve}from"./index-BzCzRpCo.js";import{s as ge,a as ye}from"./index-CoVdCniq.js";import{s as he}from"./index-B7xbQbD6.js";import{_ as we}from"./AHeader.vue_vue_type_script_setup_true_lang-BgfTck4u.js";import{_ as H}from"./ProjectCard.vue_vue_type_script_setup_true_lang-UcGnxykw.js";import{a as P}from"./index-DU_ItY1l.js";import{u as be}from"./editor-store-CREgfSfV.js";import{t as z}from"./types-81Qs7ZwA.js";import{u as _e,m as xe}from"./useSortable-DEYU19Sm.js";import"./index-HGiDyU5z.js";import"./index-BOWzKnTG.js";import"./index-BQXR58SR.js";import"./index-DimdtQOL.js";import"./index-CKgSSqZR.js";import"./index-C4F8jACC.js";import"./index-Cr72xZbi.js";import"./index-PBST-dQM.js";import"./logo-D1-3uCnC.js";import"./StudentViewToggle.vue_vue_type_script_setup_true_lang-BJoGP8im.js";import"./index-BUJyY_Tq.js";import"./index-BM6hZtEV.js";import"./index-CzTZ9E-d.js";import"./index-CG6SXWyB.js";import"./index-BlDh53mH.js";import"./http-Dcz7Gd9U.js";import"./profile-PDhrVDtH.js";import"./index-D-99ObJy.js";import"./index-CBTzXTNN.js";import"./index-DqVuGC-f.js";import"./pibody-BwAjMvHk.js";import"./v4-CmTdKEVZ.js";import"./sortable.esm-FZSyJVGy.js";const je={class:"flex flex-col min-h-screen bg-slate-50"},Ve={class:"flex items-center py-4 px-4 sm:px-12 gap-8"},ke={class:"flex-grow flex flex-col gap-1 sm:gap-4 bg-slate-50"},Le={class:"relative flex flex-col justify-between w-[500px] min-h-28 bg-purple-100 border border-gray-100 rounded-3xl p-2 gap-2 shadow-md shadow-purple-300"},Ce={class:"absolute right-5 bottom-5"},$e={key:0,class:"flex flex-col sm:flex-row gap-1 sm:gap-4 bg-slate-50 py-0 px-4 sm:px-12 items-end justify-end"},Ie={key:1,class:"border border-dashed rounded-xl border-green-400 overflow-hidden"},Pe={key:0,class:"flex flex-wrap justify-center gap-8 px-4 sm:px-12 pb-8 pt-4"},mt=re({__name:"ProjectsView",setup(Se){const S=se("el"),T=ae(),{locale:O}=le(),B=pe(),Y=be(),{addLesson:J}=Y,K=ne(),{user:E}=ie(K),m=a([]),_=a([]),x=a([]),M=a([0,0,0,0,0,0]),R=a([0,0,0,0,0,0]),g=a(!1),y=a(!1),j=a("");_e(S,m,{onUpdate:t=>{xe(m.value,t.oldIndex,t.newIndex,t),ce(async()=>{const e=[];m.value.map(o=>{const i=parseInt(o.id,10);e.push(i)});try{const{data:o}=await P.changeProjectsOrder(e);T.add({severity:"success",summary:o.message,life:2e3})}catch(o){T.add({severity:"error",summary:o.response.data.error,detail:o,life:2e3})}})}});async function h(){if(!g.value){g.value=!0;try{const{data:t}=await P.getProjects();m.value=[],_.value=[],x.value=[],M.value=[0,0,0,0,0,0],R.value=[0,0,0,0,0,0];for(const e of t)e.lego||(e.is_guidable?M.value[e.layer]++:R.value[e.layer]++);for(const e of t){if(e.lego)continue;const o=await z(e);if(e.layer==0){m.value.push(o);const i=o.creator_name??o.created_by;!V.value.includes(i)&&i.length>0&&V.value.push(o.creator_name??o.created_by)}o.is_guidable?_.value.push(o):x.value.push(o)}}catch(t){console.log(t)}finally{g.value=!1}}}ue(h),de(O,h);async function Q(){y.value=!0;try{const{data:t}=await P.createProject(),e=await z(t);J(e),B.push(`/project/${e.id}/edit`)}catch(t){console.log(t)}finally{y.value=!1}}const W=q(()=>{var i,f;const t=new Map,e=new Map;for(const r of _.value)t.has(r.layer)||t.set(r.layer,[]),t.get(r.layer).push(r);for(const r of x.value)e.has(r.layer)||e.set(r.layer,[]),e.get(r.layer).push(r);const o=[];return o.push({id:0,guided:((i=t.get(0))==null?void 0:i.filter(r=>(!p.value.length||p.value.includes(k(r.level)))&&(!d.value||r.title.toLowerCase().includes(d.value.toLowerCase()))))||[],unguided:((f=e.get(0))==null?void 0:f.filter(r=>(!p.value.length||p.value.includes(k(r.level)))&&(!d.value||r.title.toLowerCase().includes(d.value.toLowerCase()))))||[]}),o}),X=q(()=>m.value.filter(t=>(!b.value.length||b.value.includes(t.creator_name??t.created_by))&&(!w.value.length||w.value.includes(t.stage))&&(!p.value.length||p.value.includes(k(t.level)))&&(!d.value||t.title.toLowerCase().includes(d.value.toLowerCase())))),d=a(""),p=a(""),Z=a(["Easy","Medium","Hard"]),w=a(""),D=a(["prepare_for_submission","waiting_for_review","in_review","rejected","ready_for_publish","published","in_modify"]),b=a(""),V=a([]);function k(t){return t==0?"":t<3?"Easy":t<5?"Medium":t==5?"Hard":""}return(t,e)=>{var A,G;const o=ge,i=he,f=ye,r=ve,ee=fe,U=me,te=oe;return l(),u("div",je,[n(we,{class:"sticky top-0 z-10 mb-4"}),c("div",Ve,[c("div",ke,[n(f,{class:"min-w-60"},{default:v(()=>[n(o,{class:"text-primary border-gray-100"},{default:v(()=>e[6]||(e[6]=[c("i",{class:"pi pi-search"},null,-1)])),_:1}),n(i,{type:"text",modelValue:d.value,"onUpdate:modelValue":e[0]||(e[0]=s=>d.value=s),placeholder:t.$t("pages.projects.search"),variant:"filled",class:"h-fit bg-white border-gray-100 shadow-none"},null,8,["modelValue","placeholder"])]),_:1}),n(f,{class:"min-w-60"},{default:v(()=>[n(o,{class:"text-primary border-gray-100"},{default:v(()=>e[7]||(e[7]=[c("i",{class:"pi pi-filter"},null,-1)])),_:1}),n(r,{modelValue:p.value,"onUpdate:modelValue":e[1]||(e[1]=s=>p.value=s),options:Z.value,placeholder:t.$t("pages.projects.filterByLevel"),display:"chip",variant:"filled",class:"bg-white min-w-0 lg:min-w-80 border-gray-100 shadow-none"},null,8,["modelValue","options","placeholder"])]),_:1})]),c("div",Le,[n(ee,{modelValue:j.value,"onUpdate:modelValue":e[2]||(e[2]=s=>j.value=s),placeholder:t.$t("pages.creator.placeholder"),variant:"filled",rows:"5",cols:"30",class:"bg-purple-50 w-full rounded-2xl h-28"},null,8,["modelValue","placeholder"]),c("div",Ce,[n(U,{label:t.$t("pages.creator.getRoadmapLabel"),severity:"help",class:"rounded-2xl bg-purple-400 border border-purple-400",onClick:e[3]||(e[3]=s=>L(B).push({name:"creator",query:{message:j.value}}))},null,8,["label"])])])]),["editor","contributor"].includes(((A=L(E))==null?void 0:A.user_type)??"")?(l(),u("div",$e,[n(r,{modelValue:w.value,"onUpdate:modelValue":e[4]||(e[4]=s=>w.value=s),options:D.value,placeholder:"Select stage",display:"chip",variant:"filled",class:"bg-white min-w-0 lg:min-w-80 border-gray-100 shadow-none"},null,8,["modelValue","options"]),n(r,{modelValue:b.value,"onUpdate:modelValue":e[5]||(e[5]=s=>b.value=s),options:V.value,placeholder:"Select creator",display:"chip",variant:"filled",class:"bg-white min-w-0 lg:min-w-80 border-gray-100 shadow-none"},null,8,["modelValue","options"])])):F("",!0),["editor","contributor"].includes(((G=L(E))==null?void 0:G.user_type)??"")?(l(),u("div",{key:1,ref_key:"el",ref:S,class:"flex flex-wrap justify-center gap-8 px-4 sm:px-12 pb-8 pt-4"},[(l(!0),u(C,null,$(X.value,s=>(l(),I(H,{key:s.id,project:s,onAfterRemove:h},null,8,["project"]))),128)),g.value?(l(),I(te,{key:0})):(l(),u("div",Ie,[n(U,{variant:"text",style:{width:"300px",height:"234px"},class:"bg-green-50",onClick:Q,loading:y.value,disabled:y.value},{icon:v(()=>e[8]||(e[8]=[c("i",{class:"pi pi-plus text-3xl"},null,-1)])),_:1},8,["loading","disabled"])]))],512)):(l(!0),u(C,{key:2},$(W.value,s=>(l(),u("div",{key:s.id,class:"flex flex-col gap-2"},[s.unguided.length>0?(l(),u("div",Pe,[(l(!0),u(C,null,$(s.unguided,N=>(l(),I(H,{key:N.id,project:N,onAfterRemove:h},null,8,["project"]))),128))])):F("",!0)]))),128))])}}});export{mt as default};
