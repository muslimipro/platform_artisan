import{a as V,a1 as ue,a2 as ie,r as y,c as te,o as G,G as R,b as a,e as f,h as x,f as v,w as A,t as K,n as ae,q as F,k as C,j as J,F as j,a3 as pe,g as w,x as H,d as we,u as be,s as P,a4 as xe,Q as $e,l as B,C as ve,p as me,D as ke,E as Se,U as se,i as oe,a5 as Ce}from"./index-BEuVwAr8.js";import{u as fe,_ as Ue}from"./LocaleSelector.vue_vue_type_script_setup_true_lang-CxL00gZR.js";import{L as Le,d as Ve}from"./defaultConfirmDeleteOptions-Dzr4BSHL.js";import{h as M}from"./http-PePEMJWw.js";import{m as Be}from"./mapLessonFromDto-Dmd7ExqT.js";import{U as ee}from"./unitApi-DSbyspay.js";import{s as Ie,a as De,b as Te,c as Fe}from"./index-COgmdyOc.js";import{s as ze}from"./index-iN1AuD1Q.js";import"./vue-codemirror.esm-CdIqRNbs.js";import{_ as ce,T as Ae}from"./CodeEditorView.vue_vue_type_script_setup_true_lang-B7Hu46u9.js";import{s as Re}from"./index-ChOX4LA1.js";import{s as Me,a as Ee}from"./index-BZ7w--mK.js";import{s as Ne}from"./index-Dm9YnGjq.js";import{s as _e}from"./index-D6y-9tOf.js";import{v as ge}from"./v4-CmTdKEVZ.js";import{_ as Pe}from"./CodeEditor.vue_vue_type_script_setup_true_lang-BI_jy6gP.js";import{C as je}from"./cloudStorageApi--yossP73.js";import{_ as Ge}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{s as Oe}from"./index-B68ca62K.js";import{s as He}from"./index-BDEbpixQ.js";import{s as ye}from"./index-BYv6yn4V.js";import{u as qe}from"./index-DF1O2LY1.js";import{s as Je}from"./index-Bb2_kwIb.js";import{s as Ke}from"./index-CtZ9V5Xk.js";import{T as Qe}from"./index-BOe8HTYE.js";import{s as We}from"./index-svC8Un1X.js";import"./mapUnitFromDto-CYGc5n9V.js";import"./index-DBTGH9LM.js";import"./index-zDAtVMgY.js";import"./index-Ddpxhgob.js";import"./runner-gHCm9fYt.js";import"./index-BcdmDF4L.js";import"./index-B1S9ByTA.js";import"./index-CxpjP5v7.js";import"./index-CgdfpZ6C.js";const z={hideLesson:Ye,modifyLesson:Xe,publishLesson:Ze,sendLessonForReview:et,cancelLessonReview:tt,startLessonReview:st,acceptLesson:ot,rejectLesson:nt,editLesson:lt};async function Ye(c){return await M.patch(`v2/lesson/${c}/hide`)}async function Xe(c){return await M.patch(`v2/lesson/${c}/modify`)}async function Ze(c){return await M.patch(`v2/lesson/${c}/publish`)}async function et(c){return await M.patch(`v2/lesson/${c}/review/send`)}async function tt(c){return await M.patch(`v2/lesson/${c}/review/cancel`)}async function st(c){return await M.patch(`v2/lesson/${c}/review/start`)}async function ot(c){return await M.patch(`v2/lesson/${c}/review/accept`)}async function nt(c){return await M.patch(`v2/lesson/${c}/review/reject`)}async function lt(c){return await M.patch(`v2/lesson/${c}/review/edit`)}const at={class:"flex items-center"},it={class:"flex items-center mr-2"},rt=V({__name:"HighlightEditor",props:ue({index:{},usedSlots:{}},{highlight:{},highlightModifiers:{}}),emits:ue(["remove","save"],["update:highlight"]),setup(c,{emit:d}){const l=c,u=ie(c,"highlight"),n=y(""),t=y(null),e=y(null),s=y(!1),p=te(()=>t.value!=null&&e.value!=null),r=d,$=()=>{r("remove",l.index)};G(()=>{u.value&&(n.value=u.value.id,t.value=u.value.module,e.value=u.value.slot,s.value=u.value.autoPut)}),R([t,e,s],()=>{t.value!=null&&r("save",l.index,n.value,t.value,e.value,s.value)}),R(p,b=>{b||(s.value=!1)});const m=y(["A","B","C","D","E","F"]),S=y(["8","9"]),_=y(["LED","switch","push-button","light-sensor","touch-sensor","potentiometer","encoder","motion-detector","microphone","climate-sensor","gyro-accel","buzzer","color-sensor","joystick","distance-sensor","servo","led-tower"]),g=te(()=>{if(t.value){if(t.value==="servo"||t.value==="led-tower"){const I=S.value.filter(E=>!(l.usedSlots??[]).includes(E));return e.value&&!I.includes(e.value)&&I.unshift(e.value),[null,...I]}const i=m.value.filter(k=>!(l.usedSlots??[]).includes(k));return e.value&&!i.includes(e.value)&&i.unshift(e.value),[null,...i]}const o=[...m.value,...S.value].filter(h=>!(l.usedSlots??[]).includes(h));return e.value&&!o.includes(e.value)&&o.unshift(e.value),[null,...o]}),U=te(()=>e.value?e.value==="8"||e.value==="9"?["servo","led-tower"]:_.value.filter(b=>b!=="servo"&&b!=="led-tower"):_.value);return(b,o)=>{const h=_e,i=Ne,k=Me,I=Ee,E=F;return a(),f("div",at,[x("div",it,[v(h,{modelValue:s.value,"onUpdate:modelValue":o[0]||(o[0]=L=>s.value=L),binary:"","input-id":"autoput",disabled:!p.value},null,8,["modelValue","disabled"]),o[3]||(o[3]=x("label",{for:"autoput",class:"ml-1 text-sm"},"auto",-1))]),v(I,null,{default:A(()=>[v(i,{modelValue:t.value,"onUpdate:modelValue":o[1]||(o[1]=L=>t.value=L),options:U.value,placeholder:"Select module",class:"place-content-center",size:"small"},null,8,["modelValue","options"]),v(k,{class:"h-[35px]"},{default:A(()=>o[4]||(o[4]=[x("div",null,"=>",-1)])),_:1}),v(i,{modelValue:e.value,"onUpdate:modelValue":o[2]||(o[2]=L=>e.value=L),options:g.value,placeholder:"Select slot",size:"small"},{option:A(({option:L})=>[x("span",{class:ae(L===null?"text-gray-400":"")},K(L===null?"[null]":L),3)]),value:A(({value:L})=>[x("span",{class:ae(L===null?"text-gray-400":"")},K(L===null?"[null]":L),3)]),_:1},8,["modelValue","options"])]),_:1}),v(E,{icon:"pi pi-trash",variant:"text",severity:"danger","aria-label":"Remove",onClick:$,class:"ml-2"})])}}}),dt={class:"flex flex-col gap-2"},ut=V({__name:"HighlightPanel",props:{neededModules:{default:[]},neededModulesModifiers:{}},emits:["update:neededModules"],setup(c){const d=ie(c,"neededModules");function l(){d.value=[...d.value,{autoPut:!1,module:null,slot:null,id:ge()}]}function u(t){d.value.splice(t,1)}function n(t,e,s,p,r){d.value[t].id=e,d.value[t].module=s,d.value[t].slot=p,d.value[t].autoPut=r}return(t,e)=>{const s=F,p=Re;return a(),C(p,{header:"Highlight slots & modules"},{default:A(()=>[x("div",dt,[(a(!0),f(j,null,J(d.value,(r,$)=>(a(),f("div",{key:r.id},[v(rt,{highlight:d.value[$],"onUpdate:highlight":m=>d.value[$]=m,index:$,usedSlots:d.value.filter((m,S)=>{var _;return S!==$&&((_=d.value[S])==null?void 0:_.slot)!=null}).map(m=>m.slot),onRemove:u,onSave:n},null,8,["highlight","onUpdate:highlight","index","usedSlots"])]))),128))]),v(s,{icon:"pi pi-plus",variant:"text","aria-label":"Add",class:"self-center mt-2",onClick:l})]),_:1})}}}),ct={class:"flex"},pt={class:"h-[500px] flex flex-col w-full relative"},vt={class:"flex h-full",style:{border:"0.1px solid #808080",borderTopLeftRadius:"12px",borderTopRightRadius:"12px",overflow:"hidden"}},mt={class:"absolute right-2 bottom-2"},ne=!1,ft=V({__name:"PibodyEditor",props:{id:{},content:{},data:{}},emits:["save-content","show-tester"],setup(c,{emit:d}){const l=H(),u=c,n=d,t=y(""),e=y(""),s=y([]);let p=!0;pe(()=>{t.value=u.content.starting,e.value=u.content.answer,s.value=u.data.neededModules}),R([t,e,s],()=>{if(p){p=!1;return}n("save-content",{starting:t.value,answer:e.value},{neededModules:s.value.filter($=>$.module!=null),tests:u.data.tests,includedCommandsForTests:u.data.includedCommandsForTests})},{deep:!0});function r(){n("show-tester",{lesson_id:l.params.id,unit_id:u.id.split("-")[1]})}return($,m)=>{const S=F;return a(),f(j,null,[x("div",ct,[x("div",pt,[x("div",vt,[v(ce,{code:t.value,"onUpdate:code":m[0]||(m[0]=_=>t.value=_),runbuttons:!1,connectbuttons:ne,id:u.id+"_",class:"flex-1"},null,8,["code","id"]),v(ce,{code:e.value,"onUpdate:code":m[1]||(m[1]=_=>e.value=_),connectbuttons:ne,"onUpdate:connectbuttons":m[2]||(m[2]=_=>ne=_),id:u.id,class:"flex-1"},null,8,["code","id"])]),x("div",mt,[v(S,{label:"Tests",icon:"pi pi-pen-to-square",class:"w-fit",severity:"info",onClick:r})]),v(w(Ae),{id:u.id,class:"flex-grow max-h-40"},null,8,["id"])])]),v(ut,{neededModules:s.value,"onUpdate:neededModules":m[3]||(m[3]=_=>s.value=_),class:"mb-2"},null,8,["neededModules"])],64)}}}),_t=["article","options","open","video","code","pibody"],O=we("lesson-edit-store",()=>{const c=be(),d=fe(),{lang:l}=P(d),u=y(null),n=y(!1),t=y(!1),e=y(!1),s=y(!1),p=y(!1),r=y(!1);function $(b){e.value=b}async function m(b){try{n.value=!0;const{data:o}=await Le.getLessonById(b,void 0,l.value);u.value=Be(o)}catch(o){c.add({severity:"error",summary:o.response.data.error,life:2e3})}finally{n.value=!1}}async function S(b,o){try{t.value=!0;const{data:h}=await ee.getUnitByIdandLessonId(b,o,l.value);return h}catch(h){c.add({severity:"error",summary:h.response.data.error,life:2e3})}finally{t.value=!1}}async function _(b){try{s.value=!0;const{data:o}=await ee.createUnitByLessonId(u.value.id,b);c.add({severity:"success",summary:o.message,life:2e3})}catch(o){c.add({severity:"error",summary:o.response.data.error,life:2e3})}finally{s.value=!1}}async function g(b,o,h){try{p.value=!0;const{data:i}=await ee.updateUnitByIdandLessonId(b,o,h,l.value);return i.unit_id}catch(i){c.add({severity:"error",summary:i.response.data.error,life:2e3})}finally{p.value=!1}}async function U(b,o){try{r.value=!0;const{data:h}=await ee.deleteUnitByIdandLessonId(b,o);c.add({severity:"success",summary:h.message,life:2e3})}catch(h){c.add({severity:"error",summary:h.response.data.error,life:2e3})}finally{r.value=!1}}return{selectedLesson:u,isLessonLoading:n,isLessonSaving:e,isUnitLoading:t,isUnitCreating:s,isUnitUpdating:p,isUnitDeleting:r,setLessonSaving:$,loadLessonById:m,loadUnitByIdandLessonId:S,createUnit:_,updateUnitByIdandLessonId:g,deleteUnitByIdandLessonId:U}}),gt={class:"flex items-start"},yt=V({__name:"MdEditor",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(c){const d=ie(c,"modelValue"),l=xe({title:{title:"Title",icon:"v-md-icon-tip",action(n){n.insert(t=>{const e="# <center>",s="</center>",r=t||"Title";return{text:`${e}${r}${s}`,selected:r}})}},icons:{title:"icons",icon:"v-md-icon-tip",menus:[{name:"Attention",text:"Attention",action(n){n.insert(()=>{const t='<span style="font-size: 20px">',e="</span>",s="⚠️";return{text:`${t}${s}${e}`,selected:s}})}},{name:"PiBody",text:"PiBody",action(n){n.insert(()=>{const t="<b>",e="</b>",s='<span style="color: #FF3F85"> Pi</span>Body';return{text:`${t}${s}${e}`,selected:s}})}},{name:"Run",text:"Run",action(n){n.insert(()=>({text:"▶️<b>Run</b>"}))}}]},style:{title:"Style",icon:"v-md-icon-tip",action(n){n.insert(t=>{const e='<span style="">',s="</span>",r=t||"placeholder";return{text:`${e}${r}${s}`,selected:r}})}},underline:{title:"Underline",icon:"v-md-icon-under-line",action(n){n.insert(t=>{const e='<span style="text-decoration: underline">',s="</span>",r=t||"placeholder";return{text:`${e}${r}${s}`,selected:r}})}},tip:{title:"Tip",icon:"v-md-icon-tip",action(n){n.insert(t=>{const e='<div style="background-color:#F3F5F7; padding: 20px; border-left: solid 8px #42B983">',s="</div>",r=t||"placeholder";return{text:`${e}${r}${s}`,selected:r}})}},note:{title:"Note",icon:"v-md-icon-tip",action(n){n.insert(t=>{const e='<div style="background-color:#F3F5F7; padding: 15px; border-left: solid 8px #FFCD6B; margin-bottom: 15px">',s="</div>",r=t||"placeholder";return{text:`${e}${r}${s}`,selected:r}})}}});async function u(n,t,e){const s=e[0],p=new FormData;p.append("file",s);try{const{data:r}=await je.uploadFile(p,"image_"),$=r.source_url;t({url:$,desc:"desc",width:"auto",height:"auto"})}catch(r){console.log(r)}}return(n,t)=>{const e=$e("v-md-editor");return a(),f("div",gt,[v(e,{modelValue:d.value,"onUpdate:modelValue":t[0]||(t[0]=s=>d.value=s),mode:"edit",onChange:t[1]||(t[1]=s=>d.value=s),"left-toolbar":"undo redo clear | tip emoji todo-list | h bold italic strikethrough quote ul ol table hr link code image | title icons style underline tip note","right-toolbar":"",toolbar:l,"disabled-menus":[],onUploadImage:u},null,8,["modelValue","toolbar"])])}}}),he=Ge(yt,[["__scopeId","data-v-52e9f376"]]),ht=V({__name:"ArticleEditor",props:{article:{}},emits:["save-content"],setup(c,{emit:d}){const l=c,u=d,n=y("");let t=!0;return G(()=>{var e;n.value=((e=l.article)==null?void 0:e.text)??""}),R(n,()=>{if(t){t=!1;return}u("save-content",{text:n.value})},{flush:"post"}),(e,s)=>(a(),C(he,{modelValue:n.value,"onUpdate:modelValue":s[0]||(s[0]=p=>n.value=p)},null,8,["modelValue"]))}}),wt={class:"flex flex-col gap-2"},bt={class:"flex gap-1 text-gray-500"},xt={class:"flex flex-col gap-1"},$t=V({__name:"OptionsEditor",props:{optionsData:{}},emits:["save-content"],setup(c,{emit:d}){const l=c,u=d,n=y(!1),t=y(!1),e=y(!1),s=y([]),p=y([]),r=y();let $=!0;G(()=>{var _,g,U,b,o,h;n.value=((_=l.optionsData)==null?void 0:_.shuffle)??!1,t.value=((g=l.optionsData)==null?void 0:g.feedback)??!1,e.value=((U=l.optionsData)==null?void 0:U.single)??!1,s.value=((b=l.optionsData)==null?void 0:b.options)??[],p.value=((o=l.optionsData)==null?void 0:o.answer)??[],r.value=l.optionsData&&l.optionsData.answer&&l.optionsData.answer.length>0?(h=l.optionsData)==null?void 0:h.answer[0]:void 0}),R([n,t,e,s,p,r],()=>{if($){$=!1;return}u("save-content",{shuffle:n.value,feedback:t.value,single:e.value,options:s.value,answer:e.value?r.value?[r.value]:[]:p.value})},{deep:!0});function m(){s.value.push({id:ge(),text:""})}function S(_){s.value=s.value.filter(g=>g.id!==_),p.value=p.value.filter(g=>g!==_),r.value==_&&(r.value=void 0)}return(_,g)=>{const U=He,b=Oe,o=_e,h=F;return a(),f("div",wt,[x("div",bt,[g[5]||(g[5]=x("div",null,"shuffle:",-1)),v(U,{modelValue:n.value,"onUpdate:modelValue":g[0]||(g[0]=i=>n.value=i),class:"mr-2"},null,8,["modelValue"]),g[6]||(g[6]=x("div",null,"feedback:",-1)),v(U,{modelValue:t.value,"onUpdate:modelValue":g[1]||(g[1]=i=>t.value=i),class:"mr-2"},null,8,["modelValue"]),g[7]||(g[7]=x("div",null,"single:",-1)),v(U,{modelValue:e.value,"onUpdate:modelValue":g[2]||(g[2]=i=>e.value=i)},null,8,["modelValue"])]),x("div",xt,[(a(!0),f(j,null,J(s.value,i=>(a(),f("div",{key:i.id,class:"flex gap-2 items-center"},[e.value?(a(),C(b,{key:0,modelValue:r.value,"onUpdate:modelValue":g[3]||(g[3]=k=>r.value=k),value:i.id},null,8,["modelValue","value"])):(a(),C(o,{key:1,modelValue:p.value,"onUpdate:modelValue":g[4]||(g[4]=k=>p.value=k),value:i.id},null,8,["modelValue","value"])),v(he,{modelValue:i.text,"onUpdate:modelValue":k=>i.text=k,class:"w-full"},null,8,["modelValue","onUpdate:modelValue"]),v(h,{icon:"pi pi-trash",variant:"text",severity:"danger",size:"small",onClick:k=>S(i.id)},null,8,["onClick"])]))),128))]),v(h,{icon:"pi pi-plus",label:"Add option",variant:"text",size:"small",onClick:m,class:"self-center"})])}}}),kt=V({__name:"OpenEditor",props:{open:{}},emits:["save-content"],setup(c,{emit:d}){const l=c,u=d,n=y("");let t=!0;return G(()=>{var e;n.value=((e=l.open)==null?void 0:e.answer)??""}),R(n,()=>{if(t){t=!1;return}u("save-content",{answer:n.value})}),(e,s)=>{const p=ye;return a(),C(p,{type:"text",modelValue:n.value,"onUpdate:modelValue":s[0]||(s[0]=r=>n.value=r??""),class:"w-full",size:"small"},null,8,["modelValue"])}}}),St=V({__name:"VideoEditor",props:{video:{}},emits:["save-content"],setup(c,{emit:d}){const l=c,u=d,n=y("");let t=!0;return G(()=>{var e;n.value=((e=l.video)==null?void 0:e.url)??""}),R(n,()=>{if(t){t=!1;return}u("save-content",{url:n.value})}),(e,s)=>{const p=ye;return a(),C(p,{type:"text",modelValue:n.value,"onUpdate:modelValue":s[0]||(s[0]=r=>n.value=r??""),class:"w-full",size:"small"},null,8,["modelValue"])}}}),Ct={class:"bg-white rounded-lg border border-gray-200"},Ut={key:1,class:"flex flex-col h-full w-full"},Lt={class:"flex items-center gap-2 px-4 pt-2"},Vt={class:"text-sm"},Bt={class:"text-sm text-gray-500"},It={key:1,class:"flex-grow px-4 py-2"},Dt={class:"flex justify-end"},Tt=V({__name:"UnitCard",props:{unit:{},loading:{type:Boolean}},emits:["delete","update"],setup(c,{emit:d}){const l=c,u=d,n=H(),t=me(),e=O(),{updateUnitByIdandLessonId:s,setLessonSaving:p,loadUnitByIdandLessonId:r}=e,$=y(!1),m=y(null),S=y(null);pe(async()=>{$.value=!0;const o=await r(l.unit.id,Number(n.params.id));o&&(m.value=o.content,S.value=o.data),$.value=!1});function _(o,h){p(!0),U(o,h)}function g(o){t.push({name:"tester2",params:{lesson_id:o.lesson_id,unit_id:o.unit_id}})}const U=qe((o,h)=>{b(o,h)},1e3,{maxWait:5e3});async function b(o,h){const i=await s(l.unit.id,Number(n.params.id),{content:o,data:h});i&&u("update",l.unit,i),p(!1)}return(o,h)=>{const i=ze,k=F;return a(),f("div",Ct,[o.loading?(a(),C(i,{key:0,class:"flex justify-center items-center w-10 h-full"})):(a(),f("div",Ut,[x("div",Lt,[x("div",Vt,K(o.unit.id),1),x("div",Bt,K(`${o.unit.unitType}`),1)]),$.value?(a(),C(i,{key:0,class:"flex justify-center items-center w-10 h-full"})):(a(),f("div",It,[o.unit.unitType=="article"?(a(),C(ht,{key:0,article:m.value,onSaveContent:_},null,8,["article"])):o.unit.unitType=="options"?(a(),C($t,{key:1,"options-data":m.value,onSaveContent:_},null,8,["options-data"])):o.unit.unitType=="open"?(a(),C(kt,{key:2,open:m.value,onSaveContent:_},null,8,["open"])):o.unit.unitType=="video"?(a(),C(St,{key:3,video:m.value,onSaveContent:_},null,8,["video"])):l.unit.unitType=="code"?(a(),C(w(Pe),{key:4,id:`code-${l.unit.id}`,code:m.value,onSaveContent:_,onShowTester:g},null,8,["id","code"])):l.unit.unitType=="pibody"?(a(),C(w(ft),{key:5,id:`code-${l.unit.id}`,content:m.value,data:S.value,onSaveContent:_,onShowTester:g},null,8,["id","content","data"])):B("",!0)])),x("div",Dt,[v(k,{icon:"pi pi-trash",size:"small",severity:"danger",variant:"text",onClick:h[0]||(h[0]=ve(I=>u("delete",l.unit),["stop"]))})])]))])}}}),Ft={class:"group w-full relative"},zt={class:"flex"},le=V({__name:"AddUnitButton",props:{unitId:{},showAddGroup:{type:Boolean},hided:{type:Boolean}},emits:["add-group-divider"],setup(c,{emit:d}){const l=c,u=d,n=H(),t=O(),{loadLessonById:e,createUnit:s}=t,p=y(),r=y(_t.map(m=>({label:m,command:async()=>{await s({unit_type:m,prev_unit_id:l.unitId??void 0}),await e(Number(n.params.id))}}))),$=m=>{p.value.toggle(m)};return(m,S)=>{const _=Ke,g=F,U=Je;return a(),f(j,null,[x("div",Ft,[S[1]||(S[1]=x("div",{class:"h-3"},null,-1)),x("div",{class:ae(["absolute left-1/2 -translate-x-1/2 -top-5 group-hover:block mt-[9px] w-full",m.hided?"hidden":""])},[x("div",zt,[v(_,{class:"w-7",type:"dashed"}),v(_,{class:"flex-grow",type:"dashed"}),v(g,{icon:"pi pi-plus",class:"flex self-end shadow-xl h-7",size:"small",onClick:$}),v(_,{class:"flex-grow",type:"dashed"}),m.showAddGroup?(a(),C(g,{key:0,icon:"pi pi-arrow-up-right-and-arrow-down-left-from-center",class:"flex self-end h-7",size:"small",variant:"text",onClick:S[0]||(S[0]=b=>u("add-group-divider"))})):(a(),C(_,{key:1,class:"w-7",type:"dashed"}))])],2)]),v(U,{ref_key:"menu",ref:p,model:r.value,popup:!0},null,8,["model"])],64)}}}),At=V({__name:"RemoveGroupButton",emits:["remove-group-divider"],setup(c,{emit:d}){const l=d;return(u,n)=>{const t=F;return a(),C(t,{icon:"pi pi-arrow-down-left-and-arrow-up-right-to-center",severity:"danger",class:"flex self-end h-7 w-7",size:"small",variant:"text",onClick:n[0]||(n[0]=ve(e=>l("remove-group-divider"),["stop"]))})}}}),Rt={class:"flex flex-col gap-2"},Mt={class:"w-full flex justify-between gap-2 mr-4"},Et={class:"flex flex-col p-2 rounded-lg bg-slate-50"},Nt=V({__name:"UnitsView",props:{pages:{}},setup(c){const d=c,l=H(),u=ke(),n=O(),{isUnitDeleting:t}=P(n),{loadLessonById:e,createUnit:s,deleteUnitByIdandLessonId:p}=n,r=y(null);async function $(i){await s({unit_type:"group-divider",prev_unit_id:i.id}),await e(Number(l.params.id))}async function m(){await s({unit_type:"page-divider"}),await e(Number(l.params.id))}async function S(i){await p(i,Number(l.params.id)),await e(Number(l.params.id))}function _(i){r.value=i,u.require({...Ve,message:"Are you sure you want to delete this lesson?",accept:async()=>{await p(i.id,Number(l.params.id)),await e(Number(l.params.id))}})}function g(i,k){k>i.id&&(i.id=k)}const U=Number(l.params.id),b=`openedPanels-${U}`,o=y({});G(async()=>{const i=localStorage.getItem(b);i&&(o.value=JSON.parse(i)),await Se(),setTimeout(()=>{const k=localStorage.getItem(`lastOpenedGroup-${U}`);if(k){const I=document.getElementById(`group-${k}`);if(I){I.scrollIntoView({behavior:"smooth"});return}}},1e3)}),R(o,i=>{localStorage.setItem(b,JSON.stringify(i))},{deep:!0});function h(i,k){o.value[k]=i,o.value[k].length>0&&localStorage.setItem(`lastOpenedGroup-${U}`,i[i.length-1])}return(i,k)=>{const I=Ie,E=De,L=Te,Q=Fe,W=F;return a(),f("div",Rt,[(a(!0),f(j,null,J(d.pages,N=>(a(),C(Q,{value:o.value[N.id]||[],"onUpdate:value":D=>h(D,N.id),multiple:"",key:N.id,class:"flex flex-col gap-2 bg-white p-4 rounded-lg shadow-lg"},{default:A(()=>[(a(!0),f(j,null,J(N.groups,(D,Y)=>(a(),C(L,{key:D.id,value:D.id,id:`group-${D.id}`},{default:A(()=>[v(I,null,{default:A(()=>[x("div",Mt,[x("div",null,"Step: "+K(Y),1),D.id!=-1?(a(),C(At,{key:0,onRemoveGroupDivider:T=>S(D.id)},null,8,["onRemoveGroupDivider"])):B("",!0)])]),_:2},1024),v(E,{class:"flex flex-col"},{default:A(()=>[x("div",Et,[(a(!0),f(j,null,J(D.units,(T,X)=>{var q;return a(),f("div",{key:T.id},[X==0?(a(),C(le,{key:0,hided:!0,"unit-id":D.id,"show-add-group":!1},null,8,["unit-id"])):B("",!0),v(Tt,{unit:T,loading:((q=r.value)==null?void 0:q.id)===T.id&&w(t),onDelete:Z=>_(T),onUpdate:g},null,8,["unit","loading","onDelete"]),v(le,{hided:!0,"unit-id":T.id,"show-add-group":!0,onAddGroupDivider:Z=>$(T)},null,8,["unit-id","onAddGroupDivider"])])}),128)),D.units.length==0?(a(),C(le,{key:0,hided:!1,"unit-id":D.id,"show-add-group":!1},null,8,["unit-id"])):B("",!0)])]),_:2},1024)]),_:2},1032,["value","id"]))),128))]),_:2},1032,["value","onUpdate:value"]))),128)),v(W,{id:"newpage",icon:"pi pi-plus",label:"New page",variant:"text",size:"small",class:"flex self-center",onClick:k[0]||(k[0]=N=>m())})])}}}),Pt={class:"w-[24px] h-[24px]"},jt={key:0,class:"flex items-center"},Gt={key:0,class:"material-icons text-gray-500"},Ot={key:1,class:"material-icons text-gray-500"},Ht={key:1},qt={class:"material-icons text-gray-500"},Jt=V({__name:"AutoSaveCloud",setup(c){const d=O(),{selectedLesson:l,isLessonSaving:u}=P(d);return(n,t)=>{var s;const e=Qe;return a(),f("div",Pt,[(s=w(l))!=null&&s.editable?(a(),f("div",jt,[w(u)?se((a(),f("span",Ot,t[1]||(t[1]=[oe("cloud_sync")]))),[[e,"Saving...",void 0,{bottom:!0}]]):se((a(),f("span",Gt,t[0]||(t[0]=[oe("cloud_done")]))),[[e,"Saved",void 0,{bottom:!0}]])])):(a(),f("div",Ht,[se((a(),f("span",qt,t[2]||(t[2]=[oe("cloud_off")]))),[[e,"Save not allowed",void 0,{bottom:!0}]])]))])}}}),Kt={key:0},Qt={key:0},Wt={key:1},Yt={key:0},Xt={key:1},Zt={key:2},es={key:0,class:"flex gap-1"},ts={key:3},ss={key:0},os={key:4},ns={key:0,class:"flex gap-1"},ls={key:5},as={key:0,class:"flex gap-1"},is={key:6},rs={key:0,class:"flex gap-1"},ds=V({__name:"StageButtons",setup(c){const d=H(),l=Ce(),{user:u}=P(l),n=O(),{selectedLesson:t}=P(n),e=y(!1),s=y(!1);async function p(){e.value=!0;try{await z.sendLessonForReview(d.params.id.toString()),window.location.reload()}catch(o){console.log(o)}finally{e.value=!1}}async function r(){e.value=!0;try{await z.cancelLessonReview(d.params.id.toString()),window.location.reload()}catch(o){console.log(o)}finally{e.value=!1}}async function $(){e.value=!0;try{await z.startLessonReview(d.params.id.toString()),window.location.reload()}catch(o){console.log(o)}finally{e.value=!1}}async function m(){e.value=!0;try{await z.acceptLesson(d.params.id.toString()),window.location.reload()}catch(o){console.log(o)}finally{e.value=!1}}async function S(){s.value=!0;try{await z.rejectLesson(d.params.id.toString()),window.location.reload()}catch(o){console.log(o)}finally{s.value=!1}}async function _(){e.value=!0;try{await z.editLesson(d.params.id.toString()),window.location.reload()}catch(o){console.log(o)}finally{e.value=!1}}async function g(){e.value=!0;try{await z.publishLesson(d.params.id.toString()),window.location.reload()}catch(o){console.log(o)}finally{e.value=!1}}async function U(){s.value=!0;try{await z.hideLesson(d.params.id.toString()),window.location.reload()}catch(o){console.log(o)}finally{s.value=!1}}async function b(){e.value=!0;try{await z.modifyLesson(d.params.id.toString()),window.location.reload()}catch(o){console.log(o)}finally{e.value=!1}}return(o,h)=>{var k,I,E,L,Q,W,N,D,Y,T,X,q,Z,re,de;const i=F;return((k=w(t))==null?void 0:k.stage)=="prepare_for_submission"?(a(),f("div",Kt,[((I=w(u))==null?void 0:I.user_type)=="contributor"?(a(),f("div",Qt,[v(i,{label:"Send for review",severity:"info",size:"small",onClick:p,disabled:e.value,loading:e.value},null,8,["disabled","loading"])])):B("",!0)])):((E=w(t))==null?void 0:E.stage)=="waiting_for_review"?(a(),f("div",Wt,[((L=w(u))==null?void 0:L.user_type)=="contributor"?(a(),f("div",Yt,[v(i,{label:"Cancel submission",severity:"danger",size:"small",onClick:r,disabled:e.value,loading:e.value},null,8,["disabled","loading"])])):((Q=w(u))==null?void 0:Q.user_type)=="editor"?(a(),f("div",Xt,[v(i,{label:"Start review",severity:"info",size:"small",onClick:$,disabled:e.value,loading:e.value},null,8,["disabled","loading"])])):B("",!0)])):((W=w(t))==null?void 0:W.stage)=="in_review"?(a(),f("div",Zt,[((N=w(u))==null?void 0:N.user_type)=="editor"?(a(),f("div",es,[v(i,{label:"Reject",severity:"danger",size:"small",onClick:S,disabled:e.value||s.value,loading:s.value},null,8,["disabled","loading"]),v(i,{label:"Accept",size:"small",onClick:m,disabled:e.value||s.value,loading:e.value},null,8,["disabled","loading"])])):B("",!0)])):((D=w(t))==null?void 0:D.stage)=="rejected"?(a(),f("div",ts,[((Y=w(u))==null?void 0:Y.user_type)=="contributor"?(a(),f("div",ss,[v(i,{label:"Edit submission",severity:"info",size:"small",onClick:_,disabled:e.value,loading:e.value},null,8,["disabled","loading"])])):B("",!0)])):((T=w(t))==null?void 0:T.stage)=="ready_for_publish"?(a(),f("div",os,[((X=w(u))==null?void 0:X.user_type)=="editor"?(a(),f("div",ns,[w(t).createdBy!=Number(w(u).user_id)?(a(),C(i,{key:0,label:"Reject",severity:"danger",size:"small",onClick:S,disabled:e.value||s.value,loading:s.value},null,8,["disabled","loading"])):B("",!0),v(i,{label:"Publish",size:"small",onClick:g,disabled:e.value||s.value,loading:e.value},null,8,["disabled","loading"])])):B("",!0)])):((q=w(t))==null?void 0:q.stage)=="published"?(a(),f("div",ls,[((Z=w(u))==null?void 0:Z.user_type)=="editor"?(a(),f("div",as,[v(i,{label:"Hide",severity:"danger",size:"small",onClick:U,disabled:e.value||s.value,loading:s.value},null,8,["disabled","loading"]),v(i,{label:"Modify",size:"small",onClick:b,disabled:e.value||s.value,loading:e.value},null,8,["disabled","loading"])])):B("",!0)])):((re=w(t))==null?void 0:re.stage)=="in_modify"?(a(),f("div",is,[((de=w(u))==null?void 0:de.user_type)=="editor"?(a(),f("div",rs,[v(i,{label:"Hide",severity:"danger",size:"small",onClick:U,disabled:e.value||s.value,loading:s.value},null,8,["disabled","loading"]),v(i,{label:"Publish",size:"small",onClick:g,disabled:e.value||s.value,loading:e.value},null,8,["disabled","loading"])])):B("",!0)])):B("",!0)}}}),us={key:0},cs=V({__name:"StageStatus",setup(c){const d=O(),{selectedLesson:l}=P(d);return(u,n)=>{const t=We;return w(l)?(a(),f("div",us,[["prepare_for_submission","waiting_for_review","in_review","in_modify"].includes(w(l).stage)?(a(),C(t,{key:0,label:w(l).stage.replace(/_/g," ").replace(/^./,e=>e.toUpperCase()),icon:"pi pi-clock",pt:{icon:{class:"text-yellow-500"}},class:"h-8 bg-yellow-50 w-fit"},null,8,["label"])):["ready_for_publish","published"].includes(w(l).stage)?(a(),C(t,{key:1,label:w(l).stage.replace(/_/g," ").replace(/^./,e=>e.toUpperCase()),icon:"pi pi-check-circle",pt:{icon:{class:"text-green-500"}},class:"h-8 bg-green-50 w-fit"},null,8,["label"])):["rejected"].includes(w(l).stage)?(a(),C(t,{key:2,label:w(l).stage.replace(/_/g," ").replace(/^./,e=>e.toUpperCase()),icon:"pi pi-times-circle",pt:{icon:{class:"text-red-500"}},class:"h-8 bg-red-50 w-fit"},null,8,["label"])):B("",!0)])):B("",!0)}}}),ps={class:"flex flex-col items-center"},vs={class:"flex justify-between items-center w-full min-h-16 border-b border-gray-200 px-8 shadow-md gap-8"},ms={class:"flex items-center gap-4"},fs={class:"flex items-center gap-4"},_s={class:"w-full h-full max-w-screen-lg px-4 md:px-28 py-8"},gs={class:"fixed top-32 right-0 pl-2 pr-4 py-2 bg-white rounded-tl-lg rounded-bl-lg shadow-md z-50 border border-gray-200 flex flex-col items-center gap-4"},Zs=V({__name:"LessonEditPage",setup(c){const d=H(),l=me(),u=fe(),{lang:n}=P(u),t=O(),{selectedLesson:e}=P(t),{loadLessonById:s}=t;G(()=>s(Number(d.params.id))),R(n,async(r,$)=>{r!==$&&e.value&&await s(e.value.id)});function p(){window.history.length>2?l.go(-1):l.push("/v2/routes")}return(r,$)=>{var S;const m=F;return a(),f("div",ps,[x("div",vs,[x("div",ms,[v(m,{icon:"pi pi-times",variant:"text",severity:"contrast",onClick:p}),v(cs)]),x("div",fs,[v(ds)])]),x("div",_s,[v(Nt,{pages:(S=w(e))==null?void 0:S.pages},null,8,["pages"])]),x("div",gs,[v(Jt),v(w(Ue))])])}}});export{Zs as default};
