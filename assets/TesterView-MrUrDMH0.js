import{_ as ae,T as oe,S as le,s as ne,a as re}from"./SimulationView-CC4HBw8_.js";import{_ as ie}from"./IdeHeader.vue_vue_type_script_setup_true_lang-DRUcU897.js";import{s as J}from"./index-zA8N6AIZ.js";import{s as ue}from"./index-Dow_M5hI.js";import{s as ce}from"./index-Z26c4h7H.js";import{d as j,I as de,o as f,f as k,w as r,e as i,c as b,i as W,b as o,h as z,F as B,g as G,u as pe,z as me,A as L,r as V,m as fe,j as a,t as _,v as ve,C as _e,n as he,H as ge,s as ye}from"./index-CzSOBzMf.js";import{_ as be,s as we}from"./SavedCloud.vue_vue_type_script_setup_true_lang-BSNg_kTB.js";import{b as Ce,c as Se,a as P,_ as $e}from"./FeedbackTimeline.vue_vue_type_script_setup_true_lang-CHgzlynJ.js";import{g as Te,f as ke,d as O,u as xe,b as Re,I as Ve,c as ze,i as h,h as Fe,e as Ie,n as U,R as D,r as H}from"./pibody-C6I5d_e8.js";import{u as Pe}from"./editor-store-B1DONdOT.js";import{a as De}from"./index-NFHxEtBD.js";import{t as je}from"./types-CG_ifl2b.js";import{c as Be}from"./index-BXrpJlkX.js";import"./index-CSoie_Om.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-CuFuuspi.js";import"./logo-DOVQBN0O.js";import"./index-D_qJJHtk.js";import"./pibody-BwAjMvHk.js";import"./index-Z2-JVffd.js";import"./index-DGyM8AsC.js";import"./index-DTQp-zAo.js";import"./index-bR_gSSN2.js";import"./index-DDfBxct2.js";import"./index-BfOAvlfV.js";import"./index-vq9KqxT3.js";const Me={class:"flex overflow-auto mb-2"},Ne={class:"flex"},Ae={class:"text-center"},Ee={key:0,class:"flex items-center justify-center h-12"},q=j({__name:"TestDataTimeline",props:{data:{}},setup(F){const x=de(()=>Te(F.data));return(w,p)=>{const g=J;return f(),k(g,{header:"Expected"},{default:r(()=>[i("div",Me,[(f(!0),b(B,null,W(w.data,(t,u)=>(f(),b("div",Ne,[i("div",Ae,[o(Ce,{message:t.content,class:"border-4 border-blue-500"},null,8,["message"])]),u+1<w.data.length?(f(),b("div",Ee,"â†’")):z("",!0)]))),256))]),p[0]||(p[0]=G(" Inputs: ")),o(Se,{inputs:x.value},null,8,["inputs"])]),_:1})}}}),Le={class:"h-full flex flex-col"},Oe={class:"p-4"},Ue={class:"flex w-full"},He={class:"material-icons"},qe={class:"material-icons"},Je={class:"material-icons"},We={class:"material-icons"},Ge={class:"material-icons"},Ke={class:"flex flex-col gap-2 m-2 h-full overflow-auto"},Qe={class:"flex gap-2 w-full"},Xe=["for"],Ye={class:"material-icons"},Ze={class:"material-icons"},et=j({__name:"TesterControls",setup(F){const x=pe(),w=me(),p=Pe(),g=L(p),t=V(null),u=V([]);fe(async()=>{const s=he();try{const e=s.params.lesson_id;if(!g.lesson.value||g.lesson.value.id!=e){const{data:l}=await De.getProjectByID(e.toString()),S=await je(l);p.setLesson(S)}const{data:d}=await P.getStepTranslationByID(s.params.step_id.toString());if(t.value=d,y.value=t.value.content.solution??y.value,t.value.content.highlights)for(const l of t.value.content.highlights)l.module&&l.slot&&n.newModuleToSlot(l.module,l.slot);t.value&&(t.value.content.tests&&(u.value=await ke(t.value.content.tests)),t.value.content.includedCommandsForTests=t.value.content.includedCommandsForTests??[...O])}catch(e){console.log(e)}});async function C(){if(t.value!=null){p.setStepSaving(!0);try{await P.updateStepTranslationByID(t.value.step,t.value.name,t.value.content)}catch(s){let e="";s instanceof Error?e=s.message:e=String(s),x.add({severity:"error",summary:"Failed to save",detail:e,life:3e3})}finally{p.setStepSaving(!1)}}}const M=Be(()=>{C()},1e3,{maxWait:5e3});async function I(s){const e=JSON.stringify(s),d=new Blob([e],{type:"application/json"}),l=new FormData;l.append("file",d,"default.test.json");const{data:S}=await P.uploadFile(l);return S.presigned_url}async function K(){if(t.value==null)return;const s=await I(v.value);t.value.content.tests?t.value.content.tests.push({name:"",url:s}):(t.value.content.tests=[],t.value.content.tests.push({name:"",url:s})),u.value.push({data:v.value,test:{name:"",url:s}}),v.value=[],C()}function Q(s){w.require({message:"Are you sure you want to Delete?",header:"Confirmation",icon:"pi pi-exclamation-triangle",rejectProps:{label:"Cancel",severity:"secondary",outlined:!0},acceptProps:{label:"Delete",severity:"danger"},accept:()=>{var e,d;(d=(e=t.value)==null?void 0:e.content.tests)==null||d.splice(s,1),u.value.splice(s,1),C()}})}const{fileContent:y}=L(xe()),n=Re(),{isLoading:m,isRunning:N}=n,v=V(U),X=V(U);function Y(){n.recorder.start(),n.run();const s=ge(n.recorder.state,()=>{(n.replayer.state.value==D.Finish||n.replayer.state.value==D.Timeout)&&(n.recorder.stop(),v.value=n.recorder.getRecords()),s.stop()})}function Z(){n.replayer.state.value==D.Continue?(n.recorder.stop(),n.replayer.stop(),X.value=n.recorder.getRecords()):(n.recorder.stop(),v.value=n.recorder.getRecords()),n.stop()}function R(){var s;return((s=t.value)==null?void 0:s.content.includedCommandsForTests)??O}const ee=async()=>{if(!(!t.value||!t.value.content.tests)){h.value=!0;for(const[s,e]of u.value.entries()){const d=await H(y.value,e.data,R());await n.stopPromise();const l=await I(d);t.value.content.tests[s].url=l,u.value[s].test.url=l,u.value[s].data=d}await C(),h.value=!1}},te=async(s,e)=>{if(!t.value||!t.value.content.tests)return;h.value=!0;const d=await H(y.value,s.data,R());await n.stopPromise();const l=await I(d);t.value.content.tests[e].url=l,u.value[e].test.url=l,u.value[e].data=d,C(),h.value=!1};return(s,e)=>{const d=we,l=ye,S=ce,A=ue,se=J;return f(),b("div",Le,[i("div",Oe,[e[4]||(e[4]=G(" Include Commands: ")),t.value?(f(),k(d,{key:0,onChange:a(M),modelValue:t.value.content.includedCommandsForTests,"onUpdate:modelValue":e[0]||(e[0]=c=>t.value.content.includedCommandsForTests=c),options:Ve,filter:"",placeholder:"Select commands",class:"w-full md:w-80",maxSelectedLabels:3},null,8,["onChange","modelValue","options"])):z("",!0),i("div",Ue,[o(l,{type:"button",class:"w-9 h-9 mr-1",severity:"success",rounded:"",onClick:Y,disabled:a(m)||a(N)},{default:r(()=>[i("span",He,_(a(m)?"hourglass_top":"play_arrow"),1)]),_:1},8,["disabled"]),o(l,{type:"button",class:"w-9 h-9 mr-1",severity:"danger",rounded:"",onClick:Z,disabled:a(m)||!a(N)},{default:r(()=>[i("span",qe,_(a(m)?"hourglass_top":"stop"),1)]),_:1},8,["disabled"]),o(l,{type:"button",class:"w-9 h-9",severity:"info",rounded:"",onClick:e[1]||(e[1]=c=>K()),disabled:v.value.length<=0||t.value==null},{default:r(()=>[i("span",Je,_(a(m)?"hourglass_top":"save"),1)]),_:1},8,["disabled"]),o(l,{type:"button",class:"w-9 h-9",severity:"info",rounded:"",onClick:e[2]||(e[2]=c=>a(ze)(a(y),u.value,R())),disabled:a(m)||a(h)},{default:r(()=>[i("span",We,_(a(m)?"hourglass_top":"bug_report"),1)]),_:1},8,["disabled"]),o(l,{type:"button",class:"w-9 h-9",rounded:"",onClick:e[3]||(e[3]=c=>ee()),disabled:a(m)||!u.value||a(h)},{default:r(()=>[i("span",Ge,_(a(m)?"hourglass_top":"restart_alt"),1)]),_:1},8,["disabled"]),o(be)])]),v.value.length>0?(f(),k(q,{key:0,data:v.value,class:"mt-2"},null,8,["data"])):z("",!0),i("div",Ke,[(f(!0),b(B,null,W(u.value,(c,$)=>{var E;return f(),k(se,{toggleable:"",key:c.test.url,class:_e(["border-4",a(Ie)((E=c.result)==null?void 0:E.success)])},{header:r(()=>[i("div",Qe,[o(A,{variant:"on",class:"w-full"},{default:r(()=>[i("label",{for:`name ${$+1}`},"Test "+_($+1),9,Xe),o(S,{id:`name ${$+1}`,onInput:a(M),modelValue:c.test.name,"onUpdate:modelValue":T=>c.test.name=T,class:"w-full",size:"small"},null,8,["id","onInput","modelValue","onUpdate:modelValue"])]),_:2},1024),o(l,{type:"button",class:"w-9 h-9",severity:"info",rounded:"",onClick:T=>a(Fe)(a(y),c,R()),disabled:a(m)||a(h)},{default:r(()=>[i("span",Ye,_(a(m)?"hourglass_top":"bug_report"),1)]),_:2},1032,["onClick","disabled"]),o(l,{type:"button",class:"w-9 h-9",severity:"danger",rounded:"",onClick:T=>Q($)},{default:r(()=>e[5]||(e[5]=[i("span",{class:"material-icons"},_("delete_forever"),-1)])),_:2},1032,["onClick"]),o(l,{type:"button",class:"w-9 h-9",rounded:"",onClick:T=>te(c,$),disabled:a(m)||!u.value||a(h)},{default:r(()=>[i("span",Ze,_(a(m)?"hourglass_top":"restart_alt"),1)]),_:2},1032,["onClick","disabled"]),o(l,{type:"button",class:"w-9 h-9",severity:"warn",rounded:"",onClick:T=>c.result=void 0,disabled:!u.value||a(h)},{default:r(()=>e[6]||(e[6]=[i("span",{class:"material-icons"}," cleaning_services ",-1)])),_:2},1032,["onClick","disabled"])])]),default:r(()=>[o(q,{data:c.data,class:"mt-2"},null,8,["data"]),c.result?(f(),k($e,ve({key:0,ref_for:!0},c.result),null,16)):z("",!0)]),_:2},1032,["class"])}),128))])])}}}),tt={class:"flex bg-surface-0",style:{height:"calc(100vh - 52px)"}},Rt=j({__name:"TesterView",setup(F){return(x,w)=>{const p=ne,g=re;return f(),b(B,null,[o(ie),i("div",tt,[o(g,{class:"w-full rounded-none"},{default:r(()=>[o(p,{size:50,minSize:10,class:"h-full"},{default:r(()=>[o(et)]),_:1}),o(p,{size:50,minSize:10},{default:r(()=>[o(g,{layout:"vertical",class:"h-full w-full"},{default:r(()=>[o(p,{size:65,minSize:10},{default:r(()=>[o(ae)]),_:1}),o(p,{size:35,minSize:10},{default:r(()=>[o(oe)]),_:1})]),_:1})]),_:1}),o(p,{size:50,minSize:10,class:"max-w-[467px] w-full"},{default:r(()=>[o(le)]),_:1})]),_:1})])],64)}}});export{Rt as default};
