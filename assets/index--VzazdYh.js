import{s as pe}from"./index-DGh5M2xR.js";import{a as V,L as de,M as ae,r as h,c as te,o as O,E as M,b as l,e as f,h as $,f as v,w as A,t as K,n as le,m as F,i as S,k as J,F as j,N as ve,g as y,q as H,d as be,u as xe,s as P,O as $e,H as ke,K as B,A as me,l as fe,B as Se,C as Ce,P as se,D as oe,Q as Le}from"./index-CjxHu5YN.js";import{u as _e,_ as Ue}from"./LocaleSelector.vue_vue_type_script_setup_true_lang-CihKRaVT.js";import{L as Ve,d as Be}from"./defaultConfirmDeleteOptions-CWovtvJp.js";import{h as R}from"./http-InqpyRZI.js";import{m as Ie}from"./mapLessonFromDto-Dmd7ExqT.js";import{U as ee}from"./unitApi-D5y6gJDp.js";import{s as De,a as Te,b as Fe,c as ze}from"./index-CjPFk2Gz.js";import{_ as ue,T as Ae}from"./CodeEditorView.vue_vue_type_script_setup_true_lang-k9lkJmS7.js";import{s as Me}from"./index-rF-8cbWS.js";import{s as Re,a as Ee}from"./index-BJSrHmTC.js";import{s as Ne}from"./index-Drmim8DN.js";import{s as ge}from"./index-6NqAq9WG.js";import{v as ye}from"./v4-CmTdKEVZ.js";import{_ as Pe}from"./CodeEditor.vue_vue_type_script_setup_true_lang-60xKMSy6.js";import{C as je}from"./cloudStorageApi-i9JoECZk.js";import{_ as Oe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{s as Ge}from"./index-BLjzxFSN.js";import{s as He}from"./index-CY1dIMf9.js";import{s as he}from"./index-DBXIO6ay.js";import{u as qe}from"./index-t6KTEjln.js";import{s as Je}from"./index-CIt2MiG1.js";import{s as Ke}from"./index-hcdbrQIa.js";import{T as Qe}from"./index-fdmWJyL6.js";import{s as We}from"./index-CCkFeiQ0.js";import"./mapUnitFromDto-CYGc5n9V.js";import"./index-B1rk3iTt.js";import"./index-BTqmaNjr.js";import"./index-Duxymste.js";import"./index-CknO0p2F.js";import"./index-d8-_tEH-.js";import"./index-CJu7FZxJ.js";import"./index-BhngfcSD.js";const z={hideLesson:Ye,modifyLesson:Xe,publishLesson:Ze,sendLessonForReview:et,cancelLessonReview:tt,startLessonReview:st,acceptLesson:ot,rejectLesson:nt,editLesson:lt};async function Ye(u){return await R.patch(`v2/lesson/${u}/hide`)}async function Xe(u){return await R.patch(`v2/lesson/${u}/modify`)}async function Ze(u){return await R.patch(`v2/lesson/${u}/publish`)}async function et(u){return await R.patch(`v2/lesson/${u}/review/send`)}async function tt(u){return await R.patch(`v2/lesson/${u}/review/cancel`)}async function st(u){return await R.patch(`v2/lesson/${u}/review/start`)}async function ot(u){return await R.patch(`v2/lesson/${u}/review/accept`)}async function nt(u){return await R.patch(`v2/lesson/${u}/review/reject`)}async function lt(u){return await R.patch(`v2/lesson/${u}/review/edit`)}const at=["article","options","open","video","code","pibody"],it={class:"flex items-center"},rt={class:"flex items-center mr-2"},dt=V({__name:"HighlightEditor",props:de({index:{},usedSlots:{}},{highlight:{},highlightModifiers:{}}),emits:de(["remove","save"],["update:highlight"]),setup(u,{emit:c}){const a=u,d=ae(u,"highlight"),n=h(""),t=h(null),e=h(null),s=h(!1),p=te(()=>t.value!=null&&e.value!=null),r=c,b=()=>{r("remove",a.index)};O(()=>{d.value&&(n.value=d.value.id,t.value=d.value.module,e.value=d.value.slot,s.value=d.value.autoPut)}),M([t,e,s],()=>{t.value!=null&&r("save",a.index,n.value,t.value,e.value,s.value)}),M(p,x=>{x||(s.value=!1)});const m=h(["A","B","C","D","E","F"]),C=h(["8","9"]),_=h(["LED","switch","push-button","light-sensor","touch-sensor","potentiometer","encoder","motion-detector","microphone","climate-sensor","gyro-accel","buzzer","color-sensor","joystick","distance-sensor","servo","led-tower"]),g=te(()=>{if(t.value){if(t.value==="servo"||t.value==="led-tower"){const I=C.value.filter(E=>!(a.usedSlots??[]).includes(E));return e.value&&!I.includes(e.value)&&I.unshift(e.value),[null,...I]}const i=m.value.filter(k=>!(a.usedSlots??[]).includes(k));return e.value&&!i.includes(e.value)&&i.unshift(e.value),[null,...i]}const o=[...m.value,...C.value].filter(w=>!(a.usedSlots??[]).includes(w));return e.value&&!o.includes(e.value)&&o.unshift(e.value),[null,...o]}),L=te(()=>e.value?e.value==="8"||e.value==="9"?["servo","led-tower"]:_.value.filter(x=>x!=="servo"&&x!=="led-tower"):_.value);return(x,o)=>{const w=ge,i=Ne,k=Re,I=Ee,E=F;return l(),f("div",it,[$("div",rt,[v(w,{modelValue:s.value,"onUpdate:modelValue":o[0]||(o[0]=U=>s.value=U),binary:"","input-id":"autoput",disabled:!p.value},null,8,["modelValue","disabled"]),o[3]||(o[3]=$("label",{for:"autoput",class:"ml-1 text-sm"},"auto",-1))]),v(I,null,{default:A(()=>[v(i,{modelValue:t.value,"onUpdate:modelValue":o[1]||(o[1]=U=>t.value=U),options:L.value,placeholder:"Select module",class:"place-content-center",size:"small"},null,8,["modelValue","options"]),v(k,{class:"h-[35px]"},{default:A(()=>o[4]||(o[4]=[$("div",null,"=>",-1)])),_:1}),v(i,{modelValue:e.value,"onUpdate:modelValue":o[2]||(o[2]=U=>e.value=U),options:g.value,placeholder:"Select slot",size:"small"},{option:A(({option:U})=>[$("span",{class:le(U===null?"text-gray-400":"")},K(U===null?"[null]":U),3)]),value:A(({value:U})=>[$("span",{class:le(U===null?"text-gray-400":"")},K(U===null?"[null]":U),3)]),_:1},8,["modelValue","options"])]),_:1}),v(E,{icon:"pi pi-trash",variant:"text",severity:"danger","aria-label":"Remove",onClick:b,class:"ml-2"})])}}}),ut={class:"flex flex-col gap-2"},ct=V({__name:"HighlightPanel",props:{neededModules:{default:[]},neededModulesModifiers:{}},emits:["update:neededModules"],setup(u){const c=ae(u,"neededModules");function a(){c.value=[...c.value,{autoPut:!1,module:null,slot:null,id:ye()}]}function d(t){c.value.splice(t,1)}function n(t,e,s,p,r){c.value[t].id=e,c.value[t].module=s,c.value[t].slot=p,c.value[t].autoPut=r}return(t,e)=>{const s=F,p=Me;return l(),S(p,{header:"Highlight slots & modules"},{default:A(()=>[$("div",ut,[(l(!0),f(j,null,J(c.value,(r,b)=>(l(),f("div",{key:r.id},[v(dt,{highlight:c.value[b],"onUpdate:highlight":m=>c.value[b]=m,index:b,usedSlots:c.value.filter((m,C)=>{var _;return C!==b&&((_=c.value[C])==null?void 0:_.slot)!=null}).map(m=>m.slot),onRemove:d,onSave:n},null,8,["highlight","onUpdate:highlight","index","usedSlots"])]))),128))]),v(s,{icon:"pi pi-plus",variant:"text","aria-label":"Add",class:"self-center mt-2",onClick:a})]),_:1})}}}),pt={class:"flex"},vt={class:"h-[500px] flex flex-col w-full relative"},mt={class:"flex h-full",style:{border:"0.1px solid #808080",borderTopLeftRadius:"12px",borderTopRightRadius:"12px",overflow:"hidden"}},ft={class:"absolute right-2 bottom-2"},ce=!1,_t=V({__name:"PibodyEditor",props:{id:{},content:{},data:{}},emits:["save-content","show-tester"],setup(u,{emit:c}){const a=H(),d=u,n=c,t=h(""),e=h(""),s=h([]);let p=!0;ve(()=>{t.value=d.content.starting,e.value=d.content.answer,s.value=d.data.neededModules}),M([t,e,s],()=>{if(p){p=!1;return}n("save-content",{starting:t.value,answer:e.value},{neededModules:s.value.filter(b=>b.module!=null),tests:d.data.tests,includedCommandsForTests:d.data.includedCommandsForTests})},{deep:!0});function r(){n("show-tester",{lesson_id:a.params.id,unit_id:d.id.split("-")[1]})}return(b,m)=>{const C=F;return l(),f(j,null,[$("div",pt,[$("div",vt,[$("div",mt,[v(ue,{code:t.value,"onUpdate:code":m[0]||(m[0]=_=>t.value=_),runbuttons:!1,id:d.id+"_",class:"flex-1"},null,8,["code","id"]),v(ue,{code:e.value,"onUpdate:code":m[1]||(m[1]=_=>e.value=_),connectbuttons:ce,"onUpdate:connectbuttons":m[2]||(m[2]=_=>ce=_),id:d.id,class:"flex-1"},null,8,["code","id"])]),$("div",ft,[v(C,{label:"Tests",icon:"pi pi-pen-to-square",class:"w-fit",severity:"info",onClick:r})]),v(y(Ae),{id:d.id,class:"flex-grow max-h-40"},null,8,["id"])])]),v(ct,{neededModules:s.value,"onUpdate:neededModules":m[3]||(m[3]=_=>s.value=_),class:"mb-2"},null,8,["neededModules"])],64)}}}),G=be("lesson-edit-store",()=>{const u=xe(),c=_e(),{lang:a}=P(c),d=h(null),n=h(!1),t=h(!1),e=h(!1),s=h(!1),p=h(!1),r=h(!1);function b(x){e.value=x}async function m(x){try{n.value=!0;const{data:o}=await Ve.getLessonById(x,void 0,a.value);d.value=Ie(o)}catch(o){u.add({severity:"error",summary:o.response.data.error,life:2e3})}finally{n.value=!1}}async function C(x,o){try{t.value=!0;const{data:w}=await ee.getUnitByIdandLessonId(x,o,a.value);return w}catch(w){u.add({severity:"error",summary:w.response.data.error,life:2e3})}finally{t.value=!1}}async function _(x){try{s.value=!0;const{data:o}=await ee.createUnitByLessonId(d.value.id,x);u.add({severity:"success",summary:o.message,life:2e3})}catch(o){u.add({severity:"error",summary:o.response.data.error,life:2e3})}finally{s.value=!1}}async function g(x,o,w){try{p.value=!0;const{data:i}=await ee.updateUnitByIdandLessonId(x,o,w,a.value);return i.unit_id}catch(i){u.add({severity:"error",summary:i.response.data.error,life:2e3})}finally{p.value=!1}}async function L(x,o){try{r.value=!0;const{data:w}=await ee.deleteUnitByIdandLessonId(x,o);u.add({severity:"success",summary:w.message,life:2e3})}catch(w){u.add({severity:"error",summary:w.response.data.error,life:2e3})}finally{r.value=!1}}return{selectedLesson:d,isLessonLoading:n,isLessonSaving:e,isUnitLoading:t,isUnitCreating:s,isUnitUpdating:p,isUnitDeleting:r,setLessonSaving:b,loadLessonById:m,loadUnitByIdandLessonId:C,createUnit:_,updateUnitByIdandLessonId:g,deleteUnitByIdandLessonId:L}}),gt={class:"flex items-start"},yt=V({__name:"MdEditor",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(u){const c=ae(u,"modelValue"),a=$e({title:{title:"Title",icon:"v-md-icon-tip",action(n){n.insert(t=>{const e="# <center>",s="</center>",r=t||"Title";return{text:`${e}${r}${s}`,selected:r}})}},icons:{title:"icons",icon:"v-md-icon-tip",menus:[{name:"Attention",text:"Attention",action(n){n.insert(()=>{const t='<span style="font-size: 20px">',e="</span>",s="⚠️";return{text:`${t}${s}${e}`,selected:s}})}},{name:"PiBody",text:"PiBody",action(n){n.insert(()=>{const t="<b>",e="</b>",s='<span style="color: #FF3F85"> Pi</span>Body';return{text:`${t}${s}${e}`,selected:s}})}},{name:"Run",text:"Run",action(n){n.insert(()=>({text:"▶️<b>Run</b>"}))}}]},style:{title:"Style",icon:"v-md-icon-tip",action(n){n.insert(t=>{const e='<span style="">',s="</span>",r=t||"placeholder";return{text:`${e}${r}${s}`,selected:r}})}},underline:{title:"Underline",icon:"v-md-icon-under-line",action(n){n.insert(t=>{const e='<span style="text-decoration: underline">',s="</span>",r=t||"placeholder";return{text:`${e}${r}${s}`,selected:r}})}},tip:{title:"Tip",icon:"v-md-icon-tip",action(n){n.insert(t=>{const e='<div style="background-color:#F3F5F7; padding: 20px; border-left: solid 8px #42B983">',s="</div>",r=t||"placeholder";return{text:`${e}${r}${s}`,selected:r}})}},note:{title:"Note",icon:"v-md-icon-tip",action(n){n.insert(t=>{const e='<div style="background-color:#F3F5F7; padding: 15px; border-left: solid 8px #FFCD6B; margin-bottom: 15px">',s="</div>",r=t||"placeholder";return{text:`${e}${r}${s}`,selected:r}})}}});async function d(n,t,e){const s=e[0],p=new FormData;p.append("file",s);try{const{data:r}=await je.uploadFile(p,"image_"),b=r.source_url;t({url:b,desc:"desc",width:"auto",height:"auto"})}catch(r){console.log(r)}}return(n,t)=>{const e=ke("v-md-editor");return l(),f("div",gt,[v(e,{modelValue:c.value,"onUpdate:modelValue":t[0]||(t[0]=s=>c.value=s),mode:"edit","left-toolbar":"undo redo clear | tip emoji todo-list | h bold italic strikethrough quote ul ol table hr link code image | title icons style underline tip note","right-toolbar":"",toolbar:a,"disabled-menus":[],onUploadImage:d},null,8,["modelValue","toolbar"])])}}}),we=Oe(yt,[["__scopeId","data-v-15a3904e"]]),ht=V({__name:"ArticleEditor",props:{article:{}},emits:["save-content"],setup(u,{emit:c}){const a=u,d=c,n=h("");let t=!0;return O(()=>{var e;n.value=((e=a.article)==null?void 0:e.text)??""}),M(n,()=>{if(t){t=!1;return}d("save-content",{text:n.value})},{flush:"post"}),(e,s)=>(l(),S(we,{modelValue:n.value,"onUpdate:modelValue":s[0]||(s[0]=p=>n.value=p)},null,8,["modelValue"]))}}),wt={class:"flex flex-col gap-2"},bt={class:"flex gap-1 text-gray-500"},xt={class:"flex flex-col gap-1"},$t=V({__name:"OptionsEditor",props:{optionsData:{}},emits:["save-content"],setup(u,{emit:c}){const a=u,d=c,n=h(!1),t=h(!1),e=h(!1),s=h([]),p=h([]),r=h();let b=!0;O(()=>{var _,g,L,x,o,w;n.value=((_=a.optionsData)==null?void 0:_.shuffle)??!1,t.value=((g=a.optionsData)==null?void 0:g.feedback)??!1,e.value=((L=a.optionsData)==null?void 0:L.single)??!1,s.value=((x=a.optionsData)==null?void 0:x.options)??[],p.value=((o=a.optionsData)==null?void 0:o.answer)??[],r.value=a.optionsData&&a.optionsData.answer&&a.optionsData.answer.length>0?(w=a.optionsData)==null?void 0:w.answer[0]:void 0}),M([n,t,e,s,p,r],()=>{if(b){b=!1;return}d("save-content",{shuffle:n.value,feedback:t.value,single:e.value,options:s.value,answer:e.value?r.value?[r.value]:[]:p.value})},{deep:!0});function m(){s.value.push({id:ye(),text:""})}function C(_){s.value=s.value.filter(g=>g.id!==_),p.value=p.value.filter(g=>g!==_),r.value==_&&(r.value=void 0)}return(_,g)=>{const L=He,x=Ge,o=ge,w=F;return l(),f("div",wt,[$("div",bt,[g[5]||(g[5]=$("div",null,"shuffle:",-1)),v(L,{modelValue:n.value,"onUpdate:modelValue":g[0]||(g[0]=i=>n.value=i),class:"mr-2"},null,8,["modelValue"]),g[6]||(g[6]=$("div",null,"feedback:",-1)),v(L,{modelValue:t.value,"onUpdate:modelValue":g[1]||(g[1]=i=>t.value=i),class:"mr-2"},null,8,["modelValue"]),g[7]||(g[7]=$("div",null,"single:",-1)),v(L,{modelValue:e.value,"onUpdate:modelValue":g[2]||(g[2]=i=>e.value=i)},null,8,["modelValue"])]),$("div",xt,[(l(!0),f(j,null,J(s.value,i=>(l(),f("div",{key:i.id,class:"flex gap-2 items-center"},[e.value?(l(),S(x,{key:0,modelValue:r.value,"onUpdate:modelValue":g[3]||(g[3]=k=>r.value=k),value:i.id},null,8,["modelValue","value"])):(l(),S(o,{key:1,modelValue:p.value,"onUpdate:modelValue":g[4]||(g[4]=k=>p.value=k),value:i.id},null,8,["modelValue","value"])),v(we,{modelValue:i.text,"onUpdate:modelValue":k=>i.text=k,class:"w-full"},null,8,["modelValue","onUpdate:modelValue"]),v(w,{icon:"pi pi-trash",variant:"text",severity:"danger",size:"small",onClick:k=>C(i.id)},null,8,["onClick"])]))),128))]),v(w,{icon:"pi pi-plus",label:"Add option",variant:"text",size:"small",onClick:m,class:"self-center"})])}}}),kt=V({__name:"OpenEditor",props:{open:{}},emits:["save-content"],setup(u,{emit:c}){const a=u,d=c,n=h("");let t=!0;return O(()=>{var e;n.value=((e=a.open)==null?void 0:e.answer)??""}),M(n,()=>{if(t){t=!1;return}d("save-content",{answer:n.value})}),(e,s)=>{const p=he;return l(),S(p,{type:"text",modelValue:n.value,"onUpdate:modelValue":s[0]||(s[0]=r=>n.value=r),class:"w-full",size:"small"},null,8,["modelValue"])}}}),St=V({__name:"VideoEditor",props:{video:{}},emits:["save-content"],setup(u,{emit:c}){const a=u,d=c,n=h("");let t=!0;return O(()=>{var e;n.value=((e=a.video)==null?void 0:e.url)??""}),M(n,()=>{if(t){t=!1;return}d("save-content",{url:n.value})}),(e,s)=>{const p=he;return l(),S(p,{type:"text",modelValue:n.value,"onUpdate:modelValue":s[0]||(s[0]=r=>n.value=r),class:"w-full",size:"small"},null,8,["modelValue"])}}}),Ct={class:"bg-white rounded-lg border border-gray-200"},Lt={key:1,class:"flex flex-col h-full w-full"},Ut={class:"flex items-center gap-2 px-4 pt-2"},Vt={class:"text-sm"},Bt={class:"text-sm text-gray-500"},It={key:1,class:"flex-grow px-4 py-2"},Dt={class:"flex justify-end"},Tt=V({__name:"UnitCard",props:{unit:{},loading:{type:Boolean}},emits:["delete","update"],setup(u,{emit:c}){const a=u,d=c,n=H(),t=fe(),e=G(),{updateUnitByIdandLessonId:s,setLessonSaving:p,loadUnitByIdandLessonId:r}=e,b=h(!1),m=h(null),C=h(null);ve(async()=>{b.value=!0;const o=await r(a.unit.id,Number(n.params.id));o&&(m.value=o.content,C.value=o.data),b.value=!1});function _(o,w){p(!0),L(o,w)}function g(o){t.push({name:"tester2",params:{lesson_id:o.lesson_id,unit_id:o.unit_id}})}const L=qe((o,w)=>{x(o,w)},1e3,{maxWait:5e3});async function x(o,w){const i=await s(a.unit.id,Number(n.params.id),{content:o,data:w});i&&d("update",a.unit,i),p(!1)}return(o,w)=>{const i=pe,k=F;return l(),f("div",Ct,[o.loading?(l(),S(i,{key:0,class:"flex justify-center items-center w-10 h-full"})):(l(),f("div",Lt,[$("div",Ut,[$("div",Vt,K(o.unit.id),1),$("div",Bt,K(`${o.unit.unitType}`),1)]),b.value?(l(),S(i,{key:0,class:"flex justify-center items-center w-10 h-full"})):(l(),f("div",It,[o.unit.unitType=="article"?(l(),S(ht,{key:0,article:m.value,onSaveContent:_},null,8,["article"])):o.unit.unitType=="options"?(l(),S($t,{key:1,"options-data":m.value,onSaveContent:_},null,8,["options-data"])):o.unit.unitType=="open"?(l(),S(kt,{key:2,open:m.value,onSaveContent:_},null,8,["open"])):o.unit.unitType=="video"?(l(),S(St,{key:3,video:m.value,onSaveContent:_},null,8,["video"])):a.unit.unitType=="code"?(l(),S(y(Pe),{key:4,id:`code-${a.unit.id}`,code:m.value,onSaveContent:_,onShowTester:g},null,8,["id","code"])):a.unit.unitType=="pibody"?(l(),S(y(_t),{key:5,id:`code-${a.unit.id}`,content:m.value,data:C.value,onSaveContent:_,onShowTester:g},null,8,["id","content","data"])):B("",!0)])),$("div",Dt,[v(k,{icon:"pi pi-trash",size:"small",severity:"danger",variant:"text",onClick:w[0]||(w[0]=me(I=>d("delete",a.unit),["stop"]))})])]))])}}}),Ft={class:"group w-full relative"},zt={class:"flex"},ne=V({__name:"AddUnitButton",props:{unitId:{},showAddGroup:{type:Boolean},hided:{type:Boolean}},emits:["add-group-divider"],setup(u,{emit:c}){const a=u,d=c,n=H(),t=G(),{loadLessonById:e,createUnit:s}=t,p=h(),r=h(at.map(m=>({label:m,command:async()=>{await s({unit_type:m,prev_unit_id:a.unitId??void 0}),await e(Number(n.params.id))}}))),b=m=>{p.value.toggle(m)};return(m,C)=>{const _=Ke,g=F,L=Je;return l(),f(j,null,[$("div",Ft,[C[1]||(C[1]=$("div",{class:"h-3"},null,-1)),$("div",{class:le(["absolute left-1/2 -translate-x-1/2 -top-5 group-hover:block mt-[9px] w-full",m.hided?"hidden":""])},[$("div",zt,[v(_,{class:"w-7",type:"dashed"}),v(_,{class:"flex-grow",type:"dashed"}),v(g,{icon:"pi pi-plus",class:"flex self-end shadow-xl h-7",size:"small",onClick:b}),v(_,{class:"flex-grow",type:"dashed"}),m.showAddGroup?(l(),S(g,{key:0,icon:"pi pi-arrow-up-right-and-arrow-down-left-from-center",class:"flex self-end h-7",size:"small",variant:"text",onClick:C[0]||(C[0]=x=>d("add-group-divider"))})):(l(),S(_,{key:1,class:"w-7",type:"dashed"}))])],2)]),v(L,{ref_key:"menu",ref:p,model:r.value,popup:!0},null,8,["model"])],64)}}}),At=V({__name:"RemoveGroupButton",emits:["remove-group-divider"],setup(u,{emit:c}){const a=c;return(d,n)=>{const t=F;return l(),S(t,{icon:"pi pi-arrow-down-left-and-arrow-up-right-to-center",severity:"danger",class:"flex self-end h-7 w-7",size:"small",variant:"text",onClick:n[0]||(n[0]=me(e=>a("remove-group-divider"),["stop"]))})}}}),Mt={class:"flex flex-col gap-2"},Rt={class:"w-full flex justify-between gap-2 mr-4"},Et={class:"flex flex-col p-2 rounded-lg bg-slate-50"},Nt=V({__name:"UnitsView",props:{pages:{}},setup(u){const c=u,a=H(),d=Se(),n=G(),{isUnitDeleting:t}=P(n),{loadLessonById:e,createUnit:s,deleteUnitByIdandLessonId:p}=n,r=h(null);async function b(i){await s({unit_type:"group-divider",prev_unit_id:i.id}),await e(Number(a.params.id))}async function m(){await s({unit_type:"page-divider"}),await e(Number(a.params.id))}async function C(i){await p(i,Number(a.params.id)),await e(Number(a.params.id))}function _(i){r.value=i,d.require({...Be,message:"Are you sure you want to delete this lesson?",accept:async()=>{await p(i.id,Number(a.params.id)),await e(Number(a.params.id))}})}function g(i,k){k>i.id&&(i.id=k)}const L=Number(a.params.id),x=`openedPanels-${L}`,o=h({});O(async()=>{const i=localStorage.getItem(x);i&&(o.value=JSON.parse(i)),await Ce(),setTimeout(()=>{const k=localStorage.getItem(`lastOpenedGroup-${L}`);if(k){const I=document.getElementById(`group-${k}`);if(I){I.scrollIntoView({behavior:"smooth"});return}}},1e3)}),M(o,i=>{localStorage.setItem(x,JSON.stringify(i))},{deep:!0});function w(i,k){o.value[k]=i,o.value[k].length>0&&localStorage.setItem(`lastOpenedGroup-${L}`,i[i.length-1])}return(i,k)=>{const I=De,E=Te,U=Fe,Q=ze,W=F;return l(),f("div",Mt,[(l(!0),f(j,null,J(c.pages,N=>(l(),S(Q,{value:o.value[N.id]||[],"onUpdate:value":D=>w(D,N.id),multiple:"",key:N.id,class:"flex flex-col gap-2 bg-white p-4 rounded-lg shadow-lg"},{default:A(()=>[(l(!0),f(j,null,J(N.groups,(D,Y)=>(l(),S(U,{key:D.id,value:D.id,id:`group-${D.id}`},{default:A(()=>[v(I,null,{default:A(()=>[$("div",Rt,[$("div",null,"Step: "+K(Y),1),D.id!=-1?(l(),S(At,{key:0,onRemoveGroupDivider:T=>C(D.id)},null,8,["onRemoveGroupDivider"])):B("",!0)])]),_:2},1024),v(E,{class:"flex flex-col"},{default:A(()=>[$("div",Et,[(l(!0),f(j,null,J(D.units,(T,X)=>{var q;return l(),f("div",{key:T.id},[X==0?(l(),S(ne,{key:0,hided:!0,"unit-id":D.id,"show-add-group":!1},null,8,["unit-id"])):B("",!0),v(Tt,{unit:T,loading:((q=r.value)==null?void 0:q.id)===T.id&&y(t),onDelete:Z=>_(T),onUpdate:g},null,8,["unit","loading","onDelete"]),v(ne,{hided:!0,"unit-id":T.id,"show-add-group":!0,onAddGroupDivider:Z=>b(T)},null,8,["unit-id","onAddGroupDivider"])])}),128)),D.units.length==0?(l(),S(ne,{key:0,hided:!1,"unit-id":D.id,"show-add-group":!1},null,8,["unit-id"])):B("",!0)])]),_:2},1024)]),_:2},1032,["value","id"]))),128))]),_:2},1032,["value","onUpdate:value"]))),128)),v(W,{id:"newpage",icon:"pi pi-plus",label:"New page",variant:"text",size:"small",class:"flex self-center",onClick:k[0]||(k[0]=N=>m())})])}}}),Pt={class:"w-[24px] h-[24px]"},jt={key:0,class:"flex items-center"},Ot={key:0,class:"material-icons text-gray-500"},Gt={key:1,class:"material-icons text-gray-500"},Ht={key:1},qt={class:"material-icons text-gray-500"},Jt=V({__name:"AutoSaveCloud",setup(u){const c=G(),{selectedLesson:a,isLessonSaving:d}=P(c);return(n,t)=>{var s;const e=Qe;return l(),f("div",Pt,[(s=y(a))!=null&&s.editable?(l(),f("div",jt,[y(d)?se((l(),f("span",Gt,t[1]||(t[1]=[oe("cloud_sync")]))),[[e,"Saving...",void 0,{bottom:!0}]]):se((l(),f("span",Ot,t[0]||(t[0]=[oe("cloud_done")]))),[[e,"Saved",void 0,{bottom:!0}]])])):(l(),f("div",Ht,[se((l(),f("span",qt,t[2]||(t[2]=[oe("cloud_off")]))),[[e,"Save not allowed",void 0,{bottom:!0}]])]))])}}}),Kt={key:0},Qt={key:0},Wt={key:1},Yt={key:0},Xt={key:1},Zt={key:2},es={key:0,class:"flex gap-1"},ts={key:3},ss={key:0},os={key:4},ns={key:0,class:"flex gap-1"},ls={key:5},as={key:0,class:"flex gap-1"},is={key:6},rs={key:0,class:"flex gap-1"},ds=V({__name:"StageButtons",setup(u){const c=H(),a=Le(),{user:d}=P(a),n=G(),{selectedLesson:t}=P(n),e=h(!1),s=h(!1);async function p(){e.value=!0;try{await z.sendLessonForReview(c.params.id.toString()),window.location.reload()}catch(o){console.log(o)}finally{e.value=!1}}async function r(){e.value=!0;try{await z.cancelLessonReview(c.params.id.toString()),window.location.reload()}catch(o){console.log(o)}finally{e.value=!1}}async function b(){e.value=!0;try{await z.startLessonReview(c.params.id.toString()),window.location.reload()}catch(o){console.log(o)}finally{e.value=!1}}async function m(){e.value=!0;try{await z.acceptLesson(c.params.id.toString()),window.location.reload()}catch(o){console.log(o)}finally{e.value=!1}}async function C(){s.value=!0;try{await z.rejectLesson(c.params.id.toString()),window.location.reload()}catch(o){console.log(o)}finally{s.value=!1}}async function _(){e.value=!0;try{await z.editLesson(c.params.id.toString()),window.location.reload()}catch(o){console.log(o)}finally{e.value=!1}}async function g(){e.value=!0;try{await z.publishLesson(c.params.id.toString()),window.location.reload()}catch(o){console.log(o)}finally{e.value=!1}}async function L(){s.value=!0;try{await z.hideLesson(c.params.id.toString()),window.location.reload()}catch(o){console.log(o)}finally{s.value=!1}}async function x(){e.value=!0;try{await z.modifyLesson(c.params.id.toString()),window.location.reload()}catch(o){console.log(o)}finally{e.value=!1}}return(o,w)=>{var k,I,E,U,Q,W,N,D,Y,T,X,q,Z,ie,re;const i=F;return((k=y(t))==null?void 0:k.stage)=="prepare_for_submission"?(l(),f("div",Kt,[((I=y(d))==null?void 0:I.user_type)=="contributor"?(l(),f("div",Qt,[v(i,{label:"Send for review",severity:"info",size:"small",onClick:p,disabled:e.value,loading:e.value},null,8,["disabled","loading"])])):B("",!0)])):((E=y(t))==null?void 0:E.stage)=="waiting_for_review"?(l(),f("div",Wt,[((U=y(d))==null?void 0:U.user_type)=="contributor"?(l(),f("div",Yt,[v(i,{label:"Cancel submission",severity:"danger",size:"small",onClick:r,disabled:e.value,loading:e.value},null,8,["disabled","loading"])])):((Q=y(d))==null?void 0:Q.user_type)=="editor"?(l(),f("div",Xt,[v(i,{label:"Start review",severity:"info",size:"small",onClick:b,disabled:e.value,loading:e.value},null,8,["disabled","loading"])])):B("",!0)])):((W=y(t))==null?void 0:W.stage)=="in_review"?(l(),f("div",Zt,[((N=y(d))==null?void 0:N.user_type)=="editor"?(l(),f("div",es,[v(i,{label:"Reject",severity:"danger",size:"small",onClick:C,disabled:e.value||s.value,loading:s.value},null,8,["disabled","loading"]),v(i,{label:"Accept",size:"small",onClick:m,disabled:e.value||s.value,loading:e.value},null,8,["disabled","loading"])])):B("",!0)])):((D=y(t))==null?void 0:D.stage)=="rejected"?(l(),f("div",ts,[((Y=y(d))==null?void 0:Y.user_type)=="contributor"?(l(),f("div",ss,[v(i,{label:"Edit submission",severity:"info",size:"small",onClick:_,disabled:e.value,loading:e.value},null,8,["disabled","loading"])])):B("",!0)])):((T=y(t))==null?void 0:T.stage)=="ready_for_publish"?(l(),f("div",os,[((X=y(d))==null?void 0:X.user_type)=="editor"?(l(),f("div",ns,[y(t).createdBy!=Number(y(d).user_id)?(l(),S(i,{key:0,label:"Reject",severity:"danger",size:"small",onClick:C,disabled:e.value||s.value,loading:s.value},null,8,["disabled","loading"])):B("",!0),v(i,{label:"Publish",size:"small",onClick:g,disabled:e.value||s.value,loading:e.value},null,8,["disabled","loading"])])):B("",!0)])):((q=y(t))==null?void 0:q.stage)=="published"?(l(),f("div",ls,[((Z=y(d))==null?void 0:Z.user_type)=="editor"?(l(),f("div",as,[v(i,{label:"Hide",severity:"danger",size:"small",onClick:L,disabled:e.value||s.value,loading:s.value},null,8,["disabled","loading"]),v(i,{label:"Modify",size:"small",onClick:x,disabled:e.value||s.value,loading:e.value},null,8,["disabled","loading"])])):B("",!0)])):((ie=y(t))==null?void 0:ie.stage)=="in_modify"?(l(),f("div",is,[((re=y(d))==null?void 0:re.user_type)=="editor"?(l(),f("div",rs,[v(i,{label:"Hide",severity:"danger",size:"small",onClick:L,disabled:e.value||s.value,loading:s.value},null,8,["disabled","loading"]),v(i,{label:"Publish",size:"small",onClick:g,disabled:e.value||s.value,loading:e.value},null,8,["disabled","loading"])])):B("",!0)])):B("",!0)}}}),us={key:0},cs=V({__name:"StageStatus",setup(u){const c=G(),{selectedLesson:a}=P(c);return(d,n)=>{const t=We;return y(a)?(l(),f("div",us,[["prepare_for_submission","waiting_for_review","in_review","in_modify"].includes(y(a).stage)?(l(),S(t,{key:0,label:y(a).stage.replace(/_/g," ").replace(/^./,e=>e.toUpperCase()),icon:"pi pi-clock",pt:{icon:{class:"text-yellow-500"}},class:"h-8 bg-yellow-50 w-fit"},null,8,["label"])):["ready_for_publish","published"].includes(y(a).stage)?(l(),S(t,{key:1,label:y(a).stage.replace(/_/g," ").replace(/^./,e=>e.toUpperCase()),icon:"pi pi-check-circle",pt:{icon:{class:"text-green-500"}},class:"h-8 bg-green-50 w-fit"},null,8,["label"])):["rejected"].includes(y(a).stage)?(l(),S(t,{key:2,label:y(a).stage.replace(/_/g," ").replace(/^./,e=>e.toUpperCase()),icon:"pi pi-times-circle",pt:{icon:{class:"text-red-500"}},class:"h-8 bg-red-50 w-fit"},null,8,["label"])):B("",!0)])):B("",!0)}}}),ps={class:"flex flex-col items-center"},vs={class:"flex justify-between items-center w-full min-h-16 border-b border-gray-200 px-8 shadow-md gap-8"},ms={class:"flex items-center gap-4"},fs={class:"flex items-center gap-4"},_s={class:"w-full h-full max-w-screen-lg px-4 md:px-28 py-8"},gs={key:1,class:"flex justify-center"},ys={key:2},hs={class:"fixed top-32 right-0 pl-2 pr-4 py-2 bg-white rounded-tl-lg rounded-bl-lg shadow-md z-50 border border-gray-200 flex flex-col items-center gap-4"},Zs=V({__name:"LessonEditPage",setup(u){const c=H(),a=fe(),d=_e(),{lang:n}=P(d),t=G(),{isLessonLoading:e,selectedLesson:s}=P(t),{loadLessonById:p}=t;return O(()=>p(Number(c.params.id))),M(n,async(r,b)=>{r!==b&&s.value&&await p(s.value.id)}),(r,b)=>{const m=F,C=pe;return l(),f("div",ps,[$("div",vs,[$("div",ms,[v(m,{icon:"pi pi-times",variant:"text",severity:"contrast",onClick:b[0]||(b[0]=_=>y(a).go(-1))}),v(cs)]),$("div",fs,[v(ds)])]),$("div",_s,[y(e)?(l(),S(C,{key:0,class:"flex justify-center"})):y(s)?(l(),f("div",ys,[v(Nt,{pages:y(s).pages},null,8,["pages"])])):(l(),f("div",gs,"No lesson found"))]),$("div",hs,[v(Jt),v(y(Ue))])])}}});export{Zs as default};
