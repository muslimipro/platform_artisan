import{a as pe}from"./index-mggB5j7X.js";import{as as de,n as fe,p as me,u as ve,C as Q,r as h,I as A,d as $,o as i,c as p,F as w,i as I,f as j,e as _,h as _e,v as G,t as b,b as x,w as ge,g as ye,ar as he,ap as xe,H as D,m as be}from"./index-Bys-p59Q.js";import{s as we}from"./index-DG8TrzZm.js";import{_ as Se}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{s as $e}from"./index-DWmrnhHm.js";import{a as ke,s as Ce}from"./index-CDWLL-rM.js";import{s as Ve}from"./logo-C48NNFvR.js";import{u as Ae,a as Ie,b as Pe}from"./store-CTqebQSA.js";import{h as P}from"./index-CqQi59sS.js";const Be={submitStep:Re,getStudentProjectStepsByID:Me,getStudentStepTranslationByID:Ee,resetStepsProgress:je,saveStudentStepStateByID:Le};async function Me(s){try{return await P.get(`/student/project/${s}/steps`)}catch(n){throw console.log(n),n}}async function Ee(s,n){try{return await P.get(`/student/step/${s}/language/${n}`)}catch(r){throw console.log(r),r}}async function Le(s,n,r){try{return await P.put(`/student/step/${s.id}/language/${n}/save`,r)}catch(e){throw console.log(e),e}}async function Re(s,n,r){try{return await P.put(`/student/step/${s}/language/${n}`,{student_answer:r})}catch(e){throw console.log(e),e}}async function je(s){try{return await P.delete(`/project/${s}/reset`)}catch(n){throw console.log(n),n}}async function Ue(s,n){const{data:r}=await Be.getStudentStepTranslationByID(s.id.toString(),n),e=r;return{id:s.id.toString(),title:e.name,type:s.step_type,progress:s.status,inner:e.content,answer:e.user_answer,state:e.step_state,access_type:s.access_type,accessibility:s.accessibility,skip_submit:s.skip_submit}}const Ne=de("useLessonStore",()=>{const s=fe(),{locale:n}=me(),r=ve(),e=Ae(),{newModuleToSlot:d,clearSlots:a,reset:v}=e,{slots:l,helpArrows:m,moduleComponents:S,isConnected:k,isLoading:M}=Q(e),g=Ie(),{fileContent:C}=Q(g),{setCode:V}=g,J=Pe(),{setStdout:X,clear:z}=J,u=h(null),f=h(null),U=h(!1),N=h(!0),E=h(!0),Y=A(()=>N.value&&E.value),W=h(!1),q=h(!1),Z=A(()=>C.value);let L=0;function O(t){t!=null&&(u.value=t)}function ee(t){u.value!=null&&(u.value.steps=t,f.value!=null&&F(f.value))}function te(t){f.value=t}function se(t){u.value==null||f.value==null||(u.value.steps[f.value].progress=t)}function ne(t){u.value==null||f.value==null||f.value+1!=u.value.steps.length&&(u.value.steps[f.value+1].accessibility=t)}function oe(t,c){u.value==null||f.value==null||u.value.steps[f.value].inner.options!=null&&(u.value.steps[f.value].inner.options[c].correct=t)}async function F(t){var H,K;if(u.value==null)return;f.value=t;const c=u.value.steps[f.value];if(c.title==""){U.value=!0;const y=await Ue({id:c.id,status:c.progress,step_type:c.type,skip_submit:c.skip_submit,access_type:c.access_type,accessibility:c.accessibility},n.value);u.value.steps[t]=y,U.value=!1}const o=u.value.steps[f.value];if(v(),a(),T(),V(""),z(),q.value=!(((H=o.inner.platformActions)==null?void 0:H.includes("hide-ide"))??!1),W.value=!(((K=o.inner.platformActions)==null?void 0:K.includes("hide-sim"))??!1),o.progress=="nothing"||s.name=="module"){if(o.inner.platformActions!=null&&o.inner.platformActions!=null&&o.inner.platformActions.length>0)for(const y of o.inner.platformActions){if(y=="code2ide"&&V(o.inner.starting??""),y=="auto-put"&&o.inner.highlights!=null)for(const R of o.inner.highlights)L++,d(R.module,R.slot);y=="auto-run"&&k.value&&!M.value&&(e.run(),r.add({severity:"success",summary:"Run is completed!",detail:"Code has successfully auto run",life:3e3}))}if(o.inner.userActions!=null&&o.inner.userActions!=null&&o.inner.userActions.length>0)for(const y of o.inner.userActions)y=="put-module"&&(N.value=!1,a()),y=="run-code"&&(E.value=!1)}else{if(o.state==null||o.state==null)return;if(o.state.code!=null&&o.state.code!=null&&V(o.state.code),o.state.stdout!=null&&o.state.stdout!=null&&X(o.state.stdout),o.state.slots!=null&&o.state.slots!=null)for(const[y,R]of o.state.slots.entries()){const ce=String.fromCharCode(65+y);d(R,ce)}}}function le(t){u.value==null||f.value==null||(u.value.steps[f.value].state={code:t.code,stdout:t.stdout,slots:t.slots})}function re(){if(u.value==null||f.value==null)return;const t=u.value.steps[f.value];if(v(),a(),T(),V(""),z(),u.value.steps[f.value].state={code:"",stdout:"",slots:[]},t.inner.platformActions!=null&&t.inner.platformActions!=null&&t.inner.platformActions.length>0)for(const c of t.inner.platformActions){if(c=="code2ide"&&V(t.inner.starting??""),c=="auto-put"&&t.inner.highlights!=null)for(const o of t.inner.highlights)L++,d(o.module,o.slot);c=="auto-run"&&k.value&&!M.value&&(e.run(),r.add({severity:"success",summary:"Run is completed!",detail:"Code has successfully auto run",life:3e3}))}}function ie(t,c){if(t==="8"||t==="9")m.value[t].style={color:"rgba(0, 157, 255)"},m.value[t].visible=!0;else{const o=(t??"A").charCodeAt(0)-65;l.value[o].style={backgroundColor:"rgba(0, 157, 255, 0.26)",boxShadow:"0 0 15px rgb(0, 157, 255)"}}S.value.forEach(o=>{if(o.type==c){o.style={animation:"breathing 1s ease-out infinite normal",boxShadow:"0 0 15px rgb(0, 157, 255)",borderRadius:"10px"};return}})}function T(){for(let t=0;t<=5;t++)l.value[t].class="",l.value[t].style={};for(const t of S.value)t.class="",t.style={};for(const t in m.value){const c=m.value[t];c.visible=!1,c.style={},c.class=""}}function ae(){E.value=!0}function ue(t,c){L<=0?t===c?r.add({severity:"success",summary:"Correct, good job!",detail:"Module has been put successfully",life:3e3}):r.add({severity:"error",summary:"Wrong!",detail:"Keep trying",life:3e3}):L--}return{lesson:u,stepIndex:f,stepLoading:U,userCode:Z,submitEnabled:Y,modulesWerePut:N,codeWasRun:E,simVisible:W,ideVisible:q,setLesson:O,setSteps:ee,setStepIndex:te,updateStatus:se,updateAccess:ne,changeStep:F,runCodePressed:ae,saveOption:oe,lightUp:ie,clearSlotsModulesClasses:T,toastModulePut:ue,saveStepStateLocally:le,restartStep:re}});async function _t(s,n,r){const{data:e}=await pe.getStepTranslationByID(s.id.toString(),n),d=e;return{id:s.id.toString(),title:d.name,type:s.step_type,progress:"nothing",inner:r||d.content.contents==null?{contents:[],modules:[]}:d.content,access_type:s.access_type,skip_submit:s.skip_submit}}const Te={class:"flex flex-col gap-2"},ze={key:1},We={key:0,style:{position:"relative",width:"100%",height:"0","padding-bottom":"56.25%"}},qe=["src"],Fe={key:1,style:{position:"relative","margin-left":"5%",width:"90%",height:"0","padding-bottom":"160%"}},He=["src"],B=$({__name:"ContentsView",props:{contents:{}},setup(s){const n=s;function r(e){return e.replace("shorts","embed")}return(e,d)=>{const a=G("v-md-preview"),v=Ve;return i(),p("div",Te,[(i(!0),p(w,null,I(n.contents,l=>{var m;return i(),p("div",{key:l.id},[l.type=="text"?(i(),j(a,{key:0,text:l.text},null,8,["text"])):l.type=="video"?(i(),p("div",ze,[(m=l.text)!=null&&m.includes("embed")?(i(),p("div",We,[_("iframe",{credentialless:"",src:r(l.text),style:{position:"absolute",top:"0",left:"0",width:"100%",height:"100%"},frameborder:"0",allowfullscreen:"",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",referrerpolicy:"strict-origin-when-cross-origin"},null,8,qe),d[0]||(d[0]=_("iframe",null,null,-1))])):(i(),p("div",Fe,[_("iframe",{credentialless:"",src:r(l.text??""),style:{position:"absolute",top:"0",left:"0",width:"100%",height:"100%"},frameborder:"0",allowfullscreen:"",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",referrerpolicy:"strict-origin-when-cross-origin"},null,8,He)]))])):l.type=="image"?(i(),j(v,{key:2,src:l.src,alt:"Image",class:"rounded-xl object-cover h-64"},null,8,["src"])):_e("",!0)])}),128))])}}}),Ke={class:"text-[33px] font-semibold mb-4 text-center border-b pb-2"},gt=$({__name:"ArticleStep",props:{step:{},isPreview:{type:Boolean}},setup(s){const n=s;return(r,e)=>(i(),p(w,null,[_("div",Ke,b(n.step.title),1),x(B,{contents:n.step.inner.contents},null,8,["contents"])],64))}}),Qe={class:"text-[33px] font-semibold mb-4 text-center border-b pb-2"},yt=$({__name:"CodeStep",props:{step:{},isPreview:{type:Boolean}},setup(s){const n=s;return(r,e)=>(i(),p(w,null,[_("div",Qe,b(n.step.title),1),x(B,{contents:n.step.inner.contents},null,8,["contents"])],64))}}),De={class:"flex flex-col gap-4"},Ge={class:"text-[33px] font-semibold mb-4 text-center border-b pb-2"},Je={class:"flex w-full justify-between"},Xe={class:"flex flex-col gap-2"},Ye={class:"w-40 mb-[29px] border rounded-lg h-[40px] place-items-center bg-white",draggable:"true"},Ze={class:"content-center h-full"},Oe={class:"flex flex-col gap-2"},et=$({__name:"MatchStep",props:{step:{},isPreview:{type:Boolean}},setup(s){const n=s,r=A(()=>{var d;return(d=n.step.inner.pairs)==null?void 0:d.map(a=>a.key)}),e=A(()=>{var d;return(d=n.step.inner.pairs)==null?void 0:d.map(a=>a.value)});return(d,a)=>{const v=we;return i(),p("div",De,[_("div",Ge,b(n.step.title),1),x(B,{contents:n.step.inner.contents},null,8,["contents"]),_("div",Je,[_("div",Xe,[(i(!0),p(w,null,I(r.value,l=>(i(),p("div",{key:l,class:"flex flex-col"},[_("div",Ye,[_("div",Ze,b(l),1)])]))),128))]),_("div",Oe,[(i(!0),p(w,null,I(e.value,l=>(i(),p("div",{key:l,class:"flex flex-col"},[a[0]||(a[0]=_("div",{class:"w-40 h-10 border-dashed border-gray-300 rounded-border border-x border-y"},null,-1)),x(v,{size:"small",severity:"warn",variant:"simple",class:"mb-2"},{default:ge(()=>[ye(b(l.length>0?l:"..."),1)]),_:2},1024)]))),128))])])])}}}),ht=Se(et,[["__scopeId","data-v-265024ce"]]),tt={class:"flex flex-col gap-4"},st={class:"text-[33px] font-semibold mb-4 text-center border-b pb-2"},xt=$({__name:"OpenStep",props:he({step:{},isPreview:{type:Boolean}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(s){const n=xe(s,"modelValue"),r=s,e=h(null);return(d,a)=>{const v=$e;return i(),p("div",tt,[_("div",st,b(r.step.title),1),x(B,{contents:r.step.inner.contents},null,8,["contents"]),r.isPreview?(i(),j(v,{key:0,type:"text",modelValue:e.value,"onUpdate:modelValue":a[0]||(a[0]=l=>e.value=l),size:"small",placeholder:"Enter your answer"},null,8,["modelValue"])):(i(),j(v,{key:1,type:"text",modelValue:n.value,"onUpdate:modelValue":a[1]||(a[1]=l=>n.value=l),size:"small",placeholder:"Enter your answer"},null,8,["modelValue"]))])}}}),nt={class:"flex flex-col gap-4"},ot={class:"text-[33px] font-semibold mb-4 text-center border-b pb-2"},lt={key:0,class:"flex flex-col gap-4 ml-4"},rt={key:1,class:"flex flex-col gap-4 ml-4"},bt=$({__name:"QuestionStep",props:{step:{},isPreview:{type:Boolean}},setup(s){const n=Ne(),{saveOption:r}=n,e=s,d=A(()=>e.step.inner.single),a=h(null),v=h([]);return D([v],()=>{if(!e.isPreview&&e.step.inner.options!=null&&!e.step.inner.single)for(const[l,m]of e.step.inner.options.entries())r(v.value.some(S=>S==m.text),l)}),D([a],()=>{if(!e.isPreview&&e.step.inner.options!=null&&e.step.inner.single)for(const[l,m]of e.step.inner.options.entries())r(a.value==m.text,l)}),be(()=>{if(!e.isPreview&&e.step.inner.options!=null&&(a.value=null,v.value=[],e.step.answer.question))for(const[l,m]of e.step.inner.options.entries())e.step.answer.question[l]&&(v.value.push(m.text),a.value=m.text)}),(l,m)=>{const S=ke,k=G("v-md-preview"),M=Ce;return i(),p("div",nt,[_("div",ot,b(e.step.title),1),x(B,{contents:e.step.inner.contents},null,8,["contents"]),d.value?(i(),p("div",lt,[(i(!0),p(w,null,I(e.step.inner.options,g=>(i(),p("div",{key:g.id,class:"flex gap-2"},[x(S,{modelValue:a.value,"onUpdate:modelValue":m[0]||(m[0]=C=>a.value=C),inputId:g.id,name:"dynamic",value:g.text,class:"mt-1"},null,8,["modelValue","inputId","value"]),x(k,{text:g.text},null,8,["text"])]))),128))])):(i(),p("div",rt,[(i(!0),p(w,null,I(e.step.inner.options,g=>(i(),p("div",{key:g.id,class:"flex gap-2"},[x(M,{modelValue:v.value,"onUpdate:modelValue":m[1]||(m[1]=C=>v.value=C),inputId:g.id,name:"option",value:g.text,class:"mt-1"},null,8,["modelValue","inputId","value"]),x(k,{text:g.text},null,8,["text"])]))),128))]))])}}});export{ht as M,gt as _,Be as a,_t as b,yt as c,xt as d,bt as e,Ue as t,Ne as u};
