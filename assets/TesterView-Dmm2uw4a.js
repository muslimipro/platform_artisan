import{s as ae,a as oe}from"./index-DuNUk649.js";import{_ as le,T as ne,S as re}from"./SimulationView-CVH346CB.js";import{_ as ie}from"./IdeHeader.vue_vue_type_script_setup_true_lang-CBdFj-Jl.js";import{s as H}from"./index-Cx98W21n.js";import{s as ue}from"./index-pez8Z9SL.js";import{s as ce}from"./index-BOgksqy0.js";import{a as B,c as de,b as f,i as k,w as r,h as i,e as b,k as J,f as o,K as F,F as j,D as K,u as pe,B as me,s as A,r as V,o as fe,g as a,t as _,W as ve,n as _e,q as he,E as ge,m as ye}from"./index-6znFarQA.js";import{s as be}from"./index-DQjRhnJO.js";import{b as we,c as Ce,a as P,_ as Se}from"./FeedbackTimeline.vue_vue_type_script_setup_true_lang-B8RUmmSl.js";import{a as $e,f as Te,d as O,u as ke,I as xe,c as Re,i as h,e as Ve,b as Fe,n as U,R as D,r as q}from"./pibody-DvGVtPJj.js";import{u as ze}from"./stores-DndeVrM8.js";import{u as Ie}from"./editor-store-CC3oJkgm.js";import{_ as Pe}from"./SavedCloud.vue_vue_type_script_setup_true_lang-C6AOosAr.js";import{a as De}from"./index-CXRmUllW.js";import{t as Be}from"./types-81Qs7ZwA.js";import{u as je}from"./index-DMM0zgtg.js";import"./index-DfL6EWoo.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-DjFj6twC.js";import"./index-fQzns-h5.js";import"./index-D_V3hPtc.js";import"./pibody-BwAjMvHk.js";import"./logo-D1-3uCnC.js";import"./index-LXk3WpCQ.js";import"./index-LOPIZoFq.js";import"./index-P2JPrWCE.js";import"./index-DbMtR5Qy.js";import"./index-jCxHVeOh.js";import"./index-2yVQEQpg.js";import"./index-CW2vGRKQ.js";import"./http-2Rpmxk3G.js";import"./index-WT6RWPBA.js";import"./v4-CmTdKEVZ.js";const Ee={class:"flex overflow-auto mb-2"},Me={class:"flex"},Ne={class:"text-center"},Le={key:0,class:"flex items-center justify-center h-12"},W=B({__name:"TestDataTimeline",props:{data:{}},setup(z){const x=de(()=>$e(z.data));return(w,p)=>{const g=H;return f(),k(g,{header:"Expected"},{default:r(()=>[i("div",Ee,[(f(!0),b(j,null,J(w.data,(t,u)=>(f(),b("div",Me,[i("div",Ne,[o(we,{message:t.content,class:"border-4 border-blue-500"},null,8,["message"])]),u+1<w.data.length?(f(),b("div",Le,"â†’")):F("",!0)]))),256))]),p[0]||(p[0]=K(" Inputs: ")),o(Ce,{inputs:x.value},null,8,["inputs"])]),_:1})}}}),Ae={class:"h-full flex flex-col"},Oe={class:"p-4"},Ue={class:"flex w-full"},qe={class:"material-icons"},We={class:"material-icons"},He={class:"material-icons"},Je={class:"material-icons"},Ke={class:"material-icons"},Ge={class:"flex flex-col gap-2 m-2 h-full overflow-auto"},Qe={class:"flex gap-2 w-full"},Xe=["for"],Ye={class:"material-icons"},Ze={class:"material-icons"},et=B({__name:"TesterControls",setup(z){const x=pe(),w=me(),p=Ie(),g=A(p),t=V(null),u=V([]);fe(async()=>{const s=he();try{const e=s.params.lesson_id;if(!g.lesson.value||g.lesson.value.id!=e){const{data:l}=await De.getProjectByID(e.toString()),S=await Be(l);p.setLesson(S)}const{data:d}=await P.getStepTranslationByID(s.params.step_id.toString());if(t.value=d,y.value=t.value.content.solution??y.value,t.value.content.highlights)for(const l of t.value.content.highlights)l.module&&l.slot&&n.newModuleToSlot(l.module,l.slot);t.value&&(t.value.content.tests&&(u.value=await Te(t.value.content.tests)),t.value.content.includedCommandsForTests=t.value.content.includedCommandsForTests??[...O])}catch(e){console.log(e)}});async function C(){if(t.value!=null){p.setStepSaving(!0);try{await P.updateStepTranslationByID(t.value.step,t.value.name,t.value.content)}catch(s){let e="";s instanceof Error?e=s.message:e=String(s),x.add({severity:"error",summary:"Failed to save",detail:e,life:3e3})}finally{p.setStepSaving(!1)}}}const E=je(()=>{C()},1e3,{maxWait:5e3});async function I(s){const e=JSON.stringify(s),d=new Blob([e],{type:"application/json"}),l=new FormData;l.append("file",d,"default.test.json");const{data:S}=await P.uploadFile(l);return S.presigned_url}async function G(){if(t.value==null)return;const s=await I(v.value);t.value.content.tests?t.value.content.tests.push({name:"",url:s}):(t.value.content.tests=[],t.value.content.tests.push({name:"",url:s})),u.value.push({data:v.value,test:{name:"",url:s}}),v.value=[],C()}function Q(s){w.require({message:"Are you sure you want to Delete?",header:"Confirmation",icon:"pi pi-exclamation-triangle",rejectProps:{label:"Cancel",severity:"secondary",outlined:!0},acceptProps:{label:"Delete",severity:"danger"},accept:()=>{var e,d;(d=(e=t.value)==null?void 0:e.content.tests)==null||d.splice(s,1),u.value.splice(s,1),C()}})}const{fileContent:y}=A(ze()),n=ke(),{isLoading:m,isRunning:M}=n,v=V(U),X=V(U);function Y(){n.recorder.start(),n.run();const s=ge(n.recorder.state,()=>{(n.replayer.state.value==D.Finish||n.replayer.state.value==D.Timeout)&&(n.recorder.stop(),v.value=n.recorder.getRecords()),s.stop()})}function Z(){n.replayer.state.value==D.Continue?(n.recorder.stop(),n.replayer.stop(),X.value=n.recorder.getRecords()):(n.recorder.stop(),v.value=n.recorder.getRecords()),n.stop()}function R(){var s;return((s=t.value)==null?void 0:s.content.includedCommandsForTests)??O}const ee=async()=>{if(!(!t.value||!t.value.content.tests)){h.value=!0;for(const[s,e]of u.value.entries()){const d=await q(y.value,e.data,R());await n.stopPromise();const l=await I(d);t.value.content.tests[s].url=l,u.value[s].test.url=l,u.value[s].data=d}await C(),h.value=!1}},te=async(s,e)=>{if(!t.value||!t.value.content.tests)return;h.value=!0;const d=await q(y.value,s.data,R());await n.stopPromise();const l=await I(d);t.value.content.tests[e].url=l,u.value[e].test.url=l,u.value[e].data=d,C(),h.value=!1};return(s,e)=>{const d=be,l=ye,S=ce,N=ue,se=H;return f(),b("div",Ae,[i("div",Oe,[e[4]||(e[4]=K(" Include Commands: ")),t.value?(f(),k(d,{key:0,onChange:a(E),modelValue:t.value.content.includedCommandsForTests,"onUpdate:modelValue":e[0]||(e[0]=c=>t.value.content.includedCommandsForTests=c),options:xe,filter:"",placeholder:"Select commands",class:"w-full md:w-80",maxSelectedLabels:3},null,8,["onChange","modelValue","options"])):F("",!0),i("div",Ue,[o(l,{type:"button",class:"w-9 h-9 mr-1",severity:"success",rounded:"",onClick:Y,disabled:a(m)||a(M)},{default:r(()=>[i("span",qe,_(a(m)?"hourglass_top":"play_arrow"),1)]),_:1},8,["disabled"]),o(l,{type:"button",class:"w-9 h-9 mr-1",severity:"danger",rounded:"",onClick:Z,disabled:a(m)||!a(M)},{default:r(()=>[i("span",We,_(a(m)?"hourglass_top":"stop"),1)]),_:1},8,["disabled"]),o(l,{type:"button",class:"w-9 h-9",severity:"info",rounded:"",onClick:e[1]||(e[1]=c=>G()),disabled:v.value.length<=0||t.value==null},{default:r(()=>[i("span",He,_(a(m)?"hourglass_top":"save"),1)]),_:1},8,["disabled"]),o(l,{type:"button",class:"w-9 h-9",severity:"info",rounded:"",onClick:e[2]||(e[2]=c=>a(Re)(a(y),u.value,R())),disabled:a(m)||a(h)},{default:r(()=>[i("span",Je,_(a(m)?"hourglass_top":"bug_report"),1)]),_:1},8,["disabled"]),o(l,{type:"button",class:"w-9 h-9",rounded:"",onClick:e[3]||(e[3]=c=>ee()),disabled:a(m)||!u.value||a(h)},{default:r(()=>[i("span",Ke,_(a(m)?"hourglass_top":"restart_alt"),1)]),_:1},8,["disabled"]),o(Pe)])]),v.value.length>0?(f(),k(W,{key:0,data:v.value,class:"mt-2"},null,8,["data"])):F("",!0),i("div",Ge,[(f(!0),b(j,null,J(u.value,(c,$)=>{var L;return f(),k(se,{toggleable:"",key:c.test.url,class:_e(["border-4",a(Fe)((L=c.result)==null?void 0:L.success)])},{header:r(()=>[i("div",Qe,[o(N,{variant:"on",class:"w-full"},{default:r(()=>[i("label",{for:`name ${$+1}`},"Test "+_($+1),9,Xe),o(S,{id:`name ${$+1}`,onInput:a(E),modelValue:c.test.name,"onUpdate:modelValue":T=>c.test.name=T,class:"w-full",size:"small"},null,8,["id","onInput","modelValue","onUpdate:modelValue"])]),_:2},1024),o(l,{type:"button",class:"w-9 h-9",severity:"info",rounded:"",onClick:T=>a(Ve)(a(y),c,R()),disabled:a(m)||a(h)},{default:r(()=>[i("span",Ye,_(a(m)?"hourglass_top":"bug_report"),1)]),_:2},1032,["onClick","disabled"]),o(l,{type:"button",class:"w-9 h-9",severity:"danger",rounded:"",onClick:T=>Q($)},{default:r(()=>e[5]||(e[5]=[i("span",{class:"material-icons"},_("delete_forever"),-1)])),_:2},1032,["onClick"]),o(l,{type:"button",class:"w-9 h-9",rounded:"",onClick:T=>te(c,$),disabled:a(m)||!u.value||a(h)},{default:r(()=>[i("span",Ze,_(a(m)?"hourglass_top":"restart_alt"),1)]),_:2},1032,["onClick","disabled"]),o(l,{type:"button",class:"w-9 h-9",severity:"warn",rounded:"",onClick:T=>c.result=void 0,disabled:!u.value||a(h)},{default:r(()=>e[6]||(e[6]=[i("span",{class:"material-icons"}," cleaning_services ",-1)])),_:2},1032,["onClick","disabled"])])]),default:r(()=>[o(W,{data:c.data,class:"mt-2"},null,8,["data"]),c.result?(f(),k(Se,ve({key:0,ref_for:!0},c.result),null,16)):F("",!0)]),_:2},1032,["class"])}),128))])])}}}),tt={class:"flex bg-surface-0",style:{height:"calc(100vh - 52px)"}},Bt=B({__name:"TesterView",setup(z){return(x,w)=>{const p=ae,g=oe;return f(),b(j,null,[o(ie),i("div",tt,[o(g,{class:"w-full rounded-none"},{default:r(()=>[o(p,{size:50,minSize:10,class:"h-full"},{default:r(()=>[o(et)]),_:1}),o(p,{size:50,minSize:10},{default:r(()=>[o(g,{layout:"vertical",class:"h-full w-full"},{default:r(()=>[o(p,{size:65,minSize:10},{default:r(()=>[o(le)]),_:1}),o(p,{size:35,minSize:10},{default:r(()=>[o(ne)]),_:1})]),_:1})]),_:1}),o(p,{size:50,minSize:10,class:"max-w-[467px] w-full"},{default:r(()=>[o(re)]),_:1})]),_:1})])],64)}}});export{Bt as default};
