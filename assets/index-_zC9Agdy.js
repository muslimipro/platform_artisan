import{s as $e,a as ke}from"./index-De2mc7lv.js";import{_ as Ie}from"./IdeHeader.vue_vue_type_script_setup_true_lang-C-K2Y4YW.js";import{_ as Te}from"./PibodyViewer.vue_vue_type_script_setup_true_lang-CWN9NEoW.js";import{b as Se,d as ce,f as xe,e as ae,a as Fe,g as Ue,u as Be,h as Re,n as De,I as Pe,i as Ve,j as S,k as Le,l as Me,m as oe,R as K,r as re}from"./CodeEditorView.vue_vue_type_script_setup_true_lang-DhEu2zYO.js";import{s as X}from"./index-BTL82xS8.js";import{s as Ne}from"./index-Dyhdg-S7.js";import{s as je}from"./index-B7xbQbD6.js";import{a as J,c as me,r as x,b as m,k as B,w as i,h as n,t as y,g as e,i as L,l as R,e as $,j as Y,n as H,f as r,F as W,q as pe,d as ze,u as fe,D as Ae,s as le,o as Ee,G as ne,x as Oe}from"./index-DHVnmQPM.js";import{s as qe}from"./index-BzCzRpCo.js";import{u as Ge}from"./stores-CINz-4gA.js";import{_ as Q,a as ve}from"./Inputs.vue_vue_type_script_setup_true_lang-44HSV6la.js";import{C as G}from"./cloudStorageApi-HzK0WVk5.js";import{U as de}from"./unitApi-BdRQtE7l.js";import{m as He}from"./mapUnitFromDto-BXFFFlEW.js";import{u as Je}from"./index-CG6SXWyB.js";import"./index-Cr72xZbi.js";import"./index-PBST-dQM.js";import"./logo-D1-3uCnC.js";import"./SimulationView-fq8-2VoV.js";import"./index-D-99ObJy.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-COm9ynAh.js";import"./index-DimdtQOL.js";import"./index-DRCcxSDj.js";import"./index-HGiDyU5z.js";import"./index-BOWzKnTG.js";import"./index-BQXR58SR.js";import"./index-CKgSSqZR.js";import"./index-C4F8jACC.js";import"./http-Dcz7Gd9U.js";const We={class:"flex items-center gap-2"},Ke={class:"font-bold"},Qe={class:"flex"},Xe=["onClick"],Ye={class:"text-center"},Ze={key:0,class:"text-center"},et={key:0,class:"flex items-center justify-center h-20"},tt=J({__name:"FeedbackTimeline",props:{id:{},result:{}},setup(k){const u=k,{selectNode:p,selectedIndex:g,firstError:b}=Se(u.id,u.result),F=me(()=>ce(u.result.replayed)),t=x(null),D=x([]);return(v,h)=>{const w=pe,P=X;return m(),B(P,null,{header:i(()=>[n("div",We,[n("div",Ke,y(v.$t("result")),1),u.result.success===!1?(m(),B(w,{key:0,severity:"danger",onClick:h[0]||(h[0]=l=>e(b)(D.value))},{default:i(()=>[L(y(v.$t("first error")),1)]),_:1})):R("",!0)])]),default:i(()=>[n("div",{ref_key:"scrollContainer",ref:t,class:"flex overflow-auto mb-2"},[(m(!0),$(W,null,Y(u.result.feedback,(l,C)=>{var M,V;return m(),$("div",Qe,[n("button",{class:H(["flex",e(g)===C?"border border-blue-500":""]),onClick:E=>e(p)(C),ref_for:!0,ref:E=>D.value[C]=E},[n("div",Ye,[L(y(l.correct?v.$t("correct"):v.$t("incorrect"))+" ",1),r(Q,{message:(M=l.replayed)==null?void 0:M.content,class:H(["border-4 rounded-md",l.correct?"border-green-500":"border-red-500"])},null,8,["message","class"])]),l.correct?R("",!0):(m(),$("div",Ze,[h[1]||(h[1]=L(y("Expected")+" ")),r(Q,{message:(V=l.expected)==null?void 0:V.content,class:H(["border-4 rounded-md",l.correct?"border-red-500":"border-green-500"])},null,8,["message","class"])]))],10,Xe),C+1<u.result.feedback.length?(m(),$("div",et,"→")):R("",!0)])}),256))],512),h[2]||(h[2]=L(" Input used: ")),r(ve,{inputs:F.value},null,8,["inputs"])]),_:1})}}}),st={class:"flex overflow-auto mb-2"},at={class:"text-center"},ot={key:0,class:"flex items-center justify-center h-12"},ie=J({__name:"TestDataTimeline",props:{data:{}},setup(k){const u=me(()=>ce(k.data));return(p,g)=>{const b=X;return m(),B(b,{header:"Expected"},{default:i(()=>[n("div",st,[(m(!0),$(W,null,Y(p.data,(F,t)=>(m(),$("div",{class:"flex",key:t},[n("div",at,[r(e(Q),{message:F.content,class:"border-4 border-blue-500"},null,8,["message"])]),t+1<p.data.length?(m(),$("div",ot,"→")):R("",!0)]))),128))]),g[0]||(g[0]=L(" Inputs: ")),r(e(ve),{inputs:u.value},null,8,["inputs"])]),_:1})}}}),rt=ze("tester-store",()=>{const k=fe(),u=x(null),p=x(!1),g=x(!1),b=x(!1);function F(v){b.value=v}async function t(v,h){try{p.value=!0;const{data:w}=await de.getUnitByIdandLessonId(v,h);u.value=He(w)}catch(w){k.add({severity:"error",summary:w.response.data.error,life:2e3})}finally{p.value=!1}}async function D(v,h,w){try{g.value=!0,await de.updateUnitByIdandLessonId(v,h,w)}catch(P){k.add({severity:"error",summary:P.response.data.error,life:2e3})}finally{g.value=!1}}return{selectedUnit:u,isUnitLoading:p,setDataSaving:F,loadUnitByIdandLessonId:t,updateUnitByIdandLessonId:D}}),lt={class:"h-full flex flex-col"},nt={class:"p-4"},dt={class:"flex w-full gap-1"},it={class:"material-icons"},ut={class:"material-icons"},ct={class:"material-icons"},mt={class:"material-icons"},pt={class:"material-icons"},ft={class:"flex flex-col gap-2 m-2 h-full overflow-auto"},vt={class:"flex gap-2 w-full"},_t=["for"],yt={class:"material-icons"},gt={class:"material-icons"},ht=J({__name:"TesterControls",props:{id:{}},setup(k){const u=k,p=fe(),g=Ae(),b=Oe(),F=rt(),{selectedUnit:t}=le(F),{loadUnitByIdandLessonId:D,setDataSaving:v,updateUnitByIdandLessonId:h}=F,w=Number(b.params.lesson_id),P=Number(b.params.unit_id),l=x([]);Ee(async()=>{var s;try{await D(P,w);const a=(s=t.value)==null?void 0:s.content;if(U.value=a.answer,O.setCode(U.value),t.value){if(t.value.data.tests&&(l.value=await xe(t.value.data.tests)),t.value.data.neededModules)for(const c of t.value.data.neededModules)c.module&&c.slot&&N.newModuleToSlot(c.module,c.slot);t.value.data.includedCommandsForTests=t.value.data.includedCommandsForTests??[...ae]}}catch(a){console.log(a)}});async function C(){if(t.value!=null){v(!0);try{await h(P,w,{content:t.value.content,data:t.value.data})}catch(s){let a="";s instanceof Error?a=s.message:a=String(s),p.add({severity:"error",summary:"Failed to save",detail:a,life:3e3})}finally{v(!1)}}}const M=Je(()=>{C()},1e3,{maxWait:5e3});async function V(s){const a=JSON.stringify(s),c=new Blob([a],{type:"application/json"}),d=new FormData;d.append("file",c,"default.test.json");const{data:T}=await G.uploadFile(d,"tests");return T.source_url}async function E(){if(t.value!=null)try{const s=await V(I.value);t.value.data.tests?t.value.data.tests.push({name:"",url:s}):(t.value.data.tests=[],t.value.data.tests.push({name:"",url:s})),l.value.push({data:I.value,test:{name:"",url:s}}),I.value=[],await C()}catch(s){p.add({severity:"error",summary:s.response.data.error,life:2e3})}}function _e(s){g.require({message:"Are you sure you want to Delete?",header:"Confirmation",icon:"pi pi-exclamation-triangle",rejectProps:{label:"Cancel",severity:"secondary",outlined:!0},acceptProps:{label:"Delete",severity:"danger"},accept:async()=>{var a,c;try{const d=l.value[s].test.url;await G.deleteFile(d),(c=(a=t.value)==null?void 0:a.data.tests)==null||c.splice(s,1),l.value.splice(s,1),C()}catch(d){p.add({severity:"error",summary:d.response.data.error,life:2e3})}}})}const{fileContent:U}=le(Ge()),N=Fe(u.id),Z=Ue(u.id),O=Be(u.id),ee=Re(u.id),o=De(Z,Z.write,ee.writeText,ee.clearDisplay,N.setPin,N.getPin,N.getI2C),{isLoading:_,isRunning:te}=o;N.addNeededModules([]);const I=x(oe),ye=x(oe);ne(O.code,s=>{typeof s=="string"&&s!==U.value&&(U.value=s,t.value&&(t.value.content.answer=s))});function ge(){o.recorder.start();const s=typeof O.code.value=="string"?O.code.value:"";o.run(s);const a=ne(o.recorder.state,()=>{(o.replayer.state.value==K.Finish||o.replayer.state.value==K.Timeout)&&(o.recorder.stop(),I.value=o.recorder.getRecords()),a.stop()})}function he(){o.replayer.state.value==K.Continue?(o.recorder.stop(),o.replayer.stop(),ye.value=o.recorder.getRecords()):(o.recorder.stop(),I.value=o.recorder.getRecords()),o.stop()}function q(){var s;return((s=t.value)==null?void 0:s.data.includedCommandsForTests)??ae}const be=async()=>{if(!(!t.value||!t.value.content.tests)){S.value=!0;for(const[s,a]of l.value.entries()){const c=await re(o,U.value,a.data,q());await o.stopPromise();const d=t.value.data.tests[s].url,T=await V(c);t.value.data.tests[s].url=T,l.value[s].test.url=T,l.value[s].data=c;try{await G.deleteFile(d)}catch(j){p.add({severity:"error",summary:j.response.data.error,life:2e3})}}await C(),S.value=!1}},we=async(s,a)=>{if(!t.value||!t.value.data.tests)return;S.value=!0;const c=await re(o,U.value,s.data,q());await o.stopPromise();const d=t.value.data.tests[a].url,T=await V(c);t.value.data.tests[a].url=T,l.value[a].test.url=T,l.value[a].data=c,C();try{await G.deleteFile(d)}catch(j){p.add({severity:"error",summary:j.response.data.error,life:2e3})}S.value=!1};return(s,a)=>{const c=qe,d=pe,T=je,j=Ne,Ce=X;return m(),$("div",lt,[n("div",nt,[a[4]||(a[4]=L(" Include Commands: ")),e(t)?(m(),B(c,{key:0,onChange:e(M),modelValue:e(t).data.includedCommandsForTests,"onUpdate:modelValue":a[0]||(a[0]=f=>e(t).data.includedCommandsForTests=f),options:Pe,filter:"",placeholder:"Select commands",class:"w-full md:w-80 mb-2 mt-1",maxSelectedLabels:3},null,8,["onChange","modelValue","options"])):R("",!0),n("div",dt,[r(d,{type:"button",class:"w-9 h-9",severity:"success",rounded:"",onClick:ge,disabled:e(_)||e(te)},{default:i(()=>[n("span",it,y(e(_)?"hourglass_top":"play_arrow"),1)]),_:1},8,["disabled"]),r(d,{type:"button",class:"w-9 h-9",severity:"danger",rounded:"",onClick:he,disabled:e(_)||!e(te)},{default:i(()=>[n("span",ut,y(e(_)?"hourglass_top":"stop"),1)]),_:1},8,["disabled"]),r(d,{type:"button",class:"w-9 h-9",severity:"info",rounded:"",onClick:a[1]||(a[1]=f=>E()),disabled:I.value.length<=0||e(t)==null},{default:i(()=>[n("span",ct,y(e(_)?"hourglass_top":"save"),1)]),_:1},8,["disabled"]),r(d,{type:"button",class:"w-9 h-9",severity:"info",rounded:"",onClick:a[2]||(a[2]=f=>e(Ve)(e(o),e(U),l.value,q())),disabled:e(_)||e(S)},{default:i(()=>[n("span",mt,y(e(_)?"hourglass_top":"bug_report"),1)]),_:1},8,["disabled"]),r(d,{type:"button",class:"w-9 h-9",rounded:"",onClick:a[3]||(a[3]=f=>be()),disabled:e(_)||!l.value||e(S)},{default:i(()=>[n("span",pt,y(e(_)?"hourglass_top":"restart_alt"),1)]),_:1},8,["disabled"])])]),I.value.length>0?(m(),B(ie,{key:0,data:I.value,class:"mt-2"},null,8,["data"])):R("",!0),n("div",ft,[(m(!0),$(W,null,Y(l.value,(f,z)=>{var se;return m(),B(Ce,{toggleable:"",key:f.test.url,class:H(["border-4",e(Me)((se=f.result)==null?void 0:se.success)])},{header:i(()=>[n("div",vt,[r(j,{variant:"on",class:"w-full"},{default:i(()=>[n("label",{for:`name ${z+1}`},"Test "+y(z+1),9,_t),r(T,{id:`name ${z+1}`,onInput:e(M),modelValue:f.test.name,"onUpdate:modelValue":A=>f.test.name=A,class:"w-full",size:"small"},null,8,["id","onInput","modelValue","onUpdate:modelValue"])]),_:2},1024),r(d,{type:"button",class:"w-9 h-9",severity:"info",rounded:"",onClick:A=>e(Le)(e(o),e(U),f,q()),disabled:e(_)||e(S)},{default:i(()=>[n("span",yt,y(e(_)?"hourglass_top":"bug_report"),1)]),_:2},1032,["onClick","disabled"]),r(d,{type:"button",class:"w-9 h-9",severity:"danger",rounded:"",onClick:A=>_e(z)},{default:i(()=>a[5]||(a[5]=[n("span",{class:"material-icons"},y("delete_forever"),-1)])),_:2},1032,["onClick"]),r(d,{type:"button",class:"w-9 h-9",rounded:"",onClick:A=>we(f,z),disabled:e(_)||!l.value||e(S)},{default:i(()=>[n("span",gt,y(e(_)?"hourglass_top":"restart_alt"),1)]),_:2},1032,["onClick","disabled"]),r(d,{type:"button",class:"w-9 h-9",severity:"warn",rounded:"",onClick:A=>f.result=void 0,disabled:!l.value||e(S)},{default:i(()=>a[6]||(a[6]=[n("span",{class:"material-icons"}," cleaning_services ",-1)])),_:2},1032,["onClick","disabled"])])]),default:i(()=>[r(ie,{data:f.data,class:"mt-2"},null,8,["data"]),f.result?(m(),B(e(tt),{key:0,result:f.result,id:u.id},null,8,["result","id"])):R("",!0)]),_:2},1032,["class"])}),128))])])}}}),bt={class:"flex bg-surface-0",style:{height:"calc(100vh - 52px)"}},ue="tester",Xt=J({__name:"TesterView",setup(k){return(u,p)=>{const g=$e,b=ke;return m(),$(W,null,[r(Ie),n("div",bt,[r(b,{class:"w-full rounded-none"},{default:i(()=>[r(g,{size:33,minSize:10,class:"max-w-[767px] h-full"},{default:i(()=>[r(ht,{id:ue})]),_:1}),r(g,{size:67,minSize:10,class:"w-full h-full"},{default:i(()=>[r(e(Te),{id:ue,class:"w-full h-full",horizontal:!1})]),_:1})]),_:1})])],64)}}});export{Xt as default};
