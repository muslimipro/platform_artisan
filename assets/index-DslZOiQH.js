import{s as R}from"./index-BFamOs9l.js";import{s as ne}from"./index-qQbQ04WS.js";import{d as oe,u as ae,r as y,c as le,a as L,b as t,i as C,H as ie,o as U,E as A,e as c,F as E,k as j,f as k,h as _,g as s,t as re,q,s as O,I as ue,J as W,C as ce,K as I,w as F,D,T as H,m as Y,B as de,l as pe}from"./index-Bzt9KOfG.js";import{L as fe,d as ve}from"./defaultConfirmDeleteOptions-UGzn_2PT.js";import"./http-j2rGyWLF.js";import{m as me}from"./mapLessonFromDto-Dmd7ExqT.js";import{U as N}from"./unitApi-DyN4w6ZV.js";import{m as ge}from"./mapUnitFromDto-CYGc5n9V.js";import{u as ye,c as _e}from"./CodeEditorView.vue_vue_type_script_setup_true_lang-Bf0DdBHj.js";import{_ as he}from"./PibodyViewer.vue_vue_type_script_setup_true_lang-BimG2wff.js";import{_ as xe}from"./CodeViewer.vue_vue_type_script_setup_true_lang-BUpiSW3Y.js";import{s as we}from"./index-ADFpD9ce.js";import{s as be}from"./index-DbQeVANJ.js";import{s as ke}from"./index-BErXl6Bn.js";import{u as Se}from"./index-3p5Uw1Xh.js";import{_ as Ce}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./SimulationView-BmIbLh0U.js";import"./index-BTAl2Za4.js";import"./index-B-4jWEMH.js";import"./index-Dxv-j-XW.js";import"./pibody-BwAjMvHk.js";import"./index-DbdWTsGi.js";const z=oe("lesson-store",()=>{const x=ae(),e=y(null),n=y(!1),p=y(!1),a=y(!1),m=y(!1),l=y(0),f=y([]),d=y(0),i=y([]),h=y("continue"),u=y(!1),v=y(!1),o=y(!1),r=y(null),w=le(()=>{var g;return o.value&&(((g=r.value)==null?void 0:g.modulesWerePut)??!0)});async function V(g,b){try{n.value=!0;const{data:S}=await fe.getLessonById(g,b);e.value=me(S)}catch(S){x.add({severity:"error",summary:S.response.data.error,life:2e3})}finally{n.value=!1}}async function T(g,b){try{p.value=!0;const{data:S}=await N.getUnitByIdandLessonId(g,b);return S}catch(S){x.add({severity:"error",summary:S.response.data.error,life:2e3})}finally{p.value=!1}}async function G(){if(e.value!=null){a.value=!0,f.value=[],l.value=0,d.value=0;for(let g=0;g<e.value.pages.length;g++)i.value.push(0);h.value="continue",f.value.push(e.value.pages[l.value].groups[d.value]),await P(e.value.id),a.value=!1}}async function P(g){o.value=!1,u.value=!1;for(let b=0;b<f.value[d.value].units.length;b++){const S=f.value[d.value].units[b];["options","open","code","pibody"].includes(S.unitType)&&(h.value="check",u.value=!0);const B=await T(S.id,g);if(B){const $=ge(B);f.value[d.value].units[b].content=$==null?void 0:$.content,f.value[d.value].units[b].data=$==null?void 0:$.data,f.value[d.value].units[b].studentState=$==null?void 0:$.studentState,S.unitType=="pibody"&&(r.value=ye(`pibody-${$.id}`),r.value.addNeededModules($.data.neededModules))}}h.value=="continue"&&await M()}async function M(){if(e.value!=null)try{m.value=!0,v.value=!1;for(const g of f.value[f.value.length-1].units){if(g.unitType=="code"){const b=g.studentState.answer.code,S=await _e(`code-${g.id}`,b,g.data.tests,g.data.includedCommands);if(v.value=S.correct,S.correct)await N.skipSubmitUnitByIdandLessonId(g.id,e.value.id);else{const{data:B}=await N.getUnitCodeHint(g.id,b);x.add({severity:"error",summary:B.hint})}}else{const{data:b}=await N.submitUnitByIdandLessonId(g.id,e.value.id,g.studentState.answer);v.value=b.correct}if(v.value==!1)break}v.value?(i.value[l.value]++,d.value>=e.value.pages[l.value].groups.length-1?l.value<e.value.pages.length-1?h.value="continue":h.value="finish":h.value="continue"):h.value="try-again"}finally{m.value=!1}}async function J(){if(e.value!=null){if(d.value>=e.value.pages[l.value].groups.length-1){ee();return}a.value=!0,d.value++,f.value.push(e.value.pages[l.value].groups[d.value]),await P(e.value.id),a.value=!1}}function X(g,b){if(e.value!=null){for(const[S,B]of f.value.entries())for(const[$,se]of B.units.entries())if(se.id==g){f.value[S].units[$].studentState.answer=b;break}}}async function Q(){e.value!=null&&(h.value="check")}async function Z(){e.value!=null&&(h.value="completed")}async function ee(){e.value!=null&&(a.value=!0,l.value++,f.value=[],d.value=0,h.value="continue",f.value.push(e.value.pages[l.value].groups[d.value]),await P(e.value.id),a.value=!1)}function te(g){o.value=g}return{selectedLesson:e,isLessonLoading:n,isUnitLoading:p,groups:f,groupIndex:d,isGroupLoading:a,isSubmitLoading:m,groupStatus:h,submitExist:u,correct:v,submitEnabled:w,pageProgress:i,setSubmitable:te,loadLessonById:V,loadUnitByIdandLessonId:T,loadInitialGroup:G,submitGroup:M,nextGroup:J,saveAnswer:X,tryAgain:Q,finishLesson:Z}}),K=L({__name:"MdViewer",props:{text:{}},setup(x){const e=x;return(n,p)=>{const a=ie("v-md-preview");return t(),C(a,{text:e.text},null,8,["text"])}}}),$e=L({__name:"ArticleViewer",props:{article:{}},setup(x){const e=x;return(n,p)=>(t(),C(K,{text:e.article.text},null,8,["text"]))}}),Le={class:"flex flex-col gap-4 pl-4"},Ie=L({__name:"OptionsViewer",props:{optionsData:{},state:{}},emits:["save-answer"],setup(x,{emit:e}){const n=x,p=e,a=y(!1),m=y(!1),l=y(!1),f=y([]),d=y([]),i=y();return U(()=>{var h,u,v,o,r,w;a.value=((h=n.optionsData)==null?void 0:h.shuffle)??!1,m.value=((u=n.optionsData)==null?void 0:u.feedback)??!1,l.value=((v=n.optionsData)==null?void 0:v.single)??!1,f.value=((o=n.optionsData)==null?void 0:o.options)??[],d.value=((r=n.state.answer)==null?void 0:r.options)??[],i.value=n.state.answer&&n.state.answer.options&&n.state.answer.options.length>0?(w=n.state)==null?void 0:w.answer.options[0]:void 0}),A([i,d,m],()=>{l.value&&i.value?p("save-answer",{options:[i.value],feedback:m.value}):p("save-answer",{options:d.value,feedback:m.value})},{deep:!0}),(h,u)=>{const v=be,o=we;return t(),c("div",Le,[(t(!0),c(E,null,j(f.value,r=>(t(),c("div",{key:r.id,class:"flex gap-2 items-center"},[l.value?(t(),C(v,{key:0,modelValue:i.value,"onUpdate:modelValue":u[0]||(u[0]=w=>i.value=w),value:r.id},null,8,["modelValue","value"])):(t(),C(o,{key:1,modelValue:d.value,"onUpdate:modelValue":u[1]||(u[1]=w=>d.value=w),value:r.id},null,8,["modelValue","value"])),k(K,{text:r.text},null,8,["text"])]))),128))])}}}),Te=L({__name:"OpenViewer",props:{state:{}},emits:["save-answer"],setup(x,{emit:e}){const n=x,p=e,a=y("");return U(()=>{a.value=n.state.answer.open}),A(a,()=>{p("save-answer",{open:a.value})}),(m,l)=>{const f=ke;return t(),C(f,{type:"text",modelValue:a.value,"onUpdate:modelValue":l[0]||(l[0]=d=>a.value=d),class:"w-full",size:"small"},null,8,["modelValue"])}}}),Be={key:0,style:{position:"relative",width:"100%",height:"0","padding-bottom":"56.25%"}},Ee=["src"],Ve={key:1,style:{position:"relative","margin-left":"5%",width:"90%",height:"0","padding-bottom":"160%"}},Ne=["src"],Ae=L({__name:"VideoViewer",props:{video:{}},setup(x){const e=x;function n(p){return p.replace("shorts","embed")}return(p,a)=>e.video.url.includes("embed")?(t(),c("div",Be,[_("iframe",{credentialless:"",src:n(e.video.url),style:{position:"absolute",top:"0",left:"0",width:"100%",height:"100%"},frameborder:"0",allowfullscreen:"",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",referrerpolicy:"strict-origin-when-cross-origin"},null,8,Ee)])):(t(),c("div",Ve,[_("iframe",{credentialless:"",src:n(e.video.url??""),style:{position:"absolute",top:"0",left:"0",width:"100%",height:"100%"},frameborder:"0",allowfullscreen:"",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",referrerpolicy:"strict-origin-when-cross-origin"},null,8,Ne)]))}}),Ge={key:1,class:"flex-grow px-4 py-2"},Ue={key:6},je=L({__name:"UnitCard",props:{unit:{},loading:{type:Boolean}},setup(x){const e=x,n=q(),p=z(),{saveAnswer:a,setSubmitable:m}=p;function l(i){e.unit.unitType=="options"?m(i.options.length>0):e.unit.unitType=="open"?m(i.open.length>0):(e.unit.unitType=="code"||e.unit.unitType=="pibody")&&m(i.code.length>0),a(e.unit.id,i),f(i)}const f=Se(i=>{d(i)},1e3,{maxWait:5e3});async function d(i){await N.saveUnitByIdandLessonId(e.unit.id,Number(n.params.id),{answer:i})}return(i,h)=>{const u=R;return t(),c("div",null,[i.loading?(t(),C(u,{key:0,class:"flex justify-center items-center w-10 h-full"})):(t(),c("div",Ge,[e.unit.unitType=="article"?(t(),C($e,{key:0,article:e.unit.content},null,8,["article"])):e.unit.unitType=="options"?(t(),C(Ie,{key:1,"options-data":e.unit.content,state:e.unit.studentState,onSaveAnswer:l},null,8,["options-data","state"])):e.unit.unitType=="open"?(t(),C(Te,{key:2,state:e.unit.studentState,onSaveAnswer:l},null,8,["state"])):e.unit.unitType=="video"?(t(),C(Ae,{key:3,video:e.unit.content},null,8,["video"])):e.unit.unitType=="code"?(t(),C(s(xe),{key:4,id:`code-${e.unit.id}`,code:e.unit.content,state:e.unit.studentState,starting:e.unit.studentStatus=="nothing",onSaveAnswer:l},null,8,["id","code","state","starting"])):e.unit.unitType=="pibody"?(t(),C(s(he),{key:5,id:`pibody-${e.unit.id}`,content:e.unit.content,data:e.unit.data,state:e.unit.studentState,starting:e.unit.studentStatus=="nothing",onSaveAnswer:l},null,8,["id","content","data","state","starting"])):(t(),c("div",Ue,re(e.unit.content),1))]))])}}}),ze={key:1,class:"flex flex-col h-full w-full"},Pe={class:"flex-grow flex flex-col gap-4 px-4 py-2"},De=L({__name:"GroupCard",props:{group:{},loading:{type:Boolean}},setup(x){const e=x,n=y(null);return A(()=>e.loading,p=>{p===!1&&n.value&&requestAnimationFrame(()=>{var a;(a=n.value)==null||a.scrollIntoView({behavior:"smooth",block:"start"})})}),(p,a)=>{const m=R;return t(),c("div",{ref_key:"groupRef",ref:n,class:"pt-8"},[p.loading?(t(),C(m,{key:0,class:"flex justify-center items-center w-10 h-full"})):(t(),c("div",ze,[_("div",Pe,[(t(!0),c(E,null,j(p.group.units,l=>(t(),C(je,{key:l.id,unit:l},null,8,["unit"]))),128))])]))],512)}}}),Fe=L({__name:"UnitsView",props:{pages:{}},setup(x){const e=z(),{groups:n,isGroupLoading:p}=O(e),{loadInitialGroup:a}=e,m=y(null),l=y(null),f=y(0);function d(u){let v=u;for(;v&&v.parentElement;){const o=v.parentElement,w=getComputedStyle(o).overflowY;if(w==="auto"||w==="scroll")return o;v=o}return null}async function i(){await ce();const u=d(m.value),v=l.value;if(!u||!v){f.value=0;return}const o=u.clientHeight,r=v.getBoundingClientRect().height,w=Math.max(0,o-r);f.value=w}function h(u,v){var w;const o=(w=n.value[n.value.length-1])==null?void 0:w.id;let r=null;u&&(u instanceof Element?r=u:u.$el instanceof Element&&(r=u.$el)),l.value=v.id===o?r:null}return U(()=>{a(),i(),window.addEventListener("resize",i)}),ue(()=>{window.removeEventListener("resize",i)}),A(()=>n.value.length,async()=>{await i()}),A(()=>p.value,async(u,v)=>{v===!0&&u===!1&&await i()}),(u,v)=>(t(),c("div",{ref_key:"rootEl",ref:m,class:"flex flex-col gap-8"},[(t(!0),c(E,null,j(s(n),o=>(t(),c("div",{key:o.id,ref_for:!0,ref:r=>h(r,o)},[k(De,{group:o,loading:s(p)&&o.id==s(n)[s(n).length-1].id},null,8,["group","loading"])]))),128)),_("div",{style:W({height:f.value+"px"})},null,4)],512))}}),He={key:0,class:"flex justify-center items-center w-full min-h-24 px-8 gap-8"},Re={key:1},Oe={key:"correct",class:"flex justify-center items-center w-full min-h-24 px-8 gap-8 bg-green-100"},Me={key:"incorrect",class:"flex justify-center items-center w-full min-h-24 px-8 gap-8 bg-red-100"},qe={key:"no-submit",class:"flex justify-center items-center w-full min-h-24 px-8 gap-8"},We={key:"try-again",class:"flex justify-center items-center w-full min-h-24 px-8 gap-8 bg-gray-50"},Ye={key:2},Ke={key:"correct",class:"flex justify-center items-center w-full min-h-24 px-8 gap-8 bg-green-100"},Je={key:1,class:"flex justify-center items-center w-full min-h-24 px-8 gap-8"},Xe=L({__name:"NavigationBar",setup(x){const e=z(),{isSubmitLoading:n,groupStatus:p,isGroupLoading:a,submitExist:m,correct:l,submitEnabled:f}=O(e),{submitGroup:d,nextGroup:i,tryAgain:h,finishLesson:u}=e;return(v,o)=>{const r=Y;return t(),c(E,null,[s(p)=="check"?(t(),c("div",He,[k(r,{label:"CHECK",icon:"pi pi-check","icon-pos":"right",size:"large",severity:"contrast",class:"w-56 rounded-3xl",onClick:s(d),loading:s(n),disabled:s(n)||!s(f)},null,8,["onClick","loading","disabled"])])):I("",!0),s(p)=="continue"?(t(),c("div",Re,[k(H,{name:"pop",appear:"",mode:"out-in"},{default:F(()=>[s(m)&&s(l)?(t(),c("div",Oe,[o[0]||(o[0]=_("div",{class:"text-lg font-bold flex items-center gap-2"},[_("span",{class:"text-3xl"},"🎉"),D(" Correct!")],-1)),k(r,{label:"CONTINUE",icon:"pi pi-arrow-right","icon-pos":"right",size:"large",class:"w-56 rounded-3xl",onClick:s(i),loading:s(a),disabled:s(a)},null,8,["onClick","loading","disabled"])])):s(m)&&!s(l)?(t(),c("div",Me,[k(r,{label:"CONTINUE",icon:"pi pi-arrow-right","icon-pos":"right",size:"large",severity:"contrast",class:"w-56 rounded-3xl",onClick:s(i),loading:s(a),disabled:s(a)},null,8,["onClick","loading","disabled"])])):(t(),c("div",qe,[k(r,{label:"CONTINUE",icon:"pi pi-arrow-right","icon-pos":"right",size:"large",severity:"contrast",class:"w-56 rounded-3xl",onClick:s(i),loading:s(a),disabled:s(a)},null,8,["onClick","loading","disabled"])]))]),_:1})])):I("",!0),k(H,{name:"shake",appear:""},{default:F(()=>[s(p)=="try-again"?(t(),c("div",We,[o[1]||(o[1]=_("div",{class:"text-lg font-bold flex items-center gap-2"},[_("span",{class:"text-3xl"},"⚠️"),D(" Incorrect!")],-1)),k(r,{label:"TRY AGAIN",icon:"pi pi-arrow-right","icon-pos":"right",size:"large",severity:"contrast",class:"w-56 rounded-3xl",onClick:s(h)},null,8,["onClick"])])):I("",!0)]),_:1}),s(p)=="finish"?(t(),c("div",Ye,[s(m)&&s(l)?(t(),c("div",Ke,[o[2]||(o[2]=_("div",{class:"text-lg font-bold flex items-center gap-2"},[_("span",{class:"text-3xl"},"🎉"),D(" Correct!")],-1)),k(r,{label:"FINISH",icon:"pi pi-arrow-right","icon-pos":"right",size:"large",class:"w-56 rounded-3xl",onClick:s(u),loading:s(a),disabled:s(a)},null,8,["onClick","loading","disabled"])])):(t(),c("div",Je,[k(r,{label:"FINISH",icon:"pi pi-arrow-right","icon-pos":"right",size:"large",class:"w-56 rounded-3xl",onClick:s(u)},null,8,["onClick"])]))])):I("",!0)],64)}}}),Qe=Ce(Xe,[["__scopeId","data-v-fdc42d8d"]]),Ze={key:0,class:"h-screen flex flex-col items-center overflow-hidden"},et={class:"fixed top-0 left-0 right-0 z-50 bg-white border-b border-gray-200 shadow-md"},tt={class:"flex justify-between items-center w-full min-h-16 px-8 gap-8"},st={class:"flex items-center gap-4"},nt={key:0,class:"flex flex-grow max-w-screen-lg items-center gap-4"},ot={class:"flex-1 overflow-y-auto mt-16 mb-24 w-full"},at={class:"w-full h-full max-w-screen-lg mx-auto px-4 md:px-28 py-8"},lt={key:1,class:"flex justify-center"},it={key:2},rt={class:"fixed bottom-0 left-0 right-0 z-50 bg-white border-t-2 border-gray-200 shadow-md"},ut={key:0,class:"h-screen flex flex-col items-center justify-center overflow-hidden gap-10"},Vt=L({__name:"LessonPage",setup(x){const e=q(),n=pe(),p=de(),a=z(),{isLessonLoading:m,selectedLesson:l,pageProgress:f,groupStatus:d}=O(a),{loadLessonById:i}=a;function h(){p.require({...ve,header:"Close lesson",message:"Are you sure you want to exit lesson. All progress will be lost!",acceptProps:{label:"Close",severity:"danger"},accept:()=>n.go(-1)})}U(()=>i(Number(e.params.id),(e.query.route_id??"").toString()));function u(v){var r;const o=((r=l.value)==null?void 0:r.pages.reduce((w,V)=>w+V.groups.length,0))||1;return v/o*100}return(v,o)=>{const r=Y,w=ne,V=R;return t(),c(E,null,[s(d)!="completed"?(t(),c("div",Ze,[_("div",et,[_("div",tt,[_("div",st,[k(r,{icon:"pi pi-times",variant:"text",severity:"contrast",onClick:h})]),s(l)?(t(),c("div",nt,[(t(!0),c(E,null,j(s(l).pages,(T,G)=>(t(),c("div",{key:G,class:"h-full",style:W({width:u(T.groups.length)+"%"})},[k(w,{value:s(f)[G]/T.groups.length*100,"show-value":!1,class:"w-full rounded-full h-3"},null,8,["value"])],4))),128))])):I("",!0),o[1]||(o[1]=_("div",{class:"w-10"},null,-1))])]),_("div",ot,[_("div",at,[s(m)?(t(),C(V,{key:0,class:"flex justify-center"})):s(l)?(t(),c("div",it,[k(Fe,{pages:s(l).pages},null,8,["pages"])])):(t(),c("div",lt,"No lesson found"))])]),_("div",rt,[k(Qe)])])):I("",!0),k(H,{"enter-active-class":"transition duration-500 ease-out","enter-from-class":"opacity-0 scale-90","enter-to-class":"opacity-100 scale-100","leave-active-class":"transition duration-300 ease-in","leave-from-class":"opacity-100 scale-100","leave-to-class":"opacity-0 scale-90"},{default:F(()=>[s(d)=="completed"?(t(),c("div",ut,[o[2]||(o[2]=_("div",{class:"text-5xl"},"⚡️",-1)),o[3]||(o[3]=_("div",{class:"flex flex-col items-center"},[_("div",{class:"text-4xl font-bold mb-8"},"Good work!"),_("div",{class:"text-md text-gray-500"},"TOTAL XP"),_("div",{class:"text-3xl font-bold"},"35")],-1)),_("div",null,[k(r,{label:"Continue",class:"rounded-full w-56 text-xl",onClick:o[0]||(o[0]=T=>s(n).go(-1))})])])):I("",!0)]),_:1})],64)}}});export{Vt as default};
