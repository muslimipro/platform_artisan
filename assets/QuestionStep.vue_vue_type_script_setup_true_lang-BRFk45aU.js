import{a as fe}from"./index-DJBdUAYa.js";import{aN as me,n as ve,p as _e,u as ge,ah as q,r as b,L as P,d as C,o as a,c,F as k,i as I,f as B,e as g,h as F,H as Z,t as $,b as w,w as ye,g as he,aM as be,aL as xe,Q as X,m as we,j as Y}from"./index-DItfq2t-.js";import{s as Se}from"./index-DEV5oRFR.js";import{_ as $e}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{s as ke}from"./index-BDW_SoxH.js";import{a as Ce,s as Ve}from"./index-gJyaKFIx.js";import{a as Ae}from"./logo-BUjeBS_g.js";import{u as Pe,i as Ie,j as Be}from"./index-pvSm_Yds.js";import{h as M}from"./index-CDeQpJAX.js";const Me={submitStep:Re,getStudentProjectStepsByID:Le,getStudentStepTranslationByID:je,resetStepsProgress:Ne,saveStudentStepStateByID:Ee};async function Le(t){try{return await M.get(`/student/project/${t}/steps`)}catch(n){throw console.log(n),n}}async function je(t,n){try{return await M.get(`/student/step/${t}/language/${n}`)}catch(r){throw console.log(r),r}}async function Ee(t,n,r){try{return await M.put(`/student/step/${t.id}/language/${n}/save`,r)}catch(i){throw console.log(i),i}}async function Re(t,n,r){try{return await M.put(`/student/step/${t}/language/${n}`,{student_answer:r})}catch(i){throw console.log(i),i}}async function Ne(t){try{return await M.delete(`/project/${t}/reset`)}catch(n){throw console.log(n),n}}async function Ue(t,n){const{data:r}=await Me.getStudentStepTranslationByID(t.id.toString(),n),i=r;return{id:t.id.toString(),title:i.name,type:t.step_type,progress:t.status,inner:i.content,answer:i.user_answer,state:i.step_state,access_type:t.access_type,accessibility:t.accessibility,skip_submit:t.skip_submit}}const Te=me("useLessonStore",()=>{const t=ve(),{locale:n}=_e(),r=ge(),i=Pe(),{newModuleToSlot:s,clearSlots:f,reset:m}=i,{slots:l,helpArrows:v,moduleComponents:_,isConnected:x,isLoading:V}=q(i),j=Ie(),{fileContent:E}=q(j),{setCode:S}=j,y=Be(),{setStdout:A,clear:Q}=y,u=b(null),d=b(null),T=b(!1),z=b(!0),R=b(!0),O=P(()=>z.value&&R.value),H=b(!1),K=b(!1),ee=P(()=>E.value);let N=0;function te(e){e!=null&&(u.value=e)}function se(e){u.value!=null&&(u.value.steps=e,d.value!=null&&D(d.value))}function ne(e){d.value=e}function oe(e){u.value==null||d.value==null||(u.value.steps[d.value].progress=e)}function le(e){u.value==null||d.value==null||d.value+1!=u.value.steps.length&&(u.value.steps[d.value+1].accessibility=e)}function re(e,p){u.value==null||d.value==null||u.value.steps[d.value].inner.options!=null&&(u.value.steps[d.value].inner.options[p].correct=e)}async function D(e){var G,J;if(u.value==null)return;d.value=e;const p=u.value.steps[d.value];if(p.title==""){T.value=!0;const h=await Ue({id:p.id,status:p.progress,step_type:p.type,skip_submit:p.skip_submit,access_type:p.access_type,accessibility:p.accessibility},n.value);u.value.steps[e]=h,T.value=!1}const o=u.value.steps[d.value];if(m(),f(),W(),S(""),Q(),K.value=!(((G=o.inner.platformActions)==null?void 0:G.includes("hide-ide"))??!1),H.value=!(((J=o.inner.platformActions)==null?void 0:J.includes("hide-sim"))??!1),o.progress=="nothing"&&u.value.is_guidable||t.name=="module"){if(o.inner.platformActions!=null&&o.inner.platformActions!=null&&o.inner.platformActions.length>0)for(const h of o.inner.platformActions){if(h=="code2ide"&&S(o.inner.starting??""),h=="auto-put"&&o.inner.highlights!=null)for(const U of o.inner.highlights)N++,s(U.module,U.slot);h=="auto-run"&&x.value&&!V.value&&(i.run(),r.add({severity:"success",summary:"Run is completed!",detail:"Code has successfully auto run",life:3e3}))}if(o.inner.userActions!=null&&o.inner.userActions!=null&&o.inner.userActions.length>0)for(const h of o.inner.userActions)h=="put-module"&&(z.value=!1,f()),h=="run-code"&&(R.value=!1)}else{if(o.state==null||o.state==null)return;if(o.state.code!=null&&o.state.code!=null&&S(o.state.code),o.state.stdout!=null&&o.state.stdout!=null&&A(o.state.stdout),o.state.slots!=null&&o.state.slots!=null)for(const[h,U]of o.state.slots.entries()){const de=String.fromCharCode(65+h);s(U,de)}}}function ie(e){u.value==null||d.value==null||(u.value.steps[d.value].state={code:e.code,stdout:e.stdout,slots:e.slots})}function ae(){if(u.value==null||d.value==null)return;const e=u.value.steps[d.value];if(m(),f(),W(),S(""),Q(),u.value.steps[d.value].state={code:"",stdout:"",slots:[]},e.inner.platformActions!=null&&e.inner.platformActions!=null&&e.inner.platformActions.length>0)for(const p of e.inner.platformActions){if(p=="code2ide"&&S(e.inner.starting??""),p=="auto-put"&&e.inner.highlights!=null)for(const o of e.inner.highlights)N++,s(o.module,o.slot);p=="auto-run"&&x.value&&!V.value&&(i.run(),r.add({severity:"success",summary:"Run is completed!",detail:"Code has successfully auto run",life:3e3}))}}function ue(e,p){if(e==="8"||e==="9")v.value[e].style={color:"rgba(0, 157, 255)"},v.value[e].visible=!0;else{const o=(e??"A").charCodeAt(0)-65;l.value[o].style={backgroundColor:"rgba(0, 157, 255, 0.26)",boxShadow:"0 0 15px rgb(0, 157, 255)"}}_.value.forEach(o=>{if(o.type==p){o.style={animation:"breathing 1s ease-out infinite normal",boxShadow:"0 0 15px rgb(0, 157, 255)",borderRadius:"10px"};return}})}function W(){for(let e=0;e<=5;e++)l.value[e].class="",l.value[e].style={};for(const e of _.value)e.class="",e.style={};for(const e in v.value){const p=v.value[e];p.visible=!1,p.style={},p.class=""}}function ce(){R.value=!0}function pe(e,p){N<=0?e===p?r.add({severity:"success",summary:"Correct, good job!",detail:"Module has been put successfully",life:3e3}):r.add({severity:"error",summary:"Wrong!",detail:"Keep trying",life:3e3}):N--}return{lesson:u,stepIndex:d,stepLoading:T,userCode:ee,submitEnabled:O,modulesWerePut:z,codeWasRun:R,simVisible:H,ideVisible:K,setLesson:te,setSteps:se,setStepIndex:ne,updateStatus:oe,updateAccess:le,changeStep:D,runCodePressed:ce,saveOption:re,lightUp:ue,clearSlotsModulesClasses:W,toastModulePut:pe,saveStepStateLocally:ie,restartStep:ae}});async function gt(t,n,r){const{data:i}=await fe.getStepTranslationByID(t.id.toString(),n),s=i;return{id:t.id.toString(),title:s.name,type:t.step_type,progress:"nothing",inner:r||s.content.contents==null?{contents:[],modules:[]}:s.content,access_type:t.access_type,skip_submit:t.skip_submit}}const ze={class:"flex flex-col gap-2"},We={key:1},qe={key:0,style:{position:"relative",width:"100%",height:"0","padding-bottom":"56.25%"}},Fe=["src"],Qe={key:1,style:{position:"relative","margin-left":"5%",width:"90%",height:"0","padding-bottom":"160%"}},He=["src"],L=C({__name:"ContentsView",props:{contents:{}},setup(t){const n=t;function r(i){return i.replace("shorts","embed")}return(i,s)=>{const f=Z("v-md-preview"),m=Ae;return a(),c("div",ze,[(a(!0),c(k,null,I(n.contents,l=>{var v;return a(),c("div",{key:l.id},[l.type=="text"?(a(),B(f,{key:0,text:l.text},null,8,["text"])):l.type=="video"?(a(),c("div",We,[(v=l.text)!=null&&v.includes("embed")?(a(),c("div",qe,[g("iframe",{credentialless:"",src:r(l.text),style:{position:"absolute",top:"0",left:"0",width:"100%",height:"100%"},frameborder:"0",allowfullscreen:"",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",referrerpolicy:"strict-origin-when-cross-origin"},null,8,Fe),s[0]||(s[0]=g("iframe",null,null,-1))])):(a(),c("div",Qe,[g("iframe",{credentialless:"",src:r(l.text??""),style:{position:"absolute",top:"0",left:"0",width:"100%",height:"100%"},frameborder:"0",allowfullscreen:"",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",referrerpolicy:"strict-origin-when-cross-origin"},null,8,He)]))])):l.type=="image"?(a(),B(m,{key:2,src:l.src,alt:"Image",class:"rounded-xl object-cover h-64"},null,8,["src"])):F("",!0)])}),128))])}}}),Ke={class:"text-[33px] font-semibold mb-4 text-center border-b pb-2"},yt=C({__name:"ArticleStep",props:{step:{},isPreview:{type:Boolean}},setup(t){const n=t;return(r,i)=>(a(),c(k,null,[g("div",Ke,$(n.step.title),1),w(L,{contents:n.step.inner.contents},null,8,["contents"])],64))}}),De={class:"text-[33px] font-semibold mb-4 text-center border-b pb-2"},ht=C({__name:"CodeStep",props:{step:{},isPreview:{type:Boolean}},setup(t){const n=t;return(r,i)=>(a(),c(k,null,[g("div",De,$(n.step.title),1),w(L,{contents:n.step.inner.contents},null,8,["contents"])],64))}}),Ge={class:"flex flex-col gap-4"},Je={class:"text-[33px] font-semibold mb-4 text-center border-b pb-2"},Xe={class:"flex w-full justify-between"},Ye={class:"flex flex-col gap-2"},Ze={class:"w-40 mb-[29px] border rounded-lg h-[40px] place-items-center bg-white",draggable:"true"},Oe={class:"content-center h-full"},et={class:"flex flex-col gap-2"},tt=C({__name:"MatchStep",props:{step:{},isPreview:{type:Boolean}},setup(t){const n=t,r=P(()=>{var s;return(s=n.step.inner.pairs)==null?void 0:s.map(f=>f.key)}),i=P(()=>{var s;return(s=n.step.inner.pairs)==null?void 0:s.map(f=>f.value)});return(s,f)=>{const m=Se;return a(),c("div",Ge,[g("div",Je,$(n.step.title),1),w(L,{contents:n.step.inner.contents},null,8,["contents"]),g("div",Xe,[g("div",Ye,[(a(!0),c(k,null,I(r.value,l=>(a(),c("div",{key:l,class:"flex flex-col"},[g("div",Ze,[g("div",Oe,$(l),1)])]))),128))]),g("div",et,[(a(!0),c(k,null,I(i.value,l=>(a(),c("div",{key:l,class:"flex flex-col"},[f[0]||(f[0]=g("div",{class:"w-40 h-10 border-dashed border-gray-300 rounded-border border-x border-y"},null,-1)),w(m,{size:"small",severity:"warn",variant:"simple",class:"mb-2"},{default:ye(()=>[he($(l.length>0?l:"..."),1)]),_:2},1024)]))),128))])])])}}}),bt=$e(tt,[["__scopeId","data-v-265024ce"]]),st={class:"flex flex-col gap-4"},nt={class:"text-[33px] font-semibold mb-4 text-center border-b pb-2"},xt=C({__name:"OpenStep",props:be({step:{},isPreview:{type:Boolean}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(t){const n=xe(t,"modelValue"),r=t,i=b(null);return(s,f)=>{const m=ke;return a(),c("div",st,[g("div",nt,$(r.step.title),1),w(L,{contents:r.step.inner.contents},null,8,["contents"]),r.isPreview?(a(),B(m,{key:0,type:"text",modelValue:i.value,"onUpdate:modelValue":f[0]||(f[0]=l=>i.value=l),size:"small",placeholder:"Enter your answer"},null,8,["modelValue"])):(a(),B(m,{key:1,type:"text",modelValue:n.value,"onUpdate:modelValue":f[1]||(f[1]=l=>n.value=l),size:"small",placeholder:"Enter your answer"},null,8,["modelValue"]))])}}}),ot={class:"flex flex-col gap-4"},lt={key:0,class:"text-[33px] font-semibold mb-4 text-center border-b pb-2"},rt={key:2,class:"flex flex-col gap-4 ml-4"},it={key:3,class:"flex flex-col gap-4 ml-4"},wt=C({__name:"QuestionStep",props:{step:{},isPreview:{type:Boolean}},setup(t){const n=Te(),{lesson:r}=q(n),{saveOption:i}=n,s=t,f=P(()=>s.step.inner.single),m=b(null),l=b([]);return X([l],()=>{if(!s.isPreview&&s.step.inner.options!=null&&!s.step.inner.single)for(const[v,_]of s.step.inner.options.entries())i(l.value.some(x=>x==_.text),v)}),X([m],()=>{if(!s.isPreview&&s.step.inner.options!=null&&s.step.inner.single)for(const[v,_]of s.step.inner.options.entries())i(m.value==_.text,v)}),we(()=>{var v;if(!s.isPreview&&s.step.inner.options!=null&&(m.value=null,l.value=[],(v=r.value)!=null&&v.is_guidable&&s.step.answer.question))for(const[_,x]of s.step.inner.options.entries())s.step.answer.question[_]&&(l.value.push(x.text),m.value=x.text)}),(v,_)=>{var E,S;const x=Ce,V=Z("v-md-preview"),j=Ve;return a(),c("div",ot,[(E=Y(r))!=null&&E.is_guidable?(a(),c("div",lt,$(s.step.title),1)):F("",!0),(S=Y(r))!=null&&S.is_guidable?(a(),B(L,{key:1,contents:s.step.inner.contents},null,8,["contents"])):F("",!0),f.value?(a(),c("div",rt,[(a(!0),c(k,null,I(s.step.inner.options,y=>(a(),c("div",{key:y.id,class:"flex gap-2"},[w(x,{modelValue:m.value,"onUpdate:modelValue":_[0]||(_[0]=A=>m.value=A),inputId:y.id,name:"dynamic",value:y.text,class:"mt-1"},null,8,["modelValue","inputId","value"]),w(V,{text:y.text},null,8,["text"])]))),128))])):(a(),c("div",it,[(a(!0),c(k,null,I(s.step.inner.options,y=>(a(),c("div",{key:y.id,class:"flex gap-2"},[w(j,{modelValue:l.value,"onUpdate:modelValue":_[1]||(_[1]=A=>l.value=A),inputId:y.id,name:"option",value:y.text,class:"mt-1"},null,8,["modelValue","inputId","value"]),w(V,{text:y.text},null,8,["text"])]))),128))]))])}}});export{bt as M,yt as _,Me as a,gt as b,ht as c,xt as d,wt as e,Ue as t,Te as u};
