import{a as ue}from"./index-CD2e-UIx.js";import{a6 as ce,n as pe,u as de,A as fe,r as g,I as V,d as k,o as i,c as p,F as S,i as C,f as R,e as _,h as me,q as Q,t as w,b,w as ve,g as _e,a5 as ye,a3 as he,H as K,m as ge}from"./index-DcyBeJgC.js";import{s as be}from"./index-gHHiHdoU.js";import{_ as xe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{s as we}from"./index-dDCPORGv.js";import{s as Se}from"./index-N8YLxu86.js";import{s as $e}from"./index-CCrQOVR9.js";import{s as ke}from"./logo-Cr9YRutO.js";import{u as Ae,a as Ve,b as Ce}from"./pibody-DqOzv7Z7.js";import{h as P}from"./index-seXcSKnd.js";const Pe={submitStep:Ee,getStudentProjectStepsByID:Ie,getStudentStepTranslationByID:Be,resetStepsProgress:Le,saveStudentStepStateByID:Me};async function Ie(s){try{return await P.get(`/student/project/${s}/steps`)}catch(t){throw console.log(t),t}}async function Be(s){try{return await P.get(`/student/step/${s}`)}catch(t){throw console.log(t),t}}async function Me(s,t){try{return await P.put(`/student/step/${s.id}/save`,t)}catch(r){throw console.log(r),r}}async function Ee(s,t){try{return await P.put(`/student/step/${s}/submit`,{student_answer:t})}catch(r){throw console.log(r),r}}async function Le(s){try{return await P.delete(`/project/${s}/reset`)}catch(t){throw console.log(t),t}}async function Re(s){const{data:t}=await Pe.getStudentStepTranslationByID(s.id.toString()),r=t;return{id:s.id.toString(),title:r.name,type:s.step_type,progress:s.status,inner:r.content,answer:r.user_answer,state:r.step_state,access_type:s.access_type,accessibility:s.accessibility,skip_submit:s.skip_submit}}const je=ce("useLessonStore",()=>{const s=pe(),t=de(),r=Ce(),{newModuleToSlot:n,clearSlots:v,reset:a,slots:f,helpArrows:l,moduleComponents:m,isConnected:$,isLoading:A}=r,B=Ae(),{fileContent:y}=fe(B),{setCode:x}=B,D=Ve(),{setStdout:G,clear:T}=D,u=g(null),d=g(null),j=g(!1),U=g(!0),M=g(!0),J=V(()=>U.value&&M.value),q=g(!1),z=g(!1),X=V(()=>y.value);let E=0;function Y(e){e!=null&&(u.value=e)}function Z(e){u.value!=null&&(u.value.steps=e,d.value!=null&&W(d.value))}function O(e){d.value=e}function ee(e){u.value==null||d.value==null||(u.value.steps[d.value].progress=e)}function te(e){u.value==null||d.value==null||d.value+1!=u.value.steps.length&&(u.value.steps[d.value+1].accessibility=e)}function se(e,c){u.value==null||d.value==null||u.value.steps[d.value].inner.options!=null&&(u.value.steps[d.value].inner.options[c].correct=e)}async function W(e){var F,H;if(u.value==null)return;d.value=e;const c=u.value.steps[d.value];if(c.title==""){j.value=!0;const h=await Re({id:c.id,status:c.progress,step_type:c.type,skip_submit:c.skip_submit,access_type:c.access_type,accessibility:c.accessibility});u.value.steps[e]=h,j.value=!1}const o=u.value.steps[d.value];if(a(),v(),N(),x(""),T(),z.value=!(((F=o.inner.platformActions)==null?void 0:F.includes("hide-ide"))??!1),q.value=!(((H=o.inner.platformActions)==null?void 0:H.includes("hide-sim"))??!1),o.progress=="nothing"||s.name=="module"){if(o.inner.platformActions!=null&&o.inner.platformActions!=null&&o.inner.platformActions.length>0)for(const h of o.inner.platformActions){if(h=="code2ide"&&x(o.inner.starting??""),h=="auto-put"&&o.inner.highlights!=null)for(const L of o.inner.highlights)E++,n(L.module,L.slot);h=="auto-run"&&$.value&&!A.value&&(r.run(),t.add({severity:"success",summary:"Run is completed!",detail:"Code has successfully auto run",life:3e3}))}if(o.inner.userActions!=null&&o.inner.userActions!=null&&o.inner.userActions.length>0)for(const h of o.inner.userActions)h=="put-module"&&(U.value=!1,v()),h=="run-code"&&(M.value=!1)}else{if(o.state==null||o.state==null)return;if(o.state.code!=null&&o.state.code!=null&&x(o.state.code),o.state.stdout!=null&&o.state.stdout!=null&&G(o.state.stdout),o.state.slots!=null&&o.state.slots!=null)for(const[h,L]of o.state.slots.entries()){const ae=r.slots[h].id;n(L,ae)}}}function ne(e){u.value==null||d.value==null||(u.value.steps[d.value].state={code:e.code,stdout:e.stdout,slots:e.slots})}function oe(){if(u.value==null||d.value==null)return;const e=u.value.steps[d.value];if(a(),v(),N(),x(""),T(),u.value.steps[d.value].state={code:"",stdout:"",slots:[]},e.inner.platformActions!=null&&e.inner.platformActions!=null&&e.inner.platformActions.length>0)for(const c of e.inner.platformActions){if(c=="code2ide"&&x(e.inner.starting??""),c=="auto-put"&&e.inner.highlights!=null)for(const o of e.inner.highlights)E++,n(o.module,o.slot);c=="auto-run"&&$.value&&!A.value&&(r.run(),t.add({severity:"success",summary:"Run is completed!",detail:"Code has successfully auto run",life:3e3}))}}function le(e,c){if(e==="8"||e==="9")l[e].style={color:"rgba(0, 157, 255)"},l[e].visible=!0;else{const o=(e??"A").charCodeAt(0)-65;f[o].style={backgroundColor:"rgba(0, 157, 255, 0.26)",boxShadow:"0 0 15px rgb(0, 157, 255)"}}m.forEach(o=>{if(o.type==c){o.style={animation:"breathing 1s ease-out infinite normal",boxShadow:"0 0 15px rgb(0, 157, 255)",borderRadius:"10px"};return}})}function N(){for(let e=0;e<=5;e++)f[e].class="",f[e].style={};for(const e of m)e.class="",e.style={};for(const e in l){const c=l[e];c.visible=!1,c.style={},c.class=""}}function re(){M.value=!0}function ie(e,c){E<=0?e===c?t.add({severity:"success",summary:"Correct, good job!",detail:"Module has been put successfully",life:3e3}):t.add({severity:"error",summary:"Wrong!",detail:"Keep trying",life:3e3}):E--}return{lesson:u,stepIndex:d,stepLoading:j,userCode:X,submitEnabled:J,modulesWerePut:U,codeWasRun:M,simVisible:q,ideVisible:z,setLesson:Y,setSteps:Z,setStepIndex:O,updateStatus:ee,updateAccess:te,changeStep:W,runCodePressed:re,saveOption:se,lightUp:le,clearSlotsModulesClasses:N,toastModulePut:ie,saveStepStateLocally:ne,restartStep:oe}});async function vt(s,t){const{data:r}=await ue.getStepTranslationByID(s.id.toString()),n=r;return{id:s.id.toString(),title:n.name,type:s.step_type,progress:"nothing",inner:t||n.content.contents==null?{contents:[],modules:[]}:n.content,access_type:s.access_type,skip_submit:s.skip_submit}}const Ue={class:"flex flex-col gap-2"},Ne={key:1},Te={key:0,style:{position:"relative",width:"100%",height:"0","padding-bottom":"56.25%"}},qe=["src"],ze={key:1,style:{position:"relative","margin-left":"5%",width:"90%",height:"0","padding-bottom":"160%"}},We=["src"],I=k({__name:"ContentsView",props:{contents:{}},setup(s){const t=s;function r(n){return n.replace("shorts","embed")}return(n,v)=>{const a=Q("v-md-preview"),f=ke;return i(),p("div",Ue,[(i(!0),p(S,null,C(t.contents,l=>{var m;return i(),p("div",{key:l.id},[l.type=="text"?(i(),R(a,{key:0,text:l.text},null,8,["text"])):l.type=="video"?(i(),p("div",Ne,[(m=l.text)!=null&&m.includes("embed")?(i(),p("div",Te,[_("iframe",{credentialless:"",src:r(l.text),style:{position:"absolute",top:"0",left:"0",width:"100%",height:"100%"},frameborder:"0",allowfullscreen:"",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",referrerpolicy:"strict-origin-when-cross-origin"},null,8,qe),v[0]||(v[0]=_("iframe",null,null,-1))])):(i(),p("div",ze,[_("iframe",{credentialless:"",src:r(l.text??""),style:{position:"absolute",top:"0",left:"0",width:"100%",height:"100%"},frameborder:"0",allowfullscreen:"",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",referrerpolicy:"strict-origin-when-cross-origin"},null,8,We)]))])):l.type=="image"?(i(),R(f,{key:2,src:l.src,alt:"Image",class:"rounded-xl object-cover h-64"},null,8,["src"])):me("",!0)])}),128))])}}}),Fe={class:"text-[33px] font-semibold mb-4 text-center border-b pb-2"},_t=k({__name:"ArticleStep",props:{step:{},isPreview:{type:Boolean}},setup(s){const t=s;return(r,n)=>(i(),p(S,null,[_("div",Fe,w(t.step.title),1),b(I,{contents:t.step.inner.contents},null,8,["contents"])],64))}}),He={class:"text-[33px] font-semibold mb-4 text-center border-b pb-2"},yt=k({__name:"CodeStep",props:{step:{},isPreview:{type:Boolean}},setup(s){const t=s;return(r,n)=>(i(),p(S,null,[_("div",He,w(t.step.title),1),b(I,{contents:t.step.inner.contents},null,8,["contents"])],64))}}),Ke={class:"flex flex-col gap-4"},Qe={class:"text-[33px] font-semibold mb-4 text-center border-b pb-2"},De={class:"flex w-full justify-between"},Ge={class:"flex flex-col gap-2"},Je={class:"w-40 mb-[29px] border rounded-lg h-[40px] place-items-center bg-white",draggable:"true"},Xe={class:"content-center h-full"},Ye={class:"flex flex-col gap-2"},Ze=k({__name:"MatchStep",props:{step:{},isPreview:{type:Boolean}},setup(s){const t=s,r=V(()=>{var v;return(v=t.step.inner.pairs)==null?void 0:v.map(a=>a.key)}),n=V(()=>{var v;return(v=t.step.inner.pairs)==null?void 0:v.map(a=>a.value)});return(v,a)=>{const f=be;return i(),p("div",Ke,[_("div",Qe,w(t.step.title),1),b(I,{contents:t.step.inner.contents},null,8,["contents"]),_("div",De,[_("div",Ge,[(i(!0),p(S,null,C(r.value,l=>(i(),p("div",{key:l,class:"flex flex-col"},[_("div",Je,[_("div",Xe,w(l),1)])]))),128))]),_("div",Ye,[(i(!0),p(S,null,C(n.value,l=>(i(),p("div",{key:l,class:"flex flex-col"},[a[0]||(a[0]=_("div",{class:"w-40 h-10 border-dashed border-gray-300 rounded-border border-x border-y"},null,-1)),b(f,{size:"small",severity:"warn",variant:"simple",class:"mb-2"},{default:ve(()=>[_e(w(l.length>0?l:"..."),1)]),_:2},1024)]))),128))])])])}}}),ht=xe(Ze,[["__scopeId","data-v-265024ce"]]),Oe={class:"flex flex-col gap-4"},et={class:"text-[33px] font-semibold mb-4 text-center border-b pb-2"},gt=k({__name:"OpenStep",props:ye({step:{},isPreview:{type:Boolean}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(s){const t=he(s,"modelValue"),r=s,n=g(null);return(v,a)=>{const f=we;return i(),p("div",Oe,[_("div",et,w(r.step.title),1),b(I,{contents:r.step.inner.contents},null,8,["contents"]),r.isPreview?(i(),R(f,{key:0,type:"text",modelValue:n.value,"onUpdate:modelValue":a[0]||(a[0]=l=>n.value=l),size:"small",placeholder:"Enter your answer"},null,8,["modelValue"])):(i(),R(f,{key:1,type:"text",modelValue:t.value,"onUpdate:modelValue":a[1]||(a[1]=l=>t.value=l),size:"small",placeholder:"Enter your answer"},null,8,["modelValue"]))])}}}),tt={class:"flex flex-col gap-4"},st={class:"text-[33px] font-semibold mb-4 text-center border-b pb-2"},nt={key:0,class:"flex flex-col gap-4 ml-4"},ot={key:1,class:"flex flex-col gap-4 ml-4"},bt=k({__name:"QuestionStep",props:{step:{},isPreview:{type:Boolean}},setup(s){const t=je(),{saveOption:r}=t,n=s,v=V(()=>n.step.inner.single),a=g(null),f=g([]);return K([f],()=>{if(!n.isPreview&&n.step.inner.options!=null&&!n.step.inner.single)for(const[l,m]of n.step.inner.options.entries())r(f.value.some($=>$==m.text),l)}),K([a],()=>{if(!n.isPreview&&n.step.inner.options!=null&&n.step.inner.single)for(const[l,m]of n.step.inner.options.entries())r(a.value==m.text,l)}),ge(()=>{if(!n.isPreview&&n.step.inner.options!=null&&(a.value=null,f.value=[],n.step.answer.question))for(const[l,m]of n.step.inner.options.entries())n.step.answer.question[l]&&(f.value.push(m.text),a.value=m.text)}),(l,m)=>{const $=$e,A=Q("v-md-preview"),B=Se;return i(),p("div",tt,[_("div",st,w(n.step.title),1),b(I,{contents:n.step.inner.contents},null,8,["contents"]),v.value?(i(),p("div",nt,[(i(!0),p(S,null,C(n.step.inner.options,y=>(i(),p("div",{key:y.id,class:"flex gap-2"},[b($,{modelValue:a.value,"onUpdate:modelValue":m[0]||(m[0]=x=>a.value=x),inputId:y.id,name:"dynamic",value:y.text,class:"mt-1"},null,8,["modelValue","inputId","value"]),b(A,{text:y.text},null,8,["text"])]))),128))])):(i(),p("div",ot,[(i(!0),p(S,null,C(n.step.inner.options,y=>(i(),p("div",{key:y.id,class:"flex gap-2"},[b(B,{modelValue:f.value,"onUpdate:modelValue":m[1]||(m[1]=x=>f.value=x),inputId:y.id,name:"option",value:y.text,class:"mt-1"},null,8,["modelValue","inputId","value"]),b(A,{text:y.text},null,8,["text"])]))),128))]))])}}});export{ht as M,_t as _,Pe as a,vt as b,yt as c,gt as d,bt as e,Re as t,je as u};
