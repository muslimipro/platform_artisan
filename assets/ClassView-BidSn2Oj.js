import{T as se}from"./index-C4uQBDlA.js";import{s as ae}from"./index-bzgAK5Mg.js";import{d as re,u as le,z as oe,G as ne,r as d,I as ie,m as ce,o as r,f,w as a,c as u,t as l,e as o,b as s,g as m,F as b,i as C,h as z,L as ue,C as P,j as de,n as pe,k as fe,aF as me,s as ge,M as he}from"./index-CvXDlvni.js";import{s as ve,a as _e}from"./index-yNNRFSWc.js";import{s as ye}from"./index-BKSVg22X.js";import{s as be,a as $e}from"./index-BWHE24M0.js";import{s as xe}from"./index-CBf9SASP.js";import{s as we}from"./index-0lIf6O9I.js";import{a as Ce,s as ze}from"./index-BtOIGHPq.js";import{s as Fe}from"./index-uzz1oX1u.js";import{s as ke}from"./index-Cv4Foupa.js";import{T}from"./teacherApi-CIZSjg08.js";import{u as je}from"./useTeacherStore-DDKqpXC8.js";import{a as Te}from"./index-BFFggUiy.js";import"./index-CwAQA0fP.js";import"./index-Cq3sBVi5.js";import"./index-B3J6cNgh.js";import"./index-CRYd2dgD.js";import"./index-dYV8A7MW.js";import"./index-D3suYYug.js";import"./index-C2klbU81.js";import"./index-Cx2Z2ntV.js";const Se={key:1},Ne={key:2,class:"flex flex-col items-start px-8 pb-4 gap-4"},Ve={class:"flex items-center justify-between gap-2 w-full"},De={class:"flex flex-col gap-2"},Ie={class:"text-3xl"},Pe={class:"text-sm"},Me={class:"flex items-center self-end"},Be={class:"text-xl"},Re={class:"text-gray-500"},Ae={class:"flex items-center"},Ge={class:"flex-grow flex gap-2 items-center"},Le={class:"text-xl text-gray-500"},Ue={class:"w-4 h-4 rounded-md text-[10px] font-semibold flex justify-center items-center bg-gray-300"},Oe={class:"flex flex-col"},qe={class:"text-[10px] text-gray-500"},Ee={class:"flex justify-center text-[124px]"},ht=re({__name:"ClassView",setup(He){const S=le(),M=oe(),F=pe(),N=fe(),{t:g}=ne(),B=d(),v=d();(()=>{v.value={global:{value:null,matchMode:me.CONTAINS}}})();const R=je(),{loadClasses:A}=R,h=d(null),V=d([]),$=d([]),x=d(!1),w=d(!1),k=d(!1);async function G(){if(!x.value){x.value=!0;try{const{data:e}=await T.getClass(Number(F.params.id));h.value=e??null}catch(e){console.log(e)}finally{x.value=!1}}}async function L(){if(!w.value){w.value=!0;try{const{data:e}=await T.getClassStudents(Number(F.params.id));V.value=e??null}catch(e){console.log(e)}finally{w.value=!1}}}async function U(){try{const{data:e}=await Te.getProjects();$.value=e}catch(e){console.log(e)}}const O=["secondary","success","info","warn","danger","contrast"],D=ie(()=>{const e={};for(const n of $.value){let p=n.layer;p==0&&(p=999);const _=n.is_guidable?"learn":"practice";e[p]||(e[p]={learn:0,practice:0}),e[p][_]++}return e});ce(()=>{G(),U(),L()});function q(){M.require({message:g("pages.teacher.areYouSureDeleteClass"),header:g("pages.teacher.confirmation"),icon:"pi pi-exclamation-triangle",rejectProps:{label:g("pages.teacher.cancel"),severity:"secondary",outlined:!0},acceptProps:{label:g("pages.teacher.delete"),severity:"danger"},accept:()=>{E(Number(F.params.id))}})}async function E(e){try{await T.deleteClass(e),await A(),N.go(-1),S.add({severity:"success",summary:g("pages.teacher.classRemoved"),life:2e3})}catch(n){S.add({severity:"error",summary:g("pages.teacher.removeClassFailed"),detail:n,life:2e3})}}return(e,n)=>{const p=ke,_=ge,H=Ce,K=Fe,Y=ze,i=ve,J=we,j=be,I=xe,Q=$e,W=ye,X=_e,Z=he,ee=ae,te=se;return r(),f(ee,{class:"flex-grow flex flex-col gap-2"},{default:a(()=>[x.value?(r(),f(p,{key:0,class:"flex justify-center"})):h.value?(r(),u("div",Ne,[o("div",Ve,[o("div",De,[o("div",Ie,l(h.value.name),1),o("div",Pe,l(e.$t("pages.teacher.since"))+" "+l(h.value.created_time.split("T")[0]),1)]),s(_,{icon:"pi pi-hashtag",label:e.$t("pages.teacher.classCode"),severity:"info",onClick:n[0]||(n[0]=t=>k.value=!0)},null,8,["label"])]),o("div",Me,[o("div",Be,[o("span",Re,l(e.$t("pages.teacher.teacher")),1),m(" "+l(h.value.creator_name),1)])]),s(X,{ref_key:"dt",ref:B,filters:v.value,"onUpdate:filters":n[2]||(n[2]=t=>v.value=t),value:V.value,dataKey:"id",loading:w.value,scrollable:"",globalFilterFields:["name","email"],class:"overflow-hidden w-full",paginator:"",rows:25,rowsPerPageOptions:[5,10,25],groupHeader:!0,showGridlines:""},{header:a(()=>[o("div",Ae,[o("div",Ge,[o("div",Le,l(e.$t("pages.teacher.students")),1)]),s(Y,null,{default:a(()=>[s(H,null,{default:a(()=>n[4]||(n[4]=[o("i",{class:"pi pi-search"},null,-1)])),_:1}),s(K,{modelValue:v.value.global.value,"onUpdate:modelValue":n[1]||(n[1]=t=>v.value.global.value=t),placeholder:e.$t("pages.teacher.search")},null,8,["modelValue","placeholder"])]),_:1})])]),empty:a(()=>[m(l(e.$t("pages.teacher.noStudentsFound")),1)]),loading:a(()=>[m(l(e.$t("pages.teacher.loadingStudents")),1)]),default:a(()=>[s(Q,{type:"header"},{default:a(()=>[s(j,null,{default:a(()=>[s(i,{header:e.$t("pages.teacher.projects"),rowspan:2,colspan:2,frozen:!0,alignFrozen:"left"},null,8,["header"]),(r(!0),u(b,null,C(D.value,(t,c)=>(r(),f(i,{key:c,colspan:t.learn+t.practice},{header:a(()=>[s(J,{class:"w-full text-md px-2",severity:c==999?"secondary":O[c]},{default:a(()=>[m(l(c==999?e.$t("pages.teacher.other"):`${e.$t("pages.teacher.level")} ${c}`),1)]),_:2},1032,["severity"])]),_:2},1032,["colspan"]))),128)),s(i,{header:"",rowspan:2,colspan:2,frozen:!0,alignFrozen:"right"})]),_:1}),s(j,null,{default:a(()=>[(r(!0),u(b,null,C(D.value,(t,c)=>(r(),u(b,{key:c},[t.learn>0?(r(),f(i,{key:0,colspan:t.learn},{header:a(()=>[s(I,{class:"w-full flex justify-center",size:"small",severity:"success"},{default:a(()=>[m(l(e.$t("pages.projects.learn")),1)]),_:1})]),_:2},1032,["colspan"])):z("",!0),t.practice>0?(r(),f(i,{key:1,colspan:t.practice},{header:a(()=>[s(I,{class:"w-full flex justify-center",size:"small",severity:"info"},{default:a(()=>[m(l(e.$t("pages.projects.practice")),1)]),_:1})]),_:2},1032,["colspan"])):z("",!0)],64))),128))]),_:1}),s(j,null,{default:a(()=>[s(i,{header:e.$t("pages.teacher.avatar"),frozen:!0,alignFrozen:"left"},null,8,["header"]),s(i,{header:e.$t("pages.teacher.name"),frozen:!0,alignFrozen:"left",sortable:"",field:"name"},null,8,["header"]),(r(!0),u(b,null,C($.value,(t,c)=>(r(),f(i,{key:t.id,field:t.id},{header:a(()=>[ue((r(),u("div",Ue,[m(l(c+1),1)])),[[te,{value:t.name.toString()},void 0,{top:!0}]])]),body:a(({data:y})=>[y.projects[c].student_progress>0?(r(),u("div",{key:0,class:P(["w-4 h-4 mx-4 rounded-full text-[10px] flex justify-center items-center text-white",y.projects[c].student_progress==100?"bg-green-400":"bg-orange-400"])},null,2)):z("",!0)]),_:2},1032,["field"]))),128)),s(i,{header:e.$t("pages.teacher.xp"),frozen:!0,alignFrozen:"right",sortable:"",field:"xp"},null,8,["header"]),s(i,{header:"",frozen:!0,alignFrozen:"right"})]),_:1})]),_:1}),s(i,{field:"small_avatar_url",header:e.$t("pages.teacher.avatar"),sortable:"",frozen:!0,alignFrozen:"left"},{body:a(({data:t})=>[s(W,{image:t.small_avatar_url},null,8,["image"])]),_:1},8,["header"]),s(i,{field:"name",header:e.$t("pages.teacher.name"),sortable:"",frozen:!0,alignFrozen:"left"},{body:a(({data:t})=>[o("div",Oe,[o("div",null,l(`${t.name.length>0?t.name:t.email}`),1),o("div",qe,l(`Last visited: ${t.last_activity_time.split("T")[0]}`),1)])]),_:1},8,["header"]),(r(!0),u(b,null,C($.value,(t,c)=>(r(),f(i,{key:t.id,field:t.id},{body:a(({data:y})=>[y.projects[c].student_progress>0?(r(),u("div",{key:0,class:P(["w-4 h-4 rounded-full text-[10px] flex justify-center items-center text-white",y.projects[c].student_progress==100?"bg-green-400":"bg-orange-400"])},null,2)):z("",!0)]),_:2},1032,["field"]))),128)),s(i,{field:"xp",header:e.$t("pages.teacher.xp"),sortable:"",frozen:!0,alignFrozen:"right"},{body:a(({data:t})=>[o("div",null,l(`${t.xp}xp`),1)]),_:1},8,["header"]),s(i,{exportable:!1,frozen:!0,alignFrozen:"right"},{body:a(({data:t})=>[s(_,{icon:"pi pi-angle-right",outlined:"",rounded:"",severity:"info",onClick:c=>de(N).push({name:"teacher-student",params:{id:t.id}})},null,8,["onClick"])]),_:1})]),_:1},8,["filters","value","loading"]),s(_,{icon:"pi pi-trash",label:e.$t("pages.teacher.removeClass"),severity:"danger",onClick:q,class:"self-end"},null,8,["label"])])):(r(),u("div",Se,l(e.$t("pages.teacher.noData")),1)),s(Z,{visible:k.value,"onUpdate:visible":n[3]||(n[3]=t=>k.value=t),modal:"",header:e.$t("pages.teacher.classCode")},{default:a(()=>{var t;return[o("div",Ee,l((t=h.value)==null?void 0:t.code),1)]}),_:1},8,["visible","header"])]),_:1})}}});export{ht as default};
