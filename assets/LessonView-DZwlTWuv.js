import{s as G,S as Q,_ as X,T as Y,a as Z}from"./SimulationView-DoOuK75G.js";import{u as N,a as ee,t as te}from"./store-DTWq21S1.js";import{d as R,ak as T,g as se,al as F,a as A,aj as D,r as L,D as H,J,o as s,c as w,e as v,b as o,f as t,h as r,F as K,k as ae,w as x,n as ne,t as M,s as O,R as oe,u as le,C as ie,j as z,q as re}from"./index-CXOwPGdy.js";import{s as ce}from"./index-BGV9MnCK.js";import{s as ue,a as pe,t as de}from"./types-BmPXa5Uu.js";import{L as fe,s as me}from"./logo-2b8tI7rb.js";import{_ as ve}from"./LocaleSwitcher.vue_vue_type_script_setup_true_lang-n4cL8gx1.js";import{_ as _e,a as ye,M as ge,b as he,c as we}from"./QuestionStep.vue_vue_type_script_setup_true_lang-BXCP7I1K.js";import{h as be}from"./http-OZ8xEx_I.js";import"./pibody-B70zHXNr.js";import"./index-CBT3LGg4.js";const ke={class:"mx-auto flex items-center justify-between p-2 px-6 w-full bg-white"},xe={class:"flex flex-1 items-center"},Se={key:1,class:"flex items-center gap-1"},$e={class:"flex items-center gap-1"},ze={class:"flex flex-1 justify-end items-center gap-2"},je={class:"relative overflow-hidden w-full border-0 bg-transparent flex items-start p-2 pl-4 rounded-none cursor-pointer transition-colors duration-200"},Ce={class:"inline-flex flex-col items-start"},Pe={class:"font-bold"},Le={class:"text-sm"},Ie=R({__name:"LessonHeader",setup(B){const{locale:_}=T(),g=se(),S=F(),y=A(),{user:c}=D(y),u=N(),{lesson:n,stepIndex:b,stepLoading:p}=D(u),{changeStep:e,setSteps:q}=u,j=L(!1),C=L(0);function V(a){switch(a){case"article":return"pi pi-align-left";case"code":return"pi pi-code";case"question":return"pi pi-question";case"matching":return"pi pi-arrows-h";case"open":return"pi pi-pencil";default:return"pi pi-align-left"}}async function i(){if(!j.value){j.value=!0;try{const{data:a}=await ee.getProjectStepsByID(S.params.id.toString()),l=[];for(const[m,h]of a.entries())if(m==0){const I=await te(h,_.value,!1);l.push(I)}else{const I={id:h.id.toString(),title:"",type:h.step_type,progress:"nothing",inner:{contents:[]}};l.push(I)}q(l);for(let m=0;m<l.length;m++)if(l[m].progress=="completed"){C.value=m+1;break}}catch(a){alert(a)}finally{j.value=!1}}}H(i),J(_,i,{immediate:!1});const d=L(),f=L([{label:"Log out",icon:"pi pi-sign-out",command:()=>{y.logout(),g.replace({name:"login"})}}]),k=a=>{d.value.toggle(a)};return(a,l)=>{const m=me,h=O,I=ue,U=ce,W=oe;return s(),w("div",ke,[v("div",xe,[o(m,{src:t(fe),width:"32"},null,8,["src"]),l[1]||(l[1]=v("p",{class:"text-xl font-semibold px-2 mr-4"},"Artisan",-1)),o(h,{id:"#projects",icon:"pi pi-angle-left",label:a.$t("projects"),severity:"secondary",variant:"text",onClick:l[0]||(l[0]=P=>t(g).push({name:"projects"})),size:"small"},null,8,["label"])]),j.value||t(n)==null?(s(),r(I,{key:0,shape:"circle",size:"2rem",class:"mr-2"})):(s(),w("div",Se,[v("div",$e,[(s(!0),w(K,null,ae(t(n).steps,(P,$)=>(s(),r(h,{key:P.id,icon:V(P.type),rounded:"",severity:t(b)==$?void 0:"secondary",variant:t(b)==$?void 0:"outlined",onClick:Fe=>t(e)($),class:"h-8 w-8",disabled:t(p),loading:$==t(b)&&t(p)},null,8,["icon","severity","variant","onClick","disabled","loading"]))),128))])])),v("div",ze,[o(ve),o(h,{type:"button",icon:"pi pi-ellipsis-v",onClick:k,"aria-haspopup":"true","aria-controls":"overlay_menu",size:"small",variant:"outlined",severity:"secondary",class:"border border-slate-300 bg-slate-50",style:{width:"34px"}}),o(U,{ref_key:"menu",ref:d,id:"overlay_menu",model:f.value,popup:!0},{start:x(()=>{var P,$;return[ne((s(),w("button",je,[v("span",Ce,[v("span",Pe,M((P=t(c))==null?void 0:P.email),1),v("span",Le,M(($=t(c))==null?void 0:$.user_type),1)])])),[[W]])]}),_:1},8,["model"])])])}}}),E={submitStep:Be};async function Be(B,_,g,S){try{return await be.put(`/student/${B}/step/${_}/language/${g}`,{student_answer:S})}catch(y){throw console.log(y),y}}const De={class:"flex flex-col p-4 gap-4 overflow-scroll h-full justify-between bg-white"},qe={key:0},Ve={key:1,class:"flex"},Ne=R({__name:"LessonDiv",setup(B){const{locale:_}=T(),g=le(),S=A(),{user:y}=D(S),c=N(),{lesson:u,stepIndex:n,userCode:b}=D(c),{changeStep:p}=c,e=ie(()=>{var i;return n.value==null?null:((i=u.value)==null?void 0:i.steps[n.value])??null});async function q(){n.value!=null&&p(n.value-1)}async function j(){var i,d,f;if(n.value!=null&&(p(n.value+1),((i=e.value)==null?void 0:i.type)=="article"))try{const{data:k}=await E.submitStep(((d=y.value)==null?void 0:d.user_id)??"",((f=e.value)==null?void 0:f.id)??"",_.value,{});console.log(k.status)}catch(k){console.log(k)}}const C=L(!1);async function V(){var i,d,f,k;C.value=!0;try{let a;switch((i=e.value)==null?void 0:i.type){case"code":a={code:b.value};break;case"open":a={open:e.value.inner.answer};break;case"question":const m=[];(d=e.value.inner.options)==null||d.forEach(h=>{m.push(h.correct)}),a={question:m};break;case"matching":a={match:[{key:"dog",value:"b"},{key:"a",value:"animal"},{key:"c",value:"d"}]};break;default:a={};break}console.log(a);const{data:l}=await E.submitStep(((f=y.value)==null?void 0:f.user_id)??"",((k=e.value)==null?void 0:k.id)??"",_.value,a);l.status=="completed"?g.add({severity:"success",summary:"Correct, good job!",detail:"Completed successfully",life:5e3}):l.status=="attempted"&&g.add({severity:"error",summary:"Wrong answer!",detail:"Keep trying",life:5e3}),console.log(l.status)}catch(a){alert(a)}finally{C.value=!1}}return(i,d)=>{const f=O;return s(),w("div",De,[e.value?(s(),w("div",qe,[e.value.type=="article"?(s(),r(t(_e),{key:0,step:e.value,isPreview:!1},null,8,["step"])):e.value.type=="code"?(s(),r(t(ye),{key:1,step:e.value,isPreview:!1},null,8,["step"])):e.value.type=="matching"?(s(),r(t(ge),{key:2,step:e.value,isPreview:!1},null,8,["step"])):e.value.type=="open"?(s(),r(t(he),{key:3,step:e.value,isPreview:!1},null,8,["step"])):e.value.type=="question"?(s(),r(t(we),{key:4,step:e.value,isPreview:!1},null,8,["step"])):z("",!0),d[0]||(d[0]=v("br",null,null,-1)),e.value.type!="article"?(s(),r(f,{key:5,label:"Submit",icon:"pi pi-check",iconPos:"right",severity:"info",size:"small",class:"self-start",onClick:V,disabled:C.value,loading:C.value},null,8,["disabled","loading"])):z("",!0)])):z("",!0),t(u)!=null&&t(u).steps!=null&&t(u).steps.length>0&&e.value?(s(),w("div",Ve,[t(n)!==0?(s(),r(f,{key:0,label:"Previous",icon:"pi pi-angle-left",size:"small",onClick:q})):z("",!0),t(n)<t(u).steps.length-1?(s(),r(f,{key:1,label:"Next",icon:"pi pi-angle-right",iconPos:"right",size:"small",class:"ml-auto self-end",onClick:j})):z("",!0)])):z("",!0)])}}}),Re={key:1,class:"h-[51px]"},Te={class:"flex bg-surface-0",style:{height:"calc(100vh - 52px)"}},Me={class:"flex justify-center h-full"},Ee={class:"max-w-[400px] w-full"},Ze=R({__name:"LessonView",setup(B){const{locale:_}=T(),g=F(),S=N(),{setLesson:y}=S,c=L(!1);async function u(){if(!c.value){c.value=!0;try{const{data:n}=await pe.getProjectByID(g.params.id.toString()),b=await de(n,_.value);y(b)}catch(n){alert(n)}finally{c.value=!1}}}return H(u),J(_,u),(n,b)=>{const p=Z,e=G;return s(),w(K,null,[c.value?(s(),w("div",Re)):(s(),r(Ie,{key:0})),v("div",Te,[o(e,{class:"w-full rounded-none"},{default:x(()=>[o(p,{size:33,minSize:10,class:"max-w-[467px] w-full"},{default:x(()=>[o(Q)]),_:1}),o(p,{size:34,minSize:10},{default:x(()=>[o(e,{layout:"vertical",class:"h-full w-full"},{default:x(()=>[o(p,{size:65,minSize:10},{default:x(()=>[o(X)]),_:1}),o(p,{size:35,minSize:10},{default:x(()=>[o(Y)]),_:1})]),_:1})]),_:1}),o(p,{size:33,minSize:10,class:re(["max-w-md mx-auto",{"animate-fadeinright animate-once animate-duration-1000 animate-ease-in-out":!0}])},{default:x(()=>[v("div",Me,[v("div",Ee,[c.value?z("",!0):(s(),r(Ne,{key:0}))])])]),_:1})]),_:1})])],64)}}});export{Ze as default};
