import{d as ee,v as te,u as oe,x as se,a as ae,y as re,r,m as le,z as ne,A as R,o as l,c as i,b as c,e as j,w as k,j as U,h as N,F as V,i as C,f as L,k as ie,C as ue,s as de}from"./index-BRYS-vcQ.js";import{s as ce}from"./index-6mejDcUA.js";import{s as pe}from"./index-CeR3pfmH.js";import{s as me,a as fe}from"./index-Di1k7sjd.js";import{s as ve}from"./index-Df5aeo5u.js";import{_ as ge}from"./AHeader.vue_vue_type_script_setup_true_lang-Dg25dJJi.js";import{_ as z}from"./ProjectCard.vue_vue_type_script_setup_true_lang-BlZzSgOj.js";import{a as I}from"./index-BrfVjc9R.js";import{u as ye}from"./editor-store-LsyOYmWE.js";import{t as F}from"./types-Db7bbyJA.js";import{u as he,m as _e}from"./useSortable-BkShMj6I.js";import"./index-CwmpDcMI.js";import"./index-ByAGox7M.js";import"./index-BR2Jf0oz.js";import"./index-Bkk6Dlez.js";import"./index-Bev4xJwQ.js";import"./index-BI2AGJnZ.js";import"./logo-D5iHQcJv.js";import"./index-DvRQtqX3.js";import"./LocaleSwitcher.vue_vue_type_script_setup_true_lang-3z7NXoMq.js";import"./index-BONpjZaH.js";import"./StudentViewToggle.vue_vue_type_script_setup_true_lang-D_e5fFSH.js";import"./index-B66HduS2.js";import"./index-B_FzxdIN.js";import"./index-CXh-xjcX.js";import"./index-Cu6Erxkx.js";import"./profile-DexA0tEb.js";import"./index-D7LiWKXz.js";import"./index-BruGhK6t.js";import"./pibody-BwAjMvHk.js";const we={class:"flex flex-col min-h-screen bg-slate-50"},xe={class:"flex flex-col sm:flex-row gap-1 sm:gap-4 bg-slate-50 py-4 px-4 sm:px-12 items-end"},be={key:0,class:"flex flex-col sm:flex-row gap-1 sm:gap-4 bg-slate-50 py-0 px-4 sm:px-12 items-end justify-end"},je={key:1,class:"border border-dashed rounded-xl border-green-400 overflow-hidden"},ke={key:0,class:"flex flex-wrap justify-center gap-8 px-4 sm:px-12 pb-8 pt-4"},ot=ee({__name:"ProjectsView",setup(Ve){const P=te("el"),$=oe(),{locale:G}=se(),H=ie(),O=ye(),{addLesson:q}=O,J=ae(),{user:S}=re(J),p=r([]),_=r([]),w=r([]),A=r([0,0,0,0,0,0]),B=r([0,0,0,0,0,0]),m=r(!1),f=r(!1);he(P,p,{onUpdate:e=>{_e(p.value,e.oldIndex,e.newIndex,e),ue(async()=>{const t=[];p.value.map(o=>{const n=parseInt(o.id,10);t.push(n)});try{const{data:o}=await I.changeProjectsOrder(t);$.add({severity:"success",summary:o.message,life:2e3})}catch(o){$.add({severity:"error",summary:o.response.data.error,detail:o,life:2e3})}})}});async function v(){if(!m.value){m.value=!0;try{const{data:e}=await I.getProjects();p.value=[],_.value=[],w.value=[],A.value=[0,0,0,0,0,0],B.value=[0,0,0,0,0,0];for(const t of e)t.is_guidable?A.value[t.layer]++:B.value[t.layer]++;for(const t of e){const o=await F(t);if(t.layer==0){p.value.push(o);const n=o.creator_name??o.created_by;!x.value.includes(n)&&n.length>0&&x.value.push(o.creator_name??o.created_by)}o.is_guidable?_.value.push(o):w.value.push(o)}}catch(e){console.log(e)}finally{m.value=!1}}}le(v),ne(G,v);async function K(){f.value=!0;try{const{data:e}=await I.createProject(),t=await F(e);q(t),H.push(`/project/${t.id}/edit`)}catch(e){console.log(e)}finally{f.value=!1}}const Q=R(()=>{var n,h;const e=new Map,t=new Map;for(const s of _.value)e.has(s.layer)||e.set(s.layer,[]),e.get(s.layer).push(s);for(const s of w.value)t.has(s.layer)||t.set(s.layer,[]),t.get(s.layer).push(s);const o=[];return o.push({id:0,guided:((n=e.get(0))==null?void 0:n.filter(s=>(!d.value.length||d.value.includes(b(s.level)))&&(!u.value||s.title.toLowerCase().includes(u.value.toLowerCase()))))||[],unguided:((h=t.get(0))==null?void 0:h.filter(s=>(!d.value.length||d.value.includes(b(s.level)))&&(!u.value||s.title.toLowerCase().includes(u.value.toLowerCase()))))||[]}),o}),W=R(()=>p.value.filter(e=>(!y.value.length||y.value.includes(e.creator_name??e.created_by))&&(!g.value.length||g.value.includes(e.stage))&&(!d.value.length||d.value.includes(b(e.level)))&&(!u.value||e.title.toLowerCase().includes(u.value.toLowerCase())))),u=r(""),d=r(""),X=r(["Easy","Medium","Hard"]),g=r(""),Y=r(["prepare_for_submission","waiting_for_review","in_review","rejected","ready_for_publish","published","in_modify"]),y=r(""),x=r([]);function b(e){return e==0?"":e<3?"Easy":e<5?"Medium":e==5?"Hard":""}return(e,t)=>{var M,T;const o=me,n=ve,h=fe,s=pe,Z=ce,D=de;return l(),i("div",we,[c(ge,{class:"sticky top-0 z-10 mb-4"}),j("div",xe,[c(h,{class:"min-w-60"},{default:k(()=>[c(o,{class:"text-primary border-gray-100"},{default:k(()=>t[4]||(t[4]=[j("i",{class:"pi pi-search"},null,-1)])),_:1}),c(n,{type:"text",modelValue:u.value,"onUpdate:modelValue":t[0]||(t[0]=a=>u.value=a),placeholder:e.$t("pages.projects.search"),variant:"filled",class:"h-fit bg-white border-gray-100 shadow-none"},null,8,["modelValue","placeholder"])]),_:1}),c(s,{modelValue:d.value,"onUpdate:modelValue":t[1]||(t[1]=a=>d.value=a),options:X.value,placeholder:e.$t("pages.projects.filterByLevel"),display:"chip",variant:"filled",class:"bg-white min-w-0 lg:min-w-80 border-gray-100 shadow-none"},null,8,["modelValue","options","placeholder"])]),["editor","contributor"].includes(((M=U(S))==null?void 0:M.user_type)??"")?(l(),i("div",be,[c(s,{modelValue:g.value,"onUpdate:modelValue":t[2]||(t[2]=a=>g.value=a),options:Y.value,placeholder:"Select stage",display:"chip",variant:"filled",class:"bg-white min-w-0 lg:min-w-80 border-gray-100 shadow-none"},null,8,["modelValue","options"]),c(s,{modelValue:y.value,"onUpdate:modelValue":t[3]||(t[3]=a=>y.value=a),options:x.value,placeholder:"Select creator",display:"chip",variant:"filled",class:"bg-white min-w-0 lg:min-w-80 border-gray-100 shadow-none"},null,8,["modelValue","options"])])):N("",!0),["editor","contributor"].includes(((T=U(S))==null?void 0:T.user_type)??"")?(l(),i("div",{key:1,ref_key:"el",ref:P,class:"flex flex-wrap justify-center gap-8 px-4 sm:px-12 pb-8 pt-4"},[(l(!0),i(V,null,C(W.value,a=>(l(),L(z,{key:a.id,project:a,onAfterRemove:v},null,8,["project"]))),128)),m.value?(l(),L(Z,{key:0})):(l(),i("div",je,[c(D,{variant:"text",style:{width:"300px",height:"234px"},class:"bg-green-50",onClick:K,loading:f.value,disabled:f.value},{icon:k(()=>t[5]||(t[5]=[j("i",{class:"pi pi-plus text-3xl"},null,-1)])),_:1},8,["loading","disabled"])]))],512)):(l(!0),i(V,{key:2},C(Q.value,a=>(l(),i("div",{key:a.id,class:"flex flex-col gap-2"},[a.unguided.length>0?(l(),i("div",ke,[(l(!0),i(V,null,C(a.unguided,E=>(l(),L(z,{key:E.id,project:E,onAfterRemove:v},null,8,["project"]))),128))])):N("",!0)]))),128))])}}});export{ot as default};
