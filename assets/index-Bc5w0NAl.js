import{s as q}from"./index-BqbdjUlk.js";import{s as ae}from"./index-DoMJQhby.js";import{d as le,u as ie,r as g,c as re,a as L,b as t,i as $,H as ue,o as R,E as G,e as u,F as B,k as j,f as S,h as w,g as s,t as ce,q as W,s as O,I as de,J as Y,C as pe,K as I,w as F,D as U,T as H,m as K,B as fe,l as ve}from"./index-n3daKGCc.js";import{L as me,d as ge}from"./defaultConfirmDeleteOptions-DDddnZ7t.js";import"./http-BEt-6spR.js";import{m as ye}from"./mapLessonFromDto-Dmd7ExqT.js";import{U as A}from"./unitApi-D1uo5c7S.js";import{m as _e}from"./mapUnitFromDto-CYGc5n9V.js";import{u as he,c as we}from"./CodeEditorView.vue_vue_type_script_setup_true_lang-BqDbFO8I.js";import{_ as xe}from"./PibodyViewer.vue_vue_type_script_setup_true_lang-l9tZWOMG.js";import{_ as be}from"./CodeViewer.vue_vue_type_script_setup_true_lang-Dv5QKrDt.js";import{s as ke}from"./index-C9Jq8BwU.js";import{s as Ce}from"./index-Civ1v18m.js";import{s as Se}from"./index-c-XKspjc.js";import{u as $e}from"./index-D57r3cjp.js";import{_ as Le}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./SimulationView-Cg4peqrM.js";import"./index-D4py3QaC.js";import"./index-eM3voxb6.js";import"./index-Cxe1QBz0.js";import"./index-Uwvuv9oP.js";const z=le("lesson-store",()=>{const x=ie(),e=g(null),n=g(!1),f=g(!1),o=g(!1),y=g(!1),l=g(0),r=g([]),c=g(0),_=g([]),i=g("continue"),d=g(!1),v=g(!1),p=g(!1),a=g(!0),h=g(null),E=re(()=>{var m;return p.value&&(((m=h.value)==null?void 0:m.modulesWerePut)??!0)&&a.value});async function V(m,k){try{n.value=!0;const{data:C}=await me.getLessonById(m,k);e.value=ye(C)}catch(C){x.add({severity:"error",summary:C.response.data.error,life:2e3})}finally{n.value=!1}}async function N(m,k){try{f.value=!0;const{data:C}=await A.getUnitByIdandLessonId(m,k);return C}catch(C){x.add({severity:"error",summary:C.response.data.error,life:2e3})}finally{f.value=!1}}async function P(){if(e.value!=null){o.value=!0,r.value=[],l.value=0,c.value=0;for(let m=0;m<e.value.pages.length;m++)_.value.push(0);i.value="continue",r.value.push(e.value.pages[l.value].groups[c.value]),await D(e.value.id),o.value=!1}}async function D(m){p.value=!1,d.value=!1;for(let k=0;k<r.value[c.value].units.length;k++){const C=r.value[c.value].units[k];["options","open","code","pibody"].includes(C.unitType)&&(i.value="check",d.value=!0);const T=await N(C.id,m);if(T){const b=_e(T);r.value[c.value].units[k].content=b==null?void 0:b.content,r.value[c.value].units[k].data=b==null?void 0:b.data,r.value[c.value].units[k].studentState=b==null?void 0:b.studentState,["code","pibody"].includes(C.unitType)&&((b==null?void 0:b.content.answer)==""&&(b==null?void 0:b.data.tests.lenght)==0||(a.value=!1)),C.unitType=="pibody"&&(h.value=he(`pibody-${b.id}`),h.value.addNeededModules(b.data.neededModules))}}i.value=="continue"&&await M()}async function M(){if(e.value!=null)try{y.value=!0,v.value=!1;for(const m of r.value[r.value.length-1].units){if(["code","pibody"].includes(m.unitType)){const k=m.studentState.answer.code,C=await we(`${m.unitType}-${m.id}`,k,m.data.tests,m.data.includedCommands);if(v.value=C.correct,C.correct)await A.skipSubmitUnitByIdandLessonId(m.id,e.value.id);else{const{data:T}=await A.getUnitCodeHint(m.id,k);x.add({severity:"error",summary:T.hint})}}else{const{data:k}=await A.submitUnitByIdandLessonId(m.id,e.value.id,m.studentState.answer);v.value=k.correct}if(v.value==!1)break}v.value?(_.value[l.value]++,c.value>=e.value.pages[l.value].groups.length-1?l.value<e.value.pages.length-1?i.value="continue":i.value="finish":i.value="continue"):i.value="try-again"}finally{y.value=!1}}async function X(){if(e.value!=null){if(c.value>=e.value.pages[l.value].groups.length-1){te();return}o.value=!0,c.value++,r.value.push(e.value.pages[l.value].groups[c.value]),await D(e.value.id),o.value=!1}}function Q(m,k){if(e.value!=null){for(const[C,T]of r.value.entries())for(const[b,oe]of T.units.entries())if(oe.id==m){r.value[C].units[b].studentState.answer=k;break}}}async function Z(){e.value!=null&&(i.value="check")}async function ee(){e.value!=null&&(i.value="completed")}async function te(){e.value!=null&&(o.value=!0,l.value++,r.value=[],c.value=0,i.value="continue",r.value.push(e.value.pages[l.value].groups[c.value]),await D(e.value.id),o.value=!1)}function se(m){p.value=m}function ne(){a.value=!0}return{selectedLesson:e,isLessonLoading:n,isUnitLoading:f,groups:r,groupIndex:c,isGroupLoading:o,isSubmitLoading:y,groupStatus:i,submitExist:d,correct:v,submitEnabled:E,pageProgress:_,setSubmitable:se,loadLessonById:V,loadUnitByIdandLessonId:N,loadInitialGroup:P,submitGroup:M,nextGroup:X,saveAnswer:Q,tryAgain:Z,finishLesson:ee,runCodePressed:ne}}),J=L({__name:"MdViewer",props:{text:{}},setup(x){const e=x;return(n,f)=>{const o=ue("v-md-preview");return t(),$(o,{text:e.text},null,8,["text"])}}}),Ie=L({__name:"ArticleViewer",props:{article:{}},setup(x){const e=x;return(n,f)=>(t(),$(J,{text:e.article.text},null,8,["text"]))}}),Te={class:"flex flex-col gap-4 pl-4"},Be=L({__name:"OptionsViewer",props:{optionsData:{},state:{}},emits:["save-answer"],setup(x,{emit:e}){const n=x,f=e,o=g(!1),y=g(!1),l=g(!1),r=g([]),c=g([]),_=g();return R(()=>{var i,d,v,p,a,h;o.value=((i=n.optionsData)==null?void 0:i.shuffle)??!1,y.value=((d=n.optionsData)==null?void 0:d.feedback)??!1,l.value=((v=n.optionsData)==null?void 0:v.single)??!1,r.value=((p=n.optionsData)==null?void 0:p.options)??[],c.value=((a=n.state.answer)==null?void 0:a.options)??[],_.value=n.state.answer&&n.state.answer.options&&n.state.answer.options.length>0?(h=n.state)==null?void 0:h.answer.options[0]:void 0}),G([_,c,y],()=>{l.value&&_.value?f("save-answer",{options:[_.value],feedback:y.value}):f("save-answer",{options:c.value,feedback:y.value})},{deep:!0}),(i,d)=>{const v=Ce,p=ke;return t(),u("div",Te,[(t(!0),u(B,null,j(r.value,a=>(t(),u("div",{key:a.id,class:"flex gap-2 items-center"},[l.value?(t(),$(v,{key:0,modelValue:_.value,"onUpdate:modelValue":d[0]||(d[0]=h=>_.value=h),value:a.id},null,8,["modelValue","value"])):(t(),$(p,{key:1,modelValue:c.value,"onUpdate:modelValue":d[1]||(d[1]=h=>c.value=h),value:a.id},null,8,["modelValue","value"])),S(J,{text:a.text},null,8,["text"])]))),128))])}}}),Ee=L({__name:"OpenViewer",props:{state:{}},emits:["save-answer"],setup(x,{emit:e}){const n=x,f=e,o=g("");return R(()=>{o.value=n.state.answer.open}),G(o,()=>{f("save-answer",{open:o.value})}),(y,l)=>{const r=Se;return t(),$(r,{type:"text",modelValue:o.value,"onUpdate:modelValue":l[0]||(l[0]=c=>o.value=c),class:"w-full",size:"small"},null,8,["modelValue"])}}}),Ve={key:0,style:{position:"relative",width:"100%",height:"0","padding-bottom":"56.25%"}},Ne=["src"],Ae={key:1,style:{position:"relative","margin-left":"5%",width:"90%",height:"0","padding-bottom":"160%"}},Ge=["src"],Pe=L({__name:"VideoViewer",props:{video:{}},setup(x){const e=x;function n(f){return f.replace("shorts","embed")}return(f,o)=>e.video.url.includes("embed")?(t(),u("div",Ve,[w("iframe",{credentialless:"",src:n(e.video.url),style:{position:"absolute",top:"0",left:"0",width:"100%",height:"100%"},frameborder:"0",allowfullscreen:"",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",referrerpolicy:"strict-origin-when-cross-origin"},null,8,Ne)])):(t(),u("div",Ae,[w("iframe",{credentialless:"",src:n(e.video.url??""),style:{position:"absolute",top:"0",left:"0",width:"100%",height:"100%"},frameborder:"0",allowfullscreen:"",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",referrerpolicy:"strict-origin-when-cross-origin"},null,8,Ge)]))}}),Re={key:1,class:"flex-grow px-4 py-2"},je={key:6},ze=L({__name:"UnitCard",props:{unit:{},loading:{type:Boolean}},setup(x){const e=x,n=W(),f=z(),{saveAnswer:o,setSubmitable:y,runCodePressed:l}=f;function r(i){e.unit.unitType=="options"?y(i.options.length>0):e.unit.unitType=="open"?y(i.open.length>0):(e.unit.unitType=="code"||e.unit.unitType=="pibody")&&y(i.code.length>0),o(e.unit.id,i),c(i)}const c=$e(i=>{_(i)},1e3,{maxWait:5e3});async function _(i){await A.saveUnitByIdandLessonId(e.unit.id,Number(n.params.id),{answer:i})}return(i,d)=>{const v=q;return t(),u("div",null,[i.loading?(t(),$(v,{key:0,class:"flex justify-center items-center w-10 h-full"})):(t(),u("div",Re,[e.unit.unitType=="article"?(t(),$(Ie,{key:0,article:e.unit.content},null,8,["article"])):e.unit.unitType=="options"?(t(),$(Be,{key:1,"options-data":e.unit.content,state:e.unit.studentState,onSaveAnswer:r},null,8,["options-data","state"])):e.unit.unitType=="open"?(t(),$(Ee,{key:2,state:e.unit.studentState,onSaveAnswer:r},null,8,["state"])):e.unit.unitType=="video"?(t(),$(Pe,{key:3,video:e.unit.content},null,8,["video"])):e.unit.unitType=="code"?(t(),$(s(be),{key:4,id:`code-${e.unit.id}`,code:e.unit.content,state:e.unit.studentState,starting:e.unit.studentStatus=="nothing",onSaveAnswer:r,onRun:s(l)},null,8,["id","code","state","starting","onRun"])):e.unit.unitType=="pibody"?(t(),$(s(xe),{key:5,id:`pibody-${e.unit.id}`,content:e.unit.content,data:e.unit.data,state:e.unit.studentState,starting:e.unit.studentStatus=="nothing",onSaveAnswer:r,onRun:s(l)},null,8,["id","content","data","state","starting","onRun"])):(t(),u("div",je,ce(e.unit.content),1))]))])}}}),De={key:1,class:"flex flex-col h-full w-full"},Ue={class:"flex-grow flex flex-col gap-4 px-4 py-2"},Fe=L({__name:"GroupCard",props:{group:{},loading:{type:Boolean}},setup(x){const e=x,n=g(null);return G(()=>e.loading,f=>{f===!1&&n.value&&requestAnimationFrame(()=>{var o;(o=n.value)==null||o.scrollIntoView({behavior:"smooth",block:"start"})})}),(f,o)=>{const y=q;return t(),u("div",{ref_key:"groupRef",ref:n,class:"pt-8"},[f.loading?(t(),$(y,{key:0,class:"flex justify-center items-center w-10 h-full"})):(t(),u("div",De,[w("div",Ue,[(t(!0),u(B,null,j(f.group.units,l=>(t(),$(ze,{key:l.id,unit:l},null,8,["unit"]))),128))])]))],512)}}}),He=L({__name:"UnitsView",props:{pages:{}},setup(x){const e=z(),{groups:n,isGroupLoading:f}=O(e),{loadInitialGroup:o}=e,y=g(null),l=g(null),r=g(0);function c(d){let v=d;for(;v&&v.parentElement;){const p=v.parentElement,h=getComputedStyle(p).overflowY;if(h==="auto"||h==="scroll")return p;v=p}return null}async function _(){await pe();const d=c(y.value),v=l.value;if(!d||!v){r.value=0;return}const p=d.clientHeight,a=v.getBoundingClientRect().height,h=Math.max(0,p-a);r.value=h}function i(d,v){var h;const p=(h=n.value[n.value.length-1])==null?void 0:h.id;let a=null;d&&(d instanceof Element?a=d:d.$el instanceof Element&&(a=d.$el)),l.value=v.id===p?a:null}return R(()=>{o(),_(),window.addEventListener("resize",_)}),de(()=>{window.removeEventListener("resize",_)}),G(()=>n.value.length,async()=>{await _()}),G(()=>f.value,async(d,v)=>{v===!0&&d===!1&&await _()}),(d,v)=>(t(),u("div",{ref_key:"rootEl",ref:y,class:"flex flex-col gap-8"},[(t(!0),u(B,null,j(s(n),p=>(t(),u("div",{key:p.id,ref_for:!0,ref:a=>i(a,p)},[S(Fe,{group:p,loading:s(f)&&p.id==s(n)[s(n).length-1].id},null,8,["group","loading"])]))),128)),w("div",{style:Y({height:r.value+"px"})},null,4)],512))}}),qe={key:0,class:"flex justify-center items-center w-full min-h-24 px-8 gap-8"},Oe={key:1},Me={key:"correct",class:"flex justify-center items-center w-full min-h-24 px-8 gap-8 bg-green-100"},We={key:"incorrect",class:"flex justify-center items-center w-full min-h-24 px-8 gap-8 bg-red-100"},Ye={key:"no-submit",class:"flex justify-center items-center w-full min-h-24 px-8 gap-8"},Ke={key:"try-again",class:"flex justify-center items-center w-full min-h-24 px-8 gap-8 bg-gray-50"},Je={key:2},Xe={key:"correct",class:"flex justify-center items-center w-full min-h-24 px-8 gap-8 bg-green-100"},Qe={key:1,class:"flex justify-center items-center w-full min-h-24 px-8 gap-8"},Ze=L({__name:"NavigationBar",setup(x){const e=z(),{isSubmitLoading:n,groupStatus:f,isGroupLoading:o,submitExist:y,correct:l,submitEnabled:r}=O(e),{submitGroup:c,nextGroup:_,tryAgain:i,finishLesson:d}=e;return(v,p)=>{const a=K;return t(),u(B,null,[s(f)=="check"?(t(),u("div",qe,[S(a,{label:"CHECK",icon:"pi pi-check","icon-pos":"right",size:"large",severity:"contrast",class:"w-56 rounded-3xl",onClick:s(c),loading:s(n),disabled:s(n)||!s(r)},null,8,["onClick","loading","disabled"])])):I("",!0),s(f)=="continue"?(t(),u("div",Oe,[S(H,{name:"pop",appear:"",mode:"out-in"},{default:F(()=>[s(y)&&s(l)?(t(),u("div",Me,[p[0]||(p[0]=w("div",{class:"text-lg font-bold flex items-center gap-2"},[w("span",{class:"text-3xl"},"🎉"),U(" Correct!")],-1)),S(a,{label:"CONTINUE",icon:"pi pi-arrow-right","icon-pos":"right",size:"large",class:"w-56 rounded-3xl",onClick:s(_),loading:s(o),disabled:s(o)},null,8,["onClick","loading","disabled"])])):s(y)&&!s(l)?(t(),u("div",We,[S(a,{label:"CONTINUE",icon:"pi pi-arrow-right","icon-pos":"right",size:"large",severity:"contrast",class:"w-56 rounded-3xl",onClick:s(_),loading:s(o),disabled:s(o)},null,8,["onClick","loading","disabled"])])):(t(),u("div",Ye,[S(a,{label:"CONTINUE",icon:"pi pi-arrow-right","icon-pos":"right",size:"large",severity:"contrast",class:"w-56 rounded-3xl",onClick:s(_),loading:s(o),disabled:s(o)},null,8,["onClick","loading","disabled"])]))]),_:1})])):I("",!0),S(H,{name:"shake",appear:""},{default:F(()=>[s(f)=="try-again"?(t(),u("div",Ke,[p[1]||(p[1]=w("div",{class:"text-lg font-bold flex items-center gap-2"},[w("span",{class:"text-3xl"},"⚠️"),U(" Incorrect!")],-1)),S(a,{label:"TRY AGAIN",icon:"pi pi-arrow-right","icon-pos":"right",size:"large",severity:"contrast",class:"w-56 rounded-3xl",onClick:s(i)},null,8,["onClick"])])):I("",!0)]),_:1}),s(f)=="finish"?(t(),u("div",Je,[s(y)&&s(l)?(t(),u("div",Xe,[p[2]||(p[2]=w("div",{class:"text-lg font-bold flex items-center gap-2"},[w("span",{class:"text-3xl"},"🎉"),U(" Correct!")],-1)),S(a,{label:"FINISH",icon:"pi pi-arrow-right","icon-pos":"right",size:"large",class:"w-56 rounded-3xl",onClick:s(d),loading:s(o),disabled:s(o)},null,8,["onClick","loading","disabled"])])):(t(),u("div",Qe,[S(a,{label:"FINISH",icon:"pi pi-arrow-right","icon-pos":"right",size:"large",class:"w-56 rounded-3xl",onClick:s(d)},null,8,["onClick"])]))])):I("",!0)],64)}}}),et=Le(Ze,[["__scopeId","data-v-fdc42d8d"]]),tt={key:0,class:"h-screen flex flex-col items-center overflow-hidden"},st={class:"fixed top-0 left-0 right-0 z-50 bg-white border-b border-gray-200 shadow-md"},nt={class:"flex justify-between items-center w-full min-h-16 px-8 gap-8"},ot={class:"flex items-center gap-4"},at={key:0,class:"flex flex-grow max-w-screen-lg items-center gap-4"},lt={class:"flex-1 overflow-y-auto mt-16 mb-24 w-full"},it={class:"w-full h-full max-w-screen-lg mx-auto px-4 md:px-28 py-8"},rt={key:1,class:"flex justify-center"},ut={key:2},ct={class:"fixed bottom-0 left-0 right-0 z-50 bg-white border-t-2 border-gray-200 shadow-md"},dt={key:0,class:"h-screen flex flex-col items-center justify-center overflow-hidden gap-10"},Nt=L({__name:"LessonPage",setup(x){const e=W(),n=ve(),f=fe(),o=z(),{isLessonLoading:y,selectedLesson:l,pageProgress:r,groupStatus:c}=O(o),{loadLessonById:_}=o;function i(){f.require({...ge,header:"Close lesson",message:"Are you sure you want to exit lesson. All progress will be lost!",acceptProps:{label:"Close",severity:"danger"},accept:()=>v()})}R(()=>_(Number(e.params.id),(e.query.route_id??"").toString()));function d(p){var h;const a=((h=l.value)==null?void 0:h.pages.reduce((E,V)=>E+V.groups.length,0))||1;return p/a*100}function v(){window.history.length>2?n.go(-1):e.query.route_id&&e.query.route_id!=""?n.push("/v2/route/"+e.query.route_id):n.push("/v2")}return(p,a)=>{const h=K,E=ae,V=q;return t(),u(B,null,[s(c)!="completed"?(t(),u("div",tt,[w("div",st,[w("div",nt,[w("div",ot,[S(h,{icon:"pi pi-times",variant:"text",severity:"contrast",onClick:i})]),s(l)?(t(),u("div",at,[(t(!0),u(B,null,j(s(l).pages,(N,P)=>(t(),u("div",{key:P,class:"h-full",style:Y({width:d(N.groups.length)+"%"})},[S(E,{value:s(r)[P]/N.groups.length*100,"show-value":!1,class:"w-full rounded-full h-3"},null,8,["value"])],4))),128))])):I("",!0),a[0]||(a[0]=w("div",{class:"w-10"},null,-1))])]),w("div",lt,[w("div",it,[s(y)?(t(),$(V,{key:0,class:"flex justify-center"})):s(l)?(t(),u("div",ut,[S(He,{pages:s(l).pages},null,8,["pages"])])):(t(),u("div",rt,"No lesson found"))])]),w("div",ct,[S(et)])])):I("",!0),S(H,{"enter-active-class":"transition duration-500 ease-out","enter-from-class":"opacity-0 scale-90","enter-to-class":"opacity-100 scale-100","leave-active-class":"transition duration-300 ease-in","leave-from-class":"opacity-100 scale-100","leave-to-class":"opacity-0 scale-90"},{default:F(()=>[s(c)=="completed"?(t(),u("div",dt,[a[1]||(a[1]=w("div",{class:"text-5xl"},"⚡️",-1)),a[2]||(a[2]=w("div",{class:"flex flex-col items-center"},[w("div",{class:"text-4xl font-bold mb-8"},"Good work!"),w("div",{class:"text-md text-gray-500"},"TOTAL XP"),w("div",{class:"text-3xl font-bold"},"35")],-1)),w("div",null,[S(h,{label:"Continue",class:"rounded-full w-56 text-xl",onClick:v})])])):I("",!0)]),_:1})],64)}}});export{Nt as default};
