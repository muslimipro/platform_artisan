import{T as fe}from"./index-D-99ObJy.js";import{s as me}from"./index-BTL82xS8.js";import{s as ge}from"./index-BUJyY_Tq.js";import{a as he,u as ve,D as ye,a6 as _e,r as d,s as be,c as $e,o as xe,b as o,k as h,w as l,e as p,t as n,h as r,f as t,i as v,g as B,l as w,F as C,j as D,U as we,n as O,x as Ce,p as ke,aP as Te,q as ze,v as je}from"./index-DHVnmQPM.js";import{s as Fe,a as Se}from"./index-B0sN1kbj.js";import{s as De}from"./index-Boo1u9A0.js";import{s as Ve,a as Ne}from"./index-CwBcKnjS.js";import{s as Pe}from"./index-GdTgxm_8.js";import{s as Be}from"./index-DqVuGC-f.js";import{a as Ie,s as Ue}from"./index-C4F8jACC.js";import{s as Me}from"./index-B7xbQbD6.js";import{s as Re}from"./index-COm9ynAh.js";import{u as qe,S as k}from"./useSchoolStore-D1lBY3Vk.js";import{a as Ae}from"./index-DU_ItY1l.js";import"./index-DimdtQOL.js";import"./index-DRCcxSDj.js";import"./index-HGiDyU5z.js";import"./index-BOWzKnTG.js";import"./index-Dg1hJ63t.js";import"./index-C7Peqa67.js";import"./index-BQXR58SR.js";import"./index-D3Cxxuxn.js";import"./http-Dcz7Gd9U.js";const He={key:1},Le={key:2,class:"flex flex-col items-start px-8 pb-4 gap-4"},Ge={class:"flex items-center justify-between gap-2 w-full"},Oe={class:"flex flex-col gap-2"},Ee={class:"text-3xl"},Ke={class:"text-sm"},Je={class:"flex items-center px-4 self-end"},Qe={class:"text-xl mr-2"},We={class:"text-gray-500"},Xe={class:"flex items-center"},Ye={class:"flex-grow flex gap-2 items-center"},Ze={class:"text-xl text-gray-500"},es={class:"w-4 h-4 rounded-md text-[10px] font-semibold flex justify-center items-center bg-gray-300"},ss={class:"flex flex-col"},ts={class:"text-[10px] text-gray-500"},as={class:"flex justify-center text-[124px]"},ls={class:"flex justify-between items-center mb-8"},os={class:"flex justify-end gap-2"},Ds=he({__name:"ClassView",setup(rs){const T=ve(),I=ye(),y=Ce(),U=ke(),{t:m}=_e(),E=d(),_=d();(()=>{_.value={global:{value:null,matchMode:Te.CONTAINS}}})();const M=qe(),{teachers:R,school:K}=be(M),{loadClasses:J}=M,g=d(null),q=d([]),z=d([]),j=d(!1),F=d(!1),S=d(!1),V=d(!1),b=d(!1),$=d(null);async function N(){if(!j.value){j.value=!0;try{const{data:e}=await k.getClass(Number(y.params.id));g.value=e??null,$.value=R.value.find(a=>{var u;return a.teacher_id==((u=g.value)==null?void 0:u.creator)})??null}catch(e){console.log(e)}finally{j.value=!1}}}async function Q(){if(!F.value){F.value=!0;try{const{data:e}=await k.getClassStudents(Number(y.params.id));q.value=e??null}catch(e){console.log(e)}finally{F.value=!1}}}async function W(){try{const{data:e}=await Ae.getProjects();z.value=e}catch(e){console.log(e)}}const X=["secondary","success","info","warn","danger","contrast"],A=$e(()=>{const e={};for(const a of z.value){let u=a.layer;u==0&&(u=999);const f=a.is_guidable?"learn":"practice";e[u]||(e[u]={learn:0,practice:0}),e[u][f]++}return e});xe(()=>{N(),W(),Q()});function Y(){I.require({message:m("pages.school.confirmDeleteClass"),header:m("pages.school.confirmHeader"),icon:"pi pi-exclamation-triangle",rejectProps:{label:m("pages.school.confirmCancel"),severity:"secondary",outlined:!0},acceptProps:{label:m("pages.school.confirmDeleteBtn"),severity:"danger"},accept:()=>{Z(Number(y.params.id))}})}async function Z(e){try{const{data:a}=await k.deleteClass(e);await J(),U.go(-1),T.add({severity:"success",summary:a.message,life:2e3})}catch(a){T.add({severity:"error",summary:a.response.data.error,detail:a,life:2e3})}}async function ee(){if($.value){S.value=!0;try{await k.assignTeacherToClass(Number(y.params.id),$.value.teacher_id),await N()}catch(e){console.log(e)}finally{S.value=!1,b.value=!1}}}function se(){I.require({message:m("pages.school.confirmDeleteTeacher"),header:m("pages.school.confirmHeader"),icon:"pi pi-exclamation-triangle",rejectProps:{label:m("pages.school.confirmCancel"),severity:"secondary",outlined:!0},acceptProps:{label:m("pages.school.confirmDeleteBtn"),severity:"danger"},accept:()=>{te()}})}async function te(){try{const{data:e}=await k.assignTeacherToClass(Number(y.params.id));await N(),T.add({severity:"success",summary:e.message,life:2e3})}catch(e){T.add({severity:"error",summary:e.response.data.error,detail:e,life:2e3})}}return(e,a)=>{const u=Re,f=ze,ae=Ie,le=Me,oe=Ue,i=Fe,re=Be,P=Ve,H=Pe,ne=Ne,ie=De,ce=Se,L=je,de=ge,ue=me,pe=fe;return o(),h(ue,{class:"min-w-0 flex-grow flex flex-col gap-2"},{default:l(()=>{var G;return[j.value?(o(),h(u,{key:0,class:"flex justify-center"})):g.value?(o(),p("div",Le,[r("div",Ge,[r("div",Oe,[r("div",Ee,n(g.value.name),1),r("div",Ke,n(e.$t("pages.school.since"))+" "+n(g.value.created_time.split("T")[0]),1)]),t(f,{icon:"pi pi-hashtag",label:e.$t("pages.school.classCode"),severity:"info",onClick:a[0]||(a[0]=s=>V.value=!0)},null,8,["label"])]),r("div",Je,[r("div",Qe,[r("span",We,n(e.$t("pages.school.classTeacher")),1),v(": "+n(g.value.creator_name),1)]),t(f,{icon:"pi pi-pencil",severity:"info",variant:"text",rounded:"",onClick:a[1]||(a[1]=s=>b.value=!0)}),g.value.creator!=((G=B(K))==null?void 0:G.manager_id)?(o(),h(f,{key:0,icon:"pi pi-trash",severity:"danger",variant:"text",rounded:"",onClick:se})):w("",!0)]),t(ce,{ref_key:"dt",ref:E,filters:_.value,"onUpdate:filters":a[3]||(a[3]=s=>_.value=s),value:q.value,dataKey:"id",loading:F.value,scrollable:"",globalFilterFields:["name","email"],class:"overflow-hidden w-full",paginator:"",rows:25,rowsPerPageOptions:[5,10,25],groupHeader:!0,showGridlines:""},{header:l(()=>[r("div",Xe,[r("div",Ye,[r("div",Ze,n(e.$t("pages.school.students")),1)]),t(oe,null,{default:l(()=>[t(ae,null,{default:l(()=>a[8]||(a[8]=[r("i",{class:"pi pi-search"},null,-1)])),_:1}),t(le,{modelValue:_.value.global.value,"onUpdate:modelValue":a[2]||(a[2]=s=>_.value.global.value=s),placeholder:e.$t("pages.school.search")},null,8,["modelValue","placeholder"])]),_:1})])]),empty:l(()=>[v(n(e.$t("pages.school.noStudentsFound")),1)]),loading:l(()=>[v(n(e.$t("pages.school.loadingStudents")),1)]),default:l(()=>[t(ne,{type:"header"},{default:l(()=>[t(P,null,{default:l(()=>[t(i,{header:e.$t("pages.school.projects"),rowspan:2,colspan:2,frozen:!0,alignFrozen:"left"},null,8,["header"]),(o(!0),p(C,null,D(A.value,(s,c)=>(o(),h(i,{key:c,colspan:s.learn+s.practice},{header:l(()=>[t(re,{class:"w-full text-md px-2",severity:c==999?"secondary":X[c]},{default:l(()=>[v(n(c==999?e.$t("pages.school.other"):`${e.$t("pages.school.level")} ${c}`),1)]),_:2},1032,["severity"])]),_:2},1032,["colspan"]))),128)),t(i,{header:"",rowspan:2,colspan:2,frozen:!0,alignFrozen:"right"})]),_:1}),t(P,null,{default:l(()=>[(o(!0),p(C,null,D(A.value,(s,c)=>(o(),p(C,{key:c},[s.learn>0?(o(),h(i,{key:0,colspan:s.learn},{header:l(()=>[t(H,{class:"w-full flex justify-center",size:"small",severity:"success"},{default:l(()=>[v(n(e.$t("pages.projects.learn")),1)]),_:1})]),_:2},1032,["colspan"])):w("",!0),s.practice>0?(o(),h(i,{key:1,colspan:s.practice},{header:l(()=>[t(H,{class:"w-full flex justify-center",size:"small",severity:"info"},{default:l(()=>[v(n(e.$t("pages.projects.practice")),1)]),_:1})]),_:2},1032,["colspan"])):w("",!0)],64))),128))]),_:1}),t(P,null,{default:l(()=>[t(i,{header:e.$t("pages.school.avatar"),frozen:!0,alignFrozen:"left"},null,8,["header"]),t(i,{header:e.$t("pages.school.name"),frozen:!0,alignFrozen:"left",sortable:"",field:"name"},null,8,["header"]),(o(!0),p(C,null,D(z.value,(s,c)=>(o(),h(i,{key:s.id,field:s.id},{header:l(()=>[we((o(),p("div",es,[v(n(c+1),1)])),[[pe,{value:s.name.toString()},void 0,{top:!0}]])]),body:l(({data:x})=>[x.projects[c].student_progress>0?(o(),p("div",{key:0,class:O(["w-4 h-4 mx-4 rounded-full text-[10px] flex justify-center items-center text-white",x.projects[c].student_progress==100?"bg-green-400":"bg-orange-400"])},null,2)):w("",!0)]),_:2},1032,["field"]))),128)),t(i,{header:e.$t("pages.school.xp"),frozen:!0,alignFrozen:"right",sortable:"",field:"xp"},null,8,["header"]),t(i,{header:"",frozen:!0,alignFrozen:"right"})]),_:1})]),_:1}),t(i,{field:"small_avatar_url",header:e.$t("pages.school.avatar"),sortable:"",frozen:!0,alignFrozen:"left"},{body:l(({data:s})=>[t(ie,{image:s.small_avatar_url},null,8,["image"])]),_:1},8,["header"]),t(i,{field:"name",header:e.$t("pages.school.name"),sortable:"",frozen:!0,alignFrozen:"left"},{body:l(({data:s})=>[r("div",ss,[r("div",null,n(`${s.name.length>0?s.name:s.email}`),1),r("div",ts,n(`Last visited: ${s.last_activity_time.split("T")[0]}`),1)])]),_:1},8,["header"]),(o(!0),p(C,null,D(z.value,(s,c)=>(o(),h(i,{key:s.id,field:s.id},{body:l(({data:x})=>[x.projects[c].student_progress>0?(o(),p("div",{key:0,class:O(["w-4 h-4 rounded-full text-[10px] flex justify-center items-center text-white",x.projects[c].student_progress==100?"bg-green-400":"bg-orange-400"])},null,2)):w("",!0)]),_:2},1032,["field"]))),128)),t(i,{field:"xp",header:e.$t("pages.school.xp"),sortable:"",frozen:!0,alignFrozen:"right"},{body:l(({data:s})=>[r("div",null,n(`${s.xp}xp`),1)]),_:1},8,["header"]),t(i,{exportable:!1,frozen:!0,alignFrozen:"right"},{body:l(({data:s})=>[t(f,{icon:"pi pi-angle-right",outlined:"",rounded:"",severity:"info",onClick:c=>B(U).push({name:"school-student",params:{id:s.id}})},null,8,["onClick"])]),_:1})]),_:1},8,["filters","value","loading"]),t(f,{icon:"pi pi-trash",label:e.$t("pages.school.remove"),severity:"danger",onClick:Y,class:"self-end"},null,8,["label"])])):(o(),p("div",He,n(e.$t("pages.school.noData")),1)),t(L,{visible:V.value,"onUpdate:visible":a[4]||(a[4]=s=>V.value=s),modal:"",header:e.$t("pages.school.classCode")},{default:l(()=>{var s;return[r("div",as,n((s=g.value)==null?void 0:s.code),1)]}),_:1},8,["visible","header"]),t(L,{visible:b.value,"onUpdate:visible":a[7]||(a[7]=s=>b.value=s),modal:"",header:e.$t("pages.school.assignTeacher"),closable:!1},{default:l(()=>[r("div",ls,[t(de,{modelValue:$.value,"onUpdate:modelValue":a[5]||(a[5]=s=>$.value=s),options:B(R),"option-label":"email",placeholder:e.$t("pages.school.selectTeacher")},null,8,["modelValue","options","placeholder"])]),r("div",os,[t(f,{type:"button",label:e.$t("pages.school.cancel"),severity:"secondary",onClick:a[6]||(a[6]=s=>b.value=!1)},null,8,["label"]),t(f,{type:"button",label:e.$t("pages.school.assign"),onClick:ee,loading:S.value,disabled:S.value},null,8,["label","loading","disabled"])])]),_:1},8,["visible","header"])]}),_:1})}}});export{Ds as default};
