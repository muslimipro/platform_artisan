var Oe=Object.defineProperty;var De=(e,t,r)=>t in e?Oe(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var Ne=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var f=(e,t,r)=>De(e,typeof t!="symbol"?t+"":t,r);var lt=Ne((ut,B)=>{var F=(e=>(e[e.NONE=-1]="NONE",e[e.IN=0]="IN",e[e.OUT=1]="OUT",e))(F||{}),U=(e=>(e[e.NONE=-1]="NONE",e[e.UP=0]="UP",e[e.DOWN=1]="DOWN",e))(U||{}),xe=Object.defineProperty,d=(e,t)=>xe(e,"name",{value:t,configurable:!0}),X=(e=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(e,{get:(t,r)=>(typeof require<"u"?require:t)[r]}):e)(function(e){if(typeof require<"u")return require.apply(this,arguments);throw new Error('Dynamic require of "'+e+'" is not supported')});function Q(e){return!isNaN(parseFloat(e))&&isFinite(e)}d(Q,"_isNumber");function v(e){return e.charAt(0).toUpperCase()+e.substring(1)}d(v,"_capitalize");function T(e){return function(){return this[e]}}d(T,"_getter");var D=["isConstructor","isEval","isNative","isToplevel"],N=["columnNumber","lineNumber"],x=["fileName","functionName","source"],Fe=["args"],ke=["evalOrigin"],I=D.concat(N,x,Fe,ke);function y(e){if(e)for(var t=0;t<I.length;t++)e[I[t]]!==void 0&&this["set"+v(I[t])](e[I[t]])}d(y,"StackFrame");y.prototype={getArgs:function(){return this.args},setArgs:function(e){if(Object.prototype.toString.call(e)!=="[object Array]")throw new TypeError("Args must be an Array");this.args=e},getEvalOrigin:function(){return this.evalOrigin},setEvalOrigin:function(e){if(e instanceof y)this.evalOrigin=e;else if(e instanceof Object)this.evalOrigin=new y(e);else throw new TypeError("Eval Origin must be an Object or StackFrame")},toString:function(){var e=this.getFileName()||"",t=this.getLineNumber()||"",r=this.getColumnNumber()||"",i=this.getFunctionName()||"";return this.getIsEval()?e?"[eval] ("+e+":"+t+":"+r+")":"[eval]:"+t+":"+r:i?i+" ("+e+":"+t+":"+r+")":e+":"+t+":"+r}};y.fromString=d(function(e){var t=e.indexOf("("),r=e.lastIndexOf(")"),i=e.substring(0,t),o=e.substring(t+1,r).split(","),n=e.substring(r+1);if(n.indexOf("@")===0)var s=/@(.+?)(?::(\d+))?(?::(\d+))?$/.exec(n,""),a=s[1],c=s[2],l=s[3];return new y({functionName:i,args:o||void 0,fileName:a,lineNumber:c||void 0,columnNumber:l||void 0})},"StackFrame$$fromString");for(b=0;b<D.length;b++)y.prototype["get"+v(D[b])]=T(D[b]),y.prototype["set"+v(D[b])]=function(e){return function(t){this[e]=!!t}}(D[b]);var b;for(S=0;S<N.length;S++)y.prototype["get"+v(N[S])]=T(N[S]),y.prototype["set"+v(N[S])]=function(e){return function(t){if(!Q(t))throw new TypeError(e+" must be a Number");this[e]=Number(t)}}(N[S]);var S;for(E=0;E<x.length;E++)y.prototype["get"+v(x[E])]=T(x[E]),y.prototype["set"+v(x[E])]=function(e){return function(t){this[e]=String(t)}}(x[E]);var E,C=y;function ee(){var e=/^\s*at .*(\S+:\d+|\(native\))/m,t=/^(eval@)?(\[native code])?$/;return{parse:d(function(r){if(r.stack&&r.stack.match(e))return this.parseV8OrIE(r);if(r.stack)return this.parseFFOrSafari(r);throw new Error("Cannot parse given Error object")},"ErrorStackParser$$parse"),extractLocation:d(function(r){if(r.indexOf(":")===-1)return[r];var i=/(.+?)(?::(\d+))?(?::(\d+))?$/,o=i.exec(r.replace(/[()]/g,""));return[o[1],o[2]||void 0,o[3]||void 0]},"ErrorStackParser$$extractLocation"),parseV8OrIE:d(function(r){var i=r.stack.split(`
`).filter(function(o){return!!o.match(e)},this);return i.map(function(o){o.indexOf("(eval ")>-1&&(o=o.replace(/eval code/g,"eval").replace(/(\(eval at [^()]*)|(,.*$)/g,""));var n=o.replace(/^\s+/,"").replace(/\(eval code/g,"(").replace(/^.*?\s+/,""),s=n.match(/ (\(.+\)$)/);n=s?n.replace(s[0],""):n;var a=this.extractLocation(s?s[1]:n),c=s&&n||void 0,l=["eval","<anonymous>"].indexOf(a[0])>-1?void 0:a[0];return new C({functionName:c,fileName:l,lineNumber:a[1],columnNumber:a[2],source:o})},this)},"ErrorStackParser$$parseV8OrIE"),parseFFOrSafari:d(function(r){var i=r.stack.split(`
`).filter(function(o){return!o.match(t)},this);return i.map(function(o){if(o.indexOf(" > eval")>-1&&(o=o.replace(/ line (\d+)(?: > eval line \d+)* > eval:\d+:\d+/g,":$1")),o.indexOf("@")===-1&&o.indexOf(":")===-1)return new C({functionName:o});var n=/((.*".+"[^@]*)?[^@]*)(?:@)/,s=o.match(n),a=s&&s[1]?s[1]:void 0,c=this.extractLocation(o.replace(n,""));return new C({functionName:a,fileName:c[0],lineNumber:c[1],columnNumber:c[2],source:o})},this)},"ErrorStackParser$$parseFFOrSafari")}}d(ee,"ErrorStackParser");var Ie=new ee,$e=Ie,_=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string"&&!process.browser,te=_&&typeof B<"u"&&typeof B.exports<"u"&&typeof X<"u"&&typeof __dirname<"u",Le=_&&!te,Me=typeof Deno<"u",re=!_&&!Me,Ue=re&&typeof window=="object"&&typeof document=="object"&&typeof document.createElement=="function"&&"sessionStorage"in window&&typeof importScripts!="function",Te=re&&typeof importScripts=="function"&&typeof self=="object";typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent.indexOf("Chrome")==-1&&navigator.userAgent.indexOf("Safari")>-1;var ne,R,ie,Y,W;async function q(){if(!_||(ne=(await import("./__vite-browser-external-9wXp6ZBx.js")).default,Y=await import("./__vite-browser-external-9wXp6ZBx.js"),W=await import("./__vite-browser-external-9wXp6ZBx.js"),ie=(await import("./__vite-browser-external-9wXp6ZBx.js")).default,R=await import("./__vite-browser-external-9wXp6ZBx.js"),H=R.sep,typeof X<"u"))return;let e=Y,t=await import("./__vite-browser-external-9wXp6ZBx.js"),r=await import("./__vite-browser-external-9wXp6ZBx.js"),i=await import("./__vite-browser-external-9wXp6ZBx.js"),o={fs:e,crypto:t,ws:r,child_process:i};globalThis.require=function(n){return o[n]}}d(q,"initNodeModules");function oe(e,t){return R.resolve(t||".",e)}d(oe,"node_resolvePath");function se(e,t){return t===void 0&&(t=location),new URL(e,t).toString()}d(se,"browser_resolvePath");var j;_?j=oe:j=se;var H;_||(H="/");function ae(e,t){return e.startsWith("file://")&&(e=e.slice(7)),e.includes("://")?{response:fetch(e)}:{binary:W.readFile(e).then(r=>new Uint8Array(r.buffer,r.byteOffset,r.byteLength))}}d(ae,"node_getBinaryResponse");function ce(e,t){let r=new URL(e,location);return{response:fetch(r,t?{integrity:t}:{})}}d(ce,"browser_getBinaryResponse");var L;_?L=ae:L=ce;async function le(e,t){let{response:r,binary:i}=L(e,t);if(i)return i;let o=await r;if(!o.ok)throw new Error(`Failed to load '${e}': request failed.`);return new Uint8Array(await o.arrayBuffer())}d(le,"loadBinaryFile");var $;if(Ue)$=d(async e=>await import(e),"loadScript");else if(Te)$=d(async e=>{try{globalThis.importScripts(e)}catch(t){if(t instanceof TypeError)await import(e);else throw t}},"loadScript");else if(_)$=de;else throw new Error("Cannot determine runtime environment");async function de(e){e.startsWith("file://")&&(e=e.slice(7)),e.includes("://")?ie.runInThisContext(await(await fetch(e)).text()):await import(ne.pathToFileURL(e).href)}d(de,"nodeLoadScript");async function ue(e){if(_){await q();let t=await W.readFile(e,{encoding:"utf8"});return JSON.parse(t)}else return await(await fetch(e)).json()}d(ue,"loadLockFile");async function me(){if(te)return __dirname;let e;try{throw new Error}catch(i){e=i}let t=$e.parse(e)[0].fileName;if(_&&!t.startsWith("file://")&&(t=`file://${t}`),Le){let i=await import("./__vite-browser-external-9wXp6ZBx.js");return(await import("./__vite-browser-external-9wXp6ZBx.js")).fileURLToPath(i.dirname(t))}let r=t.lastIndexOf(H);if(r===-1)throw new Error("Could not extract indexURL path from pyodide module location");return t.slice(0,r)}d(me,"calculateDirname");function fe(e){let t=e.FS,r=e.FS.filesystems.MEMFS,i=e.PATH,o={DIR_MODE:16895,FILE_MODE:33279,mount:function(n){if(!n.opts.fileSystemHandle)throw new Error("opts.fileSystemHandle is required");return r.mount.apply(null,arguments)},syncfs:async(n,s,a)=>{try{let c=o.getLocalSet(n),l=await o.getRemoteSet(n),u=s?l:c,m=s?c:l;await o.reconcile(n,u,m),a(null)}catch(c){a(c)}},getLocalSet:n=>{let s=Object.create(null);function a(u){return u!=="."&&u!==".."}d(a,"isRealDir");function c(u){return m=>i.join2(u,m)}d(c,"toAbsolute");let l=t.readdir(n.mountpoint).filter(a).map(c(n.mountpoint));for(;l.length;){let u=l.pop(),m=t.stat(u);t.isDir(m.mode)&&l.push.apply(l,t.readdir(u).filter(a).map(c(u))),s[u]={timestamp:m.mtime,mode:m.mode}}return{type:"local",entries:s}},getRemoteSet:async n=>{let s=Object.create(null),a=await Pe(n.opts.fileSystemHandle);for(let[c,l]of a)c!=="."&&(s[i.join2(n.mountpoint,c)]={timestamp:l.kind==="file"?(await l.getFile()).lastModifiedDate:new Date,mode:l.kind==="file"?o.FILE_MODE:o.DIR_MODE});return{type:"remote",entries:s,handles:a}},loadLocalEntry:n=>{let s=t.lookupPath(n).node,a=t.stat(n);if(t.isDir(a.mode))return{timestamp:a.mtime,mode:a.mode};if(t.isFile(a.mode))return s.contents=r.getFileDataAsTypedArray(s),{timestamp:a.mtime,mode:a.mode,contents:s.contents};throw new Error("node type not supported")},storeLocalEntry:(n,s)=>{if(t.isDir(s.mode))t.mkdirTree(n,s.mode);else if(t.isFile(s.mode))t.writeFile(n,s.contents,{canOwn:!0});else throw new Error("node type not supported");t.chmod(n,s.mode),t.utime(n,s.timestamp,s.timestamp)},removeLocalEntry:n=>{var s=t.stat(n);t.isDir(s.mode)?t.rmdir(n):t.isFile(s.mode)&&t.unlink(n)},loadRemoteEntry:async n=>{if(n.kind==="file"){let s=await n.getFile();return{contents:new Uint8Array(await s.arrayBuffer()),mode:o.FILE_MODE,timestamp:s.lastModifiedDate}}else{if(n.kind==="directory")return{mode:o.DIR_MODE,timestamp:new Date};throw new Error("unknown kind: "+n.kind)}},storeRemoteEntry:async(n,s,a)=>{let c=n.get(i.dirname(s)),l=t.isFile(a.mode)?await c.getFileHandle(i.basename(s),{create:!0}):await c.getDirectoryHandle(i.basename(s),{create:!0});if(l.kind==="file"){let u=await l.createWritable();await u.write(a.contents),await u.close()}n.set(s,l)},removeRemoteEntry:async(n,s)=>{await n.get(i.dirname(s)).removeEntry(i.basename(s)),n.delete(s)},reconcile:async(n,s,a)=>{let c=0,l=[];Object.keys(s.entries).forEach(function(p){let g=s.entries[p],w=a.entries[p];(!w||t.isFile(g.mode)&&g.timestamp.getTime()>w.timestamp.getTime())&&(l.push(p),c++)}),l.sort();let u=[];if(Object.keys(a.entries).forEach(function(p){s.entries[p]||(u.push(p),c++)}),u.sort().reverse(),!c)return;let m=s.type==="remote"?s.handles:a.handles;for(let p of l){let g=i.normalize(p.replace(n.mountpoint,"/")).substring(1);if(a.type==="local"){let w=m.get(g),J=await o.loadRemoteEntry(w);o.storeLocalEntry(p,J)}else{let w=o.loadLocalEntry(p);await o.storeRemoteEntry(m,g,w)}}for(let p of u)if(a.type==="local")o.removeLocalEntry(p);else{let g=i.normalize(p.replace(n.mountpoint,"/")).substring(1);await o.removeRemoteEntry(m,g)}}};e.FS.filesystems.NATIVEFS_ASYNC=o}d(fe,"initializeNativeFS");var Pe=d(async e=>{let t=[];async function r(o){for await(let n of o.values())t.push(n),n.kind==="directory"&&await r(n)}d(r,"collect"),await r(e);let i=new Map;i.set(".",e);for(let o of t){let n=(await e.resolve(o)).join("/");i.set(n,o)}return i},"getFsHandles");function pe(e){let t={noImageDecoding:!0,noAudioDecoding:!0,noWasmDecoding:!1,preRun:we(e),quit(r,i){throw t.exited={status:r,toThrow:i},i},print:e.stdout,printErr:e.stderr,arguments:e.args,API:{config:e},locateFile:r=>e.indexURL+r,instantiateWasm:ve(e.indexURL)};return t}d(pe,"createSettings");function he(e){return function(t){let r="/";try{t.FS.mkdirTree(e)}catch(i){console.error(`Error occurred while making a home directory '${e}':`),console.error(i),console.error(`Using '${r}' for a home directory instead`),e=r}t.FS.chdir(e)}}d(he,"createHomeDirectory");function ye(e){return function(t){Object.assign(t.ENV,e)}}d(ye,"setEnvironment");function _e(e){return t=>{for(let r of e)t.FS.mkdirTree(r),t.FS.mount(t.FS.filesystems.NODEFS,{root:r},r)}}d(_e,"mountLocalDirectories");function ge(e){let t=le(e);return r=>{let i=r._py_version_major(),o=r._py_version_minor();r.FS.mkdirTree("/lib"),r.FS.mkdirTree(`/lib/python${i}.${o}/site-packages`),r.addRunDependency("install-stdlib"),t.then(n=>{r.FS.writeFile(`/lib/python${i}${o}.zip`,n)}).catch(n=>{console.error("Error occurred while installing the standard library:"),console.error(n)}).finally(()=>{r.removeRunDependency("install-stdlib")})}}d(ge,"installStdlib");function we(e){let t;return e.stdLibURL!=null?t=e.stdLibURL:t=e.indexURL+"python_stdlib.zip",[ge(t),he(e.env.HOME),ye(e.env),_e(e._node_mounts),fe]}d(we,"getFileSystemInitializationFuncs");function ve(e){if(typeof WasmOffsetConverter<"u")return;let{binary:t,response:r}=L(e+"pyodide.asm.wasm");return function(i,o){return async function(){try{let n;r?n=await WebAssembly.instantiateStreaming(r,i):n=await WebAssembly.instantiate(await t,i);let{instance:s,module:a}=n;o(s,a)}catch(n){console.warn("wasm instantiation failed!"),console.warn(n)}}(),{}}}d(ve,"getInstantiateWasmFunc");var G="0.27.2";async function be(e={}){var t,r;await q();let i=e.indexURL||await me();i=j(i),i.endsWith("/")||(i+="/"),e.indexURL=i;let o={fullStdLib:!1,jsglobals:globalThis,stdin:globalThis.prompt?globalThis.prompt:void 0,lockFileURL:i+"pyodide-lock.json",args:[],_node_mounts:[],env:{},packageCacheDir:i,packages:[],enableRunUntilComplete:!1,checkAPIVersion:!0,BUILD_ID:"f88dc4abb40ec8e780c94a5f70bcef45ec9eb3c1aee1c99da527febfef1c6f3f"},n=Object.assign(o,e);(t=n.env).HOME??(t.HOME="/home/pyodide"),(r=n.env).PYTHONINSPECT??(r.PYTHONINSPECT="1");let s=pe(n),a=s.API;if(a.lockFilePromise=ue(n.lockFileURL),typeof _createPyodideModule!="function"){let p=`${n.indexURL}pyodide.asm.js`;await $(p)}let c;if(e._loadSnapshot){let p=await e._loadSnapshot;ArrayBuffer.isView(p)?c=p:c=new Uint8Array(p),s.noInitialRun=!0,s.INITIAL_MEMORY=c.length}let l=await _createPyodideModule(s);if(s.exited)throw s.exited.toThrow;if(e.pyproxyToStringRepr&&a.setPyProxyToStringMethod(!0),a.version!==G&&n.checkAPIVersion)throw new Error(`Pyodide version does not match: '${G}' <==> '${a.version}'. If you updated the Pyodide version, make sure you also updated the 'indexURL' parameter passed to loadPyodide.`);l.locateFile=p=>{throw new Error("Didn't expect to load any more file_packager files!")};let u;c&&(u=a.restoreSnapshot(c));let m=a.finalizeBootstrap(u,e._snapshotDeserializer);return a.sys.path.insert(0,a.config.env.HOME),m.version.includes("dev")||a.setCdnUrl(`https://cdn.jsdelivr.net/pyodide/v${m.version}/full/`),a._pyodide.set_excepthook(),await a.packageIndexReady,a.initializeStreams(n.stdin,n.stdout,n.stderr),m}d(be,"loadPyodide");const z=new SharedArrayBuffer(16),A=new Int32Array(z),Ce=new SharedArrayBuffer(1),Z=new Uint8Array(Ce);let K=0;function h(e){Atomics.store(A,0,0),e.id=K,postMessage(e),Atomics.wait(A,0,0),K++}function Re(e,t){return e+t}function Se(e,t){return e-t}class V{constructor(t,r,i){f(this,"pin");this.pin=t,h({command:"pin mode",data:{pin:this.pin,mode:r}}),h({command:"pin pull",data:{pin:this.pin,pull:i}})}on(){h({command:"on",data:{pin:this.pin}})}off(){h({command:"off",data:{pin:this.pin}})}toggle(){h({command:"toggle",data:{pin:this.pin}})}value(t=null){if(t===1)h({command:"on",data:{pin:this.pin}});else if(t===0)h({command:"off",data:{pin:this.pin}});else return h({command:"value",data:{pin:this.pin}}),Atomics.load(A,1)}}function M(e){return e instanceof V?e.pin:e}class je{constructor(t,r,i){f(this,"pin");this.pin=M(t),t instanceof V?h({command:"pin mode",data:{pin:this.pin,mode:F.OUT}}):h({command:"pin mode",data:{pin:this.pin,mode:F.OUT}})}freq(t){h({command:"pwm freq",data:{freq:t,pin:this.pin}})}duty_u16(t){h({command:"pwm duty_u16",data:{duty_u16:t,pin:this.pin}})}}const Be={0:[0,4,8,12,16,20],1:[2,6,10,14,18,26]},We={0:[1,5,9,13,17,21],1:[3,7,11,15,19,27]};class P{constructor(t,r,i,o=4e5,n=5e4){f(this,"id");f(this,"sda");f(this,"scl");f(this,"freq");f(this,"timeout");if(t!==0&&t!==1)throw`I2C(${t}) doesn't exist: only 0 and 1 can be used`;const s=M(r),a=M(i);if(!We[t].includes(a))throw"Bad SCL pin: "+a;if(!Be[t].includes(s))throw"Bad SDA pin: "+s;this.sda=s,this.scl=a,this.id=t,this.freq=o,this.timeout=n}readfrom(t,r){throw"Not implemented"}writeto(t,r){throw"Not implemented"}scan(){h({command:"i2c scan",data:{sda:this.sda,scl:this.scl}});const t=Atomics.load(A,1),r=[];return r.toString=function(){return`[${this.join(", ")}]`},t<0||r.push(t),r}toString(){return`I2C(${this.id}, freq=${this.freq}, scl=${this.scl}, sda=${this.sda}, timeout=${this.timeout})`}}class qe{constructor(t){f(this,"i2c");f(this,"addr");this.i2c=t,this.addr=118}read(){h({command:"climate read",data:{sda:this.i2c.sda,scl:this.i2c.scl}});const t=new Uint8Array(z),r=Atomics.load(t,4),i=Atomics.load(t,5),o=Atomics.load(t,6);if(Atomics.load(t,7))throw`sda=${this.i2c.sda}, scl=${this.i2c.scl} are not connected to a Color Sensor`;const s=15+r/255*20,a=i/255*100,c=o/255*200+900,l=new Map;return l.set("temperature",Math.round(s*100)/100),l.set("humidity",Math.round(a*100)/100),l.set("pressure",Math.round(c*100)/100),l.toString=function(){return`{${Array.from(this.entries()).map(([m,p])=>`'${m}': ${p}`).join(", ")}}`},l}temperature(){return this.read().get("temperature")}humidity(){return this.read().get("humidity")}pressure(){return this.read().get("pressure")}}class He{constructor(t,r){f(this,"i2c");f(this,"address");f(this,"_started");f(this,"min_valid_mm");f(this,"max_valid_mm");f(this,"_on_close");f(this,"_on_motion");f(this,"_close_threshold");f(this,"_motion_threshold");f(this,"_last_distance");f(this,"_motion_last_trigger");f(this,"_motion_cooldown_ms");if(this.i2c=t,this.address=r,this._started=!1,this._on_close=null,this._on_motion=null,this._close_threshold=null,this._motion_threshold=null,this._last_distance=null,this._motion_last_trigger=0,this._motion_cooldown_ms=500,this.min_valid_mm=20,this.max_valid_mm=2e3,!this.i2c.scan().includes(this.address))throw`sda=${this.i2c.sda}, scl=${this.i2c.scl} are not connected to a Distance Sensor`}read(){h({command:"distance read",data:{sda:this.i2c.sda,scl:this.i2c.scl}});const t=Atomics.load(A,1);if(t<0)throw`sda=${this.i2c.sda}, scl=${this.i2c.scl} are not connected to a Distance Sensor`;return t}is_valid(t){return this.min_valid_mm<t&&t<this.max_valid_mm}add_cloase_trigger(t,r){this._close_threshold=t,this._on_close=r}add_motion_trigger(t,r,i=500){this._motion_threshold=t,this._on_motion=r,this._last_distance=null,this._motion_cooldown_ms=i}check(){const t=this.read();if(this.is_valid(t)&&(this._on_close&&this._close_threshold&&t<this._close_threshold&&this._on_close(t),this._on_motion&&this._last_distance&&this._motion_threshold)){const r=Math.abs(t-this._last_distance),i=performance.now();r>this._motion_threshold&&Se(i,this._motion_last_trigger)>this._motion_cooldown_ms&&(this._motion_last_trigger=i,this._on_motion(t,r)),this._last_distance=t}}bar(t=200,r=20,i="#",o=" "){const n=this.read();if(!this.is_valid(n))return`[${"?".repeat(r)}] invalid (${n} mm)`;const s=Math.min(r,Math.floor(n/t*r)),a=i.repeat(s),c=o.repeat(r-s);return`[${a}${c}] ${n} mm`}}class ze{constructor(t,r,i,o){f(this,"i2c");f(this,"addr");this.i2c=new P(t,i,o,r),this.addr=16}readRGB(){h({command:"color readRGB",data:{sda:this.i2c.sda,scl:this.i2c.scl}});const t=new Uint8Array(z),r=Atomics.load(t,4),i=Atomics.load(t,5),o=Atomics.load(t,6),n=Atomics.load(t,7),s=r+i+o;if(n)throw`sda=${this.i2c.sda}, scl=${this.i2c.scl} are not connected to a Color Sensor`;let a=.048403*r+.183633*i+-.253589*o,c=.022916*r+.176388*i+-.183205*o,l=-.077436*r+.124541*i+.032081*o;const u=a+c+l+1,m=new Map;a=a/u,c=c/u;const p=(a-.332)/(.1858-c),g=449*p**3+3525*p**2+6823.3*p+5520.33,w=.25168;return m.set("red",r),m.set("green",i),m.set("blue",o),m.set("white",s),m.set("als",i*w),m.set("cct",g),m.toString=function(){return`{${Array.from(this.entries()).map(([Ee,Ae])=>`'${Ee}': ${Ae}`).join(", ")}}`},m}classifyHue(t={red:0,yellow:60,green:120,cyan:180,blue:240,magenta:300},r=0){const i=this.readHSV();if(i.val>r){let o="None",n=1/0;for(const[s,a]of Object.entries(t)){const c=Math.min(360-Math.abs(i.hue-a),Math.abs(i.hue-a));c<n&&(n=c,o=s)}return o}else return"None"}readHSV(){const t=this.readRGB();let r=t.get("red"),i=t.get("green"),o=t.get("blue");r=r/256,i=i/256,o=o/256;const n=Math.max(r,i,o),s=Math.min(r,i,o);let[a,c,l]=[n,n,n];const u=n-s;return c=n==0?0:u/n,n==s?a=0:(n==r?a=(i-o)/u+(i<o?6:0):n==i?a=(o-r)/u+2:n==o&&(a=(r-i)/u+4),a/=6),{hue:a*360,sat:c,val:l}}detectColor(){const t=this.readHSV(),{hue:r,sat:i,val:o}=t;return o<.015?"black":i<.15&&o>.75?"white":i<.15&&o<=.75?"gray":r<15||r>=345?"red":r<35?"orange":r<65?"yellow":r<170?"green":r<200?"cyan":r<250?"blue":r<295?"magenta":r<345?"pink":"unknown"}lux(){throw"Not implemented"}}class Ve{constructor(t){f(this,"pin");if(this.pin=M(t),this.pin!==26&&this.pin!==27&&this.pin!==28)throw`Pin(${this.pin}) doesn't have ADC capabilities`}read_u16(){return h({command:"adc read_u16",data:{pin:this.pin}}),Atomics.load(A,1)}}class Je{constructor(t,r,i){f(this,"cs");f(this,"dc");f(this,"rst");f(this,"_text");f(this,"_x");f(this,"_y");this.cs=t,this.dc=r,this.rst=i,this._text="",this._x=0,this._y=0}display_text(t,r,i){this._text=t,this._x=r,this._y=i,h({command:"display_text",data:{text:t,x:r,y:i}})}get text(){return this._text}get x(){return this._x}get y(){return this._y}}const Ye=e=>new Ve(e),k={A:[0,1],B:[2,3],D:[4,5],E:[6,7],F:[26,27]},Ge=(e="A")=>{if(!k[e])throw"Invalid slot for Climate Sensor. Use A, B, D, E, or F (C is not I2C-compatible)";const[r,i]=k[e],o=["A","D"].includes(e)?0:1,n=new P(o,r,i);return new qe(n)},Ze=(e,t=4e5)=>{if(e=e.toUpperCase(),!k[e])throw"Invalid slot Color Sensor. Use A, B, D, E, or F (C is not I2C-compatible)";const[i,o]=k[e],n=["A","D"].includes(e)?0:1;return new ze(n,t,i,o)},Ke={0:5,1:3},Xe={0:0,1:2},Qe=(e,{sda:t=Xe[e],scl:r=Ke[e],freq:i=4e5,timeout:o=5e4}={})=>new P(e,t,r,i,o),O=(e,t=F.IN,r=U.NONE)=>new V(e,t,r),et=(e,t,r)=>new je(e,t,r),tt=(e,t,r)=>new Je(e,t,r);O.IN=F.IN;O.OUT=F.OUT;O.PULL_UP=U.UP;O.PULL_DOWN=U.DOWN;const rt=(e="A",t=41)=>{if(e=e.toUpperCase(),!k[e])throw"Invalid slot Distance Sensor. Use A, B, D, E, or F (C is not I2C-compatible)";const[i,o]=k[e],n=["A","D"].includes(e)?0:1,s=new P(n,i,o);return new He(s,t)},nt={Distance:rt},it={Climate:Ge},ot={ColorSensor:Ze},st={ST7789:tt},at={Pin:O,PWM:et,ADC:Ye,I2C:Qe},ct={display:e=>{h({command:"display_text",data:{text:e,x:0,y:16}})},clear:()=>{h({command:"clear_display"})},LED:e=>O(e,O.OUT)};(async()=>{const e=await be({stdout:o=>{h({command:"output",data:o+`
\r`})}});e.setDebug(!0);const t=new Int32Array(new SharedArrayBuffer(4)),r={sleep:o=>{const n=o*1e3;r.sleep_ms(n)},sleep_ms:o=>{const s=performance.now()+o,a=Math.min(o/20,50);for(;performance.now()<s;){const c=s-performance.now();Atomics.wait(t,0,0,Math.min(a,c)),e.checkInterrupt()}},sleep_us:o=>{r.sleep_ms(o/1e3)},ticks_ms:()=>performance.now(),ticks_us:()=>performance.now()*1e3,ticks_add:Re,ticks_diff:Se,time:()=>Date.now(),time_ns:()=>performance.now()*1e3*1e3};e.registerJsModule("utime",r),e.registerJsModule("machine",at),e.registerJsModule("artisan",st),e.registerJsModule("distance",nt),e.registerJsModule("climate",it),e.registerJsModule("colorsensor",ot),e.registerJsModule("rtzero",ct),e.setInterruptBuffer(Z);const i=`
import time
import utime
time.sleep = utime.sleep
`;self.onmessage=o=>{const{command:n,code:s}=o.data;if(n==="runPython"){if(!e){postMessage({command:"error",error:"Interpreter not initialized"});return}try{e.runPython(i),e.runPython(s),postMessage({command:"finished"})}catch(a){let c="";if(a instanceof Error){const l=a.message.split(`
`),u=l.findIndex(m=>m.includes("<exec>"));u!==-1?c=l.slice(u).filter(m=>!m.includes("mpWorker.ts")&&!/mpWorker-[A-Za-z0-9]+\.js/.test(m)&&!m.includes("pyodide.asm.js")).join(`
`):c=a.message}else c=String(a);postMessage({command:"error",data:c})}}},postMessage({command:"initialized",data:{sharedArrayInterrupt:Z,sharedArray:A}})})()});export default lt();
