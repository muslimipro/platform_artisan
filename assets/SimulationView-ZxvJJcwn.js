import{T as ae}from"./index-BOe8HTYE.js";import{a as E,r as T,G as F,o as q,E as re,b as c,e as y,h as i,_ as g,g as e,t as D,F as L,j as A,n as S,a7 as le,f as B,l as R,k as P,aj as ie,c as O,C as Y,Y as ue,a1 as de,a2 as Z,U as z,w as ee,ah as j,S as H,W as te,q as pe}from"./index-BEuVwAr8.js";import{s as ce}from"./index-BRCmLd1m.js";import{h as fe,a6 as he,ap as se,aa as ve,a9 as xe,aq as ye,ar as we,a as U,as as me,at as ge,au as be,av as _e,aw as ke}from"./vue-codemirror.esm-CdIqRNbs.js";import{_ as X}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{g as $e}from"./index-DF1O2LY1.js";const Me="/assets/pibody-CmiHEiCK.png",Pe=["width","height"],I=12,Se=E({__name:"DisplayView",props:{id:{default:"default"}},setup(b){const t=b,s=T(112),x=T(160),$=T(null),v=T(null),a=T(0),d=fe(t.id);d.text.value||(d.text.value="");function r(o){const f=o.deltaY>0?1:-1;a.value+=f*I,a.value=Math.max(0,a.value);const{lines:w,visibleLines:h}=n();a.value=Math.min(w.length*I,a.value),p(w,h)}function n(){const o=[];let f=0;return v.value&&d.text.value&&(String(d.text.value).split(`
`).forEach(h=>{let m="";h.split(" ").forEach(_=>{const u=m+_+" ";v.value.measureText(u).width>s.value?(o.push(m),m=_+" "):m=u}),o.push(m)}),f=Math.ceil(x.value/I)),{lines:o,visibleLines:f}}function p(o,f){if(v.value){v.value.fillStyle="#FFFFFF",v.value.fillRect(0,0,s.value,x.value),v.value.fillStyle=String(d.textColor.value)||"#000000",v.value.font="12px Monaco";const w=Math.floor(a.value/I);for(let h=0;h<f;h++){const m=w+h;if(m<o.length){const k=(h+1)*I-a.value%I;v.value.fillText(o[m],0,k)}}}}return F([d.text,d.textColor],()=>{const{lines:o,visibleLines:f}=n();a.value=Math.max(0,(o.length-f)*I),p(o,f)}),q(async()=>{if(await re(),!!$.value&&(v.value=$.value.getContext("2d"),v.value)){v.value.fillStyle="#FFFFFF",v.value.fillRect(0,0,s.value,x.value);const{lines:o,visibleLines:f}=n();a.value=0,p(o,f)}}),(o,f)=>(c(),y("div",{class:"display-container",onWheel:r},[i("canvas",{ref_key:"canvas",ref:$,width:s.value,height:x.value,style:{border:"1px solid black",width:"112px",height:"160px"}},null,8,Pe)],32))}}),Le=X(Se,[["__scopeId","data-v-0149e8f3"]]),oe=E({__name:"PinInfo",props:{pin:{},withPin:{},isLeft:{type:Boolean}},setup(b){return(t,s)=>(c(),y(L,null,[i("div",{class:S(["flex",t.isLeft?"flex-row":"flex-row-reverse"])},[i("div",{style:g({background:e(he)}),class:"text-center font-mono px-1 mr-1"},D(e(se)[t.pin.id].name),5),(c(!0),y(L,null,A(e(se)[t.pin.id].able,x=>(c(),y("div",{style:g({background:x.color}),class:"text-center font-mono px-1 mr-1"},D(x.name),5))),256))],2),i("div",{class:S(["flex my-1 mb-3",t.isLeft?"flex-row":"flex-row-reverse"])},[i("div",{style:g({background:`${e(ve)[t.pin.mode]}`}),class:"text-center px-4 mr-1 rounded-lg"},D(e(xe)[t.pin.mode]),5),i("div",{style:g(e(ye)(t.pin,t.withPin)),class:"text-center px-4 mr-1 rounded-lg bg-black"},D(e(we)(t.pin,t.withPin)),5)],2)],64))}}),Ce=["id"],Ie=E({__name:"SlotView",props:{slot:{},index:{},id:{}},setup(b){const{isOutside:t}=$e(le("theref")),s=U(b.id),{maxAreaIndex:x,fromSlotIndex:$,settings:v}=s,a=b.index<3;return(d,r)=>{var n;return c(),y(L,null,[i("div",{id:`slot-${d.slot.id}`,ref:"theref",class:S(["absolute w-20 h-20 rounded-lg text-center",[{"bg-green-200/[0.5]":e(x)==d.index,"bg-blue-200/[0.5]":e($)==d.index},d.slot.class]]),style:g([d.slot.style,e(me)(d.slot)])},[!e(t)&&((n=e(v))!=null&&n.showPinInfo)?(c(),y("div",{key:0,class:"absolute w-fit whitespace-nowrap text-white flex flex-col text-xs bg-black/70",style:g(a?"left:100%":"right:100%")},[B(oe,{pin:d.slot.pin2,withPin:d.slot.with.pin2,isLeft:a},null,8,["pin","withPin"]),B(oe,{pin:d.slot.pin3,withPin:d.slot.with.pin3,isLeft:a},null,8,["pin","withPin"])],4)):R("",!0)],14,Ce),e(t)?R("",!0):(c(),P(ie,{key:0,to:`#pibody-${d.id}`},null,8,["to"]))],64)}}}),Fe=["width","height"],De=["points","stroke"],N=3,ne=14,V=10,Ee=E({__name:"Connector",props:{start:{},end:{},style:{},id:{}},setup(b){const t=b,s=U(t.id),x=O(()=>{const{start:r,end:n}=t,p=40,o=[{x:r.x,y:r.y}];return o.push({x:r.x,y:r.y-p}),o.push({x:(n.x+r.x)/2,y:r.y-p}),o.push({x:(n.x+r.x)/2,y:n.y-n.yOffset}),o.push({x:n.x,y:n.y-n.yOffset}),o.push({x:n.x,y:n.y}),o}),$=[{color:"orange",offset:-N,end:-ne/2},{color:"red",offset:0,end:0},{color:"saddlebrown",offset:N,end:ne/2}],v=O(()=>{const r=x.value,n=[];return $.forEach(p=>{const o=p.offset,f=p.end;let w="";for(let k=0;k<r.length-2;k++){const _=r[k];w+=`${_.x-a.value.x-o},${_.y-a.value.y-o} `}const h=r[r.length-2];w+=`${h.x-a.value.x+o},${h.y-a.value.y-o} `;const m=r[r.length-1];w+=`${m.x-a.value.x+f},${m.y-a.value.y+3} `,n.push({color:p.color,points:w})}),n}),a=O(()=>{const r=[],n=[];for(const h of x.value)r.push(h.x),n.push(h.y);const p=Math.min(...r)-V,o=Math.min(...n)-V,f=Math.max(...r)+V,w=Math.max(...n)+V;return{x:p,y:o,w:f-p,h:w-o}}),d=r=>{t.end.at!==s.pinNone&&s.moveConnectorEnd(t,r)};return(r,n)=>(c(),y(L,null,[i("div",{class:"absolute bg-black cursor-move",style:g([t.style,{left:t.end.x-12+"px",top:t.end.y+"px",width:t.end.w+"px",height:t.end.h+"px"}]),onPointerdown:[n[0]||(n[0]=Y(p=>p.preventDefault(),["prevent"])),d]},null,36),i("div",{class:"absolute pointer-events-none",style:g([t.style,e(ge)(a.value)])},[(c(),y("svg",{xmlns:"http://www.w3.org/2000/svg",width:a.value.w,height:a.value.h},[(c(!0),y(L,null,A(v.value,(p,o)=>(c(),y("polyline",{key:o,points:p.points,stroke:p.color,fill:"none","stroke-width":N,"stroke-linejoin":"round","stroke-linecap":"round"},null,8,De))),128))],8,Fe))],4)],64))}}),Te=X(Ee,[["__scopeId","data-v-9a0ab2fc"]]),ze=E({__name:"Canvas",setup(b){const t=le("canvasEl");return q(async()=>{t.value&&(await be(t.value),requestAnimationFrame(_e))}),ue(()=>{t.value&&ke(t.value)}),(s,x)=>(c(),y("canvas",{ref_key:"canvasEl",ref:t},null,512))}}),Ae=["id"],Be=["id"],Ve={class:"absolute top-4 right-1 flex flex-col gap-1"},We={class:"material-icons"},Oe=["id"],je={class:"max-h-fit w-full overflow-auto flex flex-wrap gap-2 justify-center items-start mt-2",style:{"touch-action":"none",padding:"0px 0 15px 0"}},He=E({__name:"SimulationView",props:de({id:{},horizontal:{type:Boolean}},{neededModules:{default:[]},neededModulesModifiers:{},slots:{default:[]},slotsModifiers:{}}),emits:["update:neededModules","update:slots"],setup(b){const t=b,s=U(t.id,t.horizontal),{toDelete:x,slots:$,modules:v,isConnect8or9:a,chosenPin8or9:d,pin8:r,pin9:n,settings:p,clearSlotsModulesClasses:o,modulesWerePut:f,lightUp:w}=s,h=Z(b,"neededModules"),m=Z(b,"slots");q(()=>{s.putModuleList(m.value)});function k(_){if(f.value=!0,!(!h.value||h.value.length===0)){o();for(const u of h.value){if(!u.slot||!u.module)continue;if(s.getSlotPinWith(u.slot).type!==u.module){w(u.slot,u.module),f.value=!1;break}}}}F([s.slotHasList],()=>{m.value=s.slotHasList()});for(const _ of s.slots)F(()=>_.with.type,()=>{k()},{immediate:!0});return F(()=>s.pin8.with.type,()=>{k(s.pin8)},{immediate:!0}),F(()=>s.pin9.with.type,()=>{k(s.pin9)},{immediate:!0}),F(h,()=>{for(const _ of s.slots)k()}),(_,u)=>{var J,Q;const W=ce,G=pe,K=ae;return c(),y("div",{id:`emulator-${t.id}`,key:`emulator-${t.id}`,class:S({"h-[450px] flex flex-row":_.horizontal,"h-full flex flex-col":!_.horizontal,"parent relative items-stretch border-t border-surface overflow-hidden select-none":!0})},[i("div",null,D(t.id),1),i("div",{id:`pibody-${t.id}`,class:"relative h-[450px] flex-shrink-0 overflow-x-hidden overflow-y-auto w-[450px]"},[B(W,{src:e(Me),width:"384px",draggable:"false",class:"absolute pt-4 min-w-[384px]",style:{left:"32px",top:"0px"}},null,8,["src"]),B(Le,{class:"absolute top-[217px] left-[168px] w-[112px] h-[160px]",id:`${t.id}`},null,8,["id"]),i("div",Ve,[z((c(),P(G,{type:"button",class:S(["w-9 h-9 mr-1",(J=e(p))!=null&&J.showPinInfo?"bg-green-500":"bg-gray-500"]),rounded:"",onClick:u[0]||(u[0]=l=>{var M;return e(s).setSettings({showPinInfo:!((M=e(p))!=null&&M.showPinInfo)})})},{default:ee(()=>{var l;return[i("span",We,D(((l=e(p))!=null&&l.showPinInfo,"help_center")),1)]}),_:1},8,["class"])),[[K,`Pin Information: ${(Q=e(p))!=null&&Q.showPinInfo?"On":"Off"}`,void 0,{left:!0}]]),z((c(),P(G,{type:"button",class:"w-9 h-9 mr-1 bg-gray-500",rounded:"",onClick:u[1]||(u[1]=l=>e(s).reset())},{default:ee(()=>u[4]||(u[4]=[i("span",{class:"material-icons"},"restart_alt",-1)])),_:1})),[[K,"Reset pibody",void 0,{left:!0}]])]),(c(!0),y(L,null,A(e($),(l,M)=>(c(),P(Ie,{key:M,slot:l,index:M,id:t.id},null,8,["slot","index","id"]))),128)),i("div",{class:"absolute bg-black",style:g({left:e(s).usb.x+"px",top:e(s).usb.y-70+"px",width:e(s).usb.w+"px",height:e(s).usb.h+50+"px"})},null,4),i("div",{class:"absolute",style:g({left:e(s).onLED.x+"px",top:e(s).onLED.y+"px",width:e(s).onLED.w+"px",height:e(s).onLED.h+"px"})},null,4),z(i("div",{class:"absolute flex items-center justify-center animate-bounce-up z-10 pointer-events-none",style:g({left:e(s).helpArrows[8].x+"px",top:e(s).helpArrows[8].y+"px"})},[i("span",{class:S(["icon-arrow-down text-5xl",[e(d)===e(r)?"text-green-500":"text-gray-500",e(s).helpArrows[8].class]]),style:g(e(s).helpArrows[8].style)},null,6),u[5]||(u[5]=i("span",{class:"absolute text-white font-bold -mt-2"},"8",-1))],4),[[j,e(s).helpArrows[8].visible||e(a)]]),z(i("div",{class:"absolute flex items-center justify-center animate-bounce-down z-10 pointer-events-none",style:g({left:e(n).x-10+"px",top:e(n).y+8+"px"})},[i("span",{class:S(["icon-arrow-up text-5xl",e(d)===e(n)?"text-green-500":"text-gray-500"]),style:g(e(s).helpArrows[9].style)},null,6),u[6]||(u[6]=i("span",{class:"absolute text-white font-bold -mt-2"},"9",-1))],4),[[j,e(s).helpArrows[9].visible||e(a)]]),B(ze,{class:"absolute top-0 left-0 z-10 w-full h-full pointer-events-none",id:t.id},null,8,["id"])],8,Be),i("div",{id:`module-list-${t.id}`,class:"relative h-full flex-1 overflow-auto overflow-x-hidden w-[450px]"},[i("div",je,[(c(!0),y(L,null,A(e(s).neededModules.value,(l,M)=>(c(),P(te(l.is),H({key:M,class:l.class,style:l.style,ref_for:!0},l,{onPointerdown:[C=>e(s).startDragFromModuleList(l,C),u[2]||(u[2]=Y(C=>C.preventDefault(),["prevent"]))],class:"flex-none w-20 h-20 cursor-move"}),null,16,["class","style","onPointerdown"]))),128)),z(i("div",{class:S(["absolute top-0 left-0 h-full w-full",{"bg-red-500/[0.8]":e(x)}])},u[7]||(u[7]=[i("div",{class:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2"},[i("span",{class:"material-icons",style:{"font-size":"100px"}},"delete")],-1)]),2),[[j,e(x)]])])],8,Oe),(c(!0),y(L,null,A(e(v),(l,M)=>(c(),P(ie,{defer:"",to:l.dragging?`#emulator-${t.id}`:`#pibody-${t.id}`,key:l.id},[l.putOn8or9&&l.connector.end.x!==0&&l.connector.end.y!==0?(c(),P(Te,H({key:0,ref_for:!0},l.connector,{id:t.id}),null,16,["id"])):R("",!0),(c(),P(te(l.is),H({class:l.class,style:[l.style,{left:l.x+"px",top:l.y+"px"}],ref_for:!0},l,{onPointerdown:[C=>e(s).startDragFromSlot(l,M,l.on,C),u[3]||(u[3]=Y(C=>C.preventDefault(),["prevent"]))],class:"absolute w-20 h-20 rounded-xl cursor-move",style:{"touch-action":"none"}}),null,16,["class","style","onPointerdown"]))],8,["to"]))),128))],10,Ae)}}}),Ge=X(He,[["__scopeId","data-v-149aefe2"]]);export{Ge as S};
