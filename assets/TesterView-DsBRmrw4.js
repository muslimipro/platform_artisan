import{s as Se,a as Te}from"./index-CVp0BhX2.js";import{_ as Ie}from"./IdeHeader.vue_vue_type_script_setup_true_lang-R4thczZd.js";import{s as ae}from"./index-ChOX4LA1.js";import{s as Fe}from"./index-7OA1qYBw.js";import{s as De}from"./index-BYv6yn4V.js";import{a as O,b as o,e as r,g as e,h as t,t as a,_ as u,c as oe,F as B,i as N,l as R,j as X,r as G,k as j,w as g,n as Q,f as m,q as be,u as Me,D as Re,s as ce,o as Ve,G as ie,x as Ne}from"./index-BEuVwAr8.js";import{s as je}from"./index-DeWYWJuM.js";import{a5 as M,a6 as A,a7 as de,a8 as z,a9 as te,aa as ue,ab as se,ac as me,ad as Z,ae as Be,af as P,ag as F,ah as Ae,b as ze,d as _e,a as Ge,g as Oe,u as Ue,h as Le,I as Ee,n as ve,R as ee}from"./vue-codemirror.esm-CdIqRNbs.js";import{_ as We,a as He}from"./Inputs.vue_vue_type_script_setup_true_lang-BvXYlTCC.js";import{u as Je}from"./stores-DExdKIok.js";import{a as fe,f as Ke,d as pe,c as Qe,i as I,b as Xe,e as Ye,r as ge}from"./index-DyQEZYtm.js";import{n as Ze}from"./runner-gHCm9fYt.js";import{C as K}from"./cloudStorageApi--yossP73.js";import{u as et}from"./editor-store-CQLArBJ4.js";import{_ as tt}from"./SavedCloud.vue_vue_type_script_setup_true_lang-D8wSp2RZ.js";import{a as st}from"./index-BYssxWeg.js";import{t as at}from"./types-81Qs7ZwA.js";import{u as ot}from"./index-DF1O2LY1.js";import{_ as nt}from"./PibodyViewer.vue_vue_type_script_setup_true_lang-fYLXnvUx.js";import"./index-BRCmLd1m.js";import"./index-BFWEgjsR.js";import"./logo-D1-3uCnC.js";import"./index-BcdmDF4L.js";import"./index-B1S9ByTA.js";import"./index-Ddpxhgob.js";import"./index-CxpjP5v7.js";import"./index-D6y-9tOf.js";import"./index-svC8Un1X.js";import"./index-CgdfpZ6C.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./http-PePEMJWw.js";import"./v4-CmTdKEVZ.js";import"./index-BOe8HTYE.js";import"./SimulationView-ZxvJJcwn.js";const lt={key:0,class:"text-nowrap"},rt={key:0,class:"text-white"},ct={key:1,class:"text-white"},it={key:2,class:"text-white"},dt={key:3,class:"text-white"},ut={key:4,class:"text-white"},mt={key:5,class:"text-black w-full"},vt={class:"text-center font-mono px-1 text-white bg-black"},ft={key:6,class:"text-black w-full"},pt={class:"text-center font-mono px-1 text-white bg-black"},gt={key:7,class:"text-black w-full p-3"},xt={key:8,class:"text-white w-full"},yt={key:9,class:"text-white w-full"},ht={key:10,class:"text-white w-full"},bt={key:11,class:"text-white w-full"},_t={key:12,class:"text-black w-full"},wt={class:"text-center font-mono px-1 text-white bg-black"},kt={key:13,class:"text-white"},$t={key:14,class:"text-black w-full"},Ct={key:1,class:"text-center p-3"},xe=O({__name:"FeedbackNode",props:{message:{type:Object,required:!0}},setup(s){return(p,f)=>s.message?(o(),r("div",lt,[s.message.command===e(M).PinSetValue?(o(),r("div",rt,[t("div",{style:u({background:e(A)}),class:"text-center font-mono px-1"},"Pin "+a(s.message.request.pin)+" set value",5),t("div",{style:u(e(z)(s.message.request.value)),class:"text-center font-mono px-1"}," Value "+a(e(de)(s.message.request.value)),5)])):s.message.command===e(M).PinSetMode?(o(),r("div",ct,[t("div",{style:u({background:e(A)}),class:"text-center font-mono px-1"},"Pin "+a(s.message.request.pin)+" set mode",5),t("div",{style:u({background:e(ue)[s.message.request.mode]}),class:"text-center font-mono px-1"}," Mode "+a(e(te)[s.message.request.mode]),5)])):s.message.command===e(M).PinSetPull?(o(),r("div",it,[t("div",{style:u({background:e(A)}),class:"text-center font-mono px-1"},"Pin "+a(s.message.request.pin)+" set pull",5),t("div",{style:u({background:e(me)[s.message.request.pull]}),class:"text-center font-mono px-1"}," Pull "+a(e(se)[s.message.request.pull]),5)])):s.message.command===e(M).PwmDutyU16?(o(),r("div",dt,[t("div",{style:u({background:e(A)}),class:"text-center font-mono px-1"},"PWM "+a(s.message.request.pin)+" set duty",5),t("div",{style:u(e(z)(s.message.request.duty_u16/e(Z))),class:"text-center font-mono px-1"}," u16 "+a(s.message.request.duty_u16),5)])):s.message.command===e(M).PwmFreq?(o(),r("div",ut,[t("div",{style:u({background:e(A)}),class:"text-center font-mono px-1"},"PWM "+a(s.message.request.pin)+" set freq",5),t("div",{style:u(e(z)(s.message.request.freq/e(Z))),class:"text-center font-mono px-1"}," Freq "+a(s.message.request.freq),5)])):s.message.command===e(M).Output?(o(),r("div",mt,[f[0]||(f[0]=t("div",{class:"text-center px-1"},"Print",-1)),t("div",vt,a(s.message.request.output),1)])):s.message.command===e(M).Sleep?(o(),r("div",ft,[f[1]||(f[1]=t("div",{class:"text-center px-1"},"Sleep",-1)),t("div",pt,a(s.message.request.time_ms)+" ms",1)])):s.message.command===e(Be).Timeout?(o(),r("div",gt," Timeout ")):s.message.command===e(P).PinGetValue?(o(),r("div",xt,[t("div",{style:u({background:e(F)}),class:"text-center font-mono px-1"},"Pin "+a(s.message.request.pin)+" get value",5),t("div",{style:u(e(z)(s.message.result)),class:"text-center font-mono px-1"}," Value "+a(e(de)(s.message.result)),5)])):s.message.command===e(P).PinGetMode?(o(),r("div",yt,[t("div",{style:u({background:e(F)}),class:"text-center font-mono px-1"},"Pin "+a(s.message.request.pin)+" get mode",5),t("div",{style:u({background:e(ue)[s.message.result]}),class:"text-center font-mono px-1"}," Mode "+a(e(te)[s.message.result]),5)])):s.message.command===e(P).PinGetPull?(o(),r("div",ht,[t("div",{style:u({background:e(F)}),class:"text-center font-mono px-1"},"Pin "+a(s.message.request.pin)+" get pull",5),t("div",{style:u({background:e(me)[s.message.result]}),class:"text-center font-mono px-1"}," Pull "+a(e(se)[s.message.result]),5)])):s.message.command===e(P).AdcReadU16?(o(),r("div",bt,[t("div",{style:u({background:e(F)}),class:"text-center font-mono px-1"},"ADC "+a(s.message.request.pin)+" read",5),t("div",{style:u(e(z)(s.message.result/e(Z))),class:"text-center font-mono px-1"}," u16 "+a(s.message.result),5)])):s.message.command===e(P).Input?(o(),r("div",_t,[f[2]||(f[2]=t("div",{class:"text-center px-1"},"Input",-1)),t("div",wt,a(s.message.result),1)])):s.message.command===e(M).NeoPixelWrite?(o(),r("div",kt,[t("div",{style:u({background:e(A)}),class:"text-center font-mono px-1"},"Pin "+a(s.message.request.pin)+" write pixels",5),t("div",{style:u(e(z)(0)),class:"text-center font-mono px-1"}," pixels("+a(s.message.request.pixels.length)+") ",5)])):(o(),r("div",$t," Todo: "+a(s.message.command),1))])):(o(),r("div",Ct," Nothing "))}}),Pt={class:"flex-col overflow-auto"},qt={class:"flex"},St={key:0,class:"flex text-white border-2 border-blue-500"},Tt={class:"text-black text-nowrap"},It={key:1,class:"flex text-white border-2 border-blue-500"},Ft={class:"text-black text-nowrap"},Dt={key:2,class:"flex text-white border-2 border-blue-500"},Mt={class:"text-black text-nowrap"},Rt={key:3,class:"flex text-white border-2 border-blue-500"},Vt={class:"text-black text-nowrap"},Nt={key:4,class:"flex text-white border-2 border-blue-500"},jt={class:"text-black text-nowrap"},Bt={key:5,class:"flex text-black border-2 border-blue-500"},At=O({__name:"Inputs",props:{inputs:{}},setup(s){const p=oe(()=>{const f=[];for(const[w,i]of s.inputs){const k=Ae(w);f.push({...k,result:i})}return f});return(f,w)=>(o(),r(B,null,[p.value.length===0?(o(),r(B,{key:0},[N("Nothing")],64)):R("",!0),t("div",Pt,[(o(!0),r(B,null,X(p.value,i=>(o(),r("div",qt,[i.command===e(P).PinGetValue?(o(),r("div",St,[t("div",{style:u({background:e(F)}),class:"text-center text-nowrap font-mono px-1"},"Pin "+a(i.request.pin)+" get values:",5),t("div",Tt,a(i.result),1)])):i.command===e(P).PinGetMode?(o(),r("div",It,[t("div",{style:u({background:e(F)}),class:"text-center text-nowrap font-mono px-1"},"Pin "+a(i.request.pin)+" get values:",5),t("div",Ft,a(i.result.map(k=>e(te)[k])),1)])):i.command===e(P).PinGetPull?(o(),r("div",Dt,[t("div",{style:u({background:e(F)}),class:"text-center text-nowrap font-mono px-1"},"Pin "+a(i.request.pin)+" get values:",5),t("div",Mt,a(i.result.map(k=>e(se)[k])),1)])):i.command===e(P).AdcReadU16?(o(),r("div",Rt,[t("div",{style:u({background:e(F)}),class:"text-center text-nowrap font-mono px-1"},"ADC "+a(i.request.pin)+" read u16:",5),t("div",Vt,a(i.result),1)])):i.command===e(P).Input?(o(),r("div",Nt,[t("div",{style:u({background:e(F)}),class:"text-center text-nowrap font-mono px-1"},"Console input:",4),t("div",jt,a(i.result),1)])):(o(),r("div",Bt,"TODO: "+a(i.command),1))]))),256))])],64))}}),zt={class:"flex items-center gap-2"},Gt={class:"font-bold"},Ot={class:"flex"},Ut=["onClick"],Lt={class:"text-center"},Et={key:0,class:"text-center"},Wt={key:0,class:"flex items-center justify-center h-20"},Ht=O({__name:"FeedbackTimeline",props:{id:{},result:{}},setup(s){const p=s,{selectNode:f,selectedIndex:w,firstError:i}=ze(p.id,p.result),k=oe(()=>_e(p.result.replayed)),l=G(null),x=G([]);return(C,q)=>{const U=be,Y=ae;return o(),j(Y,null,{header:g(()=>[t("div",zt,[t("div",Gt,a(C.$t("result")),1),p.result.success===!1?(o(),j(U,{key:0,severity:"danger",onClick:q[0]||(q[0]=S=>e(i)(x.value))},{default:g(()=>[N(a(C.$t("first error")),1)]),_:1})):R("",!0)])]),default:g(()=>[t("div",{ref_key:"scrollContainer",ref:l,class:"flex overflow-auto mb-2"},[(o(!0),r(B,null,X(p.result.feedback,(S,h)=>{var D,L;return o(),r("div",Ot,[t("button",{class:Q(["flex",e(w)===h?"border border-blue-500":""]),onClick:V=>e(f)(h),ref_for:!0,ref:V=>x.value[h]=V},[t("div",Lt,[N(a(S.correct?C.$t("correct"):C.$t("incorrect"))+" ",1),m(xe,{message:(D=S.replayed)==null?void 0:D.content,class:Q(["border-4 rounded-md",S.correct?"border-green-500":"border-red-500"])},null,8,["message","class"])]),S.correct?R("",!0):(o(),r("div",Et,[q[1]||(q[1]=N(a("Expected")+" ")),m(xe,{message:(L=S.expected)==null?void 0:L.content,class:Q(["border-4 rounded-md",S.correct?"border-red-500":"border-green-500"])},null,8,["message","class"])]))],10,Ut),h+1<p.result.feedback.length?(o(),r("div",Wt,"→")):R("",!0)])}),256))],512),q[2]||(q[2]=N(" Input used: ")),m(At,{inputs:k.value},null,8,["inputs"])]),_:1})}}}),Jt={class:"flex overflow-auto mb-2"},Kt={class:"flex"},Qt={class:"text-center"},Xt={key:0,class:"flex items-center justify-center h-12"},ye=O({__name:"TestDataTimeline",props:{data:{}},setup(s){const p=oe(()=>_e(s.data));return(f,w)=>{const i=ae;return o(),j(i,{header:"Expected"},{default:g(()=>[t("div",Jt,[(o(!0),r(B,null,X(f.data,(k,l)=>(o(),r("div",Kt,[t("div",Qt,[m(e(We),{message:k.content,class:"border-4 border-blue-500"},null,8,["message"])]),l+1<f.data.length?(o(),r("div",Xt,"→")):R("",!0)]))),256))]),w[0]||(w[0]=N(" Inputs: ")),m(e(He),{inputs:p.value},null,8,["inputs"])]),_:1})}}}),Yt={class:"h-full flex flex-col"},Zt={class:"p-4"},es={class:"flex w-full gap-1"},ts={class:"material-icons"},ss={class:"material-icons"},as={class:"material-icons"},os={class:"material-icons"},ns={class:"material-icons"},ls={class:"flex flex-col gap-2 m-2 h-full overflow-auto"},rs={class:"flex gap-2 w-full"},cs=["for"],is={class:"material-icons"},ds={class:"material-icons"},us=O({__name:"TesterControls",props:{id:{}},setup(s){const p=s,f=Me(),w=Re(),i=et(),k=ce(i),l=G(null),x=G([]);Ve(async()=>{const c=Ne();try{const n=c.params.lesson_id;if(!k.lesson.value||k.lesson.value.id!=n){const{data:d}=await st.getProjectByID(n.toString()),$=await at(d);i.setLesson($)}const{data:b}=await fe.getStepTranslationByID(c.params.step_id.toString());if(l.value=b,h.value=l.value.content.solution??h.value,V.setCode(h.value),l.value.content.highlights)for(const d of l.value.content.highlights)d.module&&d.slot&&D.newModuleToSlot(d.module,d.slot);l.value&&(l.value.content.tests&&(x.value=await Ke(l.value.content.tests)),l.value.content.includedCommandsForTests=l.value.content.includedCommandsForTests??[...pe])}catch(n){console.log(n)}});async function C(){if(l.value!=null){i.setStepSaving(!0);try{await fe.updateStepTranslationByID(l.value.step,l.value.name,l.value.content)}catch(c){let n="";c instanceof Error?n=c.message:n=String(c),f.add({severity:"error",summary:"Failed to save",detail:n,life:3e3})}finally{i.setStepSaving(!1)}}}const q=ot(()=>{C()},1e3,{maxWait:5e3});async function U(c){const n=JSON.stringify(c),b=new Blob([n],{type:"application/json"}),d=new FormData;d.append("file",b,"default.test.json");const{data:$}=await K.uploadFile(d,"tests1");return $.source_url}async function Y(){if(l.value==null)return;let c="";try{c=await U(T.value)}catch(n){f.add({severity:"error",summary:n.response.data.error,life:2e3});return}l.value.content.tests?l.value.content.tests.push({name:"",url:c}):(l.value.content.tests=[],l.value.content.tests.push({name:"",url:c})),x.value.push({data:T.value,test:{name:"",url:c}}),T.value=[],C()}function S(c){w.require({message:"Are you sure you want to Delete?",header:"Confirmation",icon:"pi pi-exclamation-triangle",rejectProps:{label:"Cancel",severity:"secondary",outlined:!0},acceptProps:{label:"Delete",severity:"danger"},accept:async()=>{var n,b;try{const d=x.value[c].test.url;await K.deleteFile(d),(b=(n=l.value)==null?void 0:n.content.tests)==null||b.splice(c,1),x.value.splice(c,1),C()}catch(d){f.add({severity:"error",summary:d.response.data.error,life:2e3})}}})}const{fileContent:h}=ce(Je()),D=Ge(p.id),L=Oe(p.id),V=Ue(p.id),ne=Le(p.id),v=Ze(L,L.write,ne.writeText,ne.clearDisplay,D.setPin,D.getPin,D.getI2C),{isLoading:_,isRunning:le}=v;D.addNeededModules([]);const T=G(ve),we=G(ve);ie(V.code,c=>{typeof c=="string"&&c!==h.value&&(h.value=c,l.value&&(l.value.content.solution=c))});function ke(){v.recorder.start();const c=typeof V.code.value=="string"?V.code.value:"";v.run(c);const n=ie(v.recorder.state,()=>{(v.replayer.state.value==ee.Finish||v.replayer.state.value==ee.Timeout)&&(v.recorder.stop(),T.value=v.recorder.getRecords()),n.stop()})}function $e(){v.replayer.state.value==ee.Continue?(v.recorder.stop(),v.replayer.stop(),we.value=v.recorder.getRecords()):(v.recorder.stop(),T.value=v.recorder.getRecords()),v.stop()}function J(){var c;return((c=l.value)==null?void 0:c.content.includedCommandsForTests)??pe}const Ce=async()=>{if(!(!l.value||!l.value.content.tests)){I.value=!0;for(const[c,n]of x.value.entries()){const b=await ge(v,h.value,n.data,J());await v.stopPromise();const d=l.value.content.tests[c].url,$=await U(b);l.value.content.tests[c].url=$,x.value[c].test.url=$,x.value[c].data=b;try{await K.deleteFile(d)}catch(E){f.add({severity:"error",summary:E.response.data.error,life:2e3})}}await C(),I.value=!1}},Pe=async(c,n)=>{if(!l.value||!l.value.content.tests)return;I.value=!0;const b=await ge(v,h.value,c.data,J());await v.stopPromise();const d=l.value.content.tests[n].url,$=await U(b);l.value.content.tests[n].url=$,x.value[n].test.url=$,x.value[n].data=b,C();try{await K.deleteFile(d)}catch(E){f.add({severity:"error",summary:E.response.data.error,life:2e3})}I.value=!1};return(c,n)=>{const b=je,d=be,$=De,E=Fe,qe=ae;return o(),r("div",Yt,[t("div",Zt,[n[4]||(n[4]=N(" Include Commands: ")),l.value?(o(),j(b,{key:0,onChange:e(q),modelValue:l.value.content.includedCommandsForTests,"onUpdate:modelValue":n[0]||(n[0]=y=>l.value.content.includedCommandsForTests=y),options:Ee,filter:"",placeholder:"Select commands",class:"w-full md:w-80 mb-2 mt-1",maxSelectedLabels:3},null,8,["onChange","modelValue","options"])):R("",!0),t("div",es,[m(d,{type:"button",class:"w-9 h-9",severity:"success",rounded:"",onClick:ke,disabled:e(_)||e(le)},{default:g(()=>[t("span",ts,a(e(_)?"hourglass_top":"play_arrow"),1)]),_:1},8,["disabled"]),m(d,{type:"button",class:"w-9 h-9",severity:"danger",rounded:"",onClick:$e,disabled:e(_)||!e(le)},{default:g(()=>[t("span",ss,a(e(_)?"hourglass_top":"stop"),1)]),_:1},8,["disabled"]),m(d,{type:"button",class:"w-9 h-9",severity:"info",rounded:"",onClick:n[1]||(n[1]=y=>Y()),disabled:T.value.length<=0||l.value==null},{default:g(()=>[t("span",as,a(e(_)?"hourglass_top":"save"),1)]),_:1},8,["disabled"]),m(d,{type:"button",class:"w-9 h-9",severity:"info",rounded:"",onClick:n[2]||(n[2]=y=>e(Qe)(e(v),e(h),x.value,J())),disabled:e(_)||e(I)},{default:g(()=>[t("span",os,a(e(_)?"hourglass_top":"bug_report"),1)]),_:1},8,["disabled"]),m(d,{type:"button",class:"w-9 h-9",rounded:"",onClick:n[3]||(n[3]=y=>Ce()),disabled:e(_)||!x.value||e(I)},{default:g(()=>[t("span",ns,a(e(_)?"hourglass_top":"restart_alt"),1)]),_:1},8,["disabled"]),m(tt)])]),T.value.length>0?(o(),j(ye,{key:0,data:T.value,class:"mt-2"},null,8,["data"])):R("",!0),t("div",ls,[(o(!0),r(B,null,X(x.value,(y,W)=>{var re;return o(),j(qe,{toggleable:"",key:y.test.url,class:Q(["border-4",e(Ye)((re=y.result)==null?void 0:re.success)])},{header:g(()=>[t("div",rs,[m(E,{variant:"on",class:"w-full"},{default:g(()=>[t("label",{for:`name ${W+1}`},"Test "+a(W+1),9,cs),m($,{id:`name ${W+1}`,onInput:e(q),modelValue:y.test.name,"onUpdate:modelValue":H=>y.test.name=H,class:"w-full",size:"small"},null,8,["id","onInput","modelValue","onUpdate:modelValue"])]),_:2},1024),m(d,{type:"button",class:"w-9 h-9",severity:"info",rounded:"",onClick:H=>e(Xe)(e(v),e(h),y,J()),disabled:e(_)||e(I)},{default:g(()=>[t("span",is,a(e(_)?"hourglass_top":"bug_report"),1)]),_:2},1032,["onClick","disabled"]),m(d,{type:"button",class:"w-9 h-9",severity:"danger",rounded:"",onClick:H=>S(W)},{default:g(()=>n[5]||(n[5]=[t("span",{class:"material-icons"},a("delete_forever"),-1)])),_:2},1032,["onClick"]),m(d,{type:"button",class:"w-9 h-9",rounded:"",onClick:H=>Pe(y,W),disabled:e(_)||!x.value||e(I)},{default:g(()=>[t("span",ds,a(e(_)?"hourglass_top":"restart_alt"),1)]),_:2},1032,["onClick","disabled"]),m(d,{type:"button",class:"w-9 h-9",severity:"warn",rounded:"",onClick:H=>y.result=void 0,disabled:!x.value||e(I)},{default:g(()=>n[6]||(n[6]=[t("span",{class:"material-icons"}," cleaning_services ",-1)])),_:2},1032,["onClick","disabled"])])]),default:g(()=>[m(ye,{data:y.data,class:"mt-2"},null,8,["data"]),y.result?(o(),j(Ht,{key:0,result:y.result,id:p.id},null,8,["result","id"])):R("",!0)]),_:2},1032,["class"])}),128))])])}}}),ms={class:"flex bg-surface-0",style:{height:"calc(100vh - 52px)"}},he="tester",Hs=O({__name:"TesterView",setup(s){return(p,f)=>{const w=Se,i=Te;return o(),r(B,null,[m(Ie),t("div",ms,[m(i,{class:"w-full rounded-none"},{default:g(()=>[m(w,{size:50,minSize:10,class:"h-full"},{default:g(()=>[m(us,{id:he})]),_:1}),m(w,{size:67,minSize:10,class:"w-full h-full"},{default:g(()=>[m(e(nt),{id:he,class:"w-full h-full",horizontal:!1})]),_:1})]),_:1})])],64)}}});export{Hs as default};
