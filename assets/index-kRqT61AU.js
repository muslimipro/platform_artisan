import{s as Z}from"./index-BEiif5Za.js";import{d as ee,u as te,r as x,c as D,a as se,s as ae,o as oe,b as s,e as l,f as h,g as e,h as a,t as f,i as le,F as I,j as V,n as Y,k as m,l as ne,m as re,p as ie,q as ce}from"./index-CpNfsgee.js";import{s as i}from"./index-Gc46Whfq.js";import{_ as de}from"./MainHeader.vue_vue_type_script_setup_true_lang-DYrXSIBy.js";import{R as ue,m as fe}from"./mapRouteFromDto-DRjVAvBq.js";import{g as me,f as F}from"./groupRoutesByType-B8LQ_TR7.js";import{h as Q}from"./http-uAg3sWem.js";import"./index-D5xNLMSZ.js";import"./index-Dl1GEnYT.js";import"./index-CLdqn1Ns.js";import"./mapLessonFromDto-BcisFAGx.js";import"./mapUnitFromDto-CYGc5n9V.js";const J={getUserProgress:pe,getUserInfo:ge,getUserLastLesson:xe};async function pe(){return await Q.get("user/progress")}async function ge(){return await Q.get("user/info")}async function xe(){return await Q.get("v2/lesson/last")}const he=ee("home-store",()=>{const U=te(),p=x([]),w=x(!1);async function M(){try{w.value=!0;const{data:t}=await ue.getRoutes();p.value=(t==null?void 0:t.map(fe))??[]}catch(t){U.add({severity:"error",summary:t,life:2e3})}finally{w.value=!1}}const q=D(()=>me(p.value)),E=D(()=>F(p.value,"main")),H=D(()=>F(p.value,"side")),O=D(()=>F(p.value,"one_kit")),y=D(()=>F(p.value,"hackathon"));let S={};const _=x(0),g=x(!1);async function B(){try{g.value=!0;const{data:t}=await J.getUserProgress();_.value=t.xp,S=t.attempts.reduce((r,o)=>(r[o.date]={date:o.date,count:o.count,success:o.success},r),{})}catch(t){U.add({severity:"error",summary:t,life:2e3})}finally{g.value=!1}}const k=new Date,T=k.toISOString().slice(0,10),W=(k.getDay()+6)%7,P=new Date(k);P.setDate(k.getDate()-W-14);const j=P;function z(t,r){const o=(t-1)*7+(r-1),n=new Date(j);return n.setDate(j.getDate()+o),n.toISOString().slice(0,10)}function K(t,r){const o=z(t,r);if(o>T)return"bg-white";const n=S[o];return n?n.success?"bg-green-400":"bg-green-100":"bg-gray-200"}function G(t,r){const o=z(t,r);if(o>T)return"";const n=S[o];return n?`${o}
attempts: ${n.count}
success: ${n.success}`:`${o}: no attempts`}const v=x(),c=x(!1);async function C(){try{c.value=!0;const{data:t}=await J.getUserInfo();v.value=t}catch(t){U.add({severity:"error",summary:t,life:2e3})}finally{c.value=!1}}const A=D(()=>{var o,n;let t="",r="";return(o=v.value)!=null&&o.name&&(t=v.value.name.charAt(0).toUpperCase()),(n=v.value)!=null&&n.surname&&(r=v.value.surname.charAt(0).toUpperCase()),t+r}),d=x(),L=x(""),$=x(""),R=x(!1);async function N(){try{R.value=!0;const{data:t}=await J.getUserLastLesson();d.value=t,L.value="Continue"}catch(t){d.value.lesson_name="Default lesson",d.value.lesson_level_name="Default level",d.value.route_name="Default route",d.value.lesson_id=1,d.value.route_id=1,L.value="Start",U.add({severity:"error",summary:t,life:2e3})}finally{R.value=!1,$.value="/v2/lesson/"+d.value.lesson_id+"?route_id="+d.value.route_id}}return{routes:p,isRoutesLoading:w,loadRoutes:M,groupedRoutes:q,mainRoutes:E,sideRoutes:H,oneKitRoutes:O,hackathonRoutes:y,isProgressLoading:g,loadProgress:B,getDayClass:K,getDayTooltip:G,xp:_,isUserInfoLoading:c,userInfo:v,loadUserInfo:C,userLabel:A,isLastLessonLoading:R,lastLesson:d,lastButtonLabel:L,lastButtonURL:$,loadLastLesson:N}}),ye={class:"flex flex-col items-center h-screen"},_e={class:"w-full h-full max-w-screen-xl px-4 md:px-28 py-8"},ve={class:"flex flex-col gap-8 py-8"},be={class:"flex gap-8"},we={class:"flex flex-col gap-8"},ke={class:"flex flex-col w-[400px] h-[286px] bg-white border border-gray-100 rounded-3xl p-8"},Le={key:0,class:"text-4xl font-sans font-light text-gray-500 mb-4"},Re={key:1,class:"text-4xl font-sans font-light text-gray-500 mb-4"},De={class:"font-normal text-5xl text-black"},Ue={class:"flex"},Se={class:"flex-grow flex gap-2 justify-between items-end text-gray-500"},Be={class:"grid grid-rows-6 grid-cols-7 gap-0.5 w-full h-full"},Ce=["title"],$e={class:"w-[400px] h-[180px] bg-purple-50 border border-gray-100 rounded-3xl p-8"},Ie={key:0},Te={key:1,class:"flex flex-col justify-between gap-5"},Pe={class:"flex flex-col gap-8 w-full"},je={class:"relative flex-grow flex items-center bg-slate-50 border border-gray-100 rounded-3xl p-5"},ze={class:"flex flex-col"},Ae={key:1,class:"text-2xl"},Ne={class:"flex flex-col absolute right-5 top-3 items-end"},Ve={key:1,class:"text-gray-400"},Fe={key:3,class:"text-gray-500"},Me={class:"flex-grow flex flex-col justify-between items-center bg-white border border-gray-100 rounded-3xl px-8 pb-4 pt-10"},qe={class:"flex flex-col items-center"},Ee={key:1,class:"text-2xl font-semibold mb-2"},He={key:3,class:"text-blue-400 font-sans"},Oe={key:1,class:"text-[100px]"},We={class:"flex flex-col items-center w-full min-w-full"},Ke={key:1,class:"text-gray-500 font-sans mb-4"},Ge={class:"flex gap-4 bg-gray-50 rounded-3xl p-8 overflow-x-scroll"},Je={key:0,class:"flex flex-row gap-4"},Qe={class:"flex flex-col items-center"},Xe={class:"text-lg font-semibold"},Ye={class:"text-sm text-gray-500 text-center"},ft=se({__name:"HomePage",setup(U){const p=ie(),w=he(),{isRoutesLoading:M,mainRoutes:q,sideRoutes:E,isProgressLoading:H,xp:O,userInfo:y,userLabel:S,isUserInfoLoading:_,isLastLessonLoading:g,lastLesson:B,lastButtonLabel:k,lastButtonURL:T}=ae(w),{loadRoutes:X,loadProgress:W,getDayClass:P,getDayTooltip:j,loadUserInfo:z,loadLastLesson:K}=w,G=["pi pi-microchip","pi pi-arrow-up-right","pi pi-code","pi pi-box"];return oe(()=>{z(),W(),K(),X()}),(v,c)=>{var d,L,$,R,N,t,r,o,n;const C=ce,A=Z;return s(),l("div",ye,[h(e(de)),a("div",_e,[a("div",ve,[a("div",be,[a("div",we,[a("div",ke,[e(H)?(s(),l("div",Le,[h(e(i),{width:"11rem",height:"49px"})])):(s(),l("div",Re,[a("span",De,f(e(O)),1),c[1]||(c[1]=le(" xp "))])),a("div",Ue,[(s(),l(I,null,V(["Mo","Tu","We","Th","Fr","Sa","Su"],(u,b)=>a("div",{key:`day-${b}`,class:"w-full h-full flex items-center justify-center rounded text-xs text-gray-500 font-medium"},f(u),1)),64))]),a("div",Se,[a("div",Be,[(s(),l(I,null,V(3,u=>(s(),l(I,null,[(s(),l(I,null,V(7,b=>a("div",{key:`cell-${u}-${b}`,class:Y(["aspect-square flex items-center justify-center rounded m-1",e(P)(u,b)]),title:e(j)(u,b)},null,10,Ce)),64))],64))),64))])])]),a("div",$e,[e(_)?(s(),l("div",Ie,[e(g)?(s(),m(e(i),{key:0,height:"115px",class:"w-full mb-2"})):ne("",!0)])):(s(),l("div",Te,[c[2]||(c[2]=re('<div class="flex items-center justify-center gap-4"><i class="pi pi-crown text-orange-300" style="font-size:28px;"></i><div class="flex flex-col"><div class="text-lg">Unlock all learning with Premium</div><div class="text-gray-500">to get more ...</div></div></div>',1)),h(C,{label:"Explore Premium",severity:"help",class:"rounded-full"})]))])]),a("div",Pe,[a("div",je,[e(_)?(s(),m(e(i),{key:0,class:"mr-6",shape:"circle",size:"4rem"})):(d=e(y))!=null&&d.small_avatar_url?(s(),m(A,{key:1,class:"mr-6",size:"xlarge",shape:"circle",image:(L=e(y))==null?void 0:L.small_avatar_url},null,8,["image"])):(s(),m(A,{key:2,label:e(S),class:"mr-6",size:"xlarge",shape:"circle"},null,8,["label"])),a("div",ze,[c[3]||(c[3]=a("span",{class:"italic text-gray-500"},"Welcome back,",-1)),e(_)?(s(),m(e(i),{key:0,width:"15rem",height:"33px"})):(s(),l("div",Ae,f(($=e(y))==null?void 0:$.surname)+" "+f((R=e(y))==null?void 0:R.name),1))]),a("div",Ne,[e(_)?(s(),m(e(i),{key:0,width:"12rem",height:"25px",class:"mb-1"})):(s(),l("div",Ve,f((N=e(y))==null?void 0:N.school_name),1)),e(_)?(s(),m(e(i),{key:2,width:"3rem",height:"25px"})):(s(),l("div",Fe,f((t=e(y))==null?void 0:t.class_name),1))])]),a("div",Me,[a("div",qe,[e(g)?(s(),m(e(i),{key:0,width:"15rem",height:"30px",class:"mb-2"})):(s(),l("div",Ee,f((r=e(B))==null?void 0:r.lesson_name),1)),e(g)?(s(),m(e(i),{key:2,width:"10rem",height:"20px",class:"mb-2"})):(s(),l("div",He,f((o=e(B))==null?void 0:o.lesson_level_name),1))]),e(g)?(s(),m(e(i),{key:0,width:"10rem",height:"9rem",class:"mb-2"})):(s(),l("div",Oe,"ðŸš€")),a("div",We,[e(g)?(s(),m(e(i),{key:0,width:"10rem",height:"20px",class:"mb-4"})):(s(),l("div",Ke,f((n=e(B))==null?void 0:n.route_name),1)),h(C,{label:e(k),class:"rounded-full h-12 min-w-full",disabled:e(g),onClick:c[0]||(c[0]=u=>e(p).push(e(T)))},null,8,["label","disabled"])])])])]),a("div",Ge,[e(M)?(s(),l("div",Je,[h(e(i),{height:"16rem",width:"18rem"}),h(e(i),{height:"16rem",width:"18rem"}),h(e(i),{height:"16rem",width:"18rem"}),h(e(i),{height:"16rem",width:"18rem"})])):(s(!0),l(I,{key:1},V([...e(q),...e(E)],(u,b)=>(s(),l("div",{key:u.id,class:"flex-shrink-0 flex flex-col items-center justify-between h-64 w-72 bg-white rounded-xl p-4"},[a("div",Qe,[a("div",Xe,f(u.name),1),a("div",Ye,f(u.description),1)]),a("div",{class:Y(["text-[64px] text-gray-500",G[b]])},null,2),h(C,{label:"Start",class:"rounded-full w-full",severity:"info",variant:"outlined",onClick:Ze=>e(p).push({name:"route",params:{id:u.id}})},null,8,["onClick"])]))),128))])])])])}}});export{ft as default};
