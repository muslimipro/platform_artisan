import{a as ee,U as te,u as oe,R as se,Q as ae,s as re,r,o as le,E as ne,c as U,b as l,e as i,f as c,h as j,w as k,g as A,K as N,F as V,k as C,i as L,l as ie,C as ue,m as de}from"./index-B4mgNLDK.js";import{s as ce}from"./index-CoLnF5_w.js";import{s as pe}from"./index-Dmq4BKZD.js";import{s as me,a as fe}from"./index-hCRRwp07.js";import{s as ve}from"./index-DTwcWcpW.js";import{_ as ge}from"./AHeader.vue_vue_type_script_setup_true_lang-BC0uvjoJ.js";import{_ as F}from"./ProjectCard.vue_vue_type_script_setup_true_lang-BmPFGSpe.js";import{a as I}from"./index-D7lUJ6HY.js";import{u as ye}from"./editor-store-D12ST0Jg.js";import{t as G}from"./types-81Qs7ZwA.js";import{u as he,m as _e}from"./useSortable-B_-E1Vm8.js";import"./index-BGuqkkPX.js";import"./index-BwXScYJL.js";import"./index-BOBJGkdp.js";import"./index-Cxdl9bFS.js";import"./index-CAGAVdnu.js";import"./index-BXyuhUZg.js";import"./index-DBf8MDPs.js";import"./index-LP1JOWY5.js";import"./logo-D1-3uCnC.js";import"./StudentViewToggle.vue_vue_type_script_setup_true_lang-DxkwDAdh.js";import"./index-BV7OY5EW.js";import"./index-BCohxVXx.js";import"./index-CMDTI7V2.js";import"./index-C8FdWZ_5.js";import"./index-CslveOKd.js";import"./http-C8N77P2F.js";import"./profile-Db-v6WYO.js";import"./index-D7pEsM6s.js";import"./index-CLtLP8dQ.js";import"./index-wU8uR_x5.js";import"./pibody-BwAjMvHk.js";import"./v4-CmTdKEVZ.js";import"./sortable.esm-FZSyJVGy.js";const we={class:"flex flex-col min-h-screen bg-slate-50"},xe={class:"flex flex-col sm:flex-row gap-1 sm:gap-4 bg-slate-50 py-4 px-4 sm:px-12 items-end"},be={key:0,class:"flex flex-col sm:flex-row gap-1 sm:gap-4 bg-slate-50 py-0 px-4 sm:px-12 items-end justify-end"},je={key:1,class:"border border-dashed rounded-xl border-green-400 overflow-hidden"},ke={key:0,class:"flex flex-wrap justify-center gap-8 px-4 sm:px-12 pb-8 pt-4"},lt=ee({__name:"ProjectsView",setup(Ve){const P=te("el"),$=oe(),{locale:H}=se(),z=ie(),K=ye(),{addLesson:O}=K,Q=ae(),{user:S}=re(Q),p=r([]),_=r([]),w=r([]),B=r([0,0,0,0,0,0]),E=r([0,0,0,0,0,0]),m=r(!1),f=r(!1);he(P,p,{onUpdate:t=>{_e(p.value,t.oldIndex,t.newIndex,t),ue(async()=>{const e=[];p.value.map(o=>{const n=parseInt(o.id,10);e.push(n)});try{const{data:o}=await I.changeProjectsOrder(e);$.add({severity:"success",summary:o.message,life:2e3})}catch(o){$.add({severity:"error",summary:o.response.data.error,detail:o,life:2e3})}})}});async function v(){if(!m.value){m.value=!0;try{const{data:t}=await I.getProjects();p.value=[],_.value=[],w.value=[],B.value=[0,0,0,0,0,0],E.value=[0,0,0,0,0,0];for(const e of t)e.lego||(e.is_guidable?B.value[e.layer]++:E.value[e.layer]++);for(const e of t){if(e.lego)continue;const o=await G(e);if(e.layer==0){p.value.push(o);const n=o.creator_name??o.created_by;!x.value.includes(n)&&n.length>0&&x.value.push(o.creator_name??o.created_by)}o.is_guidable?_.value.push(o):w.value.push(o)}}catch(t){console.log(t)}finally{m.value=!1}}}le(v),ne(H,v);async function q(){f.value=!0;try{const{data:t}=await I.createProject(),e=await G(t);O(e),z.push(`/project/${e.id}/edit`)}catch(t){console.log(t)}finally{f.value=!1}}const J=U(()=>{var n,h;const t=new Map,e=new Map;for(const s of _.value)t.has(s.layer)||t.set(s.layer,[]),t.get(s.layer).push(s);for(const s of w.value)e.has(s.layer)||e.set(s.layer,[]),e.get(s.layer).push(s);const o=[];return o.push({id:0,guided:((n=t.get(0))==null?void 0:n.filter(s=>(!d.value.length||d.value.includes(b(s.level)))&&(!u.value||s.title.toLowerCase().includes(u.value.toLowerCase()))))||[],unguided:((h=e.get(0))==null?void 0:h.filter(s=>(!d.value.length||d.value.includes(b(s.level)))&&(!u.value||s.title.toLowerCase().includes(u.value.toLowerCase()))))||[]}),o}),W=U(()=>p.value.filter(t=>(!y.value.length||y.value.includes(t.creator_name??t.created_by))&&(!g.value.length||g.value.includes(t.stage))&&(!d.value.length||d.value.includes(b(t.level)))&&(!u.value||t.title.toLowerCase().includes(u.value.toLowerCase())))),u=r(""),d=r(""),X=r(["Easy","Medium","Hard"]),g=r(""),Y=r(["prepare_for_submission","waiting_for_review","in_review","rejected","ready_for_publish","published","in_modify"]),y=r(""),x=r([]);function b(t){return t==0?"":t<3?"Easy":t<5?"Medium":t==5?"Hard":""}return(t,e)=>{var M,R;const o=me,n=ve,h=fe,s=pe,Z=ce,D=de;return l(),i("div",we,[c(ge,{class:"sticky top-0 z-10 mb-4"}),j("div",xe,[c(h,{class:"min-w-60"},{default:k(()=>[c(o,{class:"text-primary border-gray-100"},{default:k(()=>e[4]||(e[4]=[j("i",{class:"pi pi-search"},null,-1)])),_:1}),c(n,{type:"text",modelValue:u.value,"onUpdate:modelValue":e[0]||(e[0]=a=>u.value=a),placeholder:t.$t("pages.projects.search"),variant:"filled",class:"h-fit bg-white border-gray-100 shadow-none"},null,8,["modelValue","placeholder"])]),_:1}),c(s,{modelValue:d.value,"onUpdate:modelValue":e[1]||(e[1]=a=>d.value=a),options:X.value,placeholder:t.$t("pages.projects.filterByLevel"),display:"chip",variant:"filled",class:"bg-white min-w-0 lg:min-w-80 border-gray-100 shadow-none"},null,8,["modelValue","options","placeholder"])]),["editor","contributor"].includes(((M=A(S))==null?void 0:M.user_type)??"")?(l(),i("div",be,[c(s,{modelValue:g.value,"onUpdate:modelValue":e[2]||(e[2]=a=>g.value=a),options:Y.value,placeholder:"Select stage",display:"chip",variant:"filled",class:"bg-white min-w-0 lg:min-w-80 border-gray-100 shadow-none"},null,8,["modelValue","options"]),c(s,{modelValue:y.value,"onUpdate:modelValue":e[3]||(e[3]=a=>y.value=a),options:x.value,placeholder:"Select creator",display:"chip",variant:"filled",class:"bg-white min-w-0 lg:min-w-80 border-gray-100 shadow-none"},null,8,["modelValue","options"])])):N("",!0),["editor","contributor"].includes(((R=A(S))==null?void 0:R.user_type)??"")?(l(),i("div",{key:1,ref_key:"el",ref:P,class:"flex flex-wrap justify-center gap-8 px-4 sm:px-12 pb-8 pt-4"},[(l(!0),i(V,null,C(W.value,a=>(l(),L(F,{key:a.id,project:a,onAfterRemove:v},null,8,["project"]))),128)),m.value?(l(),L(Z,{key:0})):(l(),i("div",je,[c(D,{variant:"text",style:{width:"300px",height:"234px"},class:"bg-green-50",onClick:q,loading:f.value,disabled:f.value},{icon:k(()=>e[5]||(e[5]=[j("i",{class:"pi pi-plus text-3xl"},null,-1)])),_:1},8,["loading","disabled"])]))],512)):(l(!0),i(V,{key:2},C(J.value,a=>(l(),i("div",{key:a.id,class:"flex flex-col gap-2"},[a.unguided.length>0?(l(),i("div",ke,[(l(!0),i(V,null,C(a.unguided,T=>(l(),L(F,{key:T.id,project:T,onAfterRemove:v},null,8,["project"]))),128))])):N("",!0)]))),128))])}}});export{lt as default};
