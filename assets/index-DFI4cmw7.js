import{d as aa,u as la,r as he,v as ua,x as ca,y as ha,z as fa,a as Ir,b as Be,e as ze,i as ts,h as Te,t as wt,f as ae,A as Ki,g as le,l as ns,m as kr,B as vi,s as pi,o as rs,C as da,F as ar,k as is,w as mt,D as va,q as gi,p as yi,E as pa,G as ga}from"./index-CTzBRDkF.js";import{s as mi}from"./index-DpB8_Bbd.js";import{s as os}from"./index-DHNHenM9.js";import{_ as ya}from"./MainHeader.vue_vue_type_script_setup_true_lang-BzMMHQX8.js";import{L as $t,d as Ei}from"./defaultConfirmDeleteOptions-q96e5U6N.js";import{R as zn,m as ma}from"./mapRouteFromDto-CIzSDawT.js";import{h as Mr}from"./http-C6s3B4Yp.js";import{g as Ea}from"./groupLessonsByLevelAndType-D70aJuVS.js";import{s as xa}from"./index-DlXfvzF6.js";import{s as Ca}from"./index-CRpkS1LV.js";import{s as Sa}from"./index-CaPaZa3U.js";import{s as ba}from"./index-6yMZBmiP.js";import{s as Pa}from"./sortable.esm-FZSyJVGy.js";import{_ as Ta}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-UttTpJwS.js";import"./index-CdRm71bP.js";import"./mapLessonFromDto-Dmd7ExqT.js";import"./mapUnitFromDto-CYGc5n9V.js";const zi=["learn","practice","module"],Fr={getLevelsByRouteId:Oa,createLevelByRouteId:Aa,updateLevelByIdAndRouteId:Da,deleteLevelByIdAndRouteId:_a};async function Oa(s){return await Mr.get(`v2/route/${s}/levels`)}async function Aa(s,a){return await Mr.post(`v2/route/${s}/level`,{name:a.name})}async function Da(s,a,r){return await Mr.put(`v2/route/${a}/level/${s}`,{language:r.language,learn_count:r.learn_count,name:r.name,practice_count:r.practice_count})}async function _a(s,a){return await Mr.delete(`v2/route/${a}/level/${s}`)}function Ia(s,a){const r=new Map,i={};for(const e of a)r.set(e.id,e.levelId),i[e.levelId]||(i[e.levelId]=[]);for(const e of s){const t=r.get(e.lesson_id);t!==void 0&&i[t].push(e)}return i}const xi=aa("route-edit-store",()=>{const s=la(),a=he("Order mode"),r=he(null),i=he({}),e=he({}),t=he(!1),n=he(!1),o=he(!1),l=he(!1),u=he(!1),c=he(!1),h=he(!1),d=he(!1),v=he(!1),p=he(!1);async function m(k){var I,w,j,G;try{t.value=!0;const{data:V}=await zn.getRouteById(k);r.value=ma(V),i.value=Ea(((I=r.value)==null?void 0:I.lessons)??[],((w=r.value)==null?void 0:w.levels)??[]),e.value=Ia(((j=r.value)==null?void 0:j.dependencies)??[],((G=r.value)==null?void 0:G.lessons)??[])}catch(V){s.add({severity:"error",summary:V.response.data.error,life:2e3})}finally{t.value=!1}}async function g(k,I){try{n.value=!0;const{data:w}=await zn.updateRouteById(k,I);s.add({severity:"success",summary:w.message,life:2e3})}catch(w){s.add({severity:"error",summary:w.response.data.error,life:2e3})}finally{n.value=!1}}async function E(k){try{o.value=!0;const{data:I}=await zn.deleteRouteById(k);s.add({severity:"success",summary:I.message,life:2e3})}catch(I){s.add({severity:"error",summary:I.response.data.error,life:2e3})}finally{o.value=!1}}async function x(k){try{l.value=!0;const{data:I}=await Fr.createLevelByRouteId(r.value.id,k);s.add({severity:"success",summary:I.message,life:2e3})}catch(I){s.add({severity:"error",summary:I.response.data.error,life:2e3})}finally{l.value=!1}}async function C(k,I){try{u.value=!0;const{data:w}=await Fr.updateLevelByIdAndRouteId(k,r.value.id,I);s.add({severity:"success",summary:w.message,life:2e3})}catch(w){s.add({severity:"error",summary:w.response.data.error,life:2e3})}finally{u.value=!1}}async function S(k){try{c.value=!0;const{data:I}=await Fr.deleteLevelByIdAndRouteId(k,r.value.id);s.add({severity:"success",summary:I.message,life:2e3})}catch(I){s.add({severity:"error",summary:I.response.data.error,life:2e3})}finally{c.value=!1}}async function b(k){try{h.value=!0;const{data:I}=await $t.createLesson(k);s.add({severity:"success",summary:I.message,life:2e3})}catch(I){s.add({severity:"error",summary:I.response.data.error,life:2e3})}finally{h.value=!1}}async function T(k,I){try{d.value=!0;const{data:w}=await $t.updateLessonById(k,I);s.add({severity:"success",summary:w.message,life:2e3})}catch(w){s.add({severity:"error",summary:w.response.data.error,life:2e3})}finally{d.value=!1}}async function D(k){try{v.value=!0;const{data:I}=await $t.deleteLessonById(k);s.add({severity:"success",summary:I.message,life:2e3})}catch(I){s.add({severity:"error",summary:I.response.data.error,life:2e3})}finally{v.value=!1}}async function P(k,I){try{p.value=!0;const{data:w}=await zn.updateRouteLessonsOrderById(k,I);s.add({severity:"success",summary:w.message,life:2e3})}catch(w){s.add({severity:"error",summary:w.response.data.error,life:2e3})}finally{p.value=!1}}async function _(k){try{const{data:I}=await $t.setLessonDependency(k);s.add({severity:"success",summary:I.message,life:2e3})}catch(I){s.add({severity:"error",summary:I.response.data.error,life:2e3})}}async function L(k){try{const{data:I}=await $t.removeLessonDependency(k);s.add({severity:"success",summary:I.message,life:2e3})}catch(I){s.add({severity:"error",summary:I.response.data.error,life:2e3})}}async function N(k){try{const{data:I}=await $t.removeAllLessonDependencies(k);s.add({severity:"success",summary:I.message,life:2e3})}catch(I){s.add({severity:"error",summary:I.response.data.error,life:2e3})}}return{mode:a,selectedRoute:r,isRouteLoading:t,isRouteUpdating:n,isRouteDeleting:o,isLevelCreating:l,isLevelUpdating:u,isLevelDeleting:c,isLessonCreating:h,isLessonUpdating:d,isLessonDeleting:v,isOrderUpdating:p,groupedLessons:i,groupedDependencies:e,loadRouteById:m,updateRouteById:g,deleteRouteById:E,createLevel:x,updateLevelById:C,deleteLevelById:S,createLesson:b,updateLessonById:T,deleteLessonById:D,updateRouteLessonsOrderById:P,createLessonDependency:_,deleteLessonDependency:L,deleteAllLessonDependencies:N}});var ss={exports:{}};const ka=ua(Pa);(function(s,a){(function(i,e){s.exports=e(ca,ka)})(typeof self<"u"?self:ha,function(r,i){return function(e){var t={};function n(o){if(t[o])return t[o].exports;var l=t[o]={i:o,l:!1,exports:{}};return e[o].call(l.exports,l,l.exports,n),l.l=!0,l.exports}return n.m=e,n.c=t,n.d=function(o,l,u){n.o(o,l)||Object.defineProperty(o,l,{enumerable:!0,get:u})},n.r=function(o){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(o,"__esModule",{value:!0})},n.t=function(o,l){if(l&1&&(o=n(o)),l&8||l&4&&typeof o=="object"&&o&&o.__esModule)return o;var u=Object.create(null);if(n.r(u),Object.defineProperty(u,"default",{enumerable:!0,value:o}),l&2&&typeof o!="string")for(var c in o)n.d(u,c,(function(h){return o[h]}).bind(null,c));return u},n.n=function(o){var l=o&&o.__esModule?function(){return o.default}:function(){return o};return n.d(l,"a",l),l},n.o=function(o,l){return Object.prototype.hasOwnProperty.call(o,l)},n.p="",n(n.s="fb15")}({"00ee":function(e,t,n){var o=n("b622"),l=o("toStringTag"),u={};u[l]="z",e.exports=String(u)==="[object z]"},"0366":function(e,t,n){var o=n("1c0b");e.exports=function(l,u,c){if(o(l),u===void 0)return l;switch(c){case 0:return function(){return l.call(u)};case 1:return function(h){return l.call(u,h)};case 2:return function(h,d){return l.call(u,h,d)};case 3:return function(h,d,v){return l.call(u,h,d,v)}}return function(){return l.apply(u,arguments)}}},"057f":function(e,t,n){var o=n("fc6a"),l=n("241c").f,u={}.toString,c=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],h=function(d){try{return l(d)}catch{return c.slice()}};e.exports.f=function(v){return c&&u.call(v)=="[object Window]"?h(v):l(o(v))}},"06cf":function(e,t,n){var o=n("83ab"),l=n("d1e7"),u=n("5c6c"),c=n("fc6a"),h=n("c04e"),d=n("5135"),v=n("0cfb"),p=Object.getOwnPropertyDescriptor;t.f=o?p:function(g,E){if(g=c(g),E=h(E,!0),v)try{return p(g,E)}catch{}if(d(g,E))return u(!l.f.call(g,E),g[E])}},"0cfb":function(e,t,n){var o=n("83ab"),l=n("d039"),u=n("cc12");e.exports=!o&&!l(function(){return Object.defineProperty(u("div"),"a",{get:function(){return 7}}).a!=7})},"13d5":function(e,t,n){var o=n("23e7"),l=n("d58f").left,u=n("a640"),c=n("ae40"),h=u("reduce"),d=c("reduce",{1:0});o({target:"Array",proto:!0,forced:!h||!d},{reduce:function(p){return l(this,p,arguments.length,arguments.length>1?arguments[1]:void 0)}})},"14c3":function(e,t,n){var o=n("c6b6"),l=n("9263");e.exports=function(u,c){var h=u.exec;if(typeof h=="function"){var d=h.call(u,c);if(typeof d!="object")throw TypeError("RegExp exec method returned something other than an Object or null");return d}if(o(u)!=="RegExp")throw TypeError("RegExp#exec called on incompatible receiver");return l.call(u,c)}},"159b":function(e,t,n){var o=n("da84"),l=n("fdbc"),u=n("17c2"),c=n("9112");for(var h in l){var d=o[h],v=d&&d.prototype;if(v&&v.forEach!==u)try{c(v,"forEach",u)}catch{v.forEach=u}}},"17c2":function(e,t,n){var o=n("b727").forEach,l=n("a640"),u=n("ae40"),c=l("forEach"),h=u("forEach");e.exports=!c||!h?function(v){return o(this,v,arguments.length>1?arguments[1]:void 0)}:[].forEach},"1be4":function(e,t,n){var o=n("d066");e.exports=o("document","documentElement")},"1c0b":function(e,t){e.exports=function(n){if(typeof n!="function")throw TypeError(String(n)+" is not a function");return n}},"1c7e":function(e,t,n){var o=n("b622"),l=o("iterator"),u=!1;try{var c=0,h={next:function(){return{done:!!c++}},return:function(){u=!0}};h[l]=function(){return this},Array.from(h,function(){throw 2})}catch{}e.exports=function(d,v){if(!v&&!u)return!1;var p=!1;try{var m={};m[l]=function(){return{next:function(){return{done:p=!0}}}},d(m)}catch{}return p}},"1d80":function(e,t){e.exports=function(n){if(n==null)throw TypeError("Can't call method on "+n);return n}},"1dde":function(e,t,n){var o=n("d039"),l=n("b622"),u=n("2d00"),c=l("species");e.exports=function(h){return u>=51||!o(function(){var d=[],v=d.constructor={};return v[c]=function(){return{foo:1}},d[h](Boolean).foo!==1})}},"23cb":function(e,t,n){var o=n("a691"),l=Math.max,u=Math.min;e.exports=function(c,h){var d=o(c);return d<0?l(d+h,0):u(d,h)}},"23e7":function(e,t,n){var o=n("da84"),l=n("06cf").f,u=n("9112"),c=n("6eeb"),h=n("ce4e"),d=n("e893"),v=n("94ca");e.exports=function(p,m){var g=p.target,E=p.global,x=p.stat,C,S,b,T,D,P;if(E?S=o:x?S=o[g]||h(g,{}):S=(o[g]||{}).prototype,S)for(b in m){if(D=m[b],p.noTargetGet?(P=l(S,b),T=P&&P.value):T=S[b],C=v(E?b:g+(x?".":"#")+b,p.forced),!C&&T!==void 0){if(typeof D==typeof T)continue;d(D,T)}(p.sham||T&&T.sham)&&u(D,"sham",!0),c(S,b,D,p)}}},"241c":function(e,t,n){var o=n("ca84"),l=n("7839"),u=l.concat("length","prototype");t.f=Object.getOwnPropertyNames||function(h){return o(h,u)}},"25f0":function(e,t,n){var o=n("6eeb"),l=n("825a"),u=n("d039"),c=n("ad6d"),h="toString",d=RegExp.prototype,v=d[h],p=u(function(){return v.call({source:"a",flags:"b"})!="/a/b"}),m=v.name!=h;(p||m)&&o(RegExp.prototype,h,function(){var E=l(this),x=String(E.source),C=E.flags,S=String(C===void 0&&E instanceof RegExp&&!("flags"in d)?c.call(E):C);return"/"+x+"/"+S},{unsafe:!0})},"2ca0":function(e,t,n){var o=n("23e7"),l=n("06cf").f,u=n("50c4"),c=n("5a34"),h=n("1d80"),d=n("ab13"),v=n("c430"),p="".startsWith,m=Math.min,g=d("startsWith"),E=!v&&!g&&!!function(){var x=l(String.prototype,"startsWith");return x&&!x.writable}();o({target:"String",proto:!0,forced:!E&&!g},{startsWith:function(C){var S=String(h(this));c(C);var b=u(m(arguments.length>1?arguments[1]:void 0,S.length)),T=String(C);return p?p.call(S,T,b):S.slice(b,b+T.length)===T}})},"2d00":function(e,t,n){var o=n("da84"),l=n("342f"),u=o.process,c=u&&u.versions,h=c&&c.v8,d,v;h?(d=h.split("."),v=d[0]+d[1]):l&&(d=l.match(/Edge\/(\d+)/),(!d||d[1]>=74)&&(d=l.match(/Chrome\/(\d+)/),d&&(v=d[1]))),e.exports=v&&+v},"342f":function(e,t,n){var o=n("d066");e.exports=o("navigator","userAgent")||""},"35a1":function(e,t,n){var o=n("f5df"),l=n("3f8c"),u=n("b622"),c=u("iterator");e.exports=function(h){if(h!=null)return h[c]||h["@@iterator"]||l[o(h)]}},"37e8":function(e,t,n){var o=n("83ab"),l=n("9bf2"),u=n("825a"),c=n("df75");e.exports=o?Object.defineProperties:function(d,v){u(d);for(var p=c(v),m=p.length,g=0,E;m>g;)l.f(d,E=p[g++],v[E]);return d}},"3bbe":function(e,t,n){var o=n("861d");e.exports=function(l){if(!o(l)&&l!==null)throw TypeError("Can't set "+String(l)+" as a prototype");return l}},"3ca3":function(e,t,n){var o=n("6547").charAt,l=n("69f3"),u=n("7dd0"),c="String Iterator",h=l.set,d=l.getterFor(c);u(String,"String",function(v){h(this,{type:c,string:String(v),index:0})},function(){var p=d(this),m=p.string,g=p.index,E;return g>=m.length?{value:void 0,done:!0}:(E=o(m,g),p.index+=E.length,{value:E,done:!1})})},"3f8c":function(e,t){e.exports={}},4160:function(e,t,n){var o=n("23e7"),l=n("17c2");o({target:"Array",proto:!0,forced:[].forEach!=l},{forEach:l})},"428f":function(e,t,n){var o=n("da84");e.exports=o},"44ad":function(e,t,n){var o=n("d039"),l=n("c6b6"),u="".split;e.exports=o(function(){return!Object("z").propertyIsEnumerable(0)})?function(c){return l(c)=="String"?u.call(c,""):Object(c)}:Object},"44d2":function(e,t,n){var o=n("b622"),l=n("7c73"),u=n("9bf2"),c=o("unscopables"),h=Array.prototype;h[c]==null&&u.f(h,c,{configurable:!0,value:l(null)}),e.exports=function(d){h[c][d]=!0}},"44e7":function(e,t,n){var o=n("861d"),l=n("c6b6"),u=n("b622"),c=u("match");e.exports=function(h){var d;return o(h)&&((d=h[c])!==void 0?!!d:l(h)=="RegExp")}},4930:function(e,t,n){var o=n("d039");e.exports=!!Object.getOwnPropertySymbols&&!o(function(){return!String(Symbol())})},"4d64":function(e,t,n){var o=n("fc6a"),l=n("50c4"),u=n("23cb"),c=function(h){return function(d,v,p){var m=o(d),g=l(m.length),E=u(p,g),x;if(h&&v!=v){for(;g>E;)if(x=m[E++],x!=x)return!0}else for(;g>E;E++)if((h||E in m)&&m[E]===v)return h||E||0;return!h&&-1}};e.exports={includes:c(!0),indexOf:c(!1)}},"4de4":function(e,t,n){var o=n("23e7"),l=n("b727").filter,u=n("1dde"),c=n("ae40"),h=u("filter"),d=c("filter");o({target:"Array",proto:!0,forced:!h||!d},{filter:function(p){return l(this,p,arguments.length>1?arguments[1]:void 0)}})},"4df4":function(e,t,n){var o=n("0366"),l=n("7b0b"),u=n("9bdd"),c=n("e95a"),h=n("50c4"),d=n("8418"),v=n("35a1");e.exports=function(m){var g=l(m),E=typeof this=="function"?this:Array,x=arguments.length,C=x>1?arguments[1]:void 0,S=C!==void 0,b=v(g),T=0,D,P,_,L,N,k;if(S&&(C=o(C,x>2?arguments[2]:void 0,2)),b!=null&&!(E==Array&&c(b)))for(L=b.call(g),N=L.next,P=new E;!(_=N.call(L)).done;T++)k=S?u(L,C,[_.value,T],!0):_.value,d(P,T,k);else for(D=h(g.length),P=new E(D);D>T;T++)k=S?C(g[T],T):g[T],d(P,T,k);return P.length=T,P}},"4fad":function(e,t,n){var o=n("23e7"),l=n("6f53").entries;o({target:"Object",stat:!0},{entries:function(c){return l(c)}})},"50c4":function(e,t,n){var o=n("a691"),l=Math.min;e.exports=function(u){return u>0?l(o(u),9007199254740991):0}},5135:function(e,t){var n={}.hasOwnProperty;e.exports=function(o,l){return n.call(o,l)}},5319:function(e,t,n){var o=n("d784"),l=n("825a"),u=n("7b0b"),c=n("50c4"),h=n("a691"),d=n("1d80"),v=n("8aa5"),p=n("14c3"),m=Math.max,g=Math.min,E=Math.floor,x=/\$([$&'`]|\d\d?|<[^>]*>)/g,C=/\$([$&'`]|\d\d?)/g,S=function(b){return b===void 0?b:String(b)};o("replace",2,function(b,T,D,P){var _=P.REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE,L=P.REPLACE_KEEPS_$0,N=_?"$":"$0";return[function(w,j){var G=d(this),V=w==null?void 0:w[b];return V!==void 0?V.call(w,G,j):T.call(String(G),w,j)},function(I,w){if(!_&&L||typeof w=="string"&&w.indexOf(N)===-1){var j=D(T,I,this,w);if(j.done)return j.value}var G=l(I),V=String(this),ce=typeof w=="function";ce||(w=String(w));var ve=G.global;if(ve){var Pe=G.unicode;G.lastIndex=0}for(var pe=[];;){var F=p(G,V);if(F===null||(pe.push(F),!ve))break;var Y=String(F[0]);Y===""&&(G.lastIndex=v(V,c(G.lastIndex),Pe))}for(var J="",re=0,ee=0;ee<pe.length;ee++){F=pe[ee];for(var Q=String(F[0]),oe=m(g(h(F.index),V.length),0),ge=[],He=1;He<F.length;He++)ge.push(S(F[He]));var it=F.groups;if(ce){var ht=[Q].concat(ge,oe,V);it!==void 0&&ht.push(it);var Ie=String(w.apply(void 0,ht))}else Ie=k(Q,V,oe,ge,it,w);oe>=re&&(J+=V.slice(re,oe)+Ie,re=oe+Q.length)}return J+V.slice(re)}];function k(I,w,j,G,V,ce){var ve=j+I.length,Pe=G.length,pe=C;return V!==void 0&&(V=u(V),pe=x),T.call(ce,pe,function(F,Y){var J;switch(Y.charAt(0)){case"$":return"$";case"&":return I;case"`":return w.slice(0,j);case"'":return w.slice(ve);case"<":J=V[Y.slice(1,-1)];break;default:var re=+Y;if(re===0)return F;if(re>Pe){var ee=E(re/10);return ee===0?F:ee<=Pe?G[ee-1]===void 0?Y.charAt(1):G[ee-1]+Y.charAt(1):F}J=G[re-1]}return J===void 0?"":J})}})},5692:function(e,t,n){var o=n("c430"),l=n("c6cd");(e.exports=function(u,c){return l[u]||(l[u]=c!==void 0?c:{})})("versions",[]).push({version:"3.6.5",mode:o?"pure":"global",copyright:"Â© 2020 Denis Pushkarev (zloirock.ru)"})},"56ef":function(e,t,n){var o=n("d066"),l=n("241c"),u=n("7418"),c=n("825a");e.exports=o("Reflect","ownKeys")||function(d){var v=l.f(c(d)),p=u.f;return p?v.concat(p(d)):v}},"5a34":function(e,t,n){var o=n("44e7");e.exports=function(l){if(o(l))throw TypeError("The method doesn't accept regular expressions");return l}},"5c6c":function(e,t){e.exports=function(n,o){return{enumerable:!(n&1),configurable:!(n&2),writable:!(n&4),value:o}}},"5db7":function(e,t,n){var o=n("23e7"),l=n("a2bf"),u=n("7b0b"),c=n("50c4"),h=n("1c0b"),d=n("65f0");o({target:"Array",proto:!0},{flatMap:function(p){var m=u(this),g=c(m.length),E;return h(p),E=d(m,0),E.length=l(E,m,m,g,0,1,p,arguments.length>1?arguments[1]:void 0),E}})},6547:function(e,t,n){var o=n("a691"),l=n("1d80"),u=function(c){return function(h,d){var v=String(l(h)),p=o(d),m=v.length,g,E;return p<0||p>=m?c?"":void 0:(g=v.charCodeAt(p),g<55296||g>56319||p+1===m||(E=v.charCodeAt(p+1))<56320||E>57343?c?v.charAt(p):g:c?v.slice(p,p+2):(g-55296<<10)+(E-56320)+65536)}};e.exports={codeAt:u(!1),charAt:u(!0)}},"65f0":function(e,t,n){var o=n("861d"),l=n("e8b5"),u=n("b622"),c=u("species");e.exports=function(h,d){var v;return l(h)&&(v=h.constructor,typeof v=="function"&&(v===Array||l(v.prototype))?v=void 0:o(v)&&(v=v[c],v===null&&(v=void 0))),new(v===void 0?Array:v)(d===0?0:d)}},"69f3":function(e,t,n){var o=n("7f9a"),l=n("da84"),u=n("861d"),c=n("9112"),h=n("5135"),d=n("f772"),v=n("d012"),p=l.WeakMap,m,g,E,x=function(_){return E(_)?g(_):m(_,{})},C=function(_){return function(L){var N;if(!u(L)||(N=g(L)).type!==_)throw TypeError("Incompatible receiver, "+_+" required");return N}};if(o){var S=new p,b=S.get,T=S.has,D=S.set;m=function(_,L){return D.call(S,_,L),L},g=function(_){return b.call(S,_)||{}},E=function(_){return T.call(S,_)}}else{var P=d("state");v[P]=!0,m=function(_,L){return c(_,P,L),L},g=function(_){return h(_,P)?_[P]:{}},E=function(_){return h(_,P)}}e.exports={set:m,get:g,has:E,enforce:x,getterFor:C}},"6eeb":function(e,t,n){var o=n("da84"),l=n("9112"),u=n("5135"),c=n("ce4e"),h=n("8925"),d=n("69f3"),v=d.get,p=d.enforce,m=String(String).split("String");(e.exports=function(g,E,x,C){var S=C?!!C.unsafe:!1,b=C?!!C.enumerable:!1,T=C?!!C.noTargetGet:!1;if(typeof x=="function"&&(typeof E=="string"&&!u(x,"name")&&l(x,"name",E),p(x).source=m.join(typeof E=="string"?E:"")),g===o){b?g[E]=x:c(E,x);return}else S?!T&&g[E]&&(b=!0):delete g[E];b?g[E]=x:l(g,E,x)})(Function.prototype,"toString",function(){return typeof this=="function"&&v(this).source||h(this)})},"6f53":function(e,t,n){var o=n("83ab"),l=n("df75"),u=n("fc6a"),c=n("d1e7").f,h=function(d){return function(v){for(var p=u(v),m=l(p),g=m.length,E=0,x=[],C;g>E;)C=m[E++],(!o||c.call(p,C))&&x.push(d?[C,p[C]]:p[C]);return x}};e.exports={entries:h(!0),values:h(!1)}},"73d9":function(e,t,n){var o=n("44d2");o("flatMap")},7418:function(e,t){t.f=Object.getOwnPropertySymbols},"746f":function(e,t,n){var o=n("428f"),l=n("5135"),u=n("e538"),c=n("9bf2").f;e.exports=function(h){var d=o.Symbol||(o.Symbol={});l(d,h)||c(d,h,{value:u.f(h)})}},7839:function(e,t){e.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},"7b0b":function(e,t,n){var o=n("1d80");e.exports=function(l){return Object(o(l))}},"7c73":function(e,t,n){var o=n("825a"),l=n("37e8"),u=n("7839"),c=n("d012"),h=n("1be4"),d=n("cc12"),v=n("f772"),p=">",m="<",g="prototype",E="script",x=v("IE_PROTO"),C=function(){},S=function(_){return m+E+p+_+m+"/"+E+p},b=function(_){_.write(S("")),_.close();var L=_.parentWindow.Object;return _=null,L},T=function(){var _=d("iframe"),L="java"+E+":",N;return _.style.display="none",h.appendChild(_),_.src=String(L),N=_.contentWindow.document,N.open(),N.write(S("document.F=Object")),N.close(),N.F},D,P=function(){try{D=document.domain&&new ActiveXObject("htmlfile")}catch{}P=D?b(D):T();for(var _=u.length;_--;)delete P[g][u[_]];return P()};c[x]=!0,e.exports=Object.create||function(L,N){var k;return L!==null?(C[g]=o(L),k=new C,C[g]=null,k[x]=L):k=P(),N===void 0?k:l(k,N)}},"7dd0":function(e,t,n){var o=n("23e7"),l=n("9ed3"),u=n("e163"),c=n("d2bb"),h=n("d44e"),d=n("9112"),v=n("6eeb"),p=n("b622"),m=n("c430"),g=n("3f8c"),E=n("ae93"),x=E.IteratorPrototype,C=E.BUGGY_SAFARI_ITERATORS,S=p("iterator"),b="keys",T="values",D="entries",P=function(){return this};e.exports=function(_,L,N,k,I,w,j){l(N,L,k);var G=function(ee){if(ee===I&&pe)return pe;if(!C&&ee in ve)return ve[ee];switch(ee){case b:return function(){return new N(this,ee)};case T:return function(){return new N(this,ee)};case D:return function(){return new N(this,ee)}}return function(){return new N(this)}},V=L+" Iterator",ce=!1,ve=_.prototype,Pe=ve[S]||ve["@@iterator"]||I&&ve[I],pe=!C&&Pe||G(I),F=L=="Array"&&ve.entries||Pe,Y,J,re;if(F&&(Y=u(F.call(new _)),x!==Object.prototype&&Y.next&&(!m&&u(Y)!==x&&(c?c(Y,x):typeof Y[S]!="function"&&d(Y,S,P)),h(Y,V,!0,!0),m&&(g[V]=P))),I==T&&Pe&&Pe.name!==T&&(ce=!0,pe=function(){return Pe.call(this)}),(!m||j)&&ve[S]!==pe&&d(ve,S,pe),g[L]=pe,I)if(J={values:G(T),keys:w?pe:G(b),entries:G(D)},j)for(re in J)(C||ce||!(re in ve))&&v(ve,re,J[re]);else o({target:L,proto:!0,forced:C||ce},J);return J}},"7f9a":function(e,t,n){var o=n("da84"),l=n("8925"),u=o.WeakMap;e.exports=typeof u=="function"&&/native code/.test(l(u))},"825a":function(e,t,n){var o=n("861d");e.exports=function(l){if(!o(l))throw TypeError(String(l)+" is not an object");return l}},"83ab":function(e,t,n){var o=n("d039");e.exports=!o(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7})},8418:function(e,t,n){var o=n("c04e"),l=n("9bf2"),u=n("5c6c");e.exports=function(c,h,d){var v=o(h);v in c?l.f(c,v,u(0,d)):c[v]=d}},"861d":function(e,t){e.exports=function(n){return typeof n=="object"?n!==null:typeof n=="function"}},8875:function(e,t,n){var o,l,u;(function(c,h){l=[],o=h,u=typeof o=="function"?o.apply(t,l):o,u!==void 0&&(e.exports=u)})(typeof self<"u"?self:this,function(){function c(){var h=Object.getOwnPropertyDescriptor(document,"currentScript");if(!h&&"currentScript"in document&&document.currentScript||h&&h.get!==c&&document.currentScript)return document.currentScript;try{throw new Error}catch(D){var d=/.*at [^(]*\((.*):(.+):(.+)\)$/ig,v=/@([^@]*):(\d+):(\d+)\s*$/ig,p=d.exec(D.stack)||v.exec(D.stack),m=p&&p[1]||!1,g=p&&p[2]||!1,E=document.location.href.replace(document.location.hash,""),x,C,S,b=document.getElementsByTagName("script");m===E&&(x=document.documentElement.outerHTML,C=new RegExp("(?:[^\\n]+?\\n){0,"+(g-2)+"}[^<]*<script>([\\d\\D]*?)<\\/script>[\\d\\D]*","i"),S=x.replace(C,"$1").trim());for(var T=0;T<b.length;T++)if(b[T].readyState==="interactive"||b[T].src===m||m===E&&b[T].innerHTML&&b[T].innerHTML.trim()===S)return b[T];return null}}return c})},8925:function(e,t,n){var o=n("c6cd"),l=Function.toString;typeof o.inspectSource!="function"&&(o.inspectSource=function(u){return l.call(u)}),e.exports=o.inspectSource},"8aa5":function(e,t,n){var o=n("6547").charAt;e.exports=function(l,u,c){return u+(c?o(l,u).length:1)}},"8bbf":function(e,t){e.exports=r},"90e3":function(e,t){var n=0,o=Math.random();e.exports=function(l){return"Symbol("+String(l===void 0?"":l)+")_"+(++n+o).toString(36)}},9112:function(e,t,n){var o=n("83ab"),l=n("9bf2"),u=n("5c6c");e.exports=o?function(c,h,d){return l.f(c,h,u(1,d))}:function(c,h,d){return c[h]=d,c}},9263:function(e,t,n){var o=n("ad6d"),l=n("9f7f"),u=RegExp.prototype.exec,c=String.prototype.replace,h=u,d=function(){var g=/a/,E=/b*/g;return u.call(g,"a"),u.call(E,"a"),g.lastIndex!==0||E.lastIndex!==0}(),v=l.UNSUPPORTED_Y||l.BROKEN_CARET,p=/()??/.exec("")[1]!==void 0,m=d||p||v;m&&(h=function(E){var x=this,C,S,b,T,D=v&&x.sticky,P=o.call(x),_=x.source,L=0,N=E;return D&&(P=P.replace("y",""),P.indexOf("g")===-1&&(P+="g"),N=String(E).slice(x.lastIndex),x.lastIndex>0&&(!x.multiline||x.multiline&&E[x.lastIndex-1]!==`
`)&&(_="(?: "+_+")",N=" "+N,L++),S=new RegExp("^(?:"+_+")",P)),p&&(S=new RegExp("^"+_+"$(?!\\s)",P)),d&&(C=x.lastIndex),b=u.call(D?S:x,N),D?b?(b.input=b.input.slice(L),b[0]=b[0].slice(L),b.index=x.lastIndex,x.lastIndex+=b[0].length):x.lastIndex=0:d&&b&&(x.lastIndex=x.global?b.index+b[0].length:C),p&&b&&b.length>1&&c.call(b[0],S,function(){for(T=1;T<arguments.length-2;T++)arguments[T]===void 0&&(b[T]=void 0)}),b}),e.exports=h},"94ca":function(e,t,n){var o=n("d039"),l=/#|\.prototype\./,u=function(p,m){var g=h[c(p)];return g==v?!0:g==d?!1:typeof m=="function"?o(m):!!m},c=u.normalize=function(p){return String(p).replace(l,".").toLowerCase()},h=u.data={},d=u.NATIVE="N",v=u.POLYFILL="P";e.exports=u},"99af":function(e,t,n){var o=n("23e7"),l=n("d039"),u=n("e8b5"),c=n("861d"),h=n("7b0b"),d=n("50c4"),v=n("8418"),p=n("65f0"),m=n("1dde"),g=n("b622"),E=n("2d00"),x=g("isConcatSpreadable"),C=9007199254740991,S="Maximum allowed index exceeded",b=E>=51||!l(function(){var _=[];return _[x]=!1,_.concat()[0]!==_}),T=m("concat"),D=function(_){if(!c(_))return!1;var L=_[x];return L!==void 0?!!L:u(_)},P=!b||!T;o({target:"Array",proto:!0,forced:P},{concat:function(L){var N=h(this),k=p(N,0),I=0,w,j,G,V,ce;for(w=-1,G=arguments.length;w<G;w++)if(ce=w===-1?N:arguments[w],D(ce)){if(V=d(ce.length),I+V>C)throw TypeError(S);for(j=0;j<V;j++,I++)j in ce&&v(k,I,ce[j])}else{if(I>=C)throw TypeError(S);v(k,I++,ce)}return k.length=I,k}})},"9bdd":function(e,t,n){var o=n("825a");e.exports=function(l,u,c,h){try{return h?u(o(c)[0],c[1]):u(c)}catch(v){var d=l.return;throw d!==void 0&&o(d.call(l)),v}}},"9bf2":function(e,t,n){var o=n("83ab"),l=n("0cfb"),u=n("825a"),c=n("c04e"),h=Object.defineProperty;t.f=o?h:function(v,p,m){if(u(v),p=c(p,!0),u(m),l)try{return h(v,p,m)}catch{}if("get"in m||"set"in m)throw TypeError("Accessors not supported");return"value"in m&&(v[p]=m.value),v}},"9ed3":function(e,t,n){var o=n("ae93").IteratorPrototype,l=n("7c73"),u=n("5c6c"),c=n("d44e"),h=n("3f8c"),d=function(){return this};e.exports=function(v,p,m){var g=p+" Iterator";return v.prototype=l(o,{next:u(1,m)}),c(v,g,!1,!0),h[g]=d,v}},"9f7f":function(e,t,n){var o=n("d039");function l(u,c){return RegExp(u,c)}t.UNSUPPORTED_Y=o(function(){var u=l("a","y");return u.lastIndex=2,u.exec("abcd")!=null}),t.BROKEN_CARET=o(function(){var u=l("^r","gy");return u.lastIndex=2,u.exec("str")!=null})},a2bf:function(e,t,n){var o=n("e8b5"),l=n("50c4"),u=n("0366"),c=function(h,d,v,p,m,g,E,x){for(var C=m,S=0,b=E?u(E,x,3):!1,T;S<p;){if(S in v){if(T=b?b(v[S],S,d):v[S],g>0&&o(T))C=c(h,d,T,l(T.length),C,g-1)-1;else{if(C>=9007199254740991)throw TypeError("Exceed the acceptable array length");h[C]=T}C++}S++}return C};e.exports=c},a352:function(e,t){e.exports=i},a434:function(e,t,n){var o=n("23e7"),l=n("23cb"),u=n("a691"),c=n("50c4"),h=n("7b0b"),d=n("65f0"),v=n("8418"),p=n("1dde"),m=n("ae40"),g=p("splice"),E=m("splice",{ACCESSORS:!0,0:0,1:2}),x=Math.max,C=Math.min,S=9007199254740991,b="Maximum allowed length exceeded";o({target:"Array",proto:!0,forced:!g||!E},{splice:function(D,P){var _=h(this),L=c(_.length),N=l(D,L),k=arguments.length,I,w,j,G,V,ce;if(k===0?I=w=0:k===1?(I=0,w=L-N):(I=k-2,w=C(x(u(P),0),L-N)),L+I-w>S)throw TypeError(b);for(j=d(_,w),G=0;G<w;G++)V=N+G,V in _&&v(j,G,_[V]);if(j.length=w,I<w){for(G=N;G<L-w;G++)V=G+w,ce=G+I,V in _?_[ce]=_[V]:delete _[ce];for(G=L;G>L-w+I;G--)delete _[G-1]}else if(I>w)for(G=L-w;G>N;G--)V=G+w-1,ce=G+I-1,V in _?_[ce]=_[V]:delete _[ce];for(G=0;G<I;G++)_[G+N]=arguments[G+2];return _.length=L-w+I,j}})},a4d3:function(e,t,n){var o=n("23e7"),l=n("da84"),u=n("d066"),c=n("c430"),h=n("83ab"),d=n("4930"),v=n("fdbf"),p=n("d039"),m=n("5135"),g=n("e8b5"),E=n("861d"),x=n("825a"),C=n("7b0b"),S=n("fc6a"),b=n("c04e"),T=n("5c6c"),D=n("7c73"),P=n("df75"),_=n("241c"),L=n("057f"),N=n("7418"),k=n("06cf"),I=n("9bf2"),w=n("d1e7"),j=n("9112"),G=n("6eeb"),V=n("5692"),ce=n("f772"),ve=n("d012"),Pe=n("90e3"),pe=n("b622"),F=n("e538"),Y=n("746f"),J=n("d44e"),re=n("69f3"),ee=n("b727").forEach,Q=ce("hidden"),oe="Symbol",ge="prototype",He=pe("toPrimitive"),it=re.set,ht=re.getterFor(oe),Ie=Object[ge],ke=l.Symbol,Tt=u("JSON","stringify"),Je=k.f,Qe=I.f,Wn=L.f,Gr=w.f,Ye=V("symbols"),ft=V("op-symbols"),Yt=V("string-to-symbol-registry"),gn=V("symbol-to-string-registry"),yn=V("wks"),mn=l.QObject,En=!mn||!mn[ge]||!mn[ge].findChild,xn=h&&p(function(){return D(Qe({},"a",{get:function(){return Qe(this,"a",{value:7}).a}})).a!=7})?function(Z,U,W){var ie=Je(Ie,U);ie&&delete Ie[U],Qe(Z,U,W),ie&&Z!==Ie&&Qe(Ie,U,ie)}:Qe,Cn=function(Z,U){var W=Ye[Z]=D(ke[ge]);return it(W,{type:oe,tag:Z,description:U}),h||(W.description=U),W},A=v?function(Z){return typeof Z=="symbol"}:function(Z){return Object(Z)instanceof ke},O=function(U,W,ie){U===Ie&&O(ft,W,ie),x(U);var se=b(W,!0);return x(ie),m(Ye,se)?(ie.enumerable?(m(U,Q)&&U[Q][se]&&(U[Q][se]=!1),ie=D(ie,{enumerable:T(0,!1)})):(m(U,Q)||Qe(U,Q,T(1,{})),U[Q][se]=!0),xn(U,se,ie)):Qe(U,se,ie)},M=function(U,W){x(U);var ie=S(W),se=P(ie).concat(ue(ie));return ee(se,function(Ge){(!h||B.call(ie,Ge))&&O(U,Ge,ie[Ge])}),U},R=function(U,W){return W===void 0?D(U):M(D(U),W)},B=function(U){var W=b(U,!0),ie=Gr.call(this,W);return this===Ie&&m(Ye,W)&&!m(ft,W)?!1:ie||!m(this,W)||!m(Ye,W)||m(this,Q)&&this[Q][W]?ie:!0},z=function(U,W){var ie=S(U),se=b(W,!0);if(!(ie===Ie&&m(Ye,se)&&!m(ft,se))){var Ge=Je(ie,se);return Ge&&m(Ye,se)&&!(m(ie,Q)&&ie[Q][se])&&(Ge.enumerable=!0),Ge}},q=function(U){var W=Wn(S(U)),ie=[];return ee(W,function(se){!m(Ye,se)&&!m(ve,se)&&ie.push(se)}),ie},ue=function(U){var W=U===Ie,ie=Wn(W?ft:S(U)),se=[];return ee(ie,function(Ge){m(Ye,Ge)&&(!W||m(Ie,Ge))&&se.push(Ye[Ge])}),se};if(d||(ke=function(){if(this instanceof ke)throw TypeError("Symbol is not a constructor");var U=!arguments.length||arguments[0]===void 0?void 0:String(arguments[0]),W=Pe(U),ie=function(se){this===Ie&&ie.call(ft,se),m(this,Q)&&m(this[Q],W)&&(this[Q][W]=!1),xn(this,W,T(1,se))};return h&&En&&xn(Ie,W,{configurable:!0,set:ie}),Cn(W,U)},G(ke[ge],"toString",function(){return ht(this).tag}),G(ke,"withoutSetter",function(Z){return Cn(Pe(Z),Z)}),w.f=B,I.f=O,k.f=z,_.f=L.f=q,N.f=ue,F.f=function(Z){return Cn(pe(Z),Z)},h&&(Qe(ke[ge],"description",{configurable:!0,get:function(){return ht(this).description}}),c||G(Ie,"propertyIsEnumerable",B,{unsafe:!0}))),o({global:!0,wrap:!0,forced:!d,sham:!d},{Symbol:ke}),ee(P(yn),function(Z){Y(Z)}),o({target:oe,stat:!0,forced:!d},{for:function(Z){var U=String(Z);if(m(Yt,U))return Yt[U];var W=ke(U);return Yt[U]=W,gn[W]=U,W},keyFor:function(U){if(!A(U))throw TypeError(U+" is not a symbol");if(m(gn,U))return gn[U]},useSetter:function(){En=!0},useSimple:function(){En=!1}}),o({target:"Object",stat:!0,forced:!d,sham:!h},{create:R,defineProperty:O,defineProperties:M,getOwnPropertyDescriptor:z}),o({target:"Object",stat:!0,forced:!d},{getOwnPropertyNames:q,getOwnPropertySymbols:ue}),o({target:"Object",stat:!0,forced:p(function(){N.f(1)})},{getOwnPropertySymbols:function(U){return N.f(C(U))}}),Tt){var Se=!d||p(function(){var Z=ke();return Tt([Z])!="[null]"||Tt({a:Z})!="{}"||Tt(Object(Z))!="{}"});o({target:"JSON",stat:!0,forced:Se},{stringify:function(U,W,ie){for(var se=[U],Ge=1,jr;arguments.length>Ge;)se.push(arguments[Ge++]);if(jr=W,!(!E(W)&&U===void 0||A(U)))return g(W)||(W=function(sa,Kn){if(typeof jr=="function"&&(Kn=jr.call(this,sa,Kn)),!A(Kn))return Kn}),se[1]=W,Tt.apply(null,se)}})}ke[ge][He]||j(ke[ge],He,ke[ge].valueOf),J(ke,oe),ve[Q]=!0},a630:function(e,t,n){var o=n("23e7"),l=n("4df4"),u=n("1c7e"),c=!u(function(h){Array.from(h)});o({target:"Array",stat:!0,forced:c},{from:l})},a640:function(e,t,n){var o=n("d039");e.exports=function(l,u){var c=[][l];return!!c&&o(function(){c.call(null,u||function(){throw 1},1)})}},a691:function(e,t){var n=Math.ceil,o=Math.floor;e.exports=function(l){return isNaN(l=+l)?0:(l>0?o:n)(l)}},ab13:function(e,t,n){var o=n("b622"),l=o("match");e.exports=function(u){var c=/./;try{"/./"[u](c)}catch{try{return c[l]=!1,"/./"[u](c)}catch{}}return!1}},ac1f:function(e,t,n){var o=n("23e7"),l=n("9263");o({target:"RegExp",proto:!0,forced:/./.exec!==l},{exec:l})},ad6d:function(e,t,n){var o=n("825a");e.exports=function(){var l=o(this),u="";return l.global&&(u+="g"),l.ignoreCase&&(u+="i"),l.multiline&&(u+="m"),l.dotAll&&(u+="s"),l.unicode&&(u+="u"),l.sticky&&(u+="y"),u}},ae40:function(e,t,n){var o=n("83ab"),l=n("d039"),u=n("5135"),c=Object.defineProperty,h={},d=function(v){throw v};e.exports=function(v,p){if(u(h,v))return h[v];p||(p={});var m=[][v],g=u(p,"ACCESSORS")?p.ACCESSORS:!1,E=u(p,0)?p[0]:d,x=u(p,1)?p[1]:void 0;return h[v]=!!m&&!l(function(){if(g&&!o)return!0;var C={length:-1};g?c(C,1,{enumerable:!0,get:d}):C[1]=1,m.call(C,E,x)})}},ae93:function(e,t,n){var o=n("e163"),l=n("9112"),u=n("5135"),c=n("b622"),h=n("c430"),d=c("iterator"),v=!1,p=function(){return this},m,g,E;[].keys&&(E=[].keys(),"next"in E?(g=o(o(E)),g!==Object.prototype&&(m=g)):v=!0),m==null&&(m={}),!h&&!u(m,d)&&l(m,d,p),e.exports={IteratorPrototype:m,BUGGY_SAFARI_ITERATORS:v}},b041:function(e,t,n){var o=n("00ee"),l=n("f5df");e.exports=o?{}.toString:function(){return"[object "+l(this)+"]"}},b0c0:function(e,t,n){var o=n("83ab"),l=n("9bf2").f,u=Function.prototype,c=u.toString,h=/^\s*function ([^ (]*)/,d="name";o&&!(d in u)&&l(u,d,{configurable:!0,get:function(){try{return c.call(this).match(h)[1]}catch{return""}}})},b622:function(e,t,n){var o=n("da84"),l=n("5692"),u=n("5135"),c=n("90e3"),h=n("4930"),d=n("fdbf"),v=l("wks"),p=o.Symbol,m=d?p:p&&p.withoutSetter||c;e.exports=function(g){return u(v,g)||(h&&u(p,g)?v[g]=p[g]:v[g]=m("Symbol."+g)),v[g]}},b64b:function(e,t,n){var o=n("23e7"),l=n("7b0b"),u=n("df75"),c=n("d039"),h=c(function(){u(1)});o({target:"Object",stat:!0,forced:h},{keys:function(v){return u(l(v))}})},b727:function(e,t,n){var o=n("0366"),l=n("44ad"),u=n("7b0b"),c=n("50c4"),h=n("65f0"),d=[].push,v=function(p){var m=p==1,g=p==2,E=p==3,x=p==4,C=p==6,S=p==5||C;return function(b,T,D,P){for(var _=u(b),L=l(_),N=o(T,D,3),k=c(L.length),I=0,w=P||h,j=m?w(b,k):g?w(b,0):void 0,G,V;k>I;I++)if((S||I in L)&&(G=L[I],V=N(G,I,_),p)){if(m)j[I]=V;else if(V)switch(p){case 3:return!0;case 5:return G;case 6:return I;case 2:d.call(j,G)}else if(x)return!1}return C?-1:E||x?x:j}};e.exports={forEach:v(0),map:v(1),filter:v(2),some:v(3),every:v(4),find:v(5),findIndex:v(6)}},c04e:function(e,t,n){var o=n("861d");e.exports=function(l,u){if(!o(l))return l;var c,h;if(u&&typeof(c=l.toString)=="function"&&!o(h=c.call(l))||typeof(c=l.valueOf)=="function"&&!o(h=c.call(l))||!u&&typeof(c=l.toString)=="function"&&!o(h=c.call(l)))return h;throw TypeError("Can't convert object to primitive value")}},c430:function(e,t){e.exports=!1},c6b6:function(e,t){var n={}.toString;e.exports=function(o){return n.call(o).slice(8,-1)}},c6cd:function(e,t,n){var o=n("da84"),l=n("ce4e"),u="__core-js_shared__",c=o[u]||l(u,{});e.exports=c},c740:function(e,t,n){var o=n("23e7"),l=n("b727").findIndex,u=n("44d2"),c=n("ae40"),h="findIndex",d=!0,v=c(h);h in[]&&Array(1)[h](function(){d=!1}),o({target:"Array",proto:!0,forced:d||!v},{findIndex:function(m){return l(this,m,arguments.length>1?arguments[1]:void 0)}}),u(h)},c8ba:function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch{typeof window=="object"&&(n=window)}e.exports=n},c975:function(e,t,n){var o=n("23e7"),l=n("4d64").indexOf,u=n("a640"),c=n("ae40"),h=[].indexOf,d=!!h&&1/[1].indexOf(1,-0)<0,v=u("indexOf"),p=c("indexOf",{ACCESSORS:!0,1:0});o({target:"Array",proto:!0,forced:d||!v||!p},{indexOf:function(g){return d?h.apply(this,arguments)||0:l(this,g,arguments.length>1?arguments[1]:void 0)}})},ca84:function(e,t,n){var o=n("5135"),l=n("fc6a"),u=n("4d64").indexOf,c=n("d012");e.exports=function(h,d){var v=l(h),p=0,m=[],g;for(g in v)!o(c,g)&&o(v,g)&&m.push(g);for(;d.length>p;)o(v,g=d[p++])&&(~u(m,g)||m.push(g));return m}},caad:function(e,t,n){var o=n("23e7"),l=n("4d64").includes,u=n("44d2"),c=n("ae40"),h=c("indexOf",{ACCESSORS:!0,1:0});o({target:"Array",proto:!0,forced:!h},{includes:function(v){return l(this,v,arguments.length>1?arguments[1]:void 0)}}),u("includes")},cc12:function(e,t,n){var o=n("da84"),l=n("861d"),u=o.document,c=l(u)&&l(u.createElement);e.exports=function(h){return c?u.createElement(h):{}}},ce4e:function(e,t,n){var o=n("da84"),l=n("9112");e.exports=function(u,c){try{l(o,u,c)}catch{o[u]=c}return c}},d012:function(e,t){e.exports={}},d039:function(e,t){e.exports=function(n){try{return!!n()}catch{return!0}}},d066:function(e,t,n){var o=n("428f"),l=n("da84"),u=function(c){return typeof c=="function"?c:void 0};e.exports=function(c,h){return arguments.length<2?u(o[c])||u(l[c]):o[c]&&o[c][h]||l[c]&&l[c][h]}},d1e7:function(e,t,n){var o={}.propertyIsEnumerable,l=Object.getOwnPropertyDescriptor,u=l&&!o.call({1:2},1);t.f=u?function(h){var d=l(this,h);return!!d&&d.enumerable}:o},d28b:function(e,t,n){var o=n("746f");o("iterator")},d2bb:function(e,t,n){var o=n("825a"),l=n("3bbe");e.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var u=!1,c={},h;try{h=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set,h.call(c,[]),u=c instanceof Array}catch{}return function(v,p){return o(v),l(p),u?h.call(v,p):v.__proto__=p,v}}():void 0)},d3b7:function(e,t,n){var o=n("00ee"),l=n("6eeb"),u=n("b041");o||l(Object.prototype,"toString",u,{unsafe:!0})},d44e:function(e,t,n){var o=n("9bf2").f,l=n("5135"),u=n("b622"),c=u("toStringTag");e.exports=function(h,d,v){h&&!l(h=v?h:h.prototype,c)&&o(h,c,{configurable:!0,value:d})}},d58f:function(e,t,n){var o=n("1c0b"),l=n("7b0b"),u=n("44ad"),c=n("50c4"),h=function(d){return function(v,p,m,g){o(p);var E=l(v),x=u(E),C=c(E.length),S=d?C-1:0,b=d?-1:1;if(m<2)for(;;){if(S in x){g=x[S],S+=b;break}if(S+=b,d?S<0:C<=S)throw TypeError("Reduce of empty array with no initial value")}for(;d?S>=0:C>S;S+=b)S in x&&(g=p(g,x[S],S,E));return g}};e.exports={left:h(!1),right:h(!0)}},d784:function(e,t,n){n("ac1f");var o=n("6eeb"),l=n("d039"),u=n("b622"),c=n("9263"),h=n("9112"),d=u("species"),v=!l(function(){var x=/./;return x.exec=function(){var C=[];return C.groups={a:"7"},C},"".replace(x,"$<a>")!=="7"}),p=function(){return"a".replace(/./,"$0")==="$0"}(),m=u("replace"),g=function(){return/./[m]?/./[m]("a","$0")==="":!1}(),E=!l(function(){var x=/(?:)/,C=x.exec;x.exec=function(){return C.apply(this,arguments)};var S="ab".split(x);return S.length!==2||S[0]!=="a"||S[1]!=="b"});e.exports=function(x,C,S,b){var T=u(x),D=!l(function(){var I={};return I[T]=function(){return 7},""[x](I)!=7}),P=D&&!l(function(){var I=!1,w=/a/;return x==="split"&&(w={},w.constructor={},w.constructor[d]=function(){return w},w.flags="",w[T]=/./[T]),w.exec=function(){return I=!0,null},w[T](""),!I});if(!D||!P||x==="replace"&&!(v&&p&&!g)||x==="split"&&!E){var _=/./[T],L=S(T,""[x],function(I,w,j,G,V){return w.exec===c?D&&!V?{done:!0,value:_.call(w,j,G)}:{done:!0,value:I.call(j,w,G)}:{done:!1}},{REPLACE_KEEPS_$0:p,REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE:g}),N=L[0],k=L[1];o(String.prototype,x,N),o(RegExp.prototype,T,C==2?function(I,w){return k.call(I,this,w)}:function(I){return k.call(I,this)})}b&&h(RegExp.prototype[T],"sham",!0)}},d81d:function(e,t,n){var o=n("23e7"),l=n("b727").map,u=n("1dde"),c=n("ae40"),h=u("map"),d=c("map");o({target:"Array",proto:!0,forced:!h||!d},{map:function(p){return l(this,p,arguments.length>1?arguments[1]:void 0)}})},da84:function(e,t,n){(function(o){var l=function(u){return u&&u.Math==Math&&u};e.exports=l(typeof globalThis=="object"&&globalThis)||l(typeof window=="object"&&window)||l(typeof self=="object"&&self)||l(typeof o=="object"&&o)||Function("return this")()}).call(this,n("c8ba"))},dbb4:function(e,t,n){var o=n("23e7"),l=n("83ab"),u=n("56ef"),c=n("fc6a"),h=n("06cf"),d=n("8418");o({target:"Object",stat:!0,sham:!l},{getOwnPropertyDescriptors:function(p){for(var m=c(p),g=h.f,E=u(m),x={},C=0,S,b;E.length>C;)b=g(m,S=E[C++]),b!==void 0&&d(x,S,b);return x}})},dbf1:function(e,t,n){(function(o){n.d(t,"a",function(){return u});function l(){return typeof window<"u"?window.console:o.console}var u=l()}).call(this,n("c8ba"))},ddb0:function(e,t,n){var o=n("da84"),l=n("fdbc"),u=n("e260"),c=n("9112"),h=n("b622"),d=h("iterator"),v=h("toStringTag"),p=u.values;for(var m in l){var g=o[m],E=g&&g.prototype;if(E){if(E[d]!==p)try{c(E,d,p)}catch{E[d]=p}if(E[v]||c(E,v,m),l[m]){for(var x in u)if(E[x]!==u[x])try{c(E,x,u[x])}catch{E[x]=u[x]}}}}},df75:function(e,t,n){var o=n("ca84"),l=n("7839");e.exports=Object.keys||function(c){return o(c,l)}},e01a:function(e,t,n){var o=n("23e7"),l=n("83ab"),u=n("da84"),c=n("5135"),h=n("861d"),d=n("9bf2").f,v=n("e893"),p=u.Symbol;if(l&&typeof p=="function"&&(!("description"in p.prototype)||p().description!==void 0)){var m={},g=function(){var T=arguments.length<1||arguments[0]===void 0?void 0:String(arguments[0]),D=this instanceof g?new p(T):T===void 0?p():p(T);return T===""&&(m[D]=!0),D};v(g,p);var E=g.prototype=p.prototype;E.constructor=g;var x=E.toString,C=String(p("test"))=="Symbol(test)",S=/^Symbol\((.*)\)[^)]+$/;d(E,"description",{configurable:!0,get:function(){var T=h(this)?this.valueOf():this,D=x.call(T);if(c(m,T))return"";var P=C?D.slice(7,-1):D.replace(S,"$1");return P===""?void 0:P}}),o({global:!0,forced:!0},{Symbol:g})}},e163:function(e,t,n){var o=n("5135"),l=n("7b0b"),u=n("f772"),c=n("e177"),h=u("IE_PROTO"),d=Object.prototype;e.exports=c?Object.getPrototypeOf:function(v){return v=l(v),o(v,h)?v[h]:typeof v.constructor=="function"&&v instanceof v.constructor?v.constructor.prototype:v instanceof Object?d:null}},e177:function(e,t,n){var o=n("d039");e.exports=!o(function(){function l(){}return l.prototype.constructor=null,Object.getPrototypeOf(new l)!==l.prototype})},e260:function(e,t,n){var o=n("fc6a"),l=n("44d2"),u=n("3f8c"),c=n("69f3"),h=n("7dd0"),d="Array Iterator",v=c.set,p=c.getterFor(d);e.exports=h(Array,"Array",function(m,g){v(this,{type:d,target:o(m),index:0,kind:g})},function(){var m=p(this),g=m.target,E=m.kind,x=m.index++;return!g||x>=g.length?(m.target=void 0,{value:void 0,done:!0}):E=="keys"?{value:x,done:!1}:E=="values"?{value:g[x],done:!1}:{value:[x,g[x]],done:!1}},"values"),u.Arguments=u.Array,l("keys"),l("values"),l("entries")},e439:function(e,t,n){var o=n("23e7"),l=n("d039"),u=n("fc6a"),c=n("06cf").f,h=n("83ab"),d=l(function(){c(1)}),v=!h||d;o({target:"Object",stat:!0,forced:v,sham:!h},{getOwnPropertyDescriptor:function(m,g){return c(u(m),g)}})},e538:function(e,t,n){var o=n("b622");t.f=o},e893:function(e,t,n){var o=n("5135"),l=n("56ef"),u=n("06cf"),c=n("9bf2");e.exports=function(h,d){for(var v=l(d),p=c.f,m=u.f,g=0;g<v.length;g++){var E=v[g];o(h,E)||p(h,E,m(d,E))}}},e8b5:function(e,t,n){var o=n("c6b6");e.exports=Array.isArray||function(u){return o(u)=="Array"}},e95a:function(e,t,n){var o=n("b622"),l=n("3f8c"),u=o("iterator"),c=Array.prototype;e.exports=function(h){return h!==void 0&&(l.Array===h||c[u]===h)}},f5df:function(e,t,n){var o=n("00ee"),l=n("c6b6"),u=n("b622"),c=u("toStringTag"),h=l(function(){return arguments}())=="Arguments",d=function(v,p){try{return v[p]}catch{}};e.exports=o?l:function(v){var p,m,g;return v===void 0?"Undefined":v===null?"Null":typeof(m=d(p=Object(v),c))=="string"?m:h?l(p):(g=l(p))=="Object"&&typeof p.callee=="function"?"Arguments":g}},f772:function(e,t,n){var o=n("5692"),l=n("90e3"),u=o("keys");e.exports=function(c){return u[c]||(u[c]=l(c))}},fb15:function(e,t,n){if(n.r(t),typeof window<"u"){var o=window.document.currentScript;{var l=n("8875");o=l(),"currentScript"in document||Object.defineProperty(document,"currentScript",{get:l})}var u=o&&o.src.match(/(.+\/)[^/]+\.js(\?.*)?$/);u&&(n.p=u[1])}n("99af"),n("4de4"),n("4160"),n("c975"),n("d81d"),n("a434"),n("159b"),n("a4d3"),n("e439"),n("dbb4"),n("b64b");function c(A,O,M){return O in A?Object.defineProperty(A,O,{value:M,enumerable:!0,configurable:!0,writable:!0}):A[O]=M,A}function h(A,O){var M=Object.keys(A);if(Object.getOwnPropertySymbols){var R=Object.getOwnPropertySymbols(A);O&&(R=R.filter(function(B){return Object.getOwnPropertyDescriptor(A,B).enumerable})),M.push.apply(M,R)}return M}function d(A){for(var O=1;O<arguments.length;O++){var M=arguments[O]!=null?arguments[O]:{};O%2?h(Object(M),!0).forEach(function(R){c(A,R,M[R])}):Object.getOwnPropertyDescriptors?Object.defineProperties(A,Object.getOwnPropertyDescriptors(M)):h(Object(M)).forEach(function(R){Object.defineProperty(A,R,Object.getOwnPropertyDescriptor(M,R))})}return A}function v(A){if(Array.isArray(A))return A}n("e01a"),n("d28b"),n("e260"),n("d3b7"),n("3ca3"),n("ddb0");function p(A,O){if(!(typeof Symbol>"u"||!(Symbol.iterator in Object(A)))){var M=[],R=!0,B=!1,z=void 0;try{for(var q=A[Symbol.iterator](),ue;!(R=(ue=q.next()).done)&&(M.push(ue.value),!(O&&M.length===O));R=!0);}catch(Se){B=!0,z=Se}finally{try{!R&&q.return!=null&&q.return()}finally{if(B)throw z}}return M}}n("a630"),n("fb6a"),n("b0c0"),n("25f0");function m(A,O){(O==null||O>A.length)&&(O=A.length);for(var M=0,R=new Array(O);M<O;M++)R[M]=A[M];return R}function g(A,O){if(A){if(typeof A=="string")return m(A,O);var M=Object.prototype.toString.call(A).slice(8,-1);if(M==="Object"&&A.constructor&&(M=A.constructor.name),M==="Map"||M==="Set")return Array.from(A);if(M==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(M))return m(A,O)}}function E(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function x(A,O){return v(A)||p(A,O)||g(A,O)||E()}function C(A){if(Array.isArray(A))return m(A)}function S(A){if(typeof Symbol<"u"&&Symbol.iterator in Object(A))return Array.from(A)}function b(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function T(A){return C(A)||S(A)||g(A)||b()}var D=n("a352"),P=n.n(D);function _(A){A.parentElement!==null&&A.parentElement.removeChild(A)}function L(A,O,M){var R=M===0?A.children[0]:A.children[M-1].nextSibling;A.insertBefore(O,R)}var N=n("dbf1");n("13d5"),n("4fad"),n("ac1f"),n("5319");function k(A){var O=Object.create(null);return function(R){var B=O[R];return B||(O[R]=A(R))}}var I=/-(\w)/g,w=k(function(A){return A.replace(I,function(O,M){return M.toUpperCase()})});n("5db7"),n("73d9");var j=["Start","Add","Remove","Update","End"],G=["Choose","Unchoose","Sort","Filter","Clone"],V=["Move"],ce=[V,j,G].flatMap(function(A){return A}).map(function(A){return"on".concat(A)}),ve={manage:V,manageAndEmit:j,emit:G};function Pe(A){return ce.indexOf(A)!==-1}n("caad"),n("2ca0");var pe=["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","label","legend","li","link","main","map","mark","math","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rb","rp","rt","rtc","ruby","s","samp","script","section","select","slot","small","source","span","strong","style","sub","summary","sup","svg","table","tbody","td","template","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr"];function F(A){return pe.includes(A)}function Y(A){return["transition-group","TransitionGroup"].includes(A)}function J(A){return["id","class","role","style"].includes(A)||A.startsWith("data-")||A.startsWith("aria-")||A.startsWith("on")}function re(A){return A.reduce(function(O,M){var R=x(M,2),B=R[0],z=R[1];return O[B]=z,O},{})}function ee(A){var O=A.$attrs,M=A.componentData,R=M===void 0?{}:M,B=re(Object.entries(O).filter(function(z){var q=x(z,2),ue=q[0];return q[1],J(ue)}));return d(d({},B),R)}function Q(A){var O=A.$attrs,M=A.callBackBuilder,R=re(oe(O));Object.entries(M).forEach(function(z){var q=x(z,2),ue=q[0],Se=q[1];ve[ue].forEach(function(Z){R["on".concat(Z)]=Se(Z)})});var B="[data-draggable]".concat(R.draggable||"");return d(d({},R),{},{draggable:B})}function oe(A){return Object.entries(A).filter(function(O){var M=x(O,2),R=M[0];return M[1],!J(R)}).map(function(O){var M=x(O,2),R=M[0],B=M[1];return[w(R),B]}).filter(function(O){var M=x(O,2),R=M[0];return M[1],!Pe(R)})}n("c740");function ge(A,O){if(!(A instanceof O))throw new TypeError("Cannot call a class as a function")}function He(A,O){for(var M=0;M<O.length;M++){var R=O[M];R.enumerable=R.enumerable||!1,R.configurable=!0,"value"in R&&(R.writable=!0),Object.defineProperty(A,R.key,R)}}function it(A,O,M){return O&&He(A.prototype,O),A}var ht=function(O){var M=O.el;return M},Ie=function(O,M){return O.__draggable_context=M},ke=function(O){return O.__draggable_context},Tt=function(){function A(O){var M=O.nodes,R=M.header,B=M.default,z=M.footer,q=O.root,ue=O.realList;ge(this,A),this.defaultNodes=B,this.children=[].concat(T(R),T(B),T(z)),this.externalComponent=q.externalComponent,this.rootTransition=q.transition,this.tag=q.tag,this.realList=ue}return it(A,[{key:"render",value:function(M,R){var B=this.tag,z=this.children,q=this._isRootComponent,ue=q?{default:function(){return z}}:z;return M(B,R,ue)}},{key:"updated",value:function(){var M=this.defaultNodes,R=this.realList;M.forEach(function(B,z){Ie(ht(B),{element:R[z],index:z})})}},{key:"getUnderlyingVm",value:function(M){return ke(M)}},{key:"getVmIndexFromDomIndex",value:function(M,R){var B=this.defaultNodes,z=B.length,q=R.children,ue=q.item(M);if(ue===null)return z;var Se=ke(ue);if(Se)return Se.index;if(z===0)return 0;var Z=ht(B[0]),U=T(q).findIndex(function(W){return W===Z});return M<U?0:z}},{key:"_isRootComponent",get:function(){return this.externalComponent||this.rootTransition}}]),A}(),Je=n("8bbf");function Qe(A,O){var M=A[O];return M?M():[]}function Wn(A){var O=A.$slots,M=A.realList,R=A.getKey,B=M||[],z=["header","footer"].map(function(W){return Qe(O,W)}),q=x(z,2),ue=q[0],Se=q[1],Z=O.item;if(!Z)throw new Error("draggable element must have an item slot");var U=B.flatMap(function(W,ie){return Z({element:W,index:ie}).map(function(se){return se.key=R(W),se.props=d(d({},se.props||{}),{},{"data-draggable":!0}),se})});if(U.length!==B.length)throw new Error("Item slot must have only one child");return{header:ue,footer:Se,default:U}}function Gr(A){var O=Y(A),M=!F(A)&&!O;return{transition:O,externalComponent:M,tag:M?Object(Je.resolveComponent)(A):O?Je.TransitionGroup:A}}function Ye(A){var O=A.$slots,M=A.tag,R=A.realList,B=A.getKey,z=Wn({$slots:O,realList:R,getKey:B}),q=Gr(M);return new Tt({nodes:z,root:q,realList:R})}function ft(A,O){var M=this;Object(Je.nextTick)(function(){return M.$emit(A.toLowerCase(),O)})}function Yt(A){var O=this;return function(M,R){if(O.realList!==null)return O["onDrag".concat(A)](M,R)}}function gn(A){var O=this,M=Yt.call(this,A);return function(R,B){M.call(O,R,B),ft.call(O,A,R)}}var yn=null,mn={list:{type:Array,required:!1,default:null},modelValue:{type:Array,required:!1,default:null},itemKey:{type:[String,Function],required:!0},clone:{type:Function,default:function(O){return O}},tag:{type:String,default:"div"},move:{type:Function,default:null},componentData:{type:Object,required:!1,default:null}},En=["update:modelValue","change"].concat(T([].concat(T(ve.manageAndEmit),T(ve.emit)).map(function(A){return A.toLowerCase()}))),xn=Object(Je.defineComponent)({name:"draggable",inheritAttrs:!1,props:mn,emits:En,data:function(){return{error:!1}},render:function(){try{this.error=!1;var O=this.$slots,M=this.$attrs,R=this.tag,B=this.componentData,z=this.realList,q=this.getKey,ue=Ye({$slots:O,tag:R,realList:z,getKey:q});this.componentStructure=ue;var Se=ee({$attrs:M,componentData:B});return ue.render(Je.h,Se)}catch(Z){return this.error=!0,Object(Je.h)("pre",{style:{color:"red"}},Z.stack)}},created:function(){this.list!==null&&this.modelValue!==null&&N.a.error("modelValue and list props are mutually exclusive! Please set one or another.")},mounted:function(){var O=this;if(!this.error){var M=this.$attrs,R=this.$el,B=this.componentStructure;B.updated();var z=Q({$attrs:M,callBackBuilder:{manageAndEmit:function(Se){return gn.call(O,Se)},emit:function(Se){return ft.bind(O,Se)},manage:function(Se){return Yt.call(O,Se)}}}),q=R.nodeType===1?R:R.parentElement;this._sortable=new P.a(q,z),this.targetDomElement=q,q.__draggable_component__=this}},updated:function(){this.componentStructure.updated()},beforeUnmount:function(){this._sortable!==void 0&&this._sortable.destroy()},computed:{realList:function(){var O=this.list;return O||this.modelValue},getKey:function(){var O=this.itemKey;return typeof O=="function"?O:function(M){return M[O]}}},watch:{$attrs:{handler:function(O){var M=this._sortable;M&&oe(O).forEach(function(R){var B=x(R,2),z=B[0],q=B[1];M.option(z,q)})},deep:!0}},methods:{getUnderlyingVm:function(O){return this.componentStructure.getUnderlyingVm(O)||null},getUnderlyingPotencialDraggableComponent:function(O){return O.__draggable_component__},emitChanges:function(O){var M=this;Object(Je.nextTick)(function(){return M.$emit("change",O)})},alterList:function(O){if(this.list){O(this.list);return}var M=T(this.modelValue);O(M),this.$emit("update:modelValue",M)},spliceList:function(){var O=arguments,M=function(B){return B.splice.apply(B,T(O))};this.alterList(M)},updatePosition:function(O,M){var R=function(z){return z.splice(M,0,z.splice(O,1)[0])};this.alterList(R)},getRelatedContextFromMoveEvent:function(O){var M=O.to,R=O.related,B=this.getUnderlyingPotencialDraggableComponent(M);if(!B)return{component:B};var z=B.realList,q={list:z,component:B};if(M!==R&&z){var ue=B.getUnderlyingVm(R)||{};return d(d({},ue),q)}return q},getVmIndexFromDomIndex:function(O){return this.componentStructure.getVmIndexFromDomIndex(O,this.targetDomElement)},onDragStart:function(O){this.context=this.getUnderlyingVm(O.item),O.item._underlying_vm_=this.clone(this.context.element),yn=O.item},onDragAdd:function(O){var M=O.item._underlying_vm_;if(M!==void 0){_(O.item);var R=this.getVmIndexFromDomIndex(O.newIndex);this.spliceList(R,0,M);var B={element:M,newIndex:R};this.emitChanges({added:B})}},onDragRemove:function(O){if(L(this.$el,O.item,O.oldIndex),O.pullMode==="clone"){_(O.clone);return}var M=this.context,R=M.index,B=M.element;this.spliceList(R,1);var z={element:B,oldIndex:R};this.emitChanges({removed:z})},onDragUpdate:function(O){_(O.item),L(O.from,O.item,O.oldIndex);var M=this.context.index,R=this.getVmIndexFromDomIndex(O.newIndex);this.updatePosition(M,R);var B={element:this.context.element,oldIndex:M,newIndex:R};this.emitChanges({moved:B})},computeFutureIndex:function(O,M){if(!O.element)return 0;var R=T(M.to.children).filter(function(ue){return ue.style.display!=="none"}),B=R.indexOf(M.related),z=O.component.getVmIndexFromDomIndex(B),q=R.indexOf(yn)!==-1;return q||!M.willInsertAfter?z:z+1},onDragMove:function(O,M){var R=this.move,B=this.realList;if(!R||!B)return!0;var z=this.getRelatedContextFromMoveEvent(O),q=this.computeFutureIndex(z,O),ue=d(d({},this.context),{},{futureIndex:q}),Se=d(d({},O),{},{relatedContext:z,draggedContext:ue});return R(Se,M)},onDragEnd:function(){yn=null}}}),Cn=xn;t.default=Cn},fb6a:function(e,t,n){var o=n("23e7"),l=n("861d"),u=n("e8b5"),c=n("23cb"),h=n("50c4"),d=n("fc6a"),v=n("8418"),p=n("b622"),m=n("1dde"),g=n("ae40"),E=m("slice"),x=g("slice",{ACCESSORS:!0,0:0,1:2}),C=p("species"),S=[].slice,b=Math.max;o({target:"Array",proto:!0,forced:!E||!x},{slice:function(D,P){var _=d(this),L=h(_.length),N=c(D,L),k=c(P===void 0?L:P,L),I,w,j;if(u(_)&&(I=_.constructor,typeof I=="function"&&(I===Array||u(I.prototype))?I=void 0:l(I)&&(I=I[C],I===null&&(I=void 0)),I===Array||I===void 0))return S.call(_,N,k);for(w=new(I===void 0?Array:I)(b(k-N,0)),j=0;N<k;N++,j++)N in _&&v(w,j,_[N]);return w.length=j,w}})},fc6a:function(e,t,n){var o=n("44ad"),l=n("1d80");e.exports=function(u){return o(l(u))}},fdbc:function(e,t){e.exports={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}},fdbf:function(e,t,n){var o=n("4930");e.exports=o&&!Symbol.sham&&typeof Symbol.iterator=="symbol"}}).default})})(ss);var Ma=ss.exports;const La=fa(Ma);function on(s){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?on=function(a){return typeof a}:on=function(a){return a&&typeof Symbol=="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},on(s)}function H(s,a){if(!(s instanceof a))throw new TypeError("Cannot call a class as a function")}function Zi(s,a){for(var r=0;r<a.length;r++){var i=a[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(s,i.key,i)}}function K(s,a,r){return a&&Zi(s.prototype,a),r&&Zi(s,r),s}function f(s,a,r){return a in s?Object.defineProperty(s,a,{value:r,enumerable:!0,configurable:!0,writable:!0}):s[a]=r,s}function fe(s,a){if(typeof a!="function"&&a!==null)throw new TypeError("Super expression must either be null or a function");s.prototype=Object.create(a&&a.prototype,{constructor:{value:s,writable:!0,configurable:!0}}),a&&Kr(s,a)}function Ee(s){return Ee=Object.setPrototypeOf?Object.getPrototypeOf:function(r){return r.__proto__||Object.getPrototypeOf(r)},Ee(s)}function Kr(s,a){return Kr=Object.setPrototypeOf||function(i,e){return i.__proto__=e,i},Kr(s,a)}function wa(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function y(s){if(s===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return s}function Ra(s,a){return a&&(typeof a=="object"||typeof a=="function")?a:y(s)}function de(s){var a=wa();return function(){var i=Ee(s),e;if(a){var t=Ee(this).constructor;e=Reflect.construct(i,arguments,t)}else e=i.apply(this,arguments);return Ra(this,e)}}function Na(s,a){for(;!Object.prototype.hasOwnProperty.call(s,a)&&(s=Ee(s),s!==null););return s}function xe(s,a,r){return typeof Reflect<"u"&&Reflect.get?xe=Reflect.get:xe=function(e,t,n){var o=Na(e,t);if(o){var l=Object.getOwnPropertyDescriptor(o,t);return l.get?l.get.call(n):l.value}},xe(s,a,r||s)}function lr(s,a){return ja(s)||Ba(s,a)||as(s,a)||Va()}function ln(s){return Ga(s)||Fa(s)||as(s)||Ua()}function Ga(s){if(Array.isArray(s))return zr(s)}function ja(s){if(Array.isArray(s))return s}function Fa(s){if(typeof Symbol<"u"&&s[Symbol.iterator]!=null||s["@@iterator"]!=null)return Array.from(s)}function Ba(s,a){var r=s==null?null:typeof Symbol<"u"&&s[Symbol.iterator]||s["@@iterator"];if(r!=null){var i=[],e=!0,t=!1,n,o;try{for(r=r.call(s);!(e=(n=r.next()).done)&&(i.push(n.value),!(a&&i.length===a));e=!0);}catch(l){t=!0,o=l}finally{try{!e&&r.return!=null&&r.return()}finally{if(t)throw o}}return i}}function as(s,a){if(s){if(typeof s=="string")return zr(s,a);var r=Object.prototype.toString.call(s).slice(8,-1);if(r==="Object"&&s.constructor&&(r=s.constructor.name),r==="Map"||r==="Set")return Array.from(s);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return zr(s,a)}}function zr(s,a){(a==null||a>s.length)&&(a=s.length);for(var r=0,i=new Array(a);r<a;r++)i[r]=s[r];return i}function Ua(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Va(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Ot(s,a,r){return s==="*"?!0:s.length>0?s.indexOf(a)!==-1:!r}function $(s,a,r){var i;s=s||{},a=a||{};var e=s,t=a;for(i in t)e[i]=t[i];return s}function Zr(s){return Object.prototype.toString.call(s)==="[object Number]"}function Ce(s){return typeof s=="string"}function ls(s){return typeof s=="boolean"}function un(s){return s==null?!1:Object.prototype.toString.call(s)==="[object Object]"}function Ha(s){return Object.prototype.toString.call(s)==="[object Date]"}function Nt(s){return Object.prototype.toString.call(s)==="[object Function]"}function vr(s){if(Ce(s))return""+s;if(ls(s))return!!s;if(Ha(s))return new Date(s.getTime());if(Nt(s))return s;if(Array.isArray(s)){for(var a=[],r=0;r<s.length;r++)a.push(vr(s[r]));return a}else if(un(s)){var i={};for(var e in s)i[e]=vr(s[e]);return i}else return s}function pr(s,a,r,i){var e={},t,n,o={};for(r=r||[],i=i||[],n=0;n<r.length;n++)e[r[n]]=!0;for(n=0;n<i.length;n++)o[i[n]]=!0;var l=vr(s);for(n in a)if(l[n]==null||o[n])l[n]=a[n];else if(e[n])t=[],t.push.apply(t,Array.isArray(l[n])?l[n]:[l[n]]),t.push(a[n]),l[n]=t;else if(Ce(a[n])||ls(a[n])||Nt(a[n])||Zr(a[n]))l[n]=a[n];else if(Array.isArray(a[n]))t=[],Array.isArray(l[n])&&t.push.apply(t,l[n]),t.push.apply(t,a[n]),l[n]=t;else if(un(a[n])){un(l[n])||(l[n]={});for(var u in a[n])l[n][u]=a[n][u]}return l}function us(s,a,r){for(var i=0;i<r.length;i++){var e=r[i][0][r[i][1]].apply(r[i][0],r[i][2]);if(e===a)return e}return s}function Ya(s,a,r,i){var e=function(o){var l=o.match(/(\${.*?})/g);if(l!=null)for(var u=0;u<l.length;u++){var c=a[l[u].substring(2,l[u].length-1)]||"";c!=null&&(o=o.replace(l[u],c))}if(l=o.match(/({{.*?}})/g),l!=null)for(var h=0;h<l.length;h++){var d=a[l[h].substring(2,l[h].length-2)]||"";d!=null&&(o=o.replace(l[h],d))}return o},t=function n(o){if(o!=null){if(Ce(o))return e(o);if(Nt(o)&&!i&&(o.name||"").indexOf(r)===0)return o(a);if(Array.isArray(o)){for(var l=[],u=0;u<o.length;u++)l.push(n(o[u]));return l}else if(un(o)){var c={};for(var h in o)c[h]=n(o[h]);return c}else return o}};return t(s)}function X(s,a){if(s)for(var r=0;r<s.length;r++)a(s[r]);else return null}function St(s,a){if(s){for(var r=0;r<s.length;r++)if(a(s[r]))return r}return-1}function $a(s,a){var r=[];if(s)for(var i=0;i<s.length;i++)a(s[i])&&r.push(i);return r}function Ci(s,a){var r=St(s,a);return r===-1?null:s[r]}function Xa(s,a){var r=$a(s,a);return r.map(function(i){return s[i]})}function cs(s,a){var r=null;return s.forEach(function(i){a(i)&&(r=i)}),r}function Wa(s){var a=[];return s.forEach(function(r){a.push(r)}),a}function _e(s,a){var r=St(s,a);return r>-1&&s.splice(r,1),r!==-1}function Zn(s){if(Array.fromArray!=null)return Array.from(s);var a=[];return Array.prototype.push.apply(a,s),a}function Ji(s,a){var r=s.indexOf(a);return r>-1&&s.splice(r,1),r!==-1}function hs(s,a,r,i){var e=s[a];return e==null&&(e=[],s[a]=e),e[i?"unshift":"push"](r),e}function Sn(s,a,r){return s.indexOf(a)===-1?(s.push(a),!0):!1}var Me=[];for(var bn=0;bn<256;bn++)Me[bn]=(bn<16?"0":"")+bn.toString(16);function Ae(){var s=Math.random()*4294967295|0,a=Math.random()*4294967295|0,r=Math.random()*4294967295|0,i=Math.random()*4294967295|0;return Me[s&255]+Me[s>>8&255]+Me[s>>16&255]+Me[s>>24&255]+"-"+Me[a&255]+Me[a>>8&255]+"-"+Me[a>>16&15|64]+Me[a>>24&255]+"-"+Me[r&63|128]+Me[r>>8&255]+"-"+Me[r>>16&255]+Me[r>>24&255]+Me[i&255]+Me[i>>8&255]+Me[i>>16&255]+Me[i>>24&255]}function gr(s,a,r){var i={x:s.x-a.x,y:s.y-a.y},e=Math.cos(r/360*Math.PI*2),t=Math.sin(r/360*Math.PI*2);return{x:i.x*e-i.y*t+a.x,y:i.y*e+i.x*t+a.y,cr:e,sr:t}}function Si(s){if(s==null)return null;for(var a=s.replace(/^\s\s*/,""),r=/\s/,i=a.length;r.test(a.charAt(--i)););return a.slice(0,i+1)}function Ka(s,a){s=s.length==null||typeof s=="string"?[s]:s;for(var r=0;r<s.length;r++)a(s[r])}function fs(s,a){for(var r=[],i=0;i<s.length;i++)r.push(a(s[i]));return r}function Oe(){for(var s=arguments.length,a=new Array(s),r=0;r<s;r++)a[r]=arguments[r];if(typeof console<"u")try{var i=arguments[arguments.length-1];console.log(i)}catch{}}function yr(s){return s<0?-1:s>0?1:0}function Jn(s,a,r){return function(){var i=null;try{a!=null&&(i=a.apply(this,arguments))}catch(e){Oe("jsPlumb function failed : "+e)}if(s!=null&&(r==null||i!==r))try{i=s.apply(this,arguments)}catch(e){Oe("wrapped function failed : "+e)}return i}}function Qi(s,a,r){return s.has(a)||s.set(a,r()),s.get(a)}function ds(s,a){for(var r=s.__proto__;r!=null;){if(r instanceof a)return!0;r=r.__proto__}return!1}function za(s,a,r,i){if(a.length===0)a.push(s);else{for(var e=i?-1:1,t=0,n=a.length,o=Math.floor((t+n)/2);n>t;){var l=r(s,a[o])*e;l<0?n=o:t=o+1,o=Math.floor((t+n)/2)}a.splice(o,0,s)}}function Gt(s,a,r){r=r||s.parentNode;for(var i=r.querySelectorAll(a),e=0;e<i.length;e++)if(i[e]===s)return!0;return!1}function Gn(s,a){s.stopPropagation?s.stopPropagation():s.returnValue=!1,!a&&s.preventDefault&&s.preventDefault()}function st(s,a,r,i){if(i&&Gt(s,a,r))return s;for(s=s.parentNode;s!=null&&s!==r;){if(Gt(s,a))return s;s=s.parentNode}}function je(s){return s.srcElement||s.target}function Za(s,a,r){a=Si(a),typeof s.className.baseVal<"u"?s.className.baseVal=a:s.className=a;try{var i=s.classList;if(i!=null){for(;i.length>0;)i.remove(i.item(0));for(var e=0;e<r.length;e++)r[e]&&i.add(r[e])}}catch(t){Oe("WARN: cannot set class list",t)}}function bi(s){return s.className!=null?typeof s.className.baseVal>"u"?s.className:s.className.baseVal:""}function vs(s,a,r){var i=a==null?[]:Array.isArray(a)?a:a.split(/\s+/),e=r==null?[]:Array.isArray(r)?r:r.split(/\s+/),t=bi(s),n=t.split(/\s+/),o=function(u,c){for(var h=0;h<c.length;h++)if(u)n.indexOf(c[h])===-1&&n.push(c[h]);else{var d=n.indexOf(c[h]);d!==-1&&n.splice(d,1)}};o(!0,i),o(!1,e),Za(s,n.join(" "),n)}function jn(s){return!Ce(s)&&!Array.isArray(s)&&s.length!=null&&s.documentElement==null&&s.nodeType==null}function Ja(s){return bi(s)}function kt(s,a){var r=function(e,t){if(e!=null&&t!=null&&t.length>0)if(e.classList){var n=Si(t).split(/\s+/);X(n,function(o){e.classList.add(o)})}else vs(e,t)};jn(s)?X(s,function(i){return r(i,a)}):r(s,a)}function Qa(s,a){return s.classList?s.classList.contains(a):bi(s).indexOf(a)!==-1}function Jr(s,a){var r=function(e,t){if(e!=null&&t!=null&&t.length>0)if(e.classList){var n=Si(t).split(/\s+/);n.forEach(function(o){e.classList.remove(o)})}else vs(e,null,t)};jn(s)?X(s,function(i){return r(i,a)}):r(s,a)}function qa(s,a){var r=this,i=function(t,n){t!=null&&n!=null&&n.length>0&&(t.classList?t.classList.toggle(n):r.hasClass(t,n)?r.removeClass(t,n):r.addClass(t,n))};jn(s)?X(s,function(e){return i(e,a)}):i(s,a)}function ps(s,a,r,i){return gs(null,s,a,r,i)}function gs(s,a,r,i,e){var t=s==null?document.createElement(a):document.createElementNS(s,a),n;r=r||{};for(n in r)t.style[n]=r[n];i&&(t.className=i),e=e||{};for(n in e)t.setAttribute(n,""+e[n]);return t}function tn(s){var a=s.getBoundingClientRect(),r=document.body,i=document.documentElement,e=window.pageYOffset||i.scrollTop||r.scrollTop,t=window.pageXOffset||i.scrollLeft||r.scrollLeft,n=i.clientTop||r.clientTop||0,o=i.clientLeft||r.clientLeft||0,l=a.top+e-n,u=a.left+t-o;return{x:Math.round(u),y:Math.round(l)}}function el(s){return{w:s.offsetWidth,h:s.offsetHeight}}function tl(s){try{return{w:parseFloat(s.width.baseVal.value),h:parseFloat(s.height.baseVal.value)}}catch{return{w:0,h:0}}}function nl(s){try{return{x:parseFloat(s.x.baseVal.value),y:parseFloat(s.y.baseVal.value)}}catch{return{x:0,y:0}}}function Qn(s,a){var r=a.getContainer().getBoundingClientRect(),i=s.getBoundingClientRect(),e=a.currentZoom;return{x:(i.left-r.left)/e,y:(i.top-r.top)/e}}function Pn(s,a){var r=s.getBoundingClientRect(),i=a.currentZoom;return{w:r.width/i,h:r.height/i}}var jt;(function(s){s.SVG="SVG",s.HTML="HTML"})(jt||(jt={}));function Qr(s){return s instanceof SVGElement?jt.SVG:jt.HTML}function rl(s){return Qr(s)===jt.SVG}function Ft(){for(var s=arguments.length,a=new Array(s),r=0;r<s;r++)a[r]=arguments[r];return a.map(function(i){return"."+i}).join(",")}function il(){for(var s=arguments.length,a=new Array(s),r=0;r<s;r++)a[r]=arguments[r];return a.join(" ")}function Lr(){for(var s=arguments.length,a=new Array(s),r=0;r<s;r++)a[r]=arguments[r];return a.map(function(i){return"["+i+"]"}).join(",")}var qr="source",ys="target",ei="block",cn="none",Fn="absolute",qi="fixed",ol="static",ms="data-jtk-group",yt="data-jtk-managed",ur="data-jtk-not-draggable",eo="tabindex",sl="data-jtk-scope",Es=sl+"-",xs="checkCondition",al="checkDropAllowed",Pi="jtk-connector",ll="jtk-connector-outline",ul="jtk-connected",sn="jtk-endpoint",cl="jtk-endpoint-connected",hl="jtk-endpoint-full",Ti="jtk-floating-endpoint",fl="jtk-endpoint-drop-allowed",dl="jtk-endpoint-drop-forbidden",vl="jtk-endpoint-anchor",qn="jtk-group-collapsed",Tn="jtk-group-expanded",wr="jtk-overlay",pl="anchor:changed",Oi="connection",Cs="internal.connection",Ss="connection:detach",Ai="connection:move",gl="container:change",yl="endpoint:replaced",bs="internal.endpoint:unregistered",Di="internal.connection:detached",Ps="element:manage",ml="group:added",El="group:collapse",xl="group:expand",Cl="group:member:added",Sl="group:member:removed",bl="group:removed",Ts="maxConnections",Pl="group:nested:added",Tl="group:nested:removed",Os="element:unmanage",As="zoom",an="isDetachAllowed",Ol="beforeDrag",Ds="beforeDrop",_s="beforeDetach",Al="beforeStartDetach",me=Lr(yt),Dl="Cannot establish connection: source endpoint is full",_l="Cannot establish connection: target endpoint is full",Il="Cannot establish connection: source does not exist",kl="Cannot establish connection: target does not exist",Ml="connectionOverlays",to={"stroke-linejoin":"stroke-linejoin","stroke-dashoffset":"stroke-dashoffset","stroke-linecap":"stroke-linecap"},On="stroke-dasharray",Br="dashstyle",Ll="fill",wl="stroke",Rl="stroke-width",Nl="strokeWidth",Is="svg",ti="path",no={svg:"http://www.w3.org/2000/svg"};function ut(s,a){for(var r in a)s.setAttribute(r,""+a[r])}function ct(s,a){return a=a||{},a.version="1.1",a.xmlns=no.svg,gs(no.svg,s,null,null,a)}function ks(s){return"position:absolute;left:"+s[0]+"px;top:"+s[1]+"px"}function ni(s,a,r){if(a.setAttribute(Ll,r.fill?r.fill:cn),a.setAttribute(wl,r.stroke?r.stroke:cn),r.strokeWidth&&a.setAttribute(Rl,r.strokeWidth),r[Br]&&r[Nl]&&!r[On]){var i=r[Br].indexOf(",")===-1?" ":",",e=r[Br].split(i),t="";X(e,function(o){t+=Math.floor(o*r.strokeWidth)+i}),a.setAttribute(On,t)}else r[On]&&a.setAttribute(On,r[On]);for(var n in to)r[n]&&a.setAttribute(to[n],r[n])}function cr(s,a,r){s.childNodes.length>r?s.insertBefore(a,s.childNodes[r]):s.appendChild(a)}function ye(s,a,r){var i=[s,a];return i.join(":")}var ro="data-jtk-container",Gl="data-jtk-group-content",er="data-jtk-enabled",Ur="data-jtk-scope",Ht="endpoint",nt="element",rt="connection",Ms="div",Re="click",at="contextmenu",Fe="dblclick",We="dbltap",jl="focus",te="mousedown",_i="mouseenter",Ii="mouseexit",De="mousemove",ne="mouseup",Ue="mouseout",Ve="mouseover",Ke="tap",Fl="touchstart",Bl="touchend",Ul="touchmove",Vl="drag:move",Hl="drag:stop",Yl="drag:start",mr="revert",$l="connection:abort",io="connection:drag",oo=ye(nt,Re),Xl=ye(nt,Fe),so=ye(nt,We),Wl=ye(nt,Ue),Kl=ye(nt,Ve),zl=ye(nt,De),Zl=ye(nt,ne),Jl=ye(nt,te),Ql=ye(nt,at),ao=ye(nt,Ke),ql=ye(Ht,Re),eu=ye(Ht,Fe),tu=ye(Ht,Ue),nu=ye(Ht,Ve),ru=ye(Ht,ne),iu=ye(Ht,te),ou=ye(rt,Re),su=ye(rt,Fe),au=ye(rt,We),lu=ye(rt,Ue),uu=ye(rt,Ve),cu=ye(rt,ne),hu=ye(rt,te),fu=ye(rt,at),du=ye(rt,Ke),lo="position",$e=Ft(Pi),At=Ft(sn),vu=Lr(ms),pu=Lr(Gl),ot=Ft(wr),bt;(function(s){s.Circle="Circle",s.Ellipse="Ellipse",s.Triangle="Triangle",s.Diamond="Diamond",s.Rectangle="Rectangle",s.Square="Square"})(bt||(bt={}));var tt;(function(s){s.Assign="Assign",s.AutoDefault="AutoDefault",s.Bottom="Bottom",s.BottomLeft="BottomLeft",s.BottomRight="BottomRight",s.Center="Center",s.Continuous="Continuous",s.ContinuousBottom="ContinuousBottom",s.ContinuousLeft="ContinuousLeft",s.ContinuousRight="ContinuousRight",s.ContinuousTop="ContinuousTop",s.ContinuousLeftRight="ContinuousLeftRight",s.ContinuousTopBottom="ContinuousTopBottom",s.Left="Left",s.Perimeter="Perimeter",s.Right="Right",s.Top="Top",s.TopLeft="TopLeft",s.TopRight="TopRight"})(tt||(tt={}));function gu(){return{d:1/0,x:null,y:null,l:null,x1:null,y1:null,x2:null,y2:null}}function Er(){return{xmin:1/0,xmax:-1/0,ymin:1/0,ymax:-1/0}}var ki=function(){function s(a){H(this,s),this.params=a,f(this,"x1",void 0),f(this,"x2",void 0),f(this,"y1",void 0),f(this,"y2",void 0),f(this,"extents",Er()),f(this,"type",void 0),this.x1=a.x1,this.y1=a.y1,this.x2=a.x2,this.y2=a.y2}return K(s,[{key:"findClosestPointOnPath",value:function(r,i){return gu()}},{key:"lineIntersection",value:function(r,i,e,t){return[]}},{key:"boxIntersection",value:function(r,i,e,t){var n=[];return n.push.apply(n,this.lineIntersection(r,i,r+e,i)),n.push.apply(n,this.lineIntersection(r+e,i,r+e,i+t)),n.push.apply(n,this.lineIntersection(r+e,i+t,r,i+t)),n.push.apply(n,this.lineIntersection(r,i+t,r,i)),n}},{key:"boundingBoxIntersection",value:function(r){return this.boxIntersection(r.x,r.y,r.w,r.h)}}]),s}(),Ls="undefined",xr="default",ws="true",nn="false",Lt="*",An,Dn;function yu(s,a,r,i,e,t,n){return new Touch({target:s,identifier:Ae(),pageX:a,pageY:r,screenX:i,screenY:e,clientX:t||i,clientY:n||e})}function mu(){var s=[];return s.push.apply(s,arguments),s.item=function(a){return this[a]},s}function Eu(s,a,r,i,e,t,n){return mu(yu(s,a,r,i,e,t,n))}function hn(s,a,r){r=r||s.parentNode;for(var i=r.querySelectorAll(a),e=0;e<i.length;e++)if(i[e]===s)return!0;return!1}function Bn(s){return s.srcElement||s.target}function ri(s,a,r,i){if(i){var e=s.composedPath?s.composedPath():s.path;if(typeof e<"u"&&e.indexOf)return{path:e,end:e.indexOf(r)};var t={path:[],end:-1},n=function o(l){t.path.push(l),l===r?t.end=t.path.length-1:l.parentNode!=null&&o(l.parentNode)};return n(a),t}else return{path:[a],end:1}}function xu(s,a){var r=0,i;for(r=0,i=s.length;r<i&&s[r][0]!==a;r++);r<s.length&&s.splice(r,1)}var Cu=1;function Rn(){return"ontouchstart"in document.documentElement||navigator.maxTouchPoints!=null&&navigator.maxTouchPoints>0}function hr(){return"onmousedown"in document.documentElement}var lt=(An={},f(An,te,Fl),f(An,ne,Bl),f(An,De,Ul),An),Su="page",bu="screen",Pu="client";function Mi(s,a){if(s==null)return{x:0,y:0};var r=Rs(s),i=Au(r,0);return{x:i[a+"X"],y:i[a+"Y"]}}function Cr(s){return Mi(s,Su)}function Tu(s){return Mi(s,bu)}function Ou(s){return Mi(s,Pu)}function Au(s,a){return s.item?s.item(a):s[a]}function Rs(s){return s.touches&&s.touches.length>0?s.touches:s.changedTouches&&s.changedTouches.length>0?s.changedTouches:s.targetTouches&&s.targetTouches.length>0?s.targetTouches:[s]}function Du(s){return Rs(s).length}function Sr(s,a,r,i,e){if(Gs(s,a,r),i.__tauid=r.__tauid,s.addEventListener)s.addEventListener(a,r,!1,e);else if(s.attachEvent){var t=a+r.__tauid;s["e"+t]=r,s[t]=function(){s["e"+t]&&s["e"+t](window.event)},s.attachEvent("on"+a,s[t])}}function Un(s,a,r){var i=this;r!=null&&Ns(s,function(e){if(_u(e,a,r),r.__tauid!=null){if(e.removeEventListener)e.removeEventListener(a,r,!1),Rn()&&lt[a]&&e.removeEventListener(lt[a],r,!1);else if(i.detachEvent){var t=a+r.__tauid;e[t]&&e.detachEvent("on"+a,e[t]),e[t]=null,e["e"+t]=null}}r.__taTouchProxy&&Un(s,r.__taTouchProxy[1],r.__taTouchProxy[0])})}function Ns(s,a){if(s!=null)for(var r=typeof s=="string"?document.querySelectorAll(s):s.length!=null?s:[s],i=0;i<r.length;i++)a(r[i])}function Gs(s,a,r){var i=Cu++;return s.__ta=s.__ta||{},s.__ta[a]=s.__ta[a]||{},s.__ta[a][i]=r,r.__tauid=i,i}function _u(s,a,r){if(s.__ta&&s.__ta[a]&&delete s.__ta[a][r.__tauid],r.__taExtra){for(var i=0;i<r.__taExtra.length;i++)Un(s,r.__taExtra[i][0],r.__taExtra[i][1]);r.__taExtra.length=0}r.__taUnstore&&r.__taUnstore()}var Iu=/:not\(([^)]+)\)/;function br(s,a,r,i){if(s==null)return r;var e=s.split(","),t=[],n=[];X(e,function(l){var u=l.match(Iu);u!=null?n.push(u[1]):t.push(l)}),n.length>0&&t.length===0&&t.push(Lt);var o=function l(u){l.__tauid=r.__tauid;var c=Bn(u),h=!1,d=c,v=ri(u,c,a,s!=null);if(v.end!=-1)for(var p=0;!h&&p<v.end;p++){d=v.path[p];for(var m=0;m<n.length;m++)if(hn(d,n[m],a))return;for(var g=0;!h&&g<t.length;g++)if(hn(d,t[g],a)){r.apply(d,[u,d]),h=!0;break}}};return ku(r,i,o),o}function ku(s,a,r){s.__taExtra=s.__taExtra||[],s.__taExtra.push([a,r])}var fr=function(a,r,i,e,t){if(Rn()&&lt[r]){var n=br(e,a,i,lt[r]);Sr(a,lt[r],n,i,t)}r===jl&&a.getAttribute(eo)==null&&a.setAttribute(eo,"1"),Sr(a,r,br(e,a,i,r),i,t)},Vr=(Dn={},f(Dn,Ke,{touches:1,taps:1}),f(Dn,We,{touches:1,taps:2}),f(Dn,at,{touches:2,taps:1}),Dn);function uo(s,a,r,i){for(var e in r.__tamee[s])r.__tamee[s].hasOwnProperty(e)&&r.__tamee[s][e].apply(i,[a])}var Mu=function(){function s(){H(this,s)}return K(s,null,[{key:"generate",value:function(r,i){return function(e,t,n,o){if(t==at&&hr())fr(e,t,n,o);else{if(e.__taTapHandler==null){var l=e.__taTapHandler={tap:[],dbltap:[],down:!1,taps:0,downSelectors:[]},u=function(p){for(var m=Bn(p),g=ri(p,m,e,o!=null),E=!1,x=0;x<g.end;x++){if(E)return;m=g.path[x];for(var C=0;C<l.downSelectors.length;C++)if(l.downSelectors[C]==null||hn(m,l.downSelectors[C],e)){l.down=!0,setTimeout(h,r),setTimeout(d,i),E=!0;break}}},c=function(p){if(l.down){var m=Bn(p),g,E;l.taps++;var x=Du(p);for(var C in Vr)if(Vr.hasOwnProperty(C)){var S=Vr[C];if(S.touches===x&&(S.taps===1||S.taps===l.taps))for(var b=0;b<l[C].length;b++){E=ri(p,m,e,l[C][b][1]!=null);for(var T=0;T<E.end;T++)if(g=E.path[T],l[C][b][1]==null||hn(g,l[C][b][1],e)){l[C][b][0].apply(g,[p,g]);break}}}}},h=function(){l.down=!1},d=function(){l.taps=0};e.__taTapHandler.downHandler=u,e.__taTapHandler.upHandler=c,fr(e,te,u),fr(e,ne,c)}e.__taTapHandler.downSelectors.push(o),e.__taTapHandler[t].push([n,o]),n.__taUnstore=function(){e.__taTapHandler!=null&&(_e(e.__taTapHandler.downSelectors,function(v){return v===o}),xu(e.__taTapHandler[t],n),e.__taTapHandler.downSelectors.length===0&&(Un(e,te,e.__taTapHandler.downHandler),Un(e,ne,e.__taTapHandler.upHandler),delete e.__taTapHandler))}}}}}]),s}(),Lu=function(){function s(){H(this,s)}return K(s,null,[{key:"generate",value:function(){var r=[];return function(i,e,t,n){if(!i.__tamee){i.__tamee={over:!1,mouseenter:[],mouseexit:[]};var o=function(c){var h=Bn(c);(n==null&&h==i&&!i.__tamee.over||hn(h,n,i)&&(h.__tamee==null||!h.__tamee.over))&&(uo(_i,c,i,h),h.__tamee=h.__tamee||{},h.__tamee.over=!0,r.push(h))},l=function(c){for(var h=Bn(c),d=0;d<r.length;d++)h==r[d]&&!hn(c.relatedTarget||c.toElement,"*",h)&&(h.__tamee.over=!1,r.splice(d,1),uo(Ii,c,i,h))};Sr(i,Ve,br(n,i,o,Ve),o),Sr(i,Ue,br(n,i,l,Ue),l)}t.__taUnstore=function(){delete i.__tamee[e][t.__tauid]},Gs(i,e,t),i.__tamee[e][t.__tauid]=t}}}]),s}(),Li=function(){function s(a){H(this,s),f(this,"clickThreshold",void 0),f(this,"dblClickThreshold",void 0),f(this,"tapHandler",void 0),f(this,"mouseEnterExitHandler",void 0),a=a||{},this.clickThreshold=a.clickThreshold||250,this.dblClickThreshold=a.dblClickThreshold||450,this.mouseEnterExitHandler=Lu.generate(),this.tapHandler=Mu.generate(this.clickThreshold,this.dblClickThreshold)}return K(s,[{key:"_doBind",value:function(r,i,e,t,n){if(e!=null){var o=r;i===Ke||i===We||i===at?this.tapHandler(o,i,e,t,n):i===_i||i==Ii?this.mouseEnterExitHandler(o,i,e,t,n):fr(o,i,e,t,n)}}},{key:"on",value:function(r,i,e,t,n){var o=t==null?null:e,l=t??e;return this._doBind(r,i,l,o,n),this}},{key:"off",value:function(r,i,e){return Un(r,i,e),this}},{key:"trigger",value:function(r,i,e,t,n){var o=hr()&&(typeof MouseEvent>"u"||e==null||e.constructor===MouseEvent),l=Rn()&&!hr()&&lt[i]?lt[i]:i,u=!(Rn()&&!hr()&&lt[i]),c=Cr(e),h=Tu(e),d=Ou(e);return Ns(r,function(v){var p;e=e||{screenX:h.x,screenY:h.y,clientX:d.x,clientY:d.y};var m=function(S){t&&(S.payload=t)},g={TouchEvent:function(S){var b=Eu(v,c.x,c.y,h.x,h.y,d.x,d.y),T=S.initTouchEvent||S.initEvent;T(l,!0,!0,window,null,h.x,h.y,d.x,d.y,!1,!1,!1,!1,b,b,b,1,0)},MouseEvents:function(S){S.initMouseEvent(l,!0,!0,window,n??1,h.x,h.y,d.x,d.y,!1,!1,!1,!1,1,v)}},E=!u&&!o&&Rn()&&lt[i],x=E?"TouchEvent":"MouseEvents";p=document.createEvent(x),g[x](p),m(p),v.dispatchEvent(p)}),this}}]),s}(),wu=[null,[1,-1],[1,1],[-1,1],[-1,-1]],Ru=[null,[-1,-1],[-1,1],[1,1],[1,-1]],Dt=2*Math.PI;function fn(s,a){return a.x===s.x?a.y>s.y?1/0:-1/0:a.y===s.y?a.x>s.x?0:-0:(a.y-s.y)/(a.x-s.x)}function Nu(s,a){return-1/fn(s,a)}function ii(s,a){return Math.sqrt(Math.pow(a.y-s.y,2)+Math.pow(a.x-s.x,2))}function wi(s,a){return a.x>s.x||a.x==s.x?a.y>s.y?2:1:a.y>s.y?3:4}function Gu(s,a){var r=fn(s,a),i=Math.atan(r),e=wi(s,a);return(e==4||e==3)&&(i+=Math.PI),i<0&&(i+=2*Math.PI),i}function js(s,a){var r=s.x,i=s.x+s.w,e=s.y,t=s.y+s.h,n=a.x,o=a.x+a.w,l=a.y,u=a.y+a.h;return r<=n&&n<=i&&e<=l&&l<=t||r<=o&&o<=i&&e<=l&&l<=t||r<=n&&n<=i&&e<=u&&u<=t||r<=o&&n<=i&&e<=u&&u<=t||n<=r&&r<=o&&l<=e&&e<=u||n<=i&&i<=o&&l<=e&&e<=u||n<=r&&r<=o&&l<=t&&t<=u||n<=i&&r<=o&&l<=t&&t<=u}function Mt(s,a,r){var i=fn(s,a),e=wi(s,a),t=r>0?wu[e]:Ru[e],n=Math.atan(i),o=Math.abs(r*Math.sin(n))*t[1],l=Math.abs(r*Math.cos(n))*t[0];return{x:s.x+l,y:s.y+o}}function ju(s,a,r){var i=fn(s,a),e=Math.atan(-1/i),t=r/2*Math.sin(e),n=r/2*Math.cos(e);return[{x:a.x+n,y:a.y+t},{x:a.x-n,y:a.y-t}]}function Fu(s,a,r,i){r=r??(a.thresholdX==null?a.w/2:a.thresholdX),i=i??(a.thresholdY==null?a.h/2:a.thresholdY);var e=Math.floor(s.x/a.w),t=a.w*e,n=t+a.w,o=Math.abs(s.x-t)<=r?t:Math.abs(n-s.x)<=r?n:s.x,l=Math.floor(s.y/a.h),u=a.h*l,c=u+a.h,h=Math.abs(s.y-u)<=i?u:Math.abs(c-s.y)<=i?c:s.y;return{x:o,y:h}}function Bu(s,a,r){if(Gt(a,r,s))return a;for(var i=a.parentNode;i!=null&&i!==s;){if(Gt(i,r,s))return i;i=i.parentNode}}function Uu(s){return typeof s=="function"?(s._katavorioId=Ae(),s._katavorioId):s}function co(s,a,r){var i=a.parentNode,e=s.getSize(i),t=s.getSize(a),n=r.x,o=n+t.w,l=r.y,u=l+t.h;return o>0&&n<e.w&&u>0&&l<e.h}function Vu(s,a,r){for(var i=null,e=a.getAttribute("katavorio-draggable"),t=e!=null?"[katavorio-draggable='"+e+"'] ":"",n=0;n<s.length;n++)if(i=Bu(a,r,t+s[n].selector),i!=null){if(s[n].filter){var o=Gt(r,s[n].filter,i),l=s[n].filterExclude===!0;if(l&&!o||o)return null}return[s[n],i]}return null}var Fs="start",Bs="beforeStart",Us="drag",Hu="drop",Yu="over",$u="out",Vs="stop",Hs="katavorio-draggable",Xu=Hs,Wu=10,Ku=10,Hr=function(){return!0},zu=function(){return!1},In={delegatedDraggable:"katavorio-delegated-draggable",draggable:Xu,drag:"katavorio-drag",selected:"katavorio-drag-selected",noSelect:"katavorio-drag-no-select",ghostProxy:"katavorio-ghost-proxy",clonedDrag:"katavorio-clone-drag"},Ze;(function(s){s.absolutePosition="absolutePosition",s.transform="transform",s.xyAttributes="xyAttributes"})(Ze||(Ze={}));var Ri=new Map;Ri.set(Ze.absolutePosition,function(s,a){s.style.left="".concat(a.x,"px"),s.style.top="".concat(a.y,"px")});Ri.set(Ze.xyAttributes,function(s,a){s.setAttribute("x","".concat(a.x)),s.setAttribute("y","".concat(a.y))});var Ni=new Map;Ni.set(Ze.absolutePosition,function(s){return{x:s.offsetLeft,y:s.offsetTop}});Ni.set(Ze.xyAttributes,function(s){return{x:parseFloat(s.getAttribute("x")),y:parseFloat(s.getAttribute("y"))}});var Gi=new Map;Gi.set(Ze.absolutePosition,function(s,a){s.style.width="".concat(a.w,"px"),s.style.height="".concat(a.h,"px")});Gi.set(Ze.xyAttributes,function(s,a){s.setAttribute("width","".concat(a.w)),s.setAttribute("height","".concat(a.h))});var ji=new Map;ji.set(Ze.absolutePosition,function(s){return{w:s.offsetWidth,h:s.offsetHeight}});ji.set(Ze.xyAttributes,function(s){return{w:parseFloat(s.getAttribute("width")),h:parseFloat(s.getAttribute("height"))}});var Yr=[Vs,Fs,Us,Hu,Yu,$u,Bs],Zu=function(){},Xt=function(a,r){if(a!=null){a=!Ce(a)&&a.tagName==null&&a.length!=null?a:[a];for(var i=0;i<a.length;i++)r.apply(a[i],[a[i]])}},Ju=function(a,r,i){var e=a.srcElement||a.target;return!Gt(e,i.getInputFilterSelector(),r)},Qu=function(){function s(a,r){H(this,s),this.el=a,this.manager=r,f(this,"_class",void 0),f(this,"uuid",Ae()),f(this,"enabled",!0),f(this,"scopes",[]),f(this,"eventManager",void 0),this.eventManager=r.eventManager}return K(s,[{key:"setEnabled",value:function(r){this.enabled=r}},{key:"isEnabled",value:function(){return this.enabled}},{key:"toggleEnabled",value:function(){this.enabled=!this.enabled}},{key:"addScope",value:function(r){var i={};Xt(this.scopes,function(t){i[t]=!0}),Xt(r?r.split(/\s+/):[],function(t){i[t]=!0}),this.scopes.length=0;for(var e in i)this.scopes.push(e)}},{key:"removeScope",value:function(r){var i={};Xt(this.scopes,function(t){i[t]=!0}),Xt(r?r.split(/\s+/):[],function(t){delete i[t]}),this.scopes.length=0;for(var e in i)this.scopes.push(e)}},{key:"toggleScope",value:function(r){var i={};Xt(this.scopes,function(t){i[t]=!0}),Xt(r?r.split(/\s+/):[],function(t){i[t]?delete i[t]:i[t]=!0}),this.scopes.length=0;for(var e in i)this.scopes.push(e)}}]),s}();function qu(s){return{w:s.parentNode.offsetWidth+s.parentNode.scrollLeft,h:s.parentNode.offsetHeight+s.parentNode.scrollTop}}var Nn;(function(s){s.notNegative="notNegative",s.parent="parent",s.parentEnclosed="parentEnclosed"})(Nn||(Nn={}));var ec=function(s){fe(r,s);var a=de(r);function r(i,e,t){var n;if(H(this,r),n=a.call(this,i,t),f(y(n),"_class",void 0),f(y(n),"rightButtonCanDrag",void 0),f(y(n),"consumeStartEvent",void 0),f(y(n),"clone",void 0),f(y(n),"scroll",void 0),f(y(n),"trackScroll",void 0),f(y(n),"_downAt",void 0),f(y(n),"_posAtDown",void 0),f(y(n),"_pagePosAtDown",void 0),f(y(n),"_pageDelta",{x:0,y:0}),f(y(n),"_moving",void 0),f(y(n),"_lastPosition",void 0),f(y(n),"_lastScrollValues",{x:0,y:0}),f(y(n),"_initialScroll",{x:0,y:0}),f(y(n),"_size",void 0),f(y(n),"_currentParentPosition",void 0),f(y(n),"_ghostParentPosition",void 0),f(y(n),"_dragEl",void 0),f(y(n),"_multipleDrop",void 0),f(y(n),"_ghostProxyOffsets",void 0),f(y(n),"_ghostDx",void 0),f(y(n),"_ghostDy",void 0),f(y(n),"_isConstrained",!1),f(y(n),"_ghostProxyParent",void 0),f(y(n),"_useGhostProxy",void 0),f(y(n),"_ghostProxyFunction",void 0),f(y(n),"_activeSelectorParams",void 0),f(y(n),"_availableSelectors",[]),f(y(n),"_canDrag",void 0),f(y(n),"_consumeFilteredEvents",void 0),f(y(n),"_parent",void 0),f(y(n),"_ignoreZoom",void 0),f(y(n),"_filters",{}),f(y(n),"_constrainRect",void 0),f(y(n),"_elementToDrag",void 0),f(y(n),"downListener",void 0),f(y(n),"moveListener",void 0),f(y(n),"upListener",void 0),f(y(n),"scrollTracker",void 0),f(y(n),"listeners",{start:[],drag:[],stop:[],over:[],out:[],beforeStart:[],revert:[]}),n._class=n.manager.css.draggable,kt(n.el,n._class),n.downListener=n._downListener.bind(y(n)),n.upListener=n._upListener.bind(y(n)),n.moveListener=n._moveListener.bind(y(n)),n.rightButtonCanDrag=e.rightButtonCanDrag===!0,n.consumeStartEvent=e.consumeStartEvent!==!1,n._dragEl=n.el,n.clone=e.clone===!0,n.scroll=e.scroll===!0,n.trackScroll=e.trackScroll!==!1,n._multipleDrop=e.multipleDrop!==!1,n._canDrag=e.canDrag||Hr,n._consumeFilteredEvents=e.consumeFilteredEvents,n._parent=e.parent,n._ignoreZoom=e.ignoreZoom===!0,n._ghostProxyParent=e.ghostProxyParent,n.trackScroll&&(n.scrollTracker=n._trackScroll.bind(y(n)),document.addEventListener("scroll",n.scrollTracker)),e.ghostProxy===!0?n._useGhostProxy=Hr:e.ghostProxy&&typeof e.ghostProxy=="function"?n._useGhostProxy=e.ghostProxy:n._useGhostProxy=function(l,u){return n._activeSelectorParams&&n._activeSelectorParams.useGhostProxy?n._activeSelectorParams.useGhostProxy(l,u):!1},e.makeGhostProxy?n._ghostProxyFunction=e.makeGhostProxy:n._ghostProxyFunction=function(l){return n._activeSelectorParams&&n._activeSelectorParams.makeGhostProxy?n._activeSelectorParams.makeGhostProxy(l):l.cloneNode(!0)},e.selector){var o=n.el.getAttribute(Hs);o==null&&(o=""+new Date().getTime(),n.el.setAttribute("katavorio-draggable",o)),n._availableSelectors.push(e)}return n.eventManager.on(n.el,te,n.downListener),n}return K(r,[{key:"_trackScroll",value:function(e){if(this._moving){var t={x:document.documentElement.scrollLeft,y:document.documentElement.scrollTop},n=t.x-this._lastScrollValues.x,o=t.y-this._lastScrollValues.y,l={x:n+this._lastPosition.x,y:o+this._lastPosition.y},u=l.x-this._downAt.x,c=l.y-this._downAt.y,h=this._ignoreZoom?1:this.manager.getZoom();this._dragEl&&this._dragEl.parentNode&&(u+=this._dragEl.parentNode.scrollLeft-this._initialScroll.x,c+=this._dragEl.parentNode.scrollTop-this._initialScroll.y),u/=h,c/=h,this.moveBy(u,c,e),this._lastPosition=l,this._lastScrollValues=t}}},{key:"on",value:function(e,t){this.listeners[e]&&this.listeners[e].push(t)}},{key:"off",value:function(e,t){if(this.listeners[e]){for(var n=[],o=0;o<this.listeners[e].length;o++)this.listeners[e][o]!==t&&n.push(this.listeners[e][o]);this.listeners[e]=n}}},{key:"_upListener",value:function(e){this._downAt&&(this._downAt=null,this.eventManager.off(document,De,this.moveListener),this.eventManager.off(document,ne,this.upListener),Jr(document.body,In.noSelect),this.unmark(e),this.stop(e),this._moving=!1,this.clone?(this._dragEl&&this._dragEl.parentNode&&this._dragEl.parentNode.removeChild(this._dragEl),this._dragEl=null):this._activeSelectorParams&&this._activeSelectorParams.revertFunction&&this._activeSelectorParams.revertFunction(this._dragEl,this.manager.getPosition(this._dragEl))===!0&&(this.manager.setPosition(this._dragEl,this._posAtDown),this._dispatch(mr,this._dragEl)))}},{key:"_downListener",value:function(e){if(!e.defaultPrevented){var t=this.rightButtonCanDrag||e.which!==3&&e.button!==2;if(t&&this.isEnabled()&&this._canDrag()){var n=this._testFilter(e)&&Ju(e,this.el,this.manager);if(n){this._activeSelectorParams=null,this._elementToDrag=null,this._availableSelectors.length===0&&console.log("JSPLUMB: no available drag selectors");var o=e.target||e.srcElement,l=Vu(this._availableSelectors,this.el,o);if(l!=null&&(this._activeSelectorParams=l[0],this._elementToDrag=l[1]),this._activeSelectorParams==null||this._elementToDrag==null)return;var u=this._activeSelectorParams.dragInit?this._activeSelectorParams.dragInit(this._elementToDrag,e):null;if(u!=null&&(this._elementToDrag=u),this.clone)if(this._dragEl=this._elementToDrag.cloneNode(!0),kt(this._dragEl,In.clonedDrag),this._dragEl.setAttribute("id",null),this._dragEl.style.position="absolute",this._parent!=null){var c=this.manager.getPosition(this.el);this._dragEl.style.left=c.x+"px",this._dragEl.style.top=c.y+"px",this._parent.appendChild(this._dragEl)}else{var h=tn(this._elementToDrag);this._dragEl.style.left=h.x+"px",this._dragEl.style.top=h.y+"px",document.body.appendChild(this._dragEl)}else this._dragEl=this._elementToDrag;this.consumeStartEvent&&Gn(e),this._downAt=Cr(e),this._dragEl&&this._dragEl.parentNode&&(this._initialScroll={x:this._dragEl.parentNode.scrollLeft,y:this._dragEl.parentNode.scrollTop}),this._posAtDown=this.manager.getPosition(this._dragEl),this._pagePosAtDown=tn(this._dragEl),this._pageDelta={x:this._pagePosAtDown.x-this._posAtDown.x,y:this._pagePosAtDown.y-this._posAtDown.y},this._size=this.manager.getSize(this._dragEl),this.eventManager.on(document,De,this.moveListener),this.eventManager.on(document,ne,this.upListener),kt(document.body,In.noSelect),this._dispatch(Bs,{el:this.el,pos:this._posAtDown,e,drag:this,size:this._size})}else this._consumeFilteredEvents&&Gn(e)}}}},{key:"_moveListener",value:function(e){if(this._downAt){if(!this._moving){var t=this._dispatch(Fs,{el:this.el,pos:this._posAtDown,e,drag:this,size:this._size});if(t!==!1){if(!this._downAt)return;this.mark(t),this._moving=!0}else this.abort()}if(this._downAt){var n=Cr(e),o=n.x-this._downAt.x,l=n.y-this._downAt.y,u=this._ignoreZoom?1:this.manager.getZoom();this._lastPosition={x:n.x,y:n.y},this._lastScrollValues={x:document.documentElement.scrollLeft,y:document.documentElement.scrollTop},this._dragEl&&this._dragEl.parentNode&&(o+=this._dragEl.parentNode.scrollLeft-this._initialScroll.x,l+=this._dragEl.parentNode.scrollTop-this._initialScroll.y),o/=u,l/=u,this.moveBy(o,l,e)}}}},{key:"getDragDelta",value:function(){return this._posAtDown!=null&&this._downAt!=null?{x:this._downAt.x-this._posAtDown.x,y:this._downAt.y-this._posAtDown.y}:{x:0,y:0}}},{key:"mark",value:function(e){this._posAtDown=this.manager.getPosition(this._dragEl),this._pagePosAtDown=tn(this._dragEl),this._pageDelta={x:this._pagePosAtDown.x-this._posAtDown.x,y:this._pagePosAtDown.y-this._posAtDown.y},this._size=this.manager.getSize(this._dragEl),kt(this._dragEl,this.manager.css.drag),this._constrainRect=qu(this._dragEl),this._ghostDx=0,this._ghostDy=0}},{key:"unmark",value:function(e){this._isConstrained&&this._useGhostProxy(this._elementToDrag,this._dragEl)?(this._ghostProxyOffsets={x:this._dragEl.offsetLeft-this._ghostDx,y:this._dragEl.offsetTop-this._ghostDy},this._dragEl.parentNode.removeChild(this._dragEl),this._dragEl=this._elementToDrag):this._ghostProxyOffsets=null,Jr(this._dragEl,this.manager.css.drag),this._isConstrained=!1}},{key:"moveBy",value:function(e,t,n){var o=this.toGrid({x:this._posAtDown.x+e,y:this._posAtDown.y+t}),l=this._doConstrain(o,this._dragEl,this._constrainRect,this._size,n);if(l!=null){if(this._useGhostProxy(this.el,this._dragEl))if(o.x!==l.x||o.y!==l.y){if(!this._isConstrained){var u=this._ghostProxyFunction(this._elementToDrag);kt(u,In.ghostProxy),this._ghostProxyParent?(this._ghostProxyParent.appendChild(u),this._currentParentPosition=tn(this._elementToDrag.parentNode),this._ghostParentPosition=tn(this._ghostProxyParent),this._ghostDx=this._currentParentPosition.x-this._ghostParentPosition.x,this._ghostDy=this._currentParentPosition.y-this._ghostParentPosition.y):this._elementToDrag.parentNode.appendChild(u),this._dragEl=u,this._isConstrained=!0}l=o}else this._isConstrained&&(this._dragEl.parentNode.removeChild(this._dragEl),this._dragEl=this._elementToDrag,this._isConstrained=!1,this._currentParentPosition=null,this._ghostParentPosition=null,this._ghostDx=0,this._ghostDy=0);this.manager.setPosition(this._dragEl,{x:l.x+this._ghostDx,y:l.y+this._ghostDy}),this._dispatch(Us,{el:this.el,pos:l,e:n,drag:this,size:this._size,originalPos:this._posAtDown})}}},{key:"abort",value:function(){this._downAt!=null&&this._upListener()}},{key:"getDragElement",value:function(e){return e?this._elementToDrag||this.el:this._dragEl||this.el}},{key:"stop",value:function(e,t){if(t||this._moving){var n=[],o=this.manager.getPosition(this._dragEl);n.push([this._dragEl,o,this,this._size]),this._dispatch(Vs,{el:this._dragEl,pos:this._ghostProxyOffsets||o,finalPos:o,e,drag:this,selection:n,size:this._size,originalPos:{x:this._posAtDown.x,y:this._posAtDown.y}})}else this._moving||this._activeSelectorParams.dragAbort&&this._activeSelectorParams.dragAbort(this._elementToDrag)}},{key:"_dispatch",value:function(e,t){var n=null;if(this._activeSelectorParams&&this._activeSelectorParams[e])n=this._activeSelectorParams[e](t);else if(this.listeners[e])for(var o=0;o<this.listeners[e].length;o++)try{var l=this.listeners[e][o](t);l!=null&&(n=l)}catch{}return n}},{key:"resolveGrid",value:function(){var e={grid:null,thresholdX:Wu/2,thresholdY:Ku/2};return this._activeSelectorParams!=null&&this._activeSelectorParams.grid!=null&&(e.grid=this._activeSelectorParams.grid,this._activeSelectorParams.snapThreshold!=null&&(e.thresholdX=this._activeSelectorParams.snapThreshold,e.thresholdY=this._activeSelectorParams.snapThreshold)),e}},{key:"toGrid",value:function(e){var t=this.resolveGrid(),n=t.grid,o=t.thresholdX,l=t.thresholdY;if(n==null)return e;var u=n?n.w/2:o,c=n?n.h/2:l;return Fu(e,n,u,c)}},{key:"setUseGhostProxy",value:function(e){this._useGhostProxy=e?Hr:zu}},{key:"_doConstrain",value:function(e,t,n,o,l){return this._activeSelectorParams!=null&&this._activeSelectorParams.constrainFunction&&typeof this._activeSelectorParams.constrainFunction=="function"?this._activeSelectorParams.constrainFunction(e,t,n,o,l):e}},{key:"_testFilter",value:function(e){for(var t in this._filters){var n=this._filters[t],o=n[0](e);if(n[1]&&(o=!o),!o)return!1}return!0}},{key:"addFilter",value:function(e,t){var n=this;if(e){var o=Uu(e);this._filters[o]=[function(l){var u=l.srcElement||l.target,c;return Ce(e)?c=Gt(u,e,n.el):typeof e=="function"&&(c=e(l,n.el)),c},t!==!1]}}},{key:"removeFilter",value:function(e){var t=typeof e=="function"?e._katavorioId:e;delete this._filters[t]}},{key:"clearAllFilters",value:function(){this._filters={}}},{key:"addSelector",value:function(e,t){e.selector&&(t?this._availableSelectors.unshift(e):this._availableSelectors.push(e))}},{key:"destroy",value:function(){this.eventManager.off(this.el,te,this.downListener),this.eventManager.off(document,De,this.moveListener),this.eventManager.off(document,ne,this.upListener),this.downListener=null,this.upListener=null,this.moveListener=null,this.scrollTracker!=null&&document.removeEventListener("scroll",this.scrollTracker)}}]),r}(Qu),tc=["input","textarea","select","button","option"],nc=tc.join(","),rc=function(){function s(a){H(this,s),f(this,"eventManager",void 0),f(this,"zoom",1),f(this,"css",{}),f(this,"inputFilterSelector",void 0),f(this,"positioningStrategy",void 0),f(this,"_positionSetter",void 0),f(this,"_positionGetter",void 0),f(this,"_sizeSetter",void 0),f(this,"_sizeGetter",void 0),a=a||{},this.inputFilterSelector=a.inputFilterSelector||nc,this.eventManager=new Li,this.zoom=a.zoom||1,this.positioningStrategy=a.positioningStrategy||Ze.absolutePosition,this._positionGetter=Ni.get(this.positioningStrategy),this._positionSetter=Ri.get(this.positioningStrategy),this._sizeGetter=ji.get(this.positioningStrategy),this._sizeSetter=Gi.get(this.positioningStrategy);var r=a.css||{};$(this.css,r)}return K(s,[{key:"getPosition",value:function(r){return this._positionGetter(r)}},{key:"setPosition",value:function(r,i){this._positionSetter(r,i)}},{key:"getSize",value:function(r){return this._sizeGetter(r)}},{key:"getZoom",value:function(){return this.zoom}},{key:"setZoom",value:function(r){this.zoom=r}},{key:"_prepareParams",value:function(r){r=r||{};var i={events:{}},e;for(e in r)i[e]=r[e];for(e=0;e<Yr.length;e++)i.events[Yr[e]]=r[Yr[e]]||Zu;return i}},{key:"getInputFilterSelector",value:function(){return this.inputFilterSelector}},{key:"setInputFilterSelector",value:function(r){return this.inputFilterSelector=r,this}},{key:"draggable",value:function(r,i){if(r._katavorioDrag==null){var e=this._prepareParams(i),t=new ec(r,e,this);return kt(r,In.delegatedDraggable),r._katavorioDrag=t,t}else return r._katavorioDrag}},{key:"destroyDraggable",value:function(r){r._katavorioDrag&&(r._katavorioDrag.destroy(),delete r._katavorioDrag)}}]),s}(),dr="jtk-drag-selected",ic=function(){function s(a){H(this,s),this.instance=a,f(this,"_dragSelection",[]),f(this,"_dragSizes",new Map),f(this,"_dragElements",new Map),f(this,"_dragElementStartPositions",new Map),f(this,"_dragElementPositions",new Map),f(this,"__activeSet",void 0)}return K(s,[{key:"_activeSet",get:function(){return this.__activeSet==null?this._dragSelection:this.__activeSet}},{key:"length",get:function(){return this._dragSelection.length}},{key:"filterActiveSet",value:function(r){var i=this;this.__activeSet=[],X(this._dragSelection,function(e){r(e)&&i.__activeSet.push(e)})}},{key:"clear",value:function(){var r=this;this.reset(),X(this._dragSelection,function(i){return r.instance.removeClass(i.jel,dr)}),this._dragSelection.length=0}},{key:"reset",value:function(){this._dragElementStartPositions.clear(),this._dragElementPositions.clear(),this._dragSizes.clear(),this._dragElements.clear(),this.__activeSet=null}},{key:"initialisePositions",value:function(){var r=this;X(this._activeSet,function(i){var e=r.instance.viewport.getPosition(i.id),t={x:parseInt(""+i.jel.offsetLeft,10),y:parseInt(""+i.jel.offsetTop,10)};r._dragElementStartPositions.set(i.id,t),r._dragElementPositions.set(i.id,t),r._dragSizes.set(i.id,{w:e.w,h:e.h})})}},{key:"updatePositions",value:function(r,i,e){var t=this,n=r.x-i.x,o=r.y-i.y;X(this._activeSet,function(l){var u=t._dragElementStartPositions.get(l.id);if(u){var c=u.x+n,h=u.y+o,d=t._dragSizes.get(l.id),v={x:c,y:h,w:d.w,h:d.h};if(l.jel._jsPlumbParentGroup&&l.jel._jsPlumbParentGroup.constrain){var p={w:l.jel.parentNode.offsetWidth+l.jel.parentNode.scrollLeft,h:l.jel.parentNode.offsetHeight+l.jel.parentNode.scrollTop};v.x=Math.max(v.x,0),v.y=Math.max(v.y,0),v.x=Math.min(v.x,p.w-d.w),v.y=Math.min(v.y,p.h-d.h)}t._dragElementPositions.set(l.id,{x:c,y:h}),l.jel.style.left=v.x+"px",l.jel.style.top=v.y+"px",e(l.jel,l.id,d,v)}})}},{key:"each",value:function(r){var i=this;X(this._activeSet,function(e){var t=i._dragSizes.get(e.id),n=i._dragElementPositions.get(e.id),o=i._dragElementStartPositions.get(e.id);r(e.jel,e.id,n,t,o)})}},{key:"add",value:function(r,i){var e=r;i=i||this.instance.getId(e);var t=St(this._dragSelection,function(n){return n.id===i});t===-1&&(this.instance.addClass(r,dr),this._dragSelection.push({id:i,jel:e}))}},{key:"remove",value:function(r){var i=this,e=r;this._dragSelection=this._dragSelection.filter(function(t){var n=t.jel!==e;return n||i.instance.removeClass(t.jel,dr),n})}},{key:"toggle",value:function(r){var i=r,e=St(this._dragSelection,function(t){return t.jel===i});e!==-1?this.remove(i):this.add(r)}}]),s}(),oc="jtk-delegated-draggable",sc="jtk-draggable",ac="jtk-drag",lc="jtk-ghost-proxy",Et="jtk-drag-active",uc="jtk-dragged",xt="jtk-drag-hover",cc=function(){function s(a,r,i){var e=this;H(this,s),this.instance=a,this.dragSelection=r,f(this,"collicat",void 0),f(this,"drag",void 0),f(this,"_draggables",{}),f(this,"_dlist",[]),f(this,"_elementsWithEndpoints",{}),f(this,"_draggablesForElements",{}),f(this,"handlers",[]),f(this,"_trackScroll",void 0),f(this,"_filtersToAdd",[]),this.collicat=new rc({zoom:this.instance.currentZoom,css:{noSelect:this.instance.dragSelectClass,delegatedDraggable:oc,draggable:sc,drag:ac,selected:dr,active:Et,hover:xt,ghostProxy:lc}}),this.instance.bind(As,function(t){e.collicat.setZoom(t)}),i=i||{},this._trackScroll=i.trackScroll!==!1}return K(s,[{key:"addHandler",value:function(r,i){var e=this,t=$({selector:r.selector},i||{});t.start=Jn(t.start,function(l){return r.onStart(l)},!1),t.drag=Jn(t.drag,function(l){return r.onDrag(l)}),t.stop=Jn(t.stop,function(l){return r.onStop(l)});var n=(r.onBeforeStart||function(l){}).bind(r);if(t.beforeStart=Jn(t.beforeStart,function(l){return n(l)}),t.dragInit=function(l,u){return r.onDragInit(l,u)},t.dragAbort=function(l){return r.onDragAbort(l)},r.useGhostProxy&&(t.useGhostProxy=r.useGhostProxy,t.makeGhostProxy=r.makeGhostProxy),t.constrainFunction==null&&t.containment!=null)switch(t.containment){case Nn.notNegative:{t.constrainFunction=function(l,u,c,h){return{x:Math.max(0,Math.min(l.x)),y:Math.max(0,Math.min(l.y))}};break}case Nn.parent:{var o=t.containmentPadding||5;t.constrainFunction=function(l,u,c,h){var d=l.x<0?0:l.x>c.w-o?c.w-o:l.x,v=l.y<0?0:l.y>c.h-o?c.h-o:l.y;return{x:d,y:v}};break}case Nn.parentEnclosed:{t.constrainFunction=function(l,u,c,h){var d=l.x<0?0:l.x+h.w>c.w?c.w-h.w:l.x,v=l.y<0?0:l.y+h.h>c.h?c.h-h.h:l.y;return{x:d,y:v}};break}}this.drag==null?(t.trackScroll=this._trackScroll,this.drag=this.collicat.draggable(this.instance.getContainer(),t),X(this._filtersToAdd,function(l){return e.drag.addFilter(l[0],l[1])}),this.drag.on(mr,function(l){e.instance.revalidate(l)})):this.drag.addSelector(t),this.handlers.push({handler:r,options:t}),r.init(this.drag)}},{key:"addSelector",value:function(r,i){this.drag&&this.drag.addSelector(r,i)}},{key:"addFilter",value:function(r,i){this.drag==null?this._filtersToAdd.push([r,i===!0]):this.drag.addFilter(r,i)}},{key:"removeFilter",value:function(r){this.drag!=null&&this.drag.removeFilter(r)}},{key:"setFilters",value:function(r){var i=this;X(r,function(e){i.drag.addFilter(e[0],e[1])})}},{key:"reset",value:function(){var r=[];if(X(this.handlers,function(t){t.handler.reset()}),this.handlers.length=0,this.drag!=null){var i=this.drag._filters;for(var e in i)r.push([e,i[e][1]]);this.collicat.destroyDraggable(this.instance.getContainer())}return delete this.drag,r}},{key:"setOption",value:function(r,i){var e=Ci(this.handlers,function(t){return t.handler===r});e!=null&&$(e.options,i||{})}}]),s}();function hc(s,a){return Ce(a)?{id:a,active:!0}:{id:a.id,active:a.active}}function fc(s,a){var r=cs(s.members,function(i){return i.el===a});return r!==null?r.active===!0:!1}function dc(s){for(var a=[],r=s._jsPlumbParentGroup;r!=null;)a.push(r.el),r=r.group;return a}var oi=function(){function s(a,r){H(this,s),this.instance=a,this._dragSelection=r,f(this,"selector","> "+me+":not("+Ft(wr)+")"),f(this,"_dragOffset",null),f(this,"_groupLocations",[]),f(this,"_intersectingGroups",[]),f(this,"_currentDragParentGroup",null),f(this,"_dragGroupByElementIdMap",{}),f(this,"_dragGroupMap",{}),f(this,"_currentDragGroup",null),f(this,"_currentDragGroupOffsets",new Map),f(this,"_currentDragGroupSizes",new Map),f(this,"_currentDragGroupOriginalPositions",new Map),f(this,"_dragPayload",null),f(this,"drag",void 0),f(this,"originalPosition",void 0)}return K(s,[{key:"onDragInit",value:function(r){return null}},{key:"onDragAbort",value:function(r){return null}},{key:"getDropGroup",value:function(){var r=null;if(this._intersectingGroups.length>0){var i=this._intersectingGroups[0].groupLoc.group,e=this._intersectingGroups[0].intersectingElement,t=e._jsPlumbParentGroup;t!==i&&(t==null||!t.overrideDrop(e,i))&&(r=this._intersectingGroups[0])}return r}},{key:"onStop",value:function(r){var i,e=this,t=r.drag.getDragElement(),n=this.getDropGroup(),o=[];o.push({el:t,id:this.instance.getId(t),pos:r.finalPos,originalGroup:t._jsPlumbParentGroup,redrawResult:null,originalPos:r.originalPos,reverted:!1,dropGroup:n!=null?n.groupLoc.group:null});function l(p,m,g,E,x){var C=g.x,S=g.y;if(p._jsPlumbParentGroup&&p._jsPlumbParentGroup.constrain){var b={w:p.parentNode.offsetWidth+p.parentNode.scrollLeft,h:p.parentNode.offsetHeight+p.parentNode.scrollTop};C=Math.max(C,0),S=Math.max(S,0),C=Math.min(C,b.w-E.w),S=Math.min(S,b.h-E.h),g.x=C,g.y=S}o.push({el:p,id:m,pos:g,originalPos:x,originalGroup:p._jsPlumbParentGroup,redrawResult:null,reverted:!1,dropGroup:n==null?void 0:n.groupLoc.group})}if(this._dragSelection.each(function(p,m,g,E,x){p!==r.el&&l(p,m,{x:g.x,y:g.y},E,x)}),(i=this._currentDragGroup)===null||i===void 0||i.members.forEach(function(p){if(p.el!==r.el){var m=e._currentDragGroupOffsets.get(p.elId),g=e._currentDragGroupSizes.get(p.elId),E={x:r.finalPos.x+m[0].x,y:r.finalPos.y+m[0].y};l(p.el,p.elId,E,g,e._currentDragGroupOriginalPositions.get(p.elId))}}),X(o,function(p){var m=p.originalGroup!=null,g=m&&co(e.instance,p.el,p.pos),E={x:0,y:0};if(m&&!g){if(n==null){var x=e._pruneOrOrphan(p,!0,!0);x.pos!=null?p.pos=x.pos.pos:!x.pruned&&p.originalGroup.revert&&(p.pos=p.originalPos,p.reverted=!0)}}else m&&g&&(E=e._computeOffsetByParentGroup(p.originalGroup));n!=null&&!g?e.instance.groupManager.addToGroup(n.groupLoc.group,!1,p.el):p.dropGroup=null,p.reverted&&e.instance.setPosition(p.el,p.pos),p.redrawResult=e.instance.setElementPosition(p.el,p.pos.x+E.x,p.pos.y+E.y),e.instance.removeClass(p.el,uc),e.instance.select({source:p.el}).removeClass(e.instance.elementDraggingClass+" "+e.instance.sourceElementDraggingClass,!0),e.instance.select({target:p.el}).removeClass(e.instance.elementDraggingClass+" "+e.instance.targetElementDraggingClass,!0)}),o[0].originalGroup!=null){var u=t._jsPlumbParentGroup;if(u!==o[0].originalGroup){var c=r.drag.getDragElement(!0);if(o[0].originalGroup.ghost){var h=this.instance.getPosition(this.instance.getGroupContentArea(u)),d=this.instance.getPosition(this.instance.getGroupContentArea(o[0].originalGroup)),v={x:d.x+r.pos.x-h.x,y:d.y+r.pos.y-h.y};c.style.left=v.x+"px",c.style.top=v.y+"px",this.instance.revalidate(c)}}}this.instance.fire(Hl,{elements:o,e:r.e,el:t,payload:this._dragPayload}),this._cleanup()}},{key:"_cleanup",value:function(){var r=this;X(this._groupLocations,function(i){r.instance.removeClass(i.el,Et),r.instance.removeClass(i.el,xt)}),this._currentDragParentGroup=null,this._groupLocations.length=0,this.instance.hoverSuspended=!1,this._dragOffset=null,this._dragSelection.reset(),this._dragPayload=null,this._currentDragGroupOffsets.clear(),this._currentDragGroupSizes.clear(),this._currentDragGroupOriginalPositions.clear(),this._currentDragGroup=null}},{key:"reset",value:function(){}},{key:"init",value:function(r){this.drag=r}},{key:"onDrag",value:function(r){var i=this,e=r.drag.getDragElement(),t=this.instance.getId(e),n=r.pos,o=this.instance.viewport.getPosition(t),l={x:n.x,y:n.y};this._intersectingGroups.length=0,this._dragOffset!=null&&(l.x+=this._dragOffset.x,l.y+=this._dragOffset.y);var u=function(d,v,p){if(p){var m=new Set;X(i._groupLocations,function(g){!m.has(g.group.id)&&js(v,g.r)?(g.group!==i._currentDragParentGroup&&i.instance.addClass(g.el,xt),i._intersectingGroups.push({groupLoc:g,intersectingElement:r.drag.getDragElement(!0),d:0}),X(i.instance.groupManager.getAncestors(g.group),function(E){return m.add(E.id)})):i.instance.removeClass(g.el,xt)})}i.instance.setElementPosition(d,v.x,v.y),i.instance.fire(Vl,{el:d,e:r.e,pos:{x:v.x,y:v.y},originalPosition:i.originalPosition,payload:i._dragPayload})},c={x:l.x,y:l.y,w:o.w,h:o.h};u(e,c,!0),this._dragSelection.updatePositions(n,this.originalPosition,function(h,d,v,p){u(h,p,!1)}),this._currentDragGroupOffsets.forEach(function(h,d){var v=i._currentDragGroupSizes.get(d),p={x:c.x+h[0].x,y:c.y+h[0].y,w:v.w,h:v.h};h[1].style.left=p.x+"px",h[1].style.top=p.y+"px",u(h[1],p,!1)})}},{key:"_computeOffsetByParentGroup",value:function(r){var i=this.instance.getPosition(r.el),e=r.contentArea;if(e!==r.el){var t=this.instance.getPosition(e);i.x+=t.x,i.y+=t.y}if(r.el._jsPlumbParentGroup){var n=this._computeOffsetByParentGroup(r.el._jsPlumbParentGroup);i.x+=n.x,i.y+=n.y}return i}},{key:"onStart",value:function(r){var i=this,e=r.drag.getDragElement(),t=this.instance.getPosition(e);this.originalPosition={x:r.pos.x,y:r.pos.y},e._jsPlumbParentGroup&&(this._dragOffset=this._computeOffsetByParentGroup(e._jsPlumbParentGroup),this._currentDragParentGroup=e._jsPlumbParentGroup);var n=!0,o=e.getAttribute(ur);if((this.instance.elementsDraggable===!1||o!=null&&o!==nn)&&(n=!1),n){this._groupLocations.length=0,this._intersectingGroups.length=0,this.instance.hoverSuspended=!0;var l=r.drag.getDragElement(!0),u=l.querySelectorAll(me),c=dc(l),h=[];Array.prototype.push.apply(h,u),Array.prototype.push.apply(h,c),this._dragSelection.filterActiveSet(function(m){return h.indexOf(m.jel)===-1}),this._dragSelection.initialisePositions();var d=function(g,E,x){if(!g._isJsPlumbGroup||i.instance.allowNestedGroups){var C=!g._jsPlumbParentGroup,S=C||g._jsPlumbParentGroup.dropOverride!==!0,b=!C&&(g._jsPlumbParentGroup.ghost||g._jsPlumbParentGroup.constrain!==!0);(C||S&&b)&&(X(i.instance.groupManager.getGroups(),function(T){var D=g._jsPlumbGroup;if(T.droppable!==!1&&T.enabled!==!1&&g._jsPlumbGroup!==T&&!i.instance.groupManager.isDescendant(T,D)){var P=T.el,_=i.instance.getId(P),L=i.instance.viewport.getPosition(_),N={x:L.x,y:L.y,w:L.w,h:L.h},k={el:P,r:N,group:T};i._groupLocations.push(k),T!==i._currentDragParentGroup&&i.instance.addClass(P,Et)}}),i._groupLocations.sort(function(T,D){return i.instance.groupManager.isDescendant(T.group,D.group)?-1:i.instance.groupManager.isAncestor(D.group,T.group)?1:0}))}return i.instance.select({source:g}).addClass(i.instance.elementDraggingClass+" "+i.instance.sourceElementDraggingClass,!0),i.instance.select({target:g}).addClass(i.instance.elementDraggingClass+" "+i.instance.targetElementDraggingClass,!0),i.instance.fire(Yl,{el:g,e:r.e,originalPosition:i.originalPosition,pos:i.originalPosition,dragGroup:E,dragGroupMemberSpec:x})},v=this.instance.getId(e);this._currentDragGroup=this._dragGroupByElementIdMap[v],this._currentDragGroup&&!fc(this._currentDragGroup,e)&&(this._currentDragGroup=null);var p=d(e);if(p===!1)return this._cleanup(),!1;this._dragPayload=p,this._currentDragGroup!=null&&(this._currentDragGroupOffsets.clear(),this._currentDragGroupSizes.clear(),this._currentDragGroup.members.forEach(function(m){var g=i.instance.viewport.getPosition(m.elId);i._currentDragGroupOffsets.set(m.elId,[{x:g.x-t.x,y:g.y-t.y},m.el]),i._currentDragGroupSizes.set(m.elId,g),i._currentDragGroupOriginalPositions.set(m.elId,{x:g.x,y:g.y}),d(m.el,i._currentDragGroup,m)}))}return n}},{key:"addToDragGroup",value:function(r){var i=this,e=hc(this.instance,r),t=this._dragGroupMap[e.id];t==null&&(t={id:e.id,members:new Set},this._dragGroupMap[e.id]=t);for(var n=arguments.length,o=new Array(n>1?n-1:0),l=1;l<n;l++)o[l-1]=arguments[l];this.removeFromDragGroup.apply(this,o),X(o,function(u){var c=i.instance.getId(u);t.members.add({elId:c,el:u,active:e.active}),i._dragGroupByElementIdMap[c]=t})}},{key:"removeFromDragGroup",value:function(){for(var r=this,i=arguments.length,e=new Array(i),t=0;t<i;t++)e[t]=arguments[t];X(e,function(n){var o=r.instance.getId(n),l=r._dragGroupByElementIdMap[o];if(l!=null){var u=new Set;l.members.forEach(function(c){c.el!==n&&u.add(c)}),l.members=u,delete r._dragGroupByElementIdMap[o]}})}},{key:"setDragGroupState",value:function(r){for(var i=this,e=arguments.length,t=new Array(e>1?e-1:0),n=1;n<e;n++)t[n-1]=arguments[n];var o=t.map(function(l){return i.instance.getId(l)});X(o,function(l){var u=i._dragGroupByElementIdMap[l];if(u!=null){var c=cs(u.members,function(h){return h.elId===l});c!=null&&(c.active=r)}})}},{key:"clearDragGroup",value:function(r){var i=this,e=this._dragGroupMap[r];e!=null&&(e.members.forEach(function(t){delete i._dragGroupByElementIdMap[t.elId]}),e.members.clear())}},{key:"_pruneOrOrphan",value:function(r,i,e){var t=r.el,n={pruned:!1,pos:null};if(e||!co(this.instance,t,r.pos)){var o=t._jsPlumbParentGroup;o.prune?(t._isJsPlumbGroup?this.instance.removeGroup(t._jsPlumbGroup):o.remove(r.el,!0),n.pruned=!0):o.orphan&&(n.pos=this.instance.groupManager.orphan(r.el,i),t._isJsPlumbGroup?o.removeGroup(t._jsPlumbGroup):o.remove(r.el))}return n}}]),s}(),ho={},fo={},vo={},Ct={get:function(a,r,i){var e=ho[r];if(e)return new e(a,i);throw{message:"jsPlumb: unknown endpoint type '"+r+"'"}},clone:function(a){var r=vo[a.type];return Ct.get(a.endpoint,a.type,r.getParams(a))},compute:function(a,r,i,e){var t=fo[a.type];if(t!=null)return t(a,r,i,e);Oe("jsPlumb: cannot find endpoint calculator for endpoint of type ",a.type)},registerHandler:function(a){vo[a.type]=a,ho[a.type]=a.cls,fo[a.type]=a.compute}},pn=function(){function s(a,r){H(this,s),this.endpoint=a,f(this,"typeId",void 0),f(this,"x",void 0),f(this,"y",void 0),f(this,"w",void 0),f(this,"h",void 0),f(this,"computedValue",void 0),f(this,"bounds",Er()),f(this,"classes",[]),f(this,"instance",void 0),f(this,"type",void 0),r=r||{},this.instance=a.instance,a.cssClass&&this.classes.push(a.cssClass),r.cssClass&&this.classes.push(r.cssClass)}return K(s,[{key:"addClass",value:function(r){this.classes.push(r),this.instance.addEndpointClass(this.endpoint,r)}},{key:"removeClass",value:function(r){this.classes=this.classes.filter(function(i){return i!==r}),this.instance.removeEndpointClass(this.endpoint,r)}},{key:"compute",value:function(r,i,e){this.computedValue=Ct.compute(this,r,i,e),this.bounds.xmin=this.x,this.bounds.ymin=this.y,this.bounds.xmax=this.x+this.w,this.bounds.ymax=this.y+this.h}},{key:"setVisible",value:function(r){this.instance.setEndpointVisible(this.endpoint,r)}}]),s}(),Wt,Kt,zt,dn;(function(s){s.top="top",s.left="left",s.right="right",s.bottom="bottom"})(dn||(dn={}));var be=dn.top,we=dn.left,Le=dn.right,Ne=dn.bottom,vc=[we,Le],pc=[be,Ne],gc=function(){function s(a,r,i){H(this,s),this.instance=a,this.element=r,f(this,"isFloating",!0),f(this,"isContinuous",void 0),f(this,"isDynamic",void 0),f(this,"locations",[]),f(this,"currentLocation",0),f(this,"locked",!1),f(this,"cssClass",""),f(this,"timestamp",null),f(this,"type","Floating"),f(this,"id",Ae()),f(this,"orientation",[0,0]),f(this,"size",void 0),this.size=a.viewport.getPosition(i),this.locations.push({x:.5,y:.5,ox:this.orientation[0],oy:this.orientation[1],offx:0,offy:0,iox:this.orientation[0],ioy:this.orientation[1],cls:""})}return K(s,[{key:"_updateOrientationInRouter",value:function(){this.instance.router.setAnchorOrientation(this,[this.locations[0].ox,this.locations[0].oy])}},{key:"over",value:function(r){this.orientation=this.instance.router.getEndpointOrientation(r),this.locations[0].ox=this.orientation[0],this.locations[0].oy=this.orientation[1],this._updateOrientationInRouter()}},{key:"out",value:function(){this.orientation=null,this.locations[0].ox=this.locations[0].iox,this.locations[0].oy=this.locations[0].ioy,this._updateOrientationInRouter()}}]),s}(),po=(Wt={},f(Wt,be,Ne),f(Wt,Le,we),f(Wt,we,Le),f(Wt,Ne,be),Wt),Ys=(Kt={},f(Kt,be,Le),f(Kt,Le,Ne),f(Kt,we,be),f(Kt,Ne,we),Kt),$s=(zt={},f(zt,be,we),f(zt,Le,be),f(zt,we,Ne),f(zt,Ne,Le),zt);function yc(s){return s.faces.length===0?be:s.faces[0]}function kn(s,a){return s.faces.indexOf(a)!==-1}function mc(s,a){return(s.clockwise?Ys:$s)[a]}function Ec(s,a){return(s.clockwise?$s:Ys)[a]}function go(s,a){return s.lockedAxis==null?s.lockedFace==null?kn(s,a)===!0:s.lockedFace===a:s.lockedAxis.indexOf(a)!==-1}function xc(s,a){if(kn(s,a))return a;if(kn(s,po[a]))return po[a];var r=mc(s,a);if(kn(s,r))return r;var i=Ec(s,a);return kn(s,i)?i:a}var yo={x:.5,y:0,ox:0,oy:-1,offx:0,offy:0},mo={x:.5,y:1,ox:0,oy:1,offx:0,offy:0},Eo={x:0,y:.5,ox:-1,oy:0,offx:0,offy:0},xo={x:1,y:.5,ox:1,oy:0,offx:0,offy:0},Cc={x:0,y:0,ox:0,oy:-1,offx:0,offy:0},Sc={x:1,y:0,ox:1,oy:-1,offx:0,offy:0},bc={x:0,y:1,ox:0,oy:1,offx:0,offy:0},Pc={x:1,y:1,ox:0,oy:1,offx:0,offy:0},Tc={x:.5,y:.5,ox:0,oy:0,offx:0,offy:0},Xs={Top:[yo],Bottom:[mo],Left:[Eo],Right:[xo],TopLeft:[Cc],TopRight:[Sc],BottomLeft:[bc],BottomRight:[Pc],Center:[Tc],AutoDefault:[yo,Eo,mo,xo]},Oc={Continuous:{faces:[be,we,Ne,Le]},ContinuousTop:{faces:[be]},ContinuousRight:{faces:[Le]},ContinuousBottom:{faces:[Ne]},ContinuousLeft:{faces:[we]},ContinuousLeftRight:{faces:[we,Le]},ContinuousTopBottom:{faces:[be,Ne]}};function Co(s,a){if(a=a||{},s===tt.Perimeter)return wc(a);var r=Xs[s];if(r!=null)return Pr(s,fs(r,function(i){return $({iox:i.ox,ioy:i.oy},i)}),a);if(r=Oc[s],r!=null)return _c(s,r.faces,a);throw{message:"jsPlumb: unknown anchor type '"+s+"'"}}function Pr(s,a,r){return{type:s,locations:a,currentLocation:0,locked:!1,id:Ae(),isFloating:!1,isContinuous:!1,isDynamic:a.length>1,timestamp:null,cssClass:r.cssClass||""}}function Ac(s,a,r){return new gc(s,a,r)}var Dc="currentFace";function _c(s,a,r){var i={type:s,locations:[],currentLocation:0,locked:!1,id:Ae(),cssClass:r.cssClass||"",isFloating:!1,isContinuous:!0,timestamp:null,faces:r.faces||a,lockedFace:null,lockedAxis:null,clockwise:r.clockwise!==!1,__currentFace:null};return Object.defineProperty(i,Dc,{get:function(){return this.__currentFace},set:function(t){this.__currentFace=xc(this,t)}}),i}function So(s){return s.length<7&&s.every(Zr)||s.length===7&&s.slice(0,5).every(Zr)&&Ce(s[6])}function Mn(s){if(Ce(s))return Co(s,null);if(Array.isArray(s))if(So(s)){var a=s;return Pr(null,[{x:a[0],y:a[1],ox:a[2],oy:a[3],offx:a[4]==null?0:a[4],offy:a[5]==null?0:a[5],iox:a[2],ioy:a[3],cls:a[6]||""}],{cssClass:a[6]||""})}else{var r=fs(s,function(e){if(Ce(e)){var t=Xs[e];return t!=null?$({iox:t[0].ox,ioy:t[0].oy,cls:""},t[0]):null}else if(So(e))return{x:e[0],y:e[1],ox:e[2],oy:e[3],offx:e[4]==null?0:e[4],offy:e[5]==null?0:e[5],iox:e[2],ioy:e[3],cls:e[6]||""}}).filter(function(e){return e!=null});return Pr("Dynamic",r,{})}else{var i=s;return Co(i.type,i.options)}}function Ws(s){for(var a=.5,r=Math.PI*2/s,i=[],e=0,t=0;t<s;t++){var n=a+a*Math.sin(e),o=a+a*Math.cos(e);i.push({x:n,y:o,ox:0,oy:0,offx:0,offy:0,iox:0,ioy:0,cls:""}),e+=r}return i}function Ic(s,a){for(var r=a/s.length,i=[],e=function(o,l,u,c,h,d,v){r=a*h;for(var p=(u-o)/r,m=(c-l)/r,g=0;g<r;g++)i.push({x:o+p*g,y:l+m*g,ox:d??0,oy:v??0,offx:0,offy:0,iox:0,ioy:0,cls:""})},t=0;t<s.length;t++)e.apply(null,s[t]);return i}function Fi(s,a){for(var r=[],i=0;i<s.length;i++)r.push([s[i][0],s[i][1],s[i][2],s[i][3],1/s.length,s[i][4],s[i][5]]);return Ic(r,a)}function Ks(s){return Fi([[0,0,1,0,0,-1],[1,0,1,1,1,0],[1,1,0,1,0,1],[0,1,0,0,-1,0]],s)}function kc(s){return Fi([[.5,0,1,.5],[1,.5,.5,1],[.5,1,0,.5],[0,.5,.5,0]],s)}function Mc(s){return Fi([[.5,0,1,1],[1,1,0,1],[0,1,.5,0]],s)}function Lc(s,a){for(var r=[],i=a/180*Math.PI,e=0;e<s.length;e++){var t=s[e].x-.5,n=s[e].y-.5;r.push({x:.5+(t*Math.cos(i)-n*Math.sin(i)),y:.5+(t*Math.sin(i)+n*Math.cos(i)),ox:s[e].ox,oy:s[e].oy,offx:0,offy:0,iox:0,ioy:0,cls:""})}return r}var Pt=new Map;Pt.set(bt.Circle,Ws);Pt.set(bt.Ellipse,Ws);Pt.set(bt.Rectangle,Ks);Pt.set(bt.Square,Ks);Pt.set(bt.Diamond,kc);Pt.set(bt.Triangle,Mc);function wc(s){s=s||{};var a=s.anchorCount||60,r=s.shape;if(!r)throw new Error("no shape supplied to Perimeter Anchor type");if(!Pt.has(r))throw new Error("Shape ["+r+"] is unknown by Perimeter Anchor type");var i=Pt.get(r)(a);s.rotation&&(i=Lc(i,s.rotation));var e=Pr(tt.Perimeter,i,s),t=$(e,{shape:r});return t}var bo=function(){function s(a,r){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;H(this,s),this.selector=a,this.def=r,this.exclude=i,f(this,"id",void 0),f(this,"redrop",void 0),this.id=Ae(),this.redrop=r.def.redrop||zs}return K(s,[{key:"setEnabled",value:function(r){this.def.enabled=r}},{key:"isEnabled",value:function(){return this.def.enabled!==!1}}]),s}(),zs="strict",Rc="any",Nc="anySource",Gc="anyTarget",jc="anySourceOrTarget";function Fc(s,a,r,i,e,t){var n=Ac(t,i,e),o={paintStyle:s.getPaintStyle(),preparedAnchor:n,element:i,scope:s.scope,cssClass:[Ti,s.cssClass].join(" ")};a!=null&&(ds(a,pn)?o.existingEndpoint=a:o.endpoint=a);var l=t._internal_newEndpoint(o);return t._paintEndpoint(l,{}),l}function Bc(s,a,r,i,e){for(var t=s.target||s.srcElement,n=!1,o=i.getSelector(a,r),l=0;l<o.length;l++)if(o[l]===t){n=!0;break}return e?!n:n}var Uc=Ft(Et,xt),Po="sourceSelectorEndpoint",To=function(){function s(a){H(this,s),this.instance=a,f(this,"jpc",void 0),f(this,"existingJpc",void 0),f(this,"_originalAnchorSpec",void 0),f(this,"ep",void 0),f(this,"endpointRepresentation",void 0),f(this,"canvasElement",void 0),f(this,"_activeDefinition",void 0),f(this,"placeholderInfo",{id:null,element:null}),f(this,"floatingIndex",void 0),f(this,"floatingId",void 0),f(this,"floatingElement",void 0),f(this,"floatingEndpoint",void 0),f(this,"floatingAnchor",void 0),f(this,"_stopped",void 0),f(this,"inPlaceCopy",void 0),f(this,"endpointDropTargets",[]),f(this,"currentDropTarget",null),f(this,"payload",void 0),f(this,"floatingConnections",{}),f(this,"_forceReattach",void 0),f(this,"_forceDetach",void 0),f(this,"mousedownHandler",void 0),f(this,"mouseupHandler",void 0),f(this,"selector",Ft(sn));var r=a.getContainer();this.mousedownHandler=this._mousedownHandler.bind(this),this.mouseupHandler=this._mouseupHandler.bind(this),a.on(r,te,me,this.mousedownHandler),a.on(r,ne,[me,Ft(sn)].join(","),this.mouseupHandler)}return K(s,[{key:"_resolveDragParent",value:function(r,i){var e=this.instance.getContainer(),t=st(i,me,e,!0);if(r.parentSelector!=null){var n=st(i,r.parentSelector,e,!0);return n!=null&&(t=st(n.parentNode,me,e,!1)),n||t}else return t}},{key:"_mousedownHandler",value:function(r){var i,e;if(!(r.which===3||r.button===2)){var t=r.target||r.srcElement;if(e=this._getSourceDefinition(r),!(e!=null&&(i=this._resolveDragParent(e.def.def,t),i==null||i.getAttribute(er)===nn))&&e){var n=r.currentTarget,o;if(t.getAttribute(er)!==nn){if(Gn(r),this._activeDefinition=e,o=e.def.def,o.canAcceptNewConnection!=null&&!o.canAcceptNewConnection(i,r))return!1;var l=Uo(r,i,this.instance.currentZoom),u={element:i};if($(u,o),u.isTemporarySource=!0,o.scope)u.scope=o.scope;else{var c=t.getAttribute(Ur);c!=null&&(u.scope=c)}var h=o.parameterExtractor?o.parameterExtractor(i,t,r):{};if(u=pr(u,h),u.maxConnections!=null&&u.maxConnections>=0){var d=this.instance.select({source:i}).length;if(d>=u.maxConnections)return Gn(r),o.onMaxConnections&&o.onMaxConnections({element:i,maxConnections:u.maxConnections},r),r.stopImmediatePropagation&&r.stopImmediatePropagation(),!1}if(o.anchorPositionFinder){var v=o.anchorPositionFinder(i,l,o,r);v!=null&&(u.anchor=v)}this._originalAnchorSpec=u.anchor||(this.instance.areDefaultAnchorsSet()?this.instance.defaults.anchors[0]:this.instance.defaults.anchor);var p=this.instance.router.prepareAnchor(this._originalAnchorSpec),m=[l.x,l.y,0,0];if(p.locations.length>0)m[2]=p.locations[0].ox,m[3]=p.locations[0].oy;else if(p.isContinuous){var g=l.x<.5?l.x:1-l.x,E=l.y<.5?l.y:1-l.y;m[2]=g<E?l.x<.5?-1:1:0,m[3]=E<g?l.y<.5?-1:1:0}u.anchor=m,u.deleteOnEmpty=!0,this.ep=this.instance._internal_newEndpoint(u);var x={};if(o.extract){for(var C in o.extract){var S=t.getAttribute(C);S&&(x[o.extract[C]]=S)}this.ep.mergeParameters(x)}if(u.uniqueEndpoint){var b=this.ep.elementId,T=this.instance.getManagedData(b,Po,e.id);T==null?(this.instance.setManagedData(b,Po,e.id,this.ep),this.ep.deleteOnEmpty=!1):this.ep.finalEndpoint=T}n._jsPlumbOrphanedEndpoints=n._jsPlumbOrphanedEndpoints||[],n._jsPlumbOrphanedEndpoints.push(this.ep),this.instance.trigger(this.ep.endpoint.canvas,te,r,x)}}}}},{key:"_mouseupHandler",value:function(r){var i=r.currentTarget||r.srcElement;i._jsPlumbOrphanedEndpoints&&(Ka(i._jsPlumbOrphanedEndpoints,this.instance._maybePruneEndpoint.bind(this.instance)),i._jsPlumbOrphanedEndpoints.length=0),this._activeDefinition=null}},{key:"onDragInit",value:function(r){var i=Qn(r,this.instance),e=Pn(r,this.instance);return this._makeDraggablePlaceholder(i,e),this.placeholderInfo.element.jtk=r.jtk,this.placeholderInfo.element}},{key:"onDragAbort",value:function(r){this._cleanupDraggablePlaceholder()}},{key:"_makeDraggablePlaceholder",value:function(r,i){this.placeholderInfo=this.placeholderInfo||{};var e=ps(Ms,{position:"absolute"});this.instance._appendElementToContainer(e);var t=this.instance.getId(e);return this.instance.setPosition(e,r),e.style.width=i.w+"px",e.style.height=i.h+"px",this.instance.manage(e),this.placeholderInfo.id=t,this.placeholderInfo.element=e,e}},{key:"_cleanupDraggablePlaceholder",value:function(){this.placeholderInfo.element&&(this.instance.unmanage(this.placeholderInfo.element,!0),delete this.placeholderInfo.element,delete this.placeholderInfo.id)}},{key:"reset",value:function(){var r=this.instance.getContainer();this.instance.off(r,ne,this.mouseupHandler),this.instance.off(r,te,this.mousedownHandler)}},{key:"init",value:function(r){}},{key:"startNewConnectionDrag",value:function(r,i){this.jpc=this.instance._newConnection({sourceEndpoint:this.ep,targetEndpoint:this.floatingEndpoint,source:this.ep.element,target:this.placeholderInfo.element,paintStyle:this.ep.connectorStyle,hoverPaintStyle:this.ep.connectorHoverStyle,connector:this.ep.connector,overlays:this.ep.connectorOverlays,type:this.ep.edgeType,cssClass:this.ep.connectorClass,hoverClass:this.ep.connectorHoverClass,scope:r,data:i}),this.jpc.pending=!0,this.jpc.addClass(this.instance.draggingClass),this.ep.addClass(this.instance.draggingClass),this.instance.fire(io,this.jpc)}},{key:"startExistingConnectionDrag",value:function(){this.existingJpc=!0,this.instance.setHover(this.jpc,!1);var r=this.jpc.endpoints[0].id===this.ep.id?0:1;this.ep.detachFromConnection(this.jpc,null,!0),this.floatingEndpoint.addConnection(this.jpc),this.instance.fire(io,this.jpc),this.instance.sourceOrTargetChanged(this.jpc.endpoints[r].elementId,this.placeholderInfo.id,this.jpc,this.placeholderInfo.element,r),this.jpc.suspendedEndpoint=this.jpc.endpoints[r],this.jpc.suspendedElement=this.jpc.endpoints[r].element,this.jpc.suspendedElementId=this.jpc.endpoints[r].elementId,this.jpc.suspendedElementType=r===0?qr:ys,this.instance.setHover(this.jpc.suspendedEndpoint,!1),this.floatingEndpoint.referenceEndpoint=this.jpc.suspendedEndpoint,this.floatingEndpoint.mergeParameters(this.jpc.suspendedEndpoint.parameters),this.jpc.endpoints[r]=this.floatingEndpoint,this.jpc.addClass(this.instance.draggingClass),this.floatingId=this.placeholderInfo.id,this.floatingIndex=r,this.instance._refreshEndpoint(this.ep)}},{key:"_shouldStartDrag",value:function(){var r=!0;this.ep.enabled||(r=!1),this.jpc==null&&!this.ep.isSource&&!this.ep.isTemporarySource&&(r=!1),this.ep.isSource&&this.ep.isFull()&&!(this.jpc!=null&&this.ep.dragAllowedWhenFull)&&(r=!1),this.jpc!=null&&!this.jpc.isDetachable(this.ep)&&(this.ep.isFull()?r=!1:this.jpc=null);var i={},e=this.instance.checkCondition(this.jpc==null?Ol:Al,{endpoint:this.ep,source:this.ep.element,sourceId:this.ep.elementId,connection:this.jpc});return e===!1?r=!1:on(e)==="object"?(i=e,$(i,this.payload||{})):i=this.payload||{},[r,i]}},{key:"_createFloatingEndpoint",value:function(r){var i=this.ep.endpoint;if(this.ep.edgeType!=null){var e=this.instance._deriveEndpointAndAnchorSpec(this.ep.edgeType);i=e.endpoints[1]}this.floatingEndpoint=Fc(this.ep,i,r,this.placeholderInfo.element,this.placeholderInfo.id,this.instance),this.floatingAnchor=this.floatingEndpoint._anchor,this.floatingEndpoint.deleteOnEmpty=!0,this.floatingElement=this.floatingEndpoint.endpoint.canvas,this.floatingId=this.instance.getId(this.floatingElement)}},{key:"_populateTargets",value:function(r,i){var e=this,t=this.jpc&&this.jpc.endpoints[0]===this.ep,n,o=this.instance.getContainer().querySelectorAll([".",sn,"[",Es,this.ep.scope,"]:not(.",Ti,")"].join(""));if(X(o,function(h){if((e.jpc!=null||h!==r)&&h!==e.floatingElement&&(e.jpc!=null||!h.jtk.endpoint.isFull())&&(t&&h.jtk.endpoint.isSource||!t&&h.jtk.endpoint.isTarget)){var d=Qn(h,e.instance),v=Pn(h,e.instance);n={x:d.x,y:d.y,w:v.w,h:v.h},e.endpointDropTargets.push({el:h,targetEl:h,r:n,endpoint:h.jtk.endpoint,def:null}),e.instance.addClass(h,Et)}}),t){var l=Ci(this.instance.sourceSelectors,function(h){return h.isEnabled()&&(h.def.def.scope==null||h.def.def.scope===e.ep.scope)});if(l!=null){var u=this._findTargetZones(l);X(u,function(h){if(h.getAttribute(er)!==nn){var d=h.getAttribute(Ur);if(d!=null&&d!==e.ep.scope)return;var v={r:null,el:h};v.targetEl=st(h,me,e.instance.getContainer(),!0);var p=Qn(v.el,e.instance),m=Pn(v.el,e.instance);v.r={x:p.x,y:p.y,w:m.w,h:m.h},l.def.def.rank!=null&&(v.rank=l.def.def.rank),v.def=l.def,e.endpointDropTargets.push(v),e.instance.addClass(v.targetEl,Et)}})}}else{var c=Xa(this.instance.targetSelectors,function(h){return h.isEnabled()});c.forEach(function(h){var d=e._findTargetZones(h);X(d,function(v){if(v.getAttribute(er)!==nn){var p=v.getAttribute(Ur);if(p!=null&&p!==e.ep.scope)return;var m={r:null,el:v};if(h.def.def.parentSelector!=null&&(m.targetEl=st(v,h.def.def.parentSelector,e.instance.getContainer(),!0)),m.targetEl==null&&(m.targetEl=st(v,me,e.instance.getContainer(),!0)),(h.def.def.allowLoopback===!1||e._activeDefinition&&e._activeDefinition.def.def.allowLoopback===!1)&&m.targetEl===e.ep.element||h.def.def.canAcceptNewConnection!=null&&!h.def.def.canAcceptNewConnection(m.targetEl,i))return;var g=h.def.def.maxConnections;if(g!=null&&g!==-1&&e.instance.select({target:m.targetEl}).length>=g)return;var E=Qn(v,e.instance),x=Pn(v,e.instance);m.r={x:E.x,y:E.y,w:x.w,h:x.h},m.def=h.def,h.def.def.rank!=null&&(m.rank=h.def.def.rank),e.endpointDropTargets.push(m),e.instance.addClass(m.targetEl,Et)}})})}this.endpointDropTargets.sort(function(h,d){if(h.targetEl._isJsPlumbGroup&&!d.targetEl._isJsPlumbGroup)return 1;if(!h.targetEl._isJsPlumbGroup&&d.targetEl._isJsPlumbGroup)return-1;if(h.targetEl._isJsPlumbGroup&&d.targetEl._isJsPlumbGroup){if(e.instance.groupManager.isAncestor(h.targetEl._jsPlumbGroup,d.targetEl._jsPlumbGroup))return-1;if(e.instance.groupManager.isAncestor(d.targetEl._jsPlumbGroup,h.targetEl._jsPlumbGroup))return 1}else if(h.rank!=null&&d.rank!=null){if(h.rank>d.rank)return-1;if(h.rank<d.rank)return 1}else return 0})}},{key:"_findTargetZones",value:function(r){var i;if(r.redrop===Rc){var e=this.instance.targetSelectors.map(function(n){return n.selector});e.push.apply(e,ln(this.instance.sourceSelectors.map(function(n){return n.selector}))),e.push(me),i=e.join(",")}else if(r.redrop===zs)i=r.selector;else if(r.redrop===Nc)i=this.instance.sourceSelectors.map(function(n){return n.selector}).join(",");else if(r.redrop===Gc)i=this.instance.targetSelectors.map(function(n){return n.selector}).join(",");else if(r.redrop===jc){var t=this.instance.targetSelectors.map(function(n){return n.selector});t.push.apply(t,ln(this.instance.sourceSelectors.map(function(n){return n.selector}))),i=t.join(",")}return this.instance.getContainer().querySelectorAll(i)}},{key:"onStart",value:function(r){this.endpointDropTargets.length=0,this.currentDropTarget=null,this._stopped=!1;var i=r.drag.getDragElement();if(this.ep=i.jtk.endpoint,!this.ep)return!1;this.endpointRepresentation=this.ep.endpoint,this.canvasElement=this.endpointRepresentation.canvas,this.jpc=this.ep.connectorSelector();var e=this._shouldStartDrag(),t=lr(e,2),n=t[0],o=t[1];if(n===!1)return this._stopped=!0,!1;this.instance.setHover(this.ep,!1),this.instance.isConnectionBeingDragged=!0,this.jpc&&!this.ep.isFull()&&this.ep.isSource&&(this.jpc=null),this._createFloatingEndpoint(this.canvasElement),this._populateTargets(this.canvasElement,r.e),this.jpc==null?this.startNewConnectionDrag(this.ep.scope,o):this.startExistingConnectionDrag(),this._registerFloatingConnection(this.placeholderInfo,this.jpc),this.instance.currentlyDragging=!0}},{key:"onBeforeStart",value:function(r){this.payload=r.e.payload||{}}},{key:"onDrag",value:function(r){if(this._stopped)return!0;if(this.placeholderInfo.element){var i=Pn(this.floatingElement,this.instance);this.instance.setElementPosition(this.placeholderInfo.element,r.pos.x,r.pos.y);for(var e={x:r.pos.x,y:r.pos.y,w:i.w,h:i.h},t,n,o,l=0;l<this.endpointDropTargets.length;l++)if(js(e,this.endpointDropTargets[l].r)){t=this.endpointDropTargets[l];break}if(t!==this.currentDropTarget&&this.currentDropTarget!=null&&(n=this._getFloatingAnchorIndex(),this.instance.removeClass(this.currentDropTarget.el,xt),this.currentDropTarget.endpoint&&(this.currentDropTarget.endpoint.endpoint.removeClass(this.instance.endpointDropAllowedClass),this.currentDropTarget.endpoint.endpoint.removeClass(this.instance.endpointDropForbiddenClass)),this.floatingAnchor.out()),t!=null&&(this.instance.addClass(t.el,xt),n=this._getFloatingAnchorIndex(),t.endpoint!=null))if(o=t.endpoint.isSource&&n===0||t.endpoint.isTarget&&n!==0||this.jpc.suspendedEndpoint&&t.endpoint.referenceEndpoint&&t.endpoint.referenceEndpoint.id===this.jpc.suspendedEndpoint.id,o){var u=this.instance.checkCondition(al,{sourceEndpoint:this.jpc.endpoints[n],targetEndpoint:t.endpoint.endpoint,connection:this.jpc});u?(t.endpoint.endpoint.addClass(this.instance.endpointDropAllowedClass),t.endpoint.endpoint.removeClass(this.instance.endpointDropForbiddenClass)):(t.endpoint.endpoint.removeClass(this.instance.endpointDropAllowedClass),t.endpoint.endpoint.addClass(this.instance.endpointDropForbiddenClass)),this.floatingAnchor.over(t.endpoint),this.instance._paintConnection(this.jpc)}else t=null;this.currentDropTarget=t}}},{key:"_maybeCleanup",value:function(r){r._mtNew&&r.connections.length===0?this.instance.deleteEndpoint(r):delete r._mtNew}},{key:"_reattachOrDiscard",value:function(r){var i=this.jpc.suspendedEndpoint!=null,e=this._getFloatingAnchorIndex();return i&&this._shouldReattach()?(e===0?(this.jpc.source=this.jpc.suspendedElement,this.jpc.sourceId=this.jpc.suspendedElementId):(this.jpc.target=this.jpc.suspendedElement,this.jpc.targetId=this.jpc.suspendedElementId),this._doForceReattach(e),!0):(this._discard(e,r),!1)}},{key:"onStop",value:function(r){var i=this,e=r.e;this.instance.isConnectionBeingDragged=!1,this.instance.currentlyDragging=!1;var t=il(xt,Et),n=this.instance.getContainer().querySelectorAll(Uc);if(X(n,function(d){i.instance.removeClass(d,t)}),this.jpc&&this.jpc.endpoints!=null){var o=this.jpc.suspendedEndpoint!=null,l=this._getFloatingAnchorIndex(),u=this.jpc.suspendedEndpoint,c;if(this.currentDropTarget!=null)if(c=this._getDropEndpoint(r,this.jpc),c==null)this._reattachOrDiscard(r.e);else if(u&&u.id===c.id)this._doForceReattach(l);else if(!c.enabled)this._reattachOrDiscard(r.e);else if(c.isFull())c.fire(Ts,{endpoint:this,connection:this.jpc,maxConnections:this.instance.defaults.maxConnections},e),this._reattachOrDiscard(r.e);else{l===0?(this.jpc.source=c.element,this.jpc.sourceId=c.elementId):(this.jpc.target=c.element,this.jpc.targetId=c.elementId);var h=!0;o&&this.jpc.suspendedEndpoint.id!==c.id&&(!this.jpc.isDetachAllowed(this.jpc)||!this.jpc.endpoints[l].isDetachAllowed(this.jpc)||!this.jpc.suspendedEndpoint.isDetachAllowed(this.jpc)||!this.instance.checkCondition("beforeDetach",this.jpc))&&(h=!1),h=h&&c.isDropAllowed(this.jpc.sourceId,this.jpc.targetId,this.jpc.scope,this.jpc,c),h?this._drop(c,l,e,h):this._reattachOrDiscard(r.e)}else this._reattachOrDiscard(r.e);this.instance._refreshEndpoint(this.ep),this.ep.removeClass(this.instance.draggingClass),this._cleanupDraggablePlaceholder(),this.jpc.removeClass(this.instance.draggingClass),delete this.jpc.suspendedEndpoint,delete this.jpc.suspendedElement,delete this.jpc.suspendedElementType,delete this.jpc.suspendedElementId,delete this.jpc.suspendedIndex,delete this.floatingId,delete this.floatingIndex,delete this.floatingElement,delete this.floatingEndpoint,delete this.floatingAnchor,delete this.jpc.pending,c!=null&&this._maybeCleanup(c)}}},{key:"_getSourceDefinition",value:function(r){for(var i,e=this.instance.getContainer(),t=0;t<this.instance.sourceSelectors.length;t++)if(i=this.instance.sourceSelectors[t],i.isEnabled()){var n=Bc(r,e,i.selector,this.instance,i.exclude);if(n!==!1)return i}}},{key:"_getDropEndpoint",value:function(r,i){var e;if(this.currentDropTarget.endpoint==null){var t=this.currentDropTarget.def,n=r.e.target||r.e.srcElement;if(t==null)return null;var o=this.currentDropTarget.targetEl,l=Uo(r.e,o,this.instance.currentZoom),u=this.instance._deriveEndpointAndAnchorSpec(i.getType().join(" "),!0),c=u.endpoints?$(r,{endpoint:t.def.endpoint||u.endpoints[1],cssClass:t.def.cssClass||"",source:t.def.source===!0,target:t.def.target===!0}):r,h=this.instance.validAnchorsSpec(u.anchors)?u.anchors:this.instance.areDefaultAnchorsSet()?this.instance.defaults.anchors:null,d=t.def.anchor,v=t.def.anchorPositionFinder?t.def.anchorPositionFinder(o,l,t.def,r.e):null,p=v??d??(h!=null&&h[1]!=null?h[1]:null);p!=null&&(c=$(c,{anchor:p})),t.def.portId!=null&&(c.portId=t.def.portId);var m=t.def.parameterExtractor?t.def.parameterExtractor(this.currentDropTarget.el,n,r.e):{};if(c=pr(c,m),c.element=o,e=this.instance._internal_newEndpoint(c),e._mtNew=!0,e.deleteOnEmpty=!0,t.def.parameters&&e.mergeParameters(t.def.parameters),t.def.extract){var g={};for(var E in t.def.extract){var x=this.currentDropTarget.el.getAttribute(E);x&&(g[t.def.extract[E]]=x)}e.mergeParameters(g)}}else e=this.currentDropTarget.endpoint;return e&&(e.removeClass(this.instance.endpointDropAllowedClass),e.removeClass(this.instance.endpointDropForbiddenClass)),e}},{key:"_doForceReattach",value:function(r){this.floatingEndpoint.detachFromConnection(this.jpc,null,!0),this.jpc.endpoints[r]=this.jpc.suspendedEndpoint,this.instance.setHover(this.jpc,!1),this.jpc._forceDetach=!0,this.jpc.suspendedEndpoint.addConnection(this.jpc),this.instance.sourceOrTargetChanged(this.floatingId,this.jpc.suspendedEndpoint.elementId,this.jpc,this.jpc.suspendedEndpoint.element,r),this.instance.deleteEndpoint(this.floatingEndpoint),this.instance.repaint(this.jpc.source),delete this.jpc._forceDetach}},{key:"_shouldReattach",value:function(){if(this.jpc.isReattach()||this.jpc._forceReattach)return!0;var r=this.jpc.suspendedEndpoint,i=this.jpc.suspendedElementType==qr?1:0,e=this.jpc.endpoints[i];return!us(!0,!1,[[r,an,[this.jpc]],[e,an,[this.jpc]],[this.jpc,an,[this.jpc]],[this.instance,xs,[_s,this.jpc]]])}},{key:"_discard",value:function(r,i){this.jpc.pending?this.instance.fire($l,this.jpc,i):(r===0?(this.jpc.source=this.jpc.suspendedEndpoint.element,this.jpc.sourceId=this.jpc.suspendedEndpoint.elementId):(this.jpc.target=this.jpc.suspendedEndpoint.element,this.jpc.targetId=this.jpc.suspendedEndpoint.elementId),this.jpc.endpoints[r]=this.jpc.suspendedEndpoint),this.floatingEndpoint&&this.floatingEndpoint.detachFromConnection(this.jpc),this.instance.deleteConnection(this.jpc,{originalEvent:i,force:!0})}},{key:"_drop",value:function(r,i,e,t){if(this.jpc.endpoints[i].detachFromConnection(this.jpc),this.jpc.suspendedEndpoint&&this.jpc.suspendedEndpoint.detachFromConnection(this.jpc),this.jpc.endpoints[i]=r,r.addConnection(this.jpc),this.jpc.suspendedEndpoint){var n=this.jpc.suspendedEndpoint.elementId;this.instance.fireMoveEvent({index:i,originalSourceId:i===0?n:this.jpc.sourceId,newSourceId:i===0?r.elementId:this.jpc.sourceId,originalTargetId:i===1?n:this.jpc.targetId,newTargetId:i===1?r.elementId:this.jpc.targetId,originalEndpoint:this.jpc.suspendedEndpoint,connection:this.jpc,newEndpoint:r},e)}if(i===1?this.instance.sourceOrTargetChanged(this.floatingId,this.jpc.targetId,this.jpc,this.jpc.target,1):this.instance.sourceOrTargetChanged(this.floatingId,this.jpc.sourceId,this.jpc,this.jpc.source,0),this.jpc.endpoints[0].finalEndpoint){var o=this.jpc.endpoints[0];o.detachFromConnection(this.jpc),this.jpc.endpoints[0]=this.jpc.endpoints[0].finalEndpoint,this.jpc.endpoints[0].addConnection(this.jpc)}un(t)&&this.jpc.mergeData(t),this._originalAnchorSpec&&(this.jpc.endpoints[0].setAnchor(this._originalAnchorSpec),this._originalAnchorSpec=null),this.instance._finaliseConnection(this.jpc,null,e),this.instance.setHover(this.jpc,!1),this.instance.revalidate(this.jpc.endpoints[0].element)}},{key:"_registerFloatingConnection",value:function(r,i){this.floatingConnections[r.id]=i}},{key:"_getFloatingAnchorIndex",value:function(){return this.floatingIndex==null?1:this.floatingIndex}}]),s}(),Oo=function(s){fe(r,s);var a=de(r);function r(i,e){var t;return H(this,r),t=a.call(this,i,e),t.instance=i,t.dragSelection=e,f(y(t),"selector",[">",vu,me].join(" ")),f(y(t),"doRevalidate",void 0),t.doRevalidate=t._revalidate.bind(y(t)),t}return K(r,[{key:"reset",value:function(){this.drag.off(mr,this.doRevalidate)}},{key:"_revalidate",value:function(e){this.instance.revalidate(e)}},{key:"init",value:function(e){this.drag=e,e.on(mr,this.doRevalidate)}},{key:"useGhostProxy",value:function(e,t){var n=t._jsPlumbParentGroup;return n==null?!1:n.ghost===!0}},{key:"makeGhostProxy",value:function(e){var t=e,n=t.cloneNode(!0);return n._jsPlumbParentGroup=t._jsPlumbParentGroup,n}}]),r}(oi),Bi=function(){function s(a,r){H(this,s),this.instance=a,this.overlay=r,f(this,"htmlElementOverlay",void 0),this.htmlElementOverlay=r}return K(s,null,[{key:"getElement",value:function(r,i,e){if(r.canvas==null){if(e&&i){r.canvas=e(i);var t=r.instance.overlayClass+" "+(r.cssClass?r.cssClass:"");r.instance.addClass(r.canvas,t)}else r.canvas=ps(Ms,{},r.instance.overlayClass+" "+(r.cssClass?r.cssClass:""));r.instance.setAttribute(r.canvas,"jtk-overlay-id",r.id);for(var n in r.attributes)r.instance.setAttribute(r.canvas,n,r.attributes[n]);r.canvas.style.position=Fn,r.instance._appendElement(r.canvas,r.instance.getContainer()),r.instance.getId(r.canvas);var o="translate(-50%, -50%)";r.canvas.style.webkitTransform=o,r.canvas.style.mozTransform=o,r.canvas.style.msTransform=o,r.canvas.style.oTransform=o,r.canvas.style.transform=o,r.isVisible()||(r.canvas.style.display=cn),r.canvas.jtk={overlay:r}}return r.canvas}},{key:"destroy",value:function(r){r.canvas&&r.canvas.parentNode&&r.canvas.parentNode.removeChild(r.canvas),delete r.canvas,delete r.cachedDimensions}},{key:"_getDimensions",value:function(r,i){return(r.cachedDimensions==null||i)&&(r.cachedDimensions={w:1,h:1}),r.cachedDimensions}}]),s}(),$n=function(){function s(){H(this,s),f(this,"_listeners",{}),f(this,"eventsSuspended",!1),f(this,"tick",!1),f(this,"eventsToDieOn",{ready:!0}),f(this,"queue",[])}return K(s,[{key:"fire",value:function(r,i,e){var t=null;if(this.tick)this.queue.unshift(arguments);else{if(this.tick=!0,!this.eventsSuspended&&this._listeners[r]){var n=this._listeners[r].length,o=0,l=!1;if(!this.shouldFireEvent||this.shouldFireEvent(r,i,e))for(;!l&&o<n&&t!==!1;){if(this.eventsToDieOn[r])this._listeners[r][o](i,e);else try{t=this._listeners[r][o](i,e)}catch(u){Oe("jsPlumb: fire failed for event "+r+" : "+(u.message||u))}o++,(this._listeners==null||this._listeners[r]==null)&&(l=!0)}}this.tick=!1,this._drain()}return t}},{key:"_drain",value:function(){var r=this.queue.pop();r&&this.fire.apply(this,r)}},{key:"unbind",value:function(r,i){if(arguments.length===0)this._listeners={};else if(arguments.length===1){if(typeof r=="string")delete this._listeners[r];else if(r.__jsPlumb){var e;for(var t in r.__jsPlumb)e=r.__jsPlumb[t],Ji(this._listeners[e]||[],r)}}else arguments.length===2&&Ji(this._listeners[r]||[],i);return this}},{key:"getListener",value:function(r){return this._listeners[r]||[]}},{key:"isSuspendEvents",value:function(){return this.eventsSuspended}},{key:"setSuspendEvents",value:function(r){this.eventsSuspended=r}},{key:"bind",value:function(r,i,e){var t=this,n=function(u){hs(t._listeners,u,i,e),i.__jsPlumb=i.__jsPlumb||{},i.__jsPlumb[Ae()]=u};if(typeof r=="string")n(r);else if(r.length!=null)for(var o=0;o<r.length;o++)n(r[o]);return this}},{key:"silently",value:function(r){this.setSuspendEvents(!0);try{r()}catch(i){Oe("Cannot execute silent function "+i)}this.setSuspendEvents(!1)}}]),s}();(function(s){fe(r,s);var a=de(r);function r(){return H(this,r),a.apply(this,arguments)}return K(r,[{key:"shouldFireEvent",value:function(e,t,n){return!0}}]),r})($n);function si(s){var a=null;return Ce(s)?a={type:s,options:{}}:a=s,a.options.id=a.options.id||Ae(),a}var Rr=function(s){fe(r,s);var a=de(r);function r(i,e,t){var n;H(this,r),n=a.call(this),n.instance=i,n.component=e,f(y(n),"id",void 0),f(y(n),"type",void 0),f(y(n),"cssClass",void 0),f(y(n),"visible",!0),f(y(n),"location",void 0),f(y(n),"events",void 0),f(y(n),"attributes",void 0),t=t||{},n.id=t.id||Ae(),n.cssClass=t.cssClass||"",n.setLocation(t.location),n.events=t.events||{},n.attributes=t.attributes||{};for(var o in n.events)n.bind(o,n.events[o]);return n}return K(r,[{key:"setLocation",value:function(e){var t=this.location==null?.5:this.location;if(e!=null)try{var n=typeof e=="string"?parseFloat(e):e;isNaN(n)||(t=n)}catch{}this.location=t}},{key:"shouldFireEvent",value:function(e,t,n){return!0}},{key:"setVisible",value:function(e){this.visible=e,this.instance.setOverlayVisible(this,e)}},{key:"isVisible",value:function(){return this.visible}}]),r}($n),Ao={},Bt={get:function(a,r,i,e){var t=Ao[r];if(t)return new t(a,i,e);throw{message:"jsPlumb: unknown overlay type '"+r+"'"}},register:function(a,r){Ao[a]=r}},Ut=function(s){fe(r,s);var a=de(r);function r(i,e,t){var n;return H(this,r),n=a.call(this,i,e,t),n.instance=i,n.component=e,f(y(n),"label",void 0),f(y(n),"labelText",void 0),f(y(n),"type",r.type),f(y(n),"cachedDimensions",void 0),t=t||{label:""},n.setLabel(t.label),n}return K(r,[{key:"getLabel",value:function(){return Nt(this.label)?this.label(this):this.labelText}},{key:"setLabel",value:function(e){this.label=e,this.labelText=null,this.instance.updateLabel(this)}},{key:"getDimensions",value:function(){return{w:1,h:1}}},{key:"updateFrom",value:function(e){e.label!=null&&this.setLabel(e.label),e.location!=null&&(this.setLocation(e.location),this.instance.updateLabel(this))}}]),r}(Rr);f(Ut,"type","Label");function dt(s){return s.type===Ut.type}Bt.register(Ut.type,Ut);function tr(s){return s==null?null:s.split(" ").filter(function(a){return a!=null&&a.length>0})}function Do(s,a,r){for(var i in a)s[i]=r}var Vc="connector",Hc="override",Yc="cssClass",_o="__default",$c="anchor",Xc="anchors",Ln="__label",Wc="jtk-default-label",Zs="overlay",Kc="labelLocation",Io="add",ko="remove";function Zt(s,a){if(s.getDefaultType){var r=s.getTypeDescriptor(),i={},e=s.getDefaultType(),t=$({},e);Do(i,e,_o),s._types.forEach(function(n){if(n!==_o){var o=s.instance.getType(n,r);if(o!=null){var l=new Set([Vc,$c,Xc]);if(o.mergeStrategy===Hc)for(var u in o)l.add(u);t=pr(t,o,[Yc],Wa(l)),Do(i,o,n)}}}),a&&(t=Ya(t,a,"_")),s.applyType(t,i)}}function $r(s,a){var r=s.instance.getType(a,s.getTypeDescriptor());r!=null&&r.cssClass&&s.removeClass(r.cssClass)}function Mo(s){if(s.paintStyle&&s.hoverPaintStyle){var a={};$(a,s.paintStyle),$(a,s.hoverPaintStyle),s.hoverPaintStyle=a}}function zc(s,a){var r={cssClass:a.cssClass,id:Ln,component:s},i=$(r,a);return new Ut(s.instance,s,i)}function Zc(s,a){var r=null;if(Ce(a))r=Bt.get(s.instance,a,s,{});else if(a.type!=null&&a.options!=null){var i=a,e=$({},i.options);r=Bt.get(s.instance,i.type,s,e)}else r=a;return r.id=r.id||Ae(),s.cacheTypeItem(Zs,r,r.id),s.overlays[r.id]=r,r}var Js=function(s){fe(r,s);var a=de(r);function r(i,e){var t;if(H(this,r),t=a.call(this),t.instance=i,f(y(t),"defaultLabelLocation",.5),f(y(t),"overlays",{}),f(y(t),"overlayPositions",{}),f(y(t),"overlayPlacements",{}),f(y(t),"clone",void 0),f(y(t),"deleted",void 0),f(y(t),"segment",void 0),f(y(t),"x",void 0),f(y(t),"y",void 0),f(y(t),"w",void 0),f(y(t),"h",void 0),f(y(t),"id",void 0),f(y(t),"visible",!0),f(y(t),"typeId",void 0),f(y(t),"params",{}),f(y(t),"paintStyle",void 0),f(y(t),"hoverPaintStyle",void 0),f(y(t),"paintStyleInUse",void 0),f(y(t),"_hover",!1),f(y(t),"lastPaintedAt",void 0),f(y(t),"data",void 0),f(y(t),"_defaultType",void 0),f(y(t),"events",void 0),f(y(t),"parameters",void 0),f(y(t),"_types",void 0),f(y(t),"_typeCache",void 0),f(y(t),"cssClass",void 0),f(y(t),"hoverClass",void 0),f(y(t),"beforeDetach",void 0),f(y(t),"beforeDrop",void 0),e=e||{},t.cssClass=e.cssClass||"",t.hoverClass=e.hoverClass||i.defaults.hoverClass,t.beforeDetach=e.beforeDetach,t.beforeDrop=e.beforeDrop,t._types=new Set,t._typeCache={},t.parameters=vr(e.parameters||{}),t.id=e.id||t.getIdPrefix()+new Date().getTime(),t._defaultType={parameters:t.parameters,scope:e.scope||t.instance.defaultScope,overlays:{}},e.events)for(var n in e.events)t.bind(n,e.events[n]);t.clone=function(){var v=Object.create(t.constructor.prototype);return t.constructor.apply(v,[i,e]),v},t.overlays={},t.overlayPositions={};var o=e.overlays||[],l={},u=t.getDefaultOverlayKey();if(u){var c=t.instance.defaults[u];c&&o.push.apply(o,ln(c));for(var h=0;h<o.length;h++){var d=si(o[h]);l[d.options.id]=d}}return t._defaultType.overlays=l,e.label&&(t.getDefaultType().overlays[Ln]={type:Ut.type,options:{label:e.label,location:e.labelLocation||t.defaultLabelLocation,id:Ln,cssClass:Wc}}),t}return K(r,[{key:"isDetachAllowed",value:function(e){var t=!0;if(this.beforeDetach)try{t=this.beforeDetach(e)}catch(n){Oe("jsPlumb: beforeDetach callback failed",n)}return t}},{key:"isDropAllowed",value:function(e,t,n,o,l){var u,c={sourceId:e,targetId:t,scope:n,connection:o,dropEndpoint:l};if(this.beforeDrop)try{u=this.beforeDrop(c)}catch(h){Oe("jsPlumb: beforeDrop callback failed",h)}else u=this.instance.checkCondition(Ds,c);return u}},{key:"getDefaultType",value:function(){return this._defaultType}},{key:"appendToDefaultType",value:function(e){for(var t in e)this._defaultType[t]=e[t]}},{key:"getId",value:function(){return this.id}},{key:"cacheTypeItem",value:function(e,t,n){this._typeCache[n]=this._typeCache[n]||{},this._typeCache[n][e]=t}},{key:"getCachedTypeItem",value:function(e,t){return this._typeCache[t]?this._typeCache[t][e]:null}},{key:"setType",value:function(e,t){this.clearTypes(),(tr(e)||[]).forEach(this._types.add,this._types),Zt(this,t)}},{key:"getType",value:function(){return Array.from(this._types.keys())}},{key:"reapplyTypes",value:function(e){Zt(this,e)}},{key:"hasType",value:function(e){return this._types.has(e)}},{key:"addType",value:function(e,t){var n=tr(e),o=!1;if(n!=null){for(var l=0,u=n.length;l<u;l++)this._types.has(n[l])||(this._types.add(n[l]),o=!0);o&&Zt(this,t)}}},{key:"removeType",value:function(e,t){var n=this,o=tr(e),l=!1,u=function(v){return n._types.has(v)?($r(n,v),n._types.delete(v),!0):!1};if(o!=null){for(var c=0,h=o.length;c<h;c++)l=u(o[c])||l;l&&Zt(this,t)}}},{key:"clearTypes",value:function(e){var t=this;this._types.forEach(function(n){$r(t,n)}),this._types.clear(),Zt(this,e)}},{key:"toggleType",value:function(e,t){var n=tr(e);if(n!=null){for(var o=0,l=n.length;o<l;o++)this._types.has(n[o])?($r(this,n[o]),this._types.delete(n[o])):this._types.add(n[o]);Zt(this,t)}}},{key:"applyType",value:function(e,t){if(this.setPaintStyle(e.paintStyle),this.setHoverPaintStyle(e.hoverPaintStyle),this.mergeParameters(e.parameters),this.paintStyleInUse=this.getPaintStyle(),e.overlays){var n={},o;for(o in e.overlays){var l=this.overlays[e.overlays[o].options.id];if(l)l.updateFrom(e.overlays[o].options),n[e.overlays[o].options.id]=!0,this.instance.reattachOverlay(l,this);else{var u=this.getCachedTypeItem(Zs,e.overlays[o].options.id);u!=null?(this.instance.reattachOverlay(u,this),u.setVisible(!0),u.updateFrom(e.overlays[o].options),this.overlays[u.id]=u):u=this.addOverlay(e.overlays[o]),n[u.id]=!0}}for(o in this.overlays)n[this.overlays[o].id]==null&&this.removeOverlay(this.overlays[o].id,!0)}}},{key:"setPaintStyle",value:function(e){this.paintStyle=e,this.paintStyleInUse=this.paintStyle,Mo(this)}},{key:"getPaintStyle",value:function(){return this.paintStyle}},{key:"setHoverPaintStyle",value:function(e){this.hoverPaintStyle=e,Mo(this)}},{key:"getHoverPaintStyle",value:function(){return this.hoverPaintStyle}},{key:"destroy",value:function(){for(var e in this.overlays)this.instance.destroyOverlay(this.overlays[e]);this.overlays={},this.overlayPositions={},this.unbind(),this.clone=null}},{key:"isHover",value:function(){return this._hover}},{key:"mergeParameters",value:function(e){e!=null&&$(this.parameters,e)}},{key:"setVisible",value:function(e){this.visible=e,e?this.showOverlays():this.hideOverlays()}},{key:"isVisible",value:function(){return this.visible}},{key:"setAbsoluteOverlayPosition",value:function(e,t){this.overlayPositions[e.id]=t}},{key:"getAbsoluteOverlayPosition",value:function(e){return this.overlayPositions?this.overlayPositions[e.id]:null}},{key:"_clazzManip",value:function(e,t){for(var n in this.overlays)e===Io?this.instance.addOverlayClass(this.overlays[n],t):e===ko&&this.instance.removeOverlayClass(this.overlays[n],t)}},{key:"addClass",value:function(e,t){var n=(this.cssClass||"").split(" ");n.push(e),this.cssClass=n.join(" "),this._clazzManip(Io,e)}},{key:"removeClass",value:function(e,t){var n=(this.cssClass||"").split(" ");this.cssClass=n.filter(function(o){return o!==e}).join(" "),this._clazzManip(ko,e)}},{key:"getClass",value:function(){return this.cssClass}},{key:"shouldFireEvent",value:function(e,t,n){return!0}},{key:"getData",value:function(){return this.data}},{key:"setData",value:function(e){this.data=e||{}}},{key:"mergeData",value:function(e){this.data=$(this.data,e)}},{key:"addOverlay",value:function(e){var t=Zc(this,e);if(this.getData&&t.type===Ut.type&&!Ce(e)){var n=this.getData(),o=e.options;if(n){var l=o.labelLocationAttribute||Kc,u=n[l];u&&(t.location=u)}}return t}},{key:"getOverlay",value:function(e){return this.overlays[e]}},{key:"getOverlays",value:function(){return this.overlays}},{key:"hideOverlay",value:function(e){var t=this.getOverlay(e);t&&t.setVisible(!1)}},{key:"hideOverlays",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];t=t||[];for(var o in this.overlays)(t.length===0||t.indexOf(o)!==-1)&&this.overlays[o].setVisible(!1)}},{key:"showOverlay",value:function(e){var t=this.getOverlay(e);t&&t.setVisible(!0)}},{key:"showOverlays",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];t=t||[];for(var o in this.overlays)(t.length===0||t.indexOf(o)!==-1)&&this.overlays[o].setVisible(!0)}},{key:"removeAllOverlays",value:function(){for(var e in this.overlays)this.instance.destroyOverlay(this.overlays[e]);this.overlays={},this.overlayPositions=null,this.overlayPlacements={}}},{key:"removeOverlay",value:function(e,t){var n=this.overlays[e];n&&(n.setVisible(!1),t||this.instance.destroyOverlay(n),delete this.overlays[e],this.overlayPositions&&delete this.overlayPositions[e],this.overlayPlacements&&delete this.overlayPlacements[e])}},{key:"removeOverlays",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(var o=0,l=t.length;o<l;o++)this.removeOverlay(arguments[o])}},{key:"getLabel",value:function(){var e=this.getLabelOverlay();return e!=null?e.getLabel():null}},{key:"getLabelOverlay",value:function(){return this.getOverlay(Ln)}},{key:"setLabel",value:function(e){var t=this.getLabelOverlay();if(t)if(Ce(e)||Nt(e))t.setLabel(e);else{var o=e;o.label&&t.setLabel(o.label),o.location&&(t.location=o.location)}else{var n=Ce(e)||Nt(e)?{label:e}:e;t=zc(this,n),this.overlays[Ln]=t}}}]),r}($n),Jc=["connectorStyle","connectorHoverStyle","connectorOverlays","connector","connectionType","connectorClass","connectorHoverClass"],rn=function(s){fe(r,s);var a=de(r);function r(i,e){var t;H(this,r),t=a.call(this,i,e),t.instance=i,f(y(t),"connections",[]),f(y(t),"endpoint",void 0),f(y(t),"element",void 0),f(y(t),"elementId",void 0),f(y(t),"dragAllowedWhenFull",!0),f(y(t),"timestamp",void 0),f(y(t),"portId",void 0),f(y(t),"maxConnections",void 0),f(y(t),"proxiedBy",void 0),f(y(t),"connectorClass",void 0),f(y(t),"connectorHoverClass",void 0),f(y(t),"finalEndpoint",void 0),f(y(t),"enabled",!0),f(y(t),"isSource",void 0),f(y(t),"isTarget",void 0),f(y(t),"isTemporarySource",void 0),f(y(t),"connectionCost",1),f(y(t),"connectionsDirected",void 0),f(y(t),"connectionsDetachable",void 0),f(y(t),"reattachConnections",void 0),f(y(t),"currentAnchorClass",void 0),f(y(t),"referenceEndpoint",void 0),f(y(t),"edgeType",void 0),f(y(t),"connector",void 0),f(y(t),"connectorOverlays",void 0),f(y(t),"connectorStyle",void 0),f(y(t),"connectorHoverStyle",void 0),f(y(t),"deleteOnEmpty",void 0),f(y(t),"uuid",void 0),f(y(t),"scope",void 0),f(y(t),"_anchor",void 0),f(y(t),"defaultLabelLocation",[.5,.5]),t.appendToDefaultType({edgeType:e.edgeType,maxConnections:e.maxConnections==null?t.instance.defaults.maxConnections:e.maxConnections,paintStyle:e.paintStyle||t.instance.defaults.endpointStyle,hoverPaintStyle:e.hoverPaintStyle||t.instance.defaults.endpointHoverStyle,connectorStyle:e.connectorStyle,connectorHoverStyle:e.connectorHoverStyle,connectorClass:e.connectorClass,connectorHoverClass:e.connectorHoverClass,connectorOverlays:e.connectorOverlays,connector:e.connector}),t.enabled=e.enabled!==!1,t.visible=!0,t.element=e.element,t.uuid=e.uuid,t.portId=e.portId,t.elementId=e.elementId,t.connectionCost=e.connectionCost==null?1:e.connectionCost,t.connectionsDirected=e.connectionsDirected,t.currentAnchorClass="",t.events={},t.connectorOverlays=e.connectorOverlays,t.connectorStyle=e.connectorStyle,t.connectorHoverStyle=e.connectorHoverStyle,t.connector=e.connector,t.edgeType=e.edgeType,t.connectorClass=e.connectorClass,t.connectorHoverClass=e.connectorHoverClass,t.deleteOnEmpty=e.deleteOnEmpty===!0,t.isSource=e.source||!1,t.isTemporarySource=e.isTemporarySource||!1,t.isTarget=e.target||!1,t.connections=e.connections||[],t.scope=e.scope||i.defaultScope,t.timestamp=null,t.reattachConnections=e.reattachConnections||i.defaults.reattachConnections,t.connectionsDetachable=i.defaults.connectionsDetachable,e.connectionsDetachable===!1&&(t.connectionsDetachable=!1),t.dragAllowedWhenFull=e.dragAllowedWhenFull!==!1,e.onMaxConnections&&t.bind(Ts,e.onMaxConnections);var n=e.endpoint||e.existingEndpoint||i.defaults.endpoint;if(t.setEndpoint(n),e.preparedAnchor!=null)t.setPreparedAnchor(e.preparedAnchor);else{var o=e.anchor?e.anchor:e.anchors?e.anchors:i.defaults.anchor||tt.Top;t.setAnchor(o)}var l=[xr,e.type||""].join(" ");return t.addType(l,e.data),t}return K(r,[{key:"getIdPrefix",value:function(){return"_jsplumb_e"}},{key:"getTypeDescriptor",value:function(){return"endpoint"}},{key:"getXY",value:function(){return{x:this.endpoint.x,y:this.endpoint.y}}},{key:"getDefaultOverlayKey",value:function(){return"endpointOverlays"}},{key:"_updateAnchorClass",value:function(){var e=this._anchor&&this._anchor.cssClass;if(e!=null&&e.length>0){var t=this.instance.endpointAnchorClassPrefix+"-"+this.currentAnchorClass;this.currentAnchorClass=e;var n=this.instance.endpointAnchorClassPrefix+(this.currentAnchorClass?"-"+this.currentAnchorClass:"");t!==n&&(this.removeClass(t),this.addClass(n),this.instance.removeClass(this.element,t),this.instance.addClass(this.element,n))}}},{key:"setPreparedAnchor",value:function(e){return this.instance.router.setAnchor(this,e),this._updateAnchorClass(),this}},{key:"_anchorLocationChanged",value:function(e){this.fire(pl,{endpoint:this,anchor:e}),this._updateAnchorClass()}},{key:"setAnchor",value:function(e){var t=this.instance.router.prepareAnchor(e);return this.setPreparedAnchor(t),this}},{key:"addConnection",value:function(e){this.connections.push(e),this.instance._refreshEndpoint(this)}},{key:"detachFromConnection",value:function(e,t,n){t=t??this.connections.indexOf(e),t>=0&&(this.connections.splice(t,1),this.instance._refreshEndpoint(this)),!n&&this.deleteOnEmpty&&this.connections.length===0&&this.instance.deleteEndpoint(this)}},{key:"deleteEveryConnection",value:function(e){for(var t=this.connections.length,n=0;n<t;n++)this.instance.deleteConnection(this.connections[0],e)}},{key:"detachFrom",value:function(e){for(var t=[],n=0;n<this.connections.length;n++)(this.connections[n].endpoints[1]===e||this.connections[n].endpoints[0]===e)&&t.push(this.connections[n]);for(var o=0,l=t.length;o<l;o++)this.instance.deleteConnection(t[0]);return this}},{key:"setVisible",value:function(e,t,n){if(xe(Ee(r.prototype),"setVisible",this).call(this,e),this.endpoint.setVisible(e),e?this.showOverlays():this.hideOverlays(),!t){for(var o=0;o<this.connections.length;o++)if(this.connections[o].setVisible(e),!n){var l=this===this.connections[o].endpoints[0]?1:0;this.connections[o].endpoints[l].connections.length===1&&this.connections[o].endpoints[l].setVisible(e,!0,!0)}}}},{key:"applyType",value:function(e,t){xe(Ee(r.prototype),"applyType",this).call(this,e,t),this.setPaintStyle(e.endpointStyle||e.paintStyle),this.setHoverPaintStyle(e.endpointHoverStyle||e.hoverPaintStyle),this.connectorStyle=e.connectorStyle,this.connectorHoverStyle=e.connectorHoverStyle,this.connector=e.connector,this.connectorOverlays=e.connectorOverlays,this.edgeType=e.edgeType,e.maxConnections!=null&&(this.maxConnections=e.maxConnections),e.scope&&(this.scope=e.scope),$(e,Jc),this.instance.applyEndpointType(this,e)}},{key:"destroy",value:function(){xe(Ee(r.prototype),"destroy",this).call(this),this.deleted=!0,this.endpoint!=null&&this.instance.destroyEndpoint(this)}},{key:"isFull",value:function(){return this.maxConnections===0?!0:!(this.isFloating()||this.maxConnections<0||this.connections.length<this.maxConnections)}},{key:"isFloating",value:function(){return this.instance.router.isFloating(this)}},{key:"isConnectedTo",value:function(e){var t=!1;if(e){for(var n=0;n<this.connections.length;n++)if(this.connections[n].endpoints[1]===e||this.connections[n].endpoints[0]===e){t=!0;break}}return t}},{key:"setDragAllowedWhenFull",value:function(e){this.dragAllowedWhenFull=e}},{key:"getUuid",value:function(){return this.uuid}},{key:"connectorSelector",value:function(){return this.connections[0]}},{key:"prepareEndpoint",value:function(e,t){var n={cssClass:this.cssClass,endpoint:this},o;if(ds(e,pn)){var l=e;o=Ct.clone(l),o.classes=n.cssClass.split(" ")}else if(Ce(e))o=Ct.get(this,e,n);else{var u=e;$(n,u.options||{}),o=Ct.get(this,u.type,n)}return o.typeId=t,o}},{key:"setEndpoint",value:function(e){var t=this.prepareEndpoint(e);this.setPreparedEndpoint(t)}},{key:"setPreparedEndpoint",value:function(e){this.endpoint!=null&&this.instance.destroyEndpoint(this),this.endpoint=e}},{key:"addClass",value:function(e,t){xe(Ee(r.prototype),"addClass",this).call(this,e,t),this.endpoint!=null&&this.endpoint.addClass(e)}},{key:"removeClass",value:function(e,t){xe(Ee(r.prototype),"removeClass",this).call(this,e,t),this.endpoint!=null&&this.endpoint.removeClass(e)}}]),r}(Js),nr="anchors",Xr="connector";function Lo(s,a,r,i,e,t,n){var o;if(a)s.endpoints[r]=a,a.addConnection(s);else{var l=n||s.endpointSpec||s.endpointsSpec[r]||s.instance.defaults.endpoints[r]||s.instance.defaults.endpoint,u=s.endpointStyles[r]||s.endpointStyle||s.instance.defaults.endpointStyles[r]||s.instance.defaults.endpointStyle;u.fill==null&&s.paintStyle!=null&&(u.fill=s.paintStyle.stroke),u.outlineStroke==null&&s.paintStyle!=null&&(u.outlineStroke=s.paintStyle.outlineStroke),u.outlineWidth==null&&s.paintStyle!=null&&(u.outlineWidth=s.paintStyle.outlineWidth);var c=s.endpointHoverStyles[r]||s.endpointHoverStyle||s.endpointHoverStyle||s.instance.defaults.endpointHoverStyles[r]||s.instance.defaults.endpointHoverStyle;s.hoverPaintStyle!=null&&(c==null&&(c={}),c.fill==null&&(c.fill=s.hoverPaintStyle.stroke));var h=s.uuids?s.uuids[r]:null;i=i??(s.instance.defaults.anchors!=null?s.instance.defaults.anchors[r]:s.instance.defaults.anchor),o=s.instance._internal_newEndpoint({paintStyle:u,hoverPaintStyle:c,endpoint:l,connections:[s],uuid:h,element:e,scope:s.scope,anchor:i,reattachConnections:s.reattach||s.instance.defaults.reattachConnections,connectionsDetachable:s.detachable||s.instance.defaults.connectionsDetachable}),s.instance._refreshEndpoint(o),a==null&&(o.deleteOnEmpty=!0),s.endpoints[r]=o}return o}var Vn=function(s){fe(r,s);var a=de(r);function r(i,e){var t;H(this,r),t=a.call(this,i,e),t.instance=i,f(y(t),"connector",void 0),f(y(t),"defaultLabelLocation",.5),f(y(t),"scope",void 0),f(y(t),"typeId","_jsplumb_connection"),f(y(t),"previousConnection",void 0),f(y(t),"sourceId",void 0),f(y(t),"targetId",void 0),f(y(t),"source",void 0),f(y(t),"target",void 0),f(y(t),"detachable",!0),f(y(t),"reattach",!1),f(y(t),"uuids",void 0),f(y(t),"cost",1),f(y(t),"directed",void 0),f(y(t),"endpoints",[null,null]),f(y(t),"endpointStyles",void 0),f(y(t),"endpointSpec",void 0),f(y(t),"endpointsSpec",void 0),f(y(t),"endpointStyle",{}),f(y(t),"endpointHoverStyle",{}),f(y(t),"endpointHoverStyles",void 0),f(y(t),"suspendedEndpoint",void 0),f(y(t),"suspendedIndex",void 0),f(y(t),"suspendedElement",void 0),f(y(t),"suspendedElementId",void 0),f(y(t),"suspendedElementType",void 0),f(y(t),"_forceReattach",void 0),f(y(t),"_forceDetach",void 0),f(y(t),"proxies",[]),f(y(t),"pending",!1),t.id=e.id,t.previousConnection=e.previousConnection,t.source=e.source,t.target=e.target,e.sourceEndpoint?(t.source=e.sourceEndpoint.element,t.sourceId=e.sourceEndpoint.elementId):t.sourceId=i.getId(t.source),e.targetEndpoint?(t.target=e.targetEndpoint.element,t.targetId=e.targetEndpoint.elementId):t.targetId=i.getId(t.target),t.scope=e.scope;var n=e.anchors?e.anchors[0]:e.anchor,o=e.anchors?e.anchors[1]:e.anchor;i.manage(t.source),i.manage(t.target),t.visible=!0,t.params={cssClass:e.cssClass,hoverClass:e.hoverClass,"pointer-events":e["pointer-events"],overlays:e.overlays},t.lastPaintedAt=null,e.type&&(e.endpoints=e.endpoints||t.instance._deriveEndpointAndAnchorSpec(e.type).endpoints),t.endpointSpec=e.endpoint,t.endpointsSpec=e.endpoints||[null,null],t.endpointStyle=e.endpointStyle,t.endpointHoverStyle=e.endpointHoverStyle,t.endpointStyles=e.endpointStyles||[null,null],t.endpointHoverStyles=e.endpointHoverStyles||[null,null],t.paintStyle=e.paintStyle,t.hoverPaintStyle=e.hoverPaintStyle,t.uuids=e.uuids,t.makeEndpoint(!0,t.source,t.sourceId,n,e.sourceEndpoint),t.makeEndpoint(!1,t.target,t.targetId,o,e.targetEndpoint),t.scope||(t.scope=t.endpoints[0].scope),e.deleteEndpointsOnEmpty!=null&&(t.endpoints[0].deleteOnEmpty=e.deleteEndpointsOnEmpty,t.endpoints[1].deleteOnEmpty=e.deleteEndpointsOnEmpty);var l=t.instance.defaults.connectionsDetachable;e.detachable===!1&&(l=!1),t.endpoints[0].connectionsDetachable===!1&&(l=!1),t.endpoints[1].connectionsDetachable===!1&&(l=!1),t.endpointsSpec=e.endpoints||[null,null],t.endpointSpec=e.endpoint||null;var u=e.reattach||t.endpoints[0].reattachConnections||t.endpoints[1].reattachConnections||t.instance.defaults.reattachConnections,c=$({},t.endpoints[0].connectorStyle||t.endpoints[1].connectorStyle||e.paintStyle||t.instance.defaults.paintStyle);if(t.appendToDefaultType({detachable:l,reattach:u,paintStyle:c,hoverPaintStyle:$({},t.endpoints[0].connectorHoverStyle||t.endpoints[1].connectorHoverStyle||e.hoverPaintStyle||t.instance.defaults.hoverPaintStyle)}),e.outlineWidth&&(c.outlineWidth=e.outlineWidth),e.outlineColor&&(c.outlineStroke=e.outlineColor),e.lineWidth&&(c.strokeWidth=e.lineWidth),e.color&&(c.stroke=e.color),!t.instance._suspendDrawing){var h=t.instance._suspendedAt||Ae();t.instance._paintEndpoint(t.endpoints[0],{timestamp:h}),t.instance._paintEndpoint(t.endpoints[1],{timestamp:h})}t.cost=e.cost||t.endpoints[0].connectionCost,t.directed=e.directed,e.directed==null&&(t.directed=t.endpoints[0].connectionsDirected);var d=$({},t.endpoints[1].parameters);$(d,t.endpoints[0].parameters),$(d,t.parameters),t.parameters=d,t.paintStyleInUse=t.getPaintStyle()||{},t._setConnector(t.endpoints[0].connector||t.endpoints[1].connector||e.connector||t.instance.defaults.connector,!0);var v=e.data==null||!un(e.data)?{}:e.data;t.setData(v);var p=[xr,t.endpoints[0].edgeType,t.endpoints[1].edgeType,e.type].join(" ");return/[^\s]/.test(p)&&t.addType(p,e.data),t}return K(r,[{key:"getIdPrefix",value:function(){return"_jsPlumb_c"}},{key:"getDefaultOverlayKey",value:function(){return Ml}},{key:"getXY",value:function(){return{x:this.connector.x,y:this.connector.y}}},{key:"makeEndpoint",value:function(e,t,n,o,l){return n=n||this.instance.getId(t),Lo(this,l,e?0:1,o,t)}},{key:"getTypeDescriptor",value:function(){return r.type}},{key:"isDetachable",value:function(e){return this.detachable===!1?!1:e!=null?e.connectionsDetachable===!0:this.detachable===!0}},{key:"setDetachable",value:function(e){this.detachable=e===!0}},{key:"isReattach",value:function(){return this.reattach===!0||this.endpoints[0].reattachConnections===!0||this.endpoints[1].reattachConnections===!0}},{key:"setReattach",value:function(e){this.reattach=e===!0}},{key:"applyType",value:function(e,t){var n=null;e.connector!=null&&(n=this.getCachedTypeItem(Xr,t.connector),n==null&&(n=this.prepareConnector(e.connector,t.connector),this.cacheTypeItem(Xr,n,t.connector)),this.setPreparedConnector(n)),xe(Ee(r.prototype),"applyType",this).call(this,e,t),e.detachable!=null&&this.setDetachable(e.detachable),e.reattach!=null&&this.setReattach(e.reattach),e.scope&&(this.scope=e.scope);var o=null;e.anchor?(o=this.getCachedTypeItem(nr,t.anchor),o==null&&(o=[Mn(e.anchor),Mn(e.anchor)],this.cacheTypeItem(nr,o,t.anchor))):e.anchors&&(o=this.getCachedTypeItem(nr,t.anchors),o==null&&(o=[Mn(e.anchors[0]),Mn(e.anchors[1])],this.cacheTypeItem(nr,o,t.anchors))),o!=null&&(this.instance.router.setConnectionAnchors(this,o),this.instance.router.isDynamicAnchor(this.endpoints[1])&&this.instance.repaint(this.endpoints[1].element)),this.instance.applyConnectorType(this.connector,e)}},{key:"addClass",value:function(e,t){xe(Ee(r.prototype),"addClass",this).call(this,e),t&&(this.endpoints[0].addClass(e),this.endpoints[1].addClass(e),this.suspendedEndpoint&&this.suspendedEndpoint.addClass(e)),this.connector&&this.instance.addConnectorClass(this.connector,e)}},{key:"removeClass",value:function(e,t){xe(Ee(r.prototype),"removeClass",this).call(this,e),t&&(this.endpoints[0].removeClass(e),this.endpoints[1].removeClass(e),this.suspendedEndpoint&&this.suspendedEndpoint.removeClass(e)),this.connector&&this.instance.removeConnectorClass(this.connector,e)}},{key:"setVisible",value:function(e){xe(Ee(r.prototype),"setVisible",this).call(this,e),this.connector&&this.instance.setConnectorVisible(this.connector,e),this.instance._paintConnection(this)}},{key:"destroy",value:function(){xe(Ee(r.prototype),"destroy",this).call(this),this.endpoints=null,this.endpointStyles=null,this.source=null,this.target=null,this.instance.destroyConnector(this),this.connector=null,this.deleted=!0}},{key:"getUuids",value:function(){return[this.endpoints[0].getUuid(),this.endpoints[1].getUuid()]}},{key:"prepareConnector",value:function(e,t){var n={cssClass:this.params.cssClass,hoverClass:this.params.hoverClass,"pointer-events":this.params["pointer-events"]},o;if(Ce(e))o=this.instance._makeConnector(this,e,n);else{var l=e;o=this.instance._makeConnector(this,l.type,pr(l.options||{},n))}return t!=null&&(o.typeId=t),o}},{key:"setPreparedConnector",value:function(e,t,n,o){if(this.connector!==e){var l,u="";if(this.connector!=null&&(l=this.connector,u=this.instance.getConnectorClass(this.connector),this.instance.destroyConnector(this)),this.connector=e,o&&this.cacheTypeItem(Xr,e,o),this.addClass(u),l!=null){var c=this.getOverlays();for(var h in c)this.instance.reattachOverlay(c[h],this)}t||this.instance._paintConnection(this)}}},{key:"_setConnector",value:function(e,t,n,o){var l=this.prepareConnector(e,o);this.setPreparedConnector(l,t,n,o)}},{key:"replaceEndpoint",value:function(e,t){var n=this.endpoints[e],o=n.elementId,l=this.instance.getEndpoints(n.element),u=l.indexOf(n),c=Lo(this,null,e,null,n.element,o,t);this.endpoints[e]=c,l.splice(u,1,c),n.detachFromConnection(this),this.instance.deleteEndpoint(n),this.instance.fire(yl,{previous:n,current:c})}}]),r}(Js);f(Vn,"type","connection");function wn(s){if(s.path==null){var a=$({"jtk-overlay-id":s.id},s.attributes);s.path=ct(ti,a);var r=s.instance.overlayClass+" "+(s.cssClass?s.cssClass:"");s.instance.addClass(s.path,r),s.path.jtk={overlay:s}}var i=s.path.parentNode;if(i==null){if(s.component instanceof Vn){var e=s.component.connector;i=e!=null?e.canvas:null}else if(s.component instanceof rn){var t=s.component.endpoint;i=t!=null?t.canvas:t}i!=null&&cr(i,s.path,1)}return s.path}function Qc(s,a,r,i){wn(s);var e=[0,0];i.xmin<0&&(e[0]=-i.xmin),i.ymin<0&&(e[1]=-i.ymin);var t={d:a,stroke:r.stroke?r.stroke:null,fill:r.fill?r.fill:null,transform:"translate("+e[0]+","+e[1]+")","pointer-events":"visibleStroke"};ut(s.path,t)}function qc(s,a){var r=s;r.path!=null&&r.path.parentNode!=null&&r.path.parentNode.removeChild(r.path),r.bgPath!=null&&r.bgPath.parentNode!=null&&r.bgPath.parentNode.removeChild(r.bgPath),delete r.path,delete r.bgPath}(function(s){fe(r,s);var a=de(r);function r(){var i;H(this,r);for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return i=a.call.apply(a,[this].concat(t)),f(y(i),"path",void 0),i}return r})(Rr);var Qs=function(){function s(){H(this,s)}return K(s,null,[{key:"paint",value:function(r,i,e,t){if(e!=null){var n=[r.x,r.y],o=[r.w,r.h];if(t!=null&&(t.xmin<0&&(n[0]+=t.xmin),t.ymin<0&&(n[1]+=t.ymin),o[0]=t.xmax+(t.xmin<0?-t.xmin:0),o[1]=t.ymax+(t.ymin<0?-t.ymin:0)),isFinite(o[0])&&isFinite(o[1])){var l={width:""+(o[0]||0),height:""+(o[1]||0)};i.containerType===jt.HTML?ut(r.canvas,$(l,{style:ks([n[0],n[1]])})):ut(r.canvas,$(l,{x:n[0],y:n[1]}))}}}}]),s}();function eh(s,a,r,i){th(s,a),Qs.paint(a,s,r,i);var e="",t=[0,0];if(i.xmin<0&&(t[0]=-i.xmin),i.ymin<0&&(t[1]=-i.ymin),a.segments.length>0){e=s.getPathData(a);var n={d:e,transform:"translate("+t[0]+","+t[1]+")","pointer-events":"visibleStroke"},o=null;if(r.outlineStroke){var l=r.outlineWidth||1,u=r.strokeWidth+2*l;o=$({},r),o.stroke=r.outlineStroke,o.strokeWidth=u,a.bgPath==null?(a.bgPath=ct(ti,n),s.addClass(a.bgPath,s.connectorOutlineClass),cr(a.canvas,a.bgPath,0)):ut(a.bgPath,n),ni(a.canvas,a.bgPath,o)}var c=a;c.path==null?(c.path=ct(ti,n),cr(c.canvas,c.path,r.outlineStroke?1:0)):(c.path.parentNode!==c.canvas&&cr(c.canvas,c.path,r.outlineStroke?1:0),ut(a.path,n)),ni(a.canvas,a.path,r)}}function th(s,a){if(a.canvas!=null)return a.canvas;var r=ct(Is,{style:"",width:"0",height:"0","pointer-events":cn,position:Fn});return a.canvas=r,s._appendElement(a.canvas,s.getContainer()),a.cssClass!=null&&s.addClass(r,a.cssClass),s.addClass(r,s.connectorClass),r.jtk=r.jtk||{},r.jtk.connector=a,r}var nh=function(){function s(){H(this,s)}return K(s,null,[{key:"getEndpointElement",value:function(r){if(r.canvas!=null)return r.canvas;var i=ct(Is,{style:"",width:"0",height:"0","pointer-events":"all",position:Fn});r.canvas=i;var e=r.classes.join(" ");r.instance.addClass(i,e);for(var t=r.endpoint.scope.split(/\s/),n=0;n<t.length;n++)r.instance.setAttribute(i,Es+t[n],ws);return r.instance._appendElementToContainer(i),r.cssClass!=null&&r.instance.addClass(i,r.cssClass),r.instance.addClass(i,r.instance.endpointClass),i.jtk=i.jtk||{},i.jtk.endpoint=r.endpoint,i.style.display=r.endpoint.visible!==!1?ei:cn,i}},{key:"paint",value:function(r,i,e){if(r.endpoint.deleted!==!0){this.getEndpointElement(r),Qs.paint(r,r.instance,e);var t=$({},e);t.outlineStroke&&(t.stroke=t.outlineStroke),r.node==null?(r.node=i.makeNode(r,t),r.canvas.appendChild(r.node)):i.updateNode!=null&&i.updateNode(r,r.node),ni(r.canvas,r.node,t)}}}]),s}(),Nr=function(){function s(a,r){H(this,s),this.connection=a,f(this,"type",void 0),f(this,"edited",!1),f(this,"stub",void 0),f(this,"sourceStub",void 0),f(this,"targetStub",void 0),f(this,"maxStub",void 0),f(this,"typeId",void 0),f(this,"gap",void 0),f(this,"sourceGap",void 0),f(this,"targetGap",void 0),f(this,"segments",[]),f(this,"totalLength",0),f(this,"segmentProportions",[]),f(this,"segmentProportionalLengths",[]),f(this,"paintInfo",null),f(this,"strokeWidth",void 0),f(this,"x",void 0),f(this,"y",void 0),f(this,"w",void 0),f(this,"h",void 0),f(this,"segment",void 0),f(this,"bounds",Er()),f(this,"cssClass",void 0),f(this,"hoverClass",void 0),f(this,"geometry",void 0),this.stub=r.stub||this.getDefaultStubs(),this.sourceStub=Array.isArray(this.stub)?this.stub[0]:this.stub,this.targetStub=Array.isArray(this.stub)?this.stub[1]:this.stub,this.gap=r.gap||0,this.sourceGap=Array.isArray(this.gap)?this.gap[0]:this.gap,this.targetGap=Array.isArray(this.gap)?this.gap[1]:this.gap,this.maxStub=Math.max(this.sourceStub,this.targetStub),this.cssClass=r.cssClass||"",this.hoverClass=r.hoverClass||""}return K(s,[{key:"getTypeDescriptor",value:function(){return"connector"}},{key:"getIdPrefix",value:function(){return"_jsplumb_connector"}},{key:"setGeometry",value:function(r,i){this.geometry=r,this.edited=r!=null&&!i}},{key:"exportGeometry",value:function(){return this.geometry}},{key:"importGeometry",value:function(r){return this.geometry=r,!0}},{key:"resetGeometry",value:function(){this.geometry=null,this.edited=!1}},{key:"transformAnchorPlacement",value:function(r,i,e){return{x:r.x,y:r.y,ox:r.ox,oy:r.oy,curX:r.curX+i,curY:r.curY+e}}},{key:"resetBounds",value:function(){this.bounds=Er()}},{key:"findSegmentForPoint",value:function(r,i){for(var e={d:1/0,s:null,x:null,y:null,l:null,x1:null,y1:null,x2:null,y2:null,index:null,connectorLocation:null},t=0;t<this.segments.length;t++){var n=this.segments[t].findClosestPointOnPath(r,i);n.d<e.d&&(e.d=n.d,e.l=n.l,e.x=n.x,e.y=n.y,e.s=this.segments[t],e.x1=n.x1,e.x2=n.x2,e.y1=n.y1,e.y2=n.y2,e.index=t,e.connectorLocation=this.segmentProportions[t][0]+n.l*(this.segmentProportions[t][1]-this.segmentProportions[t][0]))}return e}},{key:"lineIntersection",value:function(r,i,e,t){for(var n=[],o=0;o<this.segments.length;o++)n.push.apply(n,this.segments[o].lineIntersection(r,i,e,t));return n}},{key:"boxIntersection",value:function(r,i,e,t){for(var n=[],o=0;o<this.segments.length;o++)n.push.apply(n,this.segments[o].boxIntersection(r,i,e,t));return n}},{key:"boundingBoxIntersection",value:function(r){for(var i=[],e=0;e<this.segments.length;e++)i.push.apply(i,this.segments[e].boundingBoxIntersection(r));return i}},{key:"_updateSegmentProportions",value:function(){for(var r=0,i=0;i<this.segments.length;i++){var e=this.segments[i].getLength();this.segmentProportionalLengths[i]=e/this.totalLength,this.segmentProportions[i]=[r,r+=e/this.totalLength]}}},{key:"_findSegmentForLocation",value:function(r,i){var e,t,n;if(i&&(r=r>0?r/this.totalLength:(this.totalLength+r)/this.totalLength),r===1)e=this.segments.length-1,n=1;else if(r===0)n=0,e=0;else if(r>=.5){for(e=0,n=0,t=this.segmentProportions.length-1;t>-1;t--)if(this.segmentProportions[t][1]>=r&&this.segmentProportions[t][0]<=r){e=t,n=(r-this.segmentProportions[t][0])/this.segmentProportionalLengths[t];break}}else for(e=this.segmentProportions.length-1,n=1,t=0;t<this.segmentProportions.length;t++)if(this.segmentProportions[t][1]>=r){e=t,n=(r-this.segmentProportions[t][0])/this.segmentProportionalLengths[t];break}return{segment:this.segments[e],proportion:n,index:e}}},{key:"_addSegment",value:function(r,i){if(!(i.x1===i.x2&&i.y1===i.y2)){var e=new r(i);this.segments.push(e),this.totalLength+=e.getLength(),this.updateBounds(e)}}},{key:"_clearSegments",value:function(){this.totalLength=0,this.segments.length=0,this.segmentProportions.length=0,this.segmentProportionalLengths.length=0}},{key:"getLength",value:function(){return this.totalLength}},{key:"_prepareCompute",value:function(r){this.strokeWidth=r.strokeWidth;var i=r.sourcePos.curX,e=r.targetPos.curX,t=r.sourcePos.curY,n=r.targetPos.curY,o=wi({x:i,y:t},{x:e,y:n}),l=e<i,u=n<t,c=[r.sourcePos.ox,r.sourcePos.oy],h=[r.targetPos.ox,r.targetPos.oy],d=l?e:i,v=u?n:t,p=Math.abs(e-i),m=Math.abs(n-t),g=c[0]===0&&c[1]===0,E=h[0]===0&&h[1]===0;if(g||E){var x=p>m?0:1,C=[1,0][x],S=x===0?i:t,b=x===0?e:n;g&&(c[x]=S>b?-1:1,c[C]=0),E&&(h[x]=S>b?1:-1,h[C]=0)}var T=l?p+this.sourceGap*c[0]:this.sourceGap*c[0],D=u?m+this.sourceGap*c[1]:this.sourceGap*c[1],P=l?this.targetGap*h[0]:p+this.targetGap*h[0],_=u?this.targetGap*h[1]:m+this.targetGap*h[1],L=c[0]*h[0]+c[1]*h[1],N={sx:T,sy:D,tx:P,ty:_,xSpan:Math.abs(P-T),ySpan:Math.abs(_-D),mx:(T+P)/2,my:(D+_)/2,so:c,to:h,x:d,y:v,w:p,h:m,segment:o,startStubX:T+c[0]*this.sourceStub,startStubY:D+c[1]*this.sourceStub,endStubX:P+h[0]*this.targetStub,endStubY:_+h[1]*this.targetStub,isXGreaterThanStubTimes2:Math.abs(T-P)>this.sourceStub+this.targetStub,isYGreaterThanStubTimes2:Math.abs(D-_)>this.sourceStub+this.targetStub,opposite:L===-1,perpendicular:L===0,orthogonal:L===1,sourceAxis:c[0]===0?"y":"x",points:[d,v,p,m,T,D,P,_],stubs:[this.sourceStub,this.targetStub]};return N.anchorOrientation=N.opposite?"opposite":N.orthogonal?"orthogonal":"perpendicular",N}},{key:"updateBounds",value:function(r){var i=r.extents;this.bounds.xmin=Math.min(this.bounds.xmin,i.xmin),this.bounds.xmax=Math.max(this.bounds.xmax,i.xmax),this.bounds.ymin=Math.min(this.bounds.ymin,i.ymin),this.bounds.ymax=Math.max(this.bounds.ymax,i.ymax)}},{key:"dumpSegmentsToConsole",value:function(){Oe("SEGMENTS:");for(var r=0;r<this.segments.length;r++)Oe(this.segments[r].type,""+this.segments[r].getLength(),""+this.segmentProportions[r])}},{key:"pointOnPath",value:function(r,i){var e=this._findSegmentForLocation(r,i);return e.segment&&e.segment.pointOnPath(e.proportion,!1)||{x:0,y:0}}},{key:"gradientAtPoint",value:function(r,i){var e=this._findSegmentForLocation(r,i);return e.segment&&e.segment.gradientAtPoint(e.proportion,!1)||0}},{key:"pointAlongPathFrom",value:function(r,i,e){var t=this._findSegmentForLocation(r,e);return t.segment&&t.segment.pointAlongPathFrom(t.proportion,i,!1)||{x:0,y:0}}},{key:"compute",value:function(r){this.paintInfo=this._prepareCompute(r),this._clearSegments(),this._compute(this.paintInfo,r),this.x=this.paintInfo.points[0],this.y=this.paintInfo.points[1],this.w=this.paintInfo.points[2],this.h=this.paintInfo.points[3],this.segment=this.paintInfo.segment,this._updateSegmentProportions()}},{key:"setAnchorOrientation",value:function(r,i){}}]),s}(),rh=20,ih=20,vn=function(s){fe(r,s);var a=de(r);function r(i,e,t){var n;return H(this,r),n=a.call(this,i,e,t),n.instance=i,n.component=e,f(y(n),"width",void 0),f(y(n),"length",void 0),f(y(n),"foldback",void 0),f(y(n),"direction",void 0),f(y(n),"location",.5),f(y(n),"paintStyle",void 0),f(y(n),"type",r.type),f(y(n),"cachedDimensions",void 0),t=t||{},n.width=t.width||rh,n.length=t.length||ih,n.direction=(t.direction||1)<0?-1:1,n.foldback=t.foldback||.623,n.paintStyle=t.paintStyle||{strokeWidth:1},n.location=t.location==null?n.location:Array.isArray(t.location)?t.location[0]:t.location,n}return K(r,[{key:"draw",value:function(e,t,n){if(e instanceof Nr){var o=e,l,u,c,h,d;if(this.location>1||this.location<0){var v=this.location<0?1:0;l=o.pointAlongPathFrom(v,this.location,!1),u=o.pointAlongPathFrom(v,this.location-this.direction*this.length/2,!1),c=Mt(l,u,this.length)}else if(this.location===1){if(l=o.pointOnPath(this.location),u=o.pointAlongPathFrom(this.location,-this.length),c=Mt(l,u,this.length),this.direction===-1){var p=c;c=l,l=p}}else if(this.location===0){if(c=o.pointOnPath(this.location),u=o.pointAlongPathFrom(this.location,this.length),l=Mt(c,u,this.length),this.direction===-1){var m=c;c=l,l=m}}else l=o.pointAlongPathFrom(this.location,this.direction*this.length/2),u=o.pointOnPath(this.location),c=Mt(l,u,this.length);h=ju(l,c,this.width),d=Mt(l,c,this.foldback*this.length);var g={hxy:l,tail:h,cxy:d},E=this.paintStyle.stroke||t.stroke,x=this.paintStyle.fill||t.stroke,C=this.paintStyle.strokeWidth||t.strokeWidth;return{component:e,d:g,"stroke-width":C,stroke:E,fill:x,xmin:Math.min(l.x,h[0].x,h[1].x),xmax:Math.max(l.x,h[0].x,h[1].x),ymin:Math.min(l.y,h[0].y,h[1].y),ymax:Math.max(l.y,h[0].y,h[1].y)}}}},{key:"updateFrom",value:function(e){}}]),r}(Rr);f(vn,"type","Arrow");function ai(s){return s.type===vn.type}Bt.register(vn.type,vn);var Tr=function(s){fe(r,s);var a=de(r);function r(i,e,t){var n;return H(this,r),n=a.call(this,i,e,t),n.instance=i,f(y(n),"type",r.type),n.length=n.length/2,n.foldback=2,n}return r}(vn);f(Tr,"type","Diamond");function li(s){return s.type===Tr.type}Bt.register(Tr.type,Tr);var Ui=function(s){fe(r,s);var a=de(r);function r(i,e,t){var n;return H(this,r),n=a.call(this,i,e,t),n.instance=i,f(y(n),"type",r.type),n.foldback=1,n}return r}(vn);f(Ui,"type","PlainArrow");function ui(s){return s.type===Ui.type}Bt.register("PlainArrow",Ui);var Or=function(s){fe(r,s);var a=de(r);function r(i,e,t){var n;return H(this,r),n=a.call(this,i,e,t),n.instance=i,n.component=e,f(y(n),"create",void 0),f(y(n),"type",r.type),n.create=t.create,n}return K(r,[{key:"updateFrom",value:function(e){}}]),r}(Rr);f(Or,"type","Custom");function vt(s){return s.type===Or.type}Bt.register(Or.type,Or);var oh="allowNestedGroups",Jt="paintStyle",sh="scope",Vt=function(s){fe(r,s);var a=de(r);function r(i,e){var t;return H(this,r),t=a.call(this,i,e),f(y(t),"radius",void 0),f(y(t),"defaultOffset",void 0),f(y(t),"defaultInnerRadius",void 0),f(y(t),"type",r.type),e=e||{},t.radius=e.radius||5,t.defaultOffset=.5*t.radius,t.defaultInnerRadius=t.radius/3,t}return r}(pn);f(Vt,"type","Dot");var ah={type:Vt.type,cls:Vt,compute:function(a,r,i,e){var t=r.curX-a.radius,n=r.curY-a.radius,o=a.radius*2,l=a.radius*2;if(e&&e.stroke){var u=e.strokeWidth||1;t-=u,n-=u,o+=u*2,l+=u*2}return a.x=t,a.y=n,a.w=o,a.h=l,[t,n,o,l,a.radius]},getParams:function(a){return{radius:a.radius}}},Wr=function s(a,r){H(this,s),this.instance=a,this.el=r,f(this,"group",void 0)},lh=function(s){fe(r,s);var a=de(r);function r(i,e,t){var n;H(this,r),n=a.call(this,i,e),n.instance=i,f(y(n),"children",[]),f(y(n),"collapsed",!1),f(y(n),"droppable",void 0),f(y(n),"enabled",void 0),f(y(n),"orphan",void 0),f(y(n),"constrain",void 0),f(y(n),"proxied",void 0),f(y(n),"ghost",void 0),f(y(n),"revert",void 0),f(y(n),"prune",void 0),f(y(n),"dropOverride",void 0),f(y(n),"anchor",void 0),f(y(n),"endpoint",void 0),f(y(n),"connections",{source:[],target:[],internal:[]}),f(y(n),"manager",void 0),f(y(n),"id",void 0),f(y(n),"elId",void 0);var o=n.el;return o._isJsPlumbGroup=!0,o._jsPlumbGroup=y(n),n.elId=i.getId(e),n.orphan=t.orphan===!0,n.revert=n.orphan===!0?!1:t.revert!==!1,n.droppable=t.droppable!==!1,n.ghost=t.ghost===!0,n.enabled=t.enabled!==!1,n.prune=n.orphan!==!0&&t.prune===!0,n.constrain=n.ghost||t.constrain===!0,n.proxied=t.proxied!==!1,n.id=t.id||Ae(),n.dropOverride=t.dropOverride===!0,n.anchor=t.anchor,n.endpoint=t.endpoint,n.anchor=t.anchor,i.setAttribute(e,ms,""),n}return K(r,[{key:"contentArea",get:function(){return this.instance.getGroupContentArea(this)}},{key:"overrideDrop",value:function(e,t){return this.dropOverride&&(this.revert||this.prune||this.orphan)}},{key:"getAnchor",value:function(e,t){return this.anchor||"Continuous"}},{key:"getEndpoint",value:function(e,t){return this.endpoint||{type:Vt.type,options:{radius:10}}}},{key:"add",value:function(e,t){var n=this.instance.getGroupContentArea(this),o=e;if(o._jsPlumbParentGroup!=null){if(o._jsPlumbParentGroup===this)return;o._jsPlumbParentGroup.remove(e,!0,t,!1)}o._jsPlumbParentGroup=this,this.children.push(new Wr(this.instance,e)),this.instance._appendElement(o,n),this.manager._updateConnectionsForGroup(this)}},{key:"resolveNode",value:function(e){return e==null?null:Ci(this.children,function(t){return t.el===e})}},{key:"remove",value:function(e,t,n,o,l){var u=this.resolveNode(e);u!=null&&this._doRemove(u,t,n,o,l)}},{key:"_doRemove",value:function(e,t,n,o,l){var u=e.el;if(delete u._jsPlumbParentGroup,_e(this.children,function(h){return h===e}),t)try{this.instance.getGroupContentArea(this).removeChild(u)}catch(h){Oe("Could not remove element from Group "+h)}if(!n){var c={group:this,el:u};l&&(c.targetGroup=l),this.instance.fire(Sl,c)}o||this.manager._updateConnectionsForGroup(this)}},{key:"removeAll",value:function(e,t){for(var n=0,o=this.children.length;n<o;n++){var l=this.children[0];this._doRemove(l,e,t,!0),this.instance.unmanage(l.el,!0)}this.children.length=0,this.manager._updateConnectionsForGroup(this)}},{key:"orphanAll",value:function(){for(var e={},t=0;t<this.children.length;t++){var n=this.manager.orphan(this.children[t].el,!1);e[n.id]=n.pos}return this.children.length=0,e}},{key:"addGroup",value:function(e){if(this.instance.allowNestedGroups&&e!==this){if(this.instance.groupManager.isAncestor(this,e))return!1;e.group!=null&&e.group.removeGroup(e);var t=this.instance.getId(e.el),n=this.instance.getManagedElements()[t];n.group=this.elId;var o=this.instance.getOffsetRelativeToRoot(e.el),l=this.collapsed?this.instance.getOffsetRelativeToRoot(this.el):this.instance.getOffsetRelativeToRoot(this.instance.getGroupContentArea(this));e.el._jsPlumbParentGroup=this,this.children.push(e),this.instance._appendElementToGroup(this,e.el),e.group=this;var u={x:o.x-l.x,y:o.y-l.y};return this.instance.setPosition(e.el,u),this.instance.fire(Pl,{parent:this,child:e}),!0}else return!1}},{key:"removeGroup",value:function(e){if(e.group===this){var t=e.el,n=this.instance.getGroupContentArea(this);n===t.parentNode&&n.removeChild(e.el);var o=this.instance.getId(e.el),l=this.instance.getManagedElements()[o];l&&delete l.group,this.children=this.children.filter(function(u){return u.id!==e.id}),delete e.group,delete t._jsPlumbParentGroup,this.instance.fire(Tl,{parent:this,child:e})}}},{key:"getGroups",value:function(){return this.children.filter(function(e){return e.constructor===r})}},{key:"getNodes",value:function(){return this.children.filter(function(e){return e.constructor===Wr})}},{key:"collapseParent",get:function(){var e=null;if(this.group==null)return null;for(var t=this.group;t!=null;)t.collapsed&&(e=t),t=t.group;return e}}]),r}(Wr),uh=function(){function s(a){var r=this;H(this,s),this.instance=a,f(this,"groupMap",{}),f(this,"_connectionSourceMap",{}),f(this,"_connectionTargetMap",{}),a.bind(Cs,function(i){var e=r.getGroupFor(i.source),t=r.getGroupFor(i.target);e!=null&&t!=null&&e===t?(r._connectionSourceMap[i.connection.id]=e,r._connectionTargetMap[i.connection.id]=e,Sn(e.connections.internal,i.connection)):(e!=null&&(i.target._jsPlumbGroup===e?Sn(e.connections.internal,i.connection):Sn(e.connections.source,i.connection),r._connectionSourceMap[i.connection.id]=e),t!=null&&(i.source._jsPlumbGroup===t?Sn(t.connections.internal,i.connection):Sn(t.connections.target,i.connection),r._connectionTargetMap[i.connection.id]=t))}),a.bind(Di,function(i){r._cleanupDetachedConnection(i.connection)}),a.bind(Ai,function(i){var e=i.originalEndpoint.element,t=r.getGroupFor(e),n=i.connection.endpoints[i.index],o=n.element,l=r.getGroupFor(o),u=i.index===0?r._connectionSourceMap:r._connectionTargetMap,c=i.index===0?r._connectionTargetMap:r._connectionSourceMap;l!=null?(u[i.connection.id]=l,i.connection.source===i.connection.target&&(c[i.connection.id]=l)):(delete u[i.connection.id],i.connection.source===i.connection.target&&delete c[i.connection.id]),t!=null&&r._updateConnectionsForGroup(t),l!=null&&r._updateConnectionsForGroup(l)})}return K(s,[{key:"_cleanupDetachedConnection",value:function(r){r.proxies.length=0;var i=this._connectionSourceMap[r.id],e;i!=null&&(e=function(n){return n.id===r.id},_e(i.connections.source,e),_e(i.connections.target,e),_e(i.connections.internal,e),delete this._connectionSourceMap[r.id]),i=this._connectionTargetMap[r.id],i!=null&&(e=function(n){return n.id===r.id},_e(i.connections.source,e),_e(i.connections.target,e),_e(i.connections.internal,e),delete this._connectionTargetMap[r.id])}},{key:"addGroup",value:function(r){var i=r.el;if(this.groupMap[r.id]!=null)throw new Error("cannot create Group ["+r.id+"]; a Group with that ID exists");if(i._isJsPlumbGroup!=null)throw new Error("cannot create Group ["+r.id+"]; the given element is already a Group");var e=new lh(this.instance,r.el,r);return this.groupMap[e.id]=e,r.collapsed&&this.collapseGroup(e),this.instance.manage(e.el),this.instance.addClass(e.el,Tn),e.manager=this,this._updateConnectionsForGroup(e),this.instance.fire(ml,{group:e}),e}},{key:"getGroup",value:function(r){var i=r;if(Ce(r)&&(i=this.groupMap[r],i==null))throw new Error("No such group ["+r+"]");return i}},{key:"getGroupFor",value:function(r){for(var i=r,e=this.instance.getContainer(),t=!1,n=null;!t;)i==null||i===e?t=!0:i._jsPlumbParentGroup?(n=i._jsPlumbParentGroup,t=!0):i=i.parentNode;return n}},{key:"getGroups",value:function(){var r=[];for(var i in this.groupMap)r.push(this.groupMap[i]);return r}},{key:"removeGroup",value:function(r,i,e,t){var n=this,o=this.getGroup(r);this.expandGroup(o,!0);var l={};return X(o.children,function(u){var c=n.instance.getManagedElements()[n.instance.getId(u.el)];c&&delete c.group}),i?(X(o.getGroups(),function(u){return n.removeGroup(u,i,e)}),o.removeAll(e,t)):(o.group&&X(o.children,function(u){return o.group.add(u.el)}),l=o.orphanAll()),o.group&&o.group.removeGroup(o),this.instance.unmanage(o.el,!0),delete this.groupMap[o.id],this.instance.fire(bl,{group:o}),l}},{key:"removeAllGroups",value:function(r,i,e){for(var t in this.groupMap)this.removeGroup(this.groupMap[t],r,i,e)}},{key:"forEach",value:function(r){for(var i in this.groupMap)r(this.groupMap[i])}},{key:"orphan",value:function(r,i){var e=r;if(e._jsPlumbParentGroup){var t=e._jsPlumbParentGroup,n=this.instance.getId(e),o=this.instance.getOffset(r);return i!==!0&&t.group?this.instance._appendElementToGroup(t.group,r):this.instance._appendElementToContainer(r),this.instance.setPosition(r,o),delete e._jsPlumbParentGroup,{id:n,pos:o}}}},{key:"_updateConnectionsForGroup",value:function(r){var i=this;r.connections.source.length=0,r.connections.target.length=0,r.connections.internal.length=0;var e=r.children.slice().map(function(d){return d.el}),t=[];if(X(e,function(d){Array.prototype.push.apply(t,i.instance.getSelector(d,me))}),Array.prototype.push.apply(e,t),e.length>0){var n=this.instance.getConnections({source:e,scope:Lt},!0),o=this.instance.getConnections({target:e,scope:Lt},!0),l={},u,c,h=function(v){for(var p=0;p<v.length;p++)l[v[p].id]||(l[v[p].id]=!0,u=i.getGroupFor(v[p].source),c=i.getGroupFor(v[p].target),v[p].source===r.el&&c===r||v[p].target===r.el&&u===r?r.connections.internal.push(v[p]):u===r?(c!==r?r.connections.source.push(v[p]):r.connections.internal.push(v[p]),i._connectionSourceMap[v[p].id]=r):c===r&&(r.connections.target.push(v[p]),i._connectionTargetMap[v[p].id]=r))};h(n),h(o)}}},{key:"_collapseConnection",value:function(r,i,e){var t=r.endpoints[i===0?1:0].element;if(t._jsPlumbParentGroup&&!t._jsPlumbParentGroup.proxied&&t._jsPlumbParentGroup.collapsed)return!1;var n=r.endpoints[0].element,o=n._jsPlumbParentGroup,l=o!=null?o.collapseParent||o:null,u=r.endpoints[1].element,c=u._jsPlumbParentGroup,h=c!=null?c.collapseParent||c:null;if(l==null||h==null||l.id!==h.id){var d=e.el;return this.instance.getId(d),this.instance.proxyConnection(r,i,d,function(v,p){return e.getEndpoint(v,p)},function(v,p){return e.getAnchor(v,p)}),!0}else return!1}},{key:"_expandConnection",value:function(r,i,e){this.instance.unproxyConnection(r,i)}},{key:"isElementDescendant",value:function(r,i){for(var e=this.instance.getContainer(),t=!1;!t;){if(r==null||r===e)return!1;if(r===i)return!0;r=r.parentNode}}},{key:"collapseGroup",value:function(r){var i=this,e=this.getGroup(r);if(!(e==null||e.collapsed)){var t=e.el;if(e.collapseParent==null){if(this.instance.setGroupVisible(e,!1),e.collapsed=!0,this.instance.removeClass(t,Tn),this.instance.addClass(t,qn),e.proxied){var n=new Set,o=function(u,c){for(var h=0;h<u.length;h++){var d=u[h];i._collapseConnection(d,c,e)===!0&&n.add(d.id)}};o(e.connections.source,0),o(e.connections.target,1),X(e.getGroups(),function(l){i.cascadeCollapse(e,l,n)})}this.instance.revalidate(t),this.repaintGroup(e),this.instance.fire(El,{group:e})}else e.collapsed=!0,this.instance.removeClass(t,Tn),this.instance.addClass(t,qn)}}},{key:"cascadeCollapse",value:function(r,i,e){var t=this;if(r.proxied){var n=function(l,u){for(var c=0;c<l.length;c++){var h=l[c];e.has(h.id)||t._collapseConnection(h,u,r)===!0&&e.add(h.id)}};n(i.connections.source,0),n(i.connections.target,1)}X(i.getGroups(),function(o){t.cascadeCollapse(r,o,e)})}},{key:"expandGroup",value:function(r,i){var e=this,t=this.getGroup(r);if(t!=null){var n=t.el;if(t.collapseParent==null){if(this.instance.setGroupVisible(t,!0),t.collapsed=!1,this.instance.addClass(n,Tn),this.instance.removeClass(n,qn),t.proxied){var o=function(c,h){for(var d=0;d<c.length;d++){var v=c[d];e._expandConnection(v,h,t)}};o(t.connections.source,0),o(t.connections.target,1);var l=function u(c,h){if(h||c.collapsed){var d=function(p,m){for(var g=0;g<p.length;g++){var E=p[g];e._collapseConnection(E,m,c.collapseParent||c)}};d(c.connections.source,0),d(c.connections.target,1),X(c.connections.internal,function(v){return v.setVisible(!1)}),X(c.getGroups(),function(v){return u(v,!0)})}else e.expandGroup(c,!0)};X(t.getGroups(),l)}this.instance.revalidate(n),this.repaintGroup(t),i||this.instance.fire(xl,{group:t})}else t.collapsed=!1,this.instance.addClass(n,Tn),this.instance.removeClass(n,qn)}}},{key:"toggleGroup",value:function(r){r=this.getGroup(r),r!=null&&(r.collapsed?this.expandGroup(r):this.collapseGroup(r))}},{key:"repaintGroup",value:function(r){for(var i=this.getGroup(r),e=i.children,t=0;t<e.length;t++)this.instance.revalidate(e[t].el)}},{key:"addToGroup",value:function(r,i){var e=this,t=this.getGroup(r);if(t){for(var n=t.el,o=function(d){var v=d,p=v._isJsPlumbGroup!=null,m=v._jsPlumbGroup,g=v._jsPlumbParentGroup;if(g!==t){var E=e.instance.manage(d),x=e.instance.getOffset(d),C=t.collapsed?e.instance.getOffsetRelativeToRoot(n):e.instance.getOffset(e.instance.getGroupContentArea(t));E.group=t.elId,g!=null&&(g.remove(d,!1,i,!1,t),e._updateConnectionsForGroup(g)),p?t.addGroup(m):t.add(d,i);var S=function(P,_){var L=_===0?1:0;P.each(function(N){N.setVisible(!1),N.endpoints[L].element._jsPlumbGroup===t?(N.endpoints[L].setVisible(!1),e._expandConnection(N,L,t)):(N.endpoints[_].setVisible(!1),e._collapseConnection(N,_,t))})};t.collapsed&&(S(e.instance.select({source:d}),0),S(e.instance.select({target:d}),1)),e.instance.getId(d);var b={x:x.x-C.x,y:x.y-C.y};if(e.instance.setPosition(d,b),e._updateConnectionsForGroup(t),e.instance.revalidate(d),!i){var T={group:t,el:d,pos:b};g&&(T.sourceGroup=g),e.instance.fire(Cl,T)}}},l=arguments.length,u=new Array(l>2?l-2:0),c=2;c<l;c++)u[c-2]=arguments[c];X(u,o)}}},{key:"removeFromGroup",value:function(r,i){var e=this,t=this.getGroup(r);if(t){for(var n=function(h){if(t.collapsed){var d=function(m,g){for(var E=0;E<m.length;E++){var x=m[E];if(x.proxies){for(var C=0;C<x.proxies.length;C++)if(x.proxies[C]!=null){var S=x.proxies[C].originalEp.element;(S===h||e.isElementDescendant(S,h))&&e._expandConnection(x,g,t)}}}};d(t.connections.source.slice(),0),d(t.connections.target.slice(),1)}t.remove(h,null,i);var v=e.instance.getManagedElements()[e.instance.getId(h)];v&&delete v.group},o=arguments.length,l=new Array(o>2?o-2:0),u=2;u<o;u++)l[u-2]=arguments[u];X(l,n)}}},{key:"getAncestors",value:function(r){for(var i=[],e=r.group;e!=null;)i.push(e),e=e.group;return i}},{key:"isAncestor",value:function(r,i){return r==null||i==null?!1:this.getAncestors(r).indexOf(i)!==-1}},{key:"getDescendants",value:function(r){var i=[],e=function t(n){var o=n.getGroups();i.push.apply(i,ln(o)),X(o,t)};return e(r),i}},{key:"isDescendant",value:function(r,i){return r==null||i==null?!1:this.getDescendants(i).indexOf(r)!==-1}},{key:"reset",value:function(){this._connectionSourceMap={},this._connectionTargetMap={},this.groupMap={}}}]),s}(),qs=function(){function s(a,r){H(this,s),this.instance=a,this.entries=r}return K(s,[{key:"length",get:function(){return this.entries.length}},{key:"each",value:function(r){return X(this.entries,function(i){return r(i)}),this}},{key:"get",value:function(r){return this.entries[r]}},{key:"addClass",value:function(r,i){return this.each(function(e){return e.addClass(r,i)}),this}},{key:"removeClass",value:function(r,i){return this.each(function(e){return e.removeClass(r,i)}),this}},{key:"removeAllOverlays",value:function(){return this.each(function(r){return r.removeAllOverlays()}),this}},{key:"setLabel",value:function(r){return this.each(function(i){return i.setLabel(r)}),this}},{key:"clear",value:function(){return this.entries.length=0,this}},{key:"map",value:function(r){var i=[];return this.each(function(e){return i.push(r(e))}),i}},{key:"addOverlay",value:function(r){return this.each(function(i){return i.addOverlay(r)}),this}},{key:"removeOverlay",value:function(r){return this.each(function(i){return i.removeOverlay(r)}),this}},{key:"removeOverlays",value:function(){return this.each(function(r){return r.removeOverlays()}),this}},{key:"showOverlay",value:function(r){return this.each(function(i){return i.showOverlay(r)}),this}},{key:"hideOverlay",value:function(r){return this.each(function(i){return i.hideOverlay(r)}),this}},{key:"setPaintStyle",value:function(r){return this.each(function(i){return i.setPaintStyle(r)}),this}},{key:"setHoverPaintStyle",value:function(r){return this.each(function(i){return i.setHoverPaintStyle(r)}),this}},{key:"setSuspendEvents",value:function(r){return this.each(function(i){return i.setSuspendEvents(r)}),this}},{key:"setParameter",value:function(r,i){return this.each(function(e){return e.parameters[r]=i}),this}},{key:"setParameters",value:function(r){return this.each(function(i){return i.parameters=r}),this}},{key:"setVisible",value:function(r){return this.each(function(i){return i.setVisible(r)}),this}},{key:"addType",value:function(r){return this.each(function(i){return i.addType(r)}),this}},{key:"toggleType",value:function(r){return this.each(function(i){return i.toggleType(r)}),this}},{key:"removeType",value:function(r){return this.each(function(i){return i.removeType(r)}),this}},{key:"bind",value:function(r,i){return this.each(function(e){return e.bind(r,i)}),this}},{key:"unbind",value:function(r,i){return this.each(function(e){return e.unbind(r,i)}),this}},{key:"setHover",value:function(r){var i=this;return this.each(function(e){return i.instance.setHover(e,r)}),this}}]),s}(),ch=function(s){fe(r,s);var a=de(r);function r(){return H(this,r),a.apply(this,arguments)}return K(r,[{key:"setEnabled",value:function(e){return this.each(function(t){return t.enabled=e}),this}},{key:"setAnchor",value:function(e){return this.each(function(t){return t.setAnchor(e)}),this}},{key:"deleteEveryConnection",value:function(){return this.each(function(e){return e.deleteEveryConnection()}),this}},{key:"deleteAll",value:function(){var e=this;return this.each(function(t){return e.instance.deleteEndpoint(t)}),this.clear(),this}}]),r}(qs),hh=function(s){fe(r,s);var a=de(r);function r(){return H(this,r),a.apply(this,arguments)}return K(r,[{key:"setDetachable",value:function(e){return this.each(function(t){return t.setDetachable(e)}),this}},{key:"setReattach",value:function(e){return this.each(function(t){return t.setReattach(e)}),this}},{key:"setConnector",value:function(e){return this.each(function(t){return t._setConnector(e)}),this}},{key:"deleteAll",value:function(){var e=this;this.each(function(t){return e.instance.deleteConnection(t)}),this.clear()}},{key:"repaint",value:function(){var e=this;return this.each(function(t){return e.instance._paintConnection(t)}),this}}]),r}(qs),fh=function s(){H(this,s),f(this,"affectedElements",new Set)};function wo(){return{x:0,y:0,w:0,h:0,r:0,c:{x:0,y:0},x2:0,y2:0,t:{x:0,y:0,c:{x:0,y:0},w:0,h:0,r:0,x2:0,y2:0,cr:0,sr:0},dirty:!0}}function dh(s,a,r,i,e){var t={x:s+r/2,y:a+i/2},n=Math.cos(e/360*Math.PI*2),o=Math.sin(e/360*Math.PI*2),l=function(C,S){return{x:t.x+Math.round((C-t.x)*n-(S-t.y)*o),y:t.y+Math.round((S-t.y)*n-(C-t.x)*o)}},u=l(s,a),c=l(s+r,a),h=l(s+r,a+i),d=l(s,a+i),v=l(s+r/2,a+i/2),p=Math.min(u.x,c.x,h.x,d.x),m=Math.max(u.x,c.x,h.x,d.x),g=Math.min(u.y,c.y,h.y,d.y),E=Math.max(u.y,c.y,h.y,d.y);return{x:p,y:g,w:m-p,h:E-g,c:v,r:e,x2:m,y2:E,cr:n,sr:o}}var Ar=function(a,r){var i=0;return r[1]>a[1]?i=-1:r[1]<a[1]&&(i=1),i},Ro=function(a,r){return Ar(a,r)*-1};function rr(s,a,r,i){za([s,a],r,Ar,i)}function pt(s,a){var r=St(a,function(i){return i[0]===s});r>-1&&a.splice(r,1)}var vh=function(s){fe(r,s);var a=de(r);function r(i){var e;return H(this,r),e=a.call(this),e.instance=i,f(y(e),"_currentTransaction",null),f(y(e),"_sortedElements",{xmin:[],xmax:[],ymin:[],ymax:[]}),f(y(e),"_elementMap",new Map),f(y(e),"_transformedElementMap",new Map),f(y(e),"_bounds",{minx:0,maxx:0,miny:0,maxy:0}),e}return K(r,[{key:"_updateBounds",value:function(e,t,n){t!=null&&(pt(e,this._sortedElements.xmin),pt(e,this._sortedElements.xmax),pt(e,this._sortedElements.ymin),pt(e,this._sortedElements.ymax),rr(e,t.t.x,this._sortedElements.xmin,!1),rr(e,t.t.x+t.t.w,this._sortedElements.xmax,!0),rr(e,t.t.y,this._sortedElements.ymin,!1),rr(e,t.t.y+t.t.h,this._sortedElements.ymax,!0),n!==!0&&this._recalculateBounds())}},{key:"_recalculateBounds",value:function(){this._bounds.minx=this._sortedElements.xmin.length>0?this._sortedElements.xmin[0][1]:0,this._bounds.maxx=this._sortedElements.xmax.length>0?this._sortedElements.xmax[0][1]:0,this._bounds.miny=this._sortedElements.ymin.length>0?this._sortedElements.ymin[0][1]:0,this._bounds.maxy=this._sortedElements.ymax.length>0?this._sortedElements.ymax[0][1]:0}},{key:"recomputeBounds",value:function(){var e=this;this._sortedElements.xmin.length=0,this._sortedElements.xmax.length=0,this._sortedElements.ymin.length=0,this._sortedElements.ymax.length=0,this._elementMap.forEach(function(t,n){e._sortedElements.xmin.push([n,t.t.x]),e._sortedElements.xmax.push([n,t.t.x+t.t.w]),e._sortedElements.ymin.push([n,t.t.y]),e._sortedElements.ymax.push([n,t.t.y+t.t.h])}),this._sortedElements.xmin.sort(Ar),this._sortedElements.ymin.sort(Ar),this._sortedElements.xmax.sort(Ro),this._sortedElements.ymax.sort(Ro),this._recalculateBounds()}},{key:"_finaliseUpdate",value:function(e,t,n){t.t=dh(t.x,t.y,t.w,t.h,t.r),this._transformedElementMap.set(e,t.t),n!==!0&&this._updateBounds(e,t,n)}},{key:"shouldFireEvent",value:function(e,t,n){return!0}},{key:"startTransaction",value:function(){if(this._currentTransaction!=null)throw new Error("Viewport: cannot start transaction; a transaction is currently active.");this._currentTransaction=new fh}},{key:"endTransaction",value:function(){var e=this;this._currentTransaction!=null&&(this._currentTransaction.affectedElements.forEach(function(t){var n=e.getPosition(t);e._finaliseUpdate(t,n,!0)}),this.recomputeBounds(),this._currentTransaction=null)}},{key:"updateElements",value:function(e){var t=this;X(e,function(n){return t.updateElement(n.id,n.x,n.y,n.width,n.height,n.rotation)})}},{key:"updateElement",value:function(e,t,n,o,l,u,c){var h=Qi(this._elementMap,e,wo);return h.dirty=t==null&&h.x==null||n==null&&h.y==null||o==null&&h.w==null||l==null&&h.h==null,t!=null&&(h.x=t),n!=null&&(h.y=n),o!=null&&(h.w=o),l!=null&&(h.h=l),u!=null&&(h.r=u||0),h.c.x=h.x+h.w/2,h.c.y=h.y+h.h/2,h.x2=h.x+h.w,h.y2=h.y+h.h,this._currentTransaction==null?this._finaliseUpdate(e,h,c):this._currentTransaction.affectedElements.add(e),h}},{key:"refreshElement",value:function(e,t){var n=this.instance.getManagedElements(),o=n[e]?n[e].el:null;if(o!=null){var l=this.getSize(o),u=this.getOffset(o);return this.updateElement(e,u.x,u.y,l.w,l.h,null,t)}else return null}},{key:"getSize",value:function(e){return this.instance.getSize(e)}},{key:"getOffset",value:function(e){return this.instance.getOffset(e)}},{key:"registerElement",value:function(e,t){return this.updateElement(e,0,0,0,0,0,t)}},{key:"addElement",value:function(e,t,n,o,l,u){return this.updateElement(e,t,n,o,l,u)}},{key:"rotateElement",value:function(e,t){var n=Qi(this._elementMap,e,wo);return n.r=t||0,this._finaliseUpdate(e,n),n}},{key:"getBoundsWidth",value:function(){return this._bounds.maxx-this._bounds.minx}},{key:"getBoundsHeight",value:function(){return this._bounds.maxy-this._bounds.miny}},{key:"getX",value:function(){return this._bounds.minx}},{key:"getY",value:function(){return this._bounds.miny}},{key:"setSize",value:function(e,t,n){if(this._elementMap.has(e))return this.updateElement(e,null,null,t,n,null)}},{key:"setPosition",value:function(e,t,n){if(this._elementMap.has(e))return this.updateElement(e,t,n,null,null,null)}},{key:"reset",value:function(){this._sortedElements.xmin.length=0,this._sortedElements.xmax.length=0,this._sortedElements.ymin.length=0,this._sortedElements.ymax.length=0,this._elementMap.clear(),this._transformedElementMap.clear(),this._recalculateBounds()}},{key:"remove",value:function(e){pt(e,this._sortedElements.xmin),pt(e,this._sortedElements.xmax),pt(e,this._sortedElements.ymin),pt(e,this._sortedElements.ymax),this._elementMap.delete(e),this._transformedElementMap.delete(e),this._recalculateBounds()}},{key:"getPosition",value:function(e){return this._elementMap.get(e)}},{key:"getElements",value:function(){return this._elementMap}},{key:"isEmpty",value:function(){return this._elementMap.size===0}}]),r}($n),Qt;function ph(s,a,r,i,e){for(var t=r?s.w:s.h,n=r?s.h:s.w,o=[],l=t/(a.length+1),u=0;u<a.length;u++){var c=(u+1)*l,h=i*n;e&&(c=t-c);var d=r?c:h,v=s.x+d,p=d/s.w,m=r?h:c,g=s.y+m,E=m/s.h;if(s.r!==0&&s.r!=null){var x=gr({x:v,y:g},s.c,s.r);v=x.x,g=x.y}o.push({x:v,y:g,xLoc:p,yLoc:E,c:a[u].c})}return o}function No(s,a){return a.theta-s.theta}function Go(s,a){var r=s.theta<0?-Math.PI-s.theta:Math.PI-s.theta,i=a.theta<0?-Math.PI-a.theta:Math.PI-a.theta;return r-i}var gh=(Qt={},f(Qt,be,Go),f(Qt,Le,No),f(Qt,Ne,No),f(Qt,we,Go),Qt);function gt(s){return s.isContinuous===!0}function jo(s){return s.isContinuous===!0}function yh(s){return s.locations.length>1}function Fo(s){return[s.currentLocation,s.locations[s.currentLocation]]}var mh=function(){function s(a){var r=this;H(this,s),this.instance=a,f(this,"anchorLists",new Map),f(this,"anchorLocations",new Map),a.bind(Di,function(i){i.sourceEndpoint._anchor.isContinuous&&r._removeEndpointFromAnchorLists(i.sourceEndpoint),i.targetEndpoint._anchor.isContinuous&&r._removeEndpointFromAnchorLists(i.targetEndpoint)}),a.bind(bs,function(i){r._removeEndpointFromAnchorLists(i)})}return K(s,[{key:"getAnchorOrientation",value:function(r){var i=this.anchorLocations.get(r.id);return i?[i.ox,i.oy]:[0,0]}},{key:"_distance",value:function(r,i,e,t,n,o,l){var u=t.x+r.x*n.w,c=t.y+r.y*n.h,h=t.x+n.w/2,d=t.y+n.h/2;if(o!=null&&o.length>0){var v=this.instance._applyRotations([u,c,0,0],o);u=v.x,c=v.y}return Math.sqrt(Math.pow(i-u,2)+Math.pow(e-c,2))+Math.sqrt(Math.pow(h-u,2)+Math.pow(d-c,2))}},{key:"_anchorSelector",value:function(r,i,e,t,n,o,l){for(var u=e.x+t.w/2,c=e.y+t.h/2,h=-1,d=1/0,v=0;v<l.length;v++){var p=this._distance(l[v],u,c,r,i,n,o);p<d&&(h=v+0,d=p)}return[h,l[h]]}},{key:"_floatingAnchorCompute",value:function(r,i){var e=i.xy,t={curX:e.x+r.size.w/2,curY:e.y+r.size.h/2,x:0,y:0,ox:0,oy:0};return this._setComputedPosition(r,t)}},{key:"_setComputedPosition",value:function(r,i,e){return this.anchorLocations.set(r.id,i),r.computedPosition=i,e&&(r.timestamp=e),i}},{key:"_computeSingleLocation",value:function(r,i,e,t){var n,o=t.rotation,l={curX:i.x+r.x*e.w+r.offx,curY:i.y+r.y*e.h+r.offy,x:r.x,y:r.y,ox:0,oy:0};if(o!=null&&o.length>0){var u=[r.iox,r.ioy],c={x:l.curX,y:l.curY,cr:0,sr:0};X(o,function(h){c=gr(c,h.c,h.r);var d=[Math.round(u[0]*c.cr-u[1]*c.sr),Math.round(u[1]*c.cr+u[0]*c.sr)];u=d.slice()}),r.ox=u[0],r.oy=u[1],n={curX:c.x,curY:c.y,x:r.x,y:r.y,ox:u[0],oy:u[1]}}else r.ox=r.iox,r.oy=r.ioy,n=$({ox:r.iox,oy:r.ioy},l);return n}},{key:"_singleAnchorCompute",value:function(r,i){var e=i.xy,t=i.wh,n=i.timestamp,o=this.anchorLocations.get(r.id);if(o!=null&&n&&n===r.timestamp)return o;var l=Fo(r),u=lr(l,2);u[0];var c=u[1];return o=this._computeSingleLocation(c,e,t,i),this._setComputedPosition(r,o,n)}},{key:"_defaultAnchorCompute",value:function(r,i){var e;if(r.locations.length===1)return this._singleAnchorCompute(r,i);var t=i.xy,n=i.wh,o=i.txy,l=i.twh,u=Fo(r),c=lr(u,2),h=c[0],d=c[1];if(r.locked||o==null||l==null)e=this._computeSingleLocation(d,t,n,i);else{var v=this._anchorSelector(t,n,o,l,i.rotation,i.tRotation,r.locations),p=lr(v,2),m=p[0],g=p[1];r.currentLocation=m,m!==h&&(r.cssClass=g.cls||r.cssClass,i.element._anchorLocationChanged(r)),e=this._computeSingleLocation(g,t,n,i)}return this._setComputedPosition(r,e,i.timestamp)}},{key:"_placeAnchors",value:function(r,i){var e=this,t=this.instance.viewport.getPosition(r),n=function(l,u,c,h,d,v){if(c.length>0)for(var p=c.sort(gh[l]),m=l===Le||l===be,g=ph(t,p,h,d,m),E=0;E<g.length;E++){var x=g[E].c,C=x.endpoints[0].elementId===r,S=C?x.endpoints[0]:x.endpoints[1];e._setComputedPosition(S._anchor,{curX:g[E].x,curY:g[E].y,x:g[E].xLoc,y:g[E].yLoc,ox:v[0],oy:v[1]})}};n(Ne,t,i.bottom,!0,1,[0,1]),n(be,t,i.top,!0,0,[0,-1]),n(we,t,i.left,!1,0,[-1,0]),n(Le,t,i.right,!1,1,[1,0])}},{key:"_updateAnchorList",value:function(r,i,e,t,n,o,l,u,c,h,d){var v=t.endpoints[l],p=v.id,m=[1,0][l],g={theta:i,order:e,c:t,b:n,elId:o,epId:p},E=r[c],x=v._continuousAnchorEdge?r[v._continuousAnchorEdge]:null,C;if(x){var S=St(x,function(P){return P.epId===p});if(S!==-1){x.splice(S,1);for(var b=0;b<x.length;b++)C=x[b].c,C.placeholder!==!0&&h.add(C),d.add(x[b].c.endpoints[l]),d.add(x[b].c.endpoints[m])}}for(var T=0;T<E.length;T++)C=E[T].c,C.placeholder!==!0&&h.add(C),d.add(E[T].c.endpoints[l]),d.add(E[T].c.endpoints[m]);{var D=u?0:E.length;E.splice(D,0,g)}v._continuousAnchorEdge=c}},{key:"_removeEndpointFromAnchorLists",value:function(r){var i=this.anchorLists.get(r.elementId),e=0;(function(t,n){if(t){var o=function(u){return u.epId===n};_e(t.top,o),_e(t.left,o),_e(t.bottom,o),_e(t.right,o),e+=t.top.length,e+=t.left.length,e+=t.bottom.length,e+=t.right.length}})(i,r.id),e===0&&this.anchorLists.delete(r.elementId),this.anchorLocations.delete(r._anchor.id)}},{key:"computeAnchorLocation",value:function(r,i){var e;return gt(r)?e=this.anchorLocations.get(r.id)||{curX:0,curY:0,x:0,y:0,ox:0,oy:0}:jo(r)?e=this._floatingAnchorCompute(r,i):e=this._defaultAnchorCompute(r,i),r.timestamp=i.timestamp,e}},{key:"computePath",value:function(r,i){var e=this.instance.viewport.getPosition(r.sourceId),t=this.instance.viewport.getPosition(r.targetId),n=r.endpoints[0],o=r.endpoints[1],l=this.getEndpointLocation(n,{xy:e,wh:e,element:n,timestamp:i,rotation:this.instance._getRotations(r.sourceId)}),u=this.getEndpointLocation(o,{xy:t,wh:t,element:o,timestamp:i,rotation:this.instance._getRotations(r.targetId)});r.connector.resetBounds(),r.connector.compute({sourcePos:l,targetPos:u,sourceEndpoint:r.endpoints[0],targetEndpoint:r.endpoints[1],strokeWidth:r.paintStyleInUse.strokeWidth,sourceInfo:e,targetInfo:t})}},{key:"getEndpointLocation",value:function(r,i){i=i||{};var e=r._anchor,t=this.anchorLocations.get(e.id);return(t==null||i.timestamp!=null&&e.timestamp!==i.timestamp)&&(t=this.computeAnchorLocation(e,i),this._setComputedPosition(e,t,i.timestamp)),t}},{key:"getEndpointOrientation",value:function(r){return r._anchor?this.getAnchorOrientation(r._anchor):[0,0]}},{key:"setAnchorOrientation",value:function(r,i){var e=this.anchorLocations.get(r.id);e!=null&&(e.ox=i[0],e.oy=i[1])}},{key:"isDynamicAnchor",value:function(r){return r._anchor?!gt(r._anchor)&&r._anchor.locations.length>1:!1}},{key:"isFloating",value:function(r){return r._anchor?jo(r._anchor):!1}},{key:"prepareAnchor",value:function(r){return Mn(r)}},{key:"redraw",value:function(r,i,e){var t=this,n=new Set,o=new Set,l=new Set;if(!this.instance._suspendDrawing){var u=this.instance.endpointsByElement[r]||[];i=i||Ae();for(var c={},h,d,v=0;v<u.length;v++)if(d=u[v],d.visible!==!1)if(o.add(d),h=d._anchor,d.connections.length===0)gt(h)&&(this.anchorLists.has(r)||this.anchorLists.set(r,{top:[],right:[],bottom:[],left:[]}),this._updateAnchorList(this.anchorLists.get(r),-Math.PI/2,0,{endpoints:[d,d],placeholder:!0},!1,r,0,!1,yc(h),n,o),l.add(r));else for(var p=0;p<d.connections.length;p++){var m=d.connections[p],g=m.sourceId,E=m.targetId,x=gt(m.endpoints[0]._anchor),C=gt(m.endpoints[1]._anchor);if(x||C){var S=(m.endpoints[0]._anchor.faces||[]).join("-"),b=(m.endpoints[1]._anchor.faces||[]).join("-"),T=[g,S,E,b].join("-"),D=c[T],P=m.sourceId===r?1:0;x&&!this.anchorLists.has(g)&&this.anchorLists.set(g,{top:[],right:[],bottom:[],left:[]}),C&&!this.anchorLists.has(E)&&this.anchorLists.set(E,{top:[],right:[],bottom:[],left:[]});var _=this.instance.viewport.getPosition(E),L=this.instance.viewport.getPosition(g);if(E===g&&(x||C))this._updateAnchorList(this.anchorLists.get(g),-Math.PI/2,0,m,!1,E,0,!1,be,n,o),this._updateAnchorList(this.anchorLists.get(E),-Math.PI/2,0,m,!1,g,1,!1,be,n,o);else{var N=this.instance._getRotations(g),k=this.instance._getRotations(E);D||(D=this._calculateOrientation(g,E,L,_,m.endpoints[0]._anchor,m.endpoints[1]._anchor,N,k),c[T]=D),x&&this._updateAnchorList(this.anchorLists.get(g),D.theta,0,m,!1,E,0,!1,D.a[0],n,o),C&&this._updateAnchorList(this.anchorLists.get(E),D.theta2,-1,m,!0,g,1,!0,D.a[1],n,o)}x&&l.add(g),C&&l.add(E),n.add(m),(x&&P===0||C&&P===1)&&o.add(m.endpoints[P])}else{var I=d.connections[p].endpoints[m.sourceId===r?1:0],w=I._anchor;if(yh(w)){this.instance._paintEndpoint(I,{elementWithPrecedence:r,timestamp:i}),n.add(d.connections[p]);for(var j=0;j<I.connections.length;j++)I.connections[j]!==d.connections[p]&&n.add(I.connections[j])}else n.add(d.connections[p])}}l.forEach(function(G){t._placeAnchors(G,t.anchorLists.get(G))}),o.forEach(function(G){var V=t.instance.viewport.getPosition(G.elementId);t.instance._paintEndpoint(G,{timestamp:i,offset:V})}),n.forEach(function(G){t.instance._paintConnection(G,{timestamp:i})})}return{c:n,e:o}}},{key:"reset",value:function(){this.anchorLocations.clear(),this.anchorLists.clear()}},{key:"setAnchor",value:function(r,i){i!=null&&(r._anchor=i)}},{key:"setConnectionAnchors",value:function(r,i){r.endpoints[0]._anchor=i[0],r.endpoints[1]._anchor=i[1]}},{key:"_calculateOrientation",value:function(r,i,e,t,n,o,l,u){var c=this,h={HORIZONTAL:"horizontal",VERTICAL:"vertical",DIAGONAL:"diagonal",IDENTITY:"identity"};if(r===i)return{orientation:h.IDENTITY,a:[be,be]};var d=Math.atan2(t.c.y-e.c.y,t.c.x-e.c.x),v=Math.atan2(e.c.y-t.c.y,e.c.x-t.c.x),p=[],m={};(function(T,D){for(var P=0;P<T.length;P++){var _;if(m[T[P]]=(_={},f(_,we,{x:D[P][0].x,y:D[P][0].c.y}),f(_,Le,{x:D[P][0].x+D[P][0].w,y:D[P][0].c.y}),f(_,be,{x:D[P][0].c.x,y:D[P][0].y}),f(_,Ne,{x:D[P][0].c.x,y:D[P][0].y+D[P][0].h}),_),D[P][1]!=null&&D[P][1].length>0)for(var L in m[T[P]])m[T[P]][L]=c.instance._applyRotationsXY(m[T[P]][L],D[P][1])}})([qr,ys],[[e,l],[t,u]]);for(var g=[be,we,Le,Ne],E=0;E<g.length;E++)for(var x=0;x<g.length;x++)p.push({source:g[E],target:g[x],dist:ii(m.source[g[E]],m.target[g[x]])});p.sort(function(T,D){if(T.dist<D.dist)return-1;if(D.dist<T.dist)return 1;var P,_=(P={},f(P,we,0),f(P,be,1),f(P,Le,2),f(P,Ne,3),P),L=_[T.source],N=_[D.source],k=_[T.target],I=_[D.target];return L<N?-1:N<L?1:k<I?-1:I<k?1:0});for(var C=p[0].source,S=p[0].target,b=0;b<p.length&&(gt(n)&&n.locked?C=n.currentFace:!n.isContinuous||go(n,p[b].source)?C=p[b].source:C=null,o.isContinuous&&o.locked?S=o.currentFace:!o.isContinuous||go(o,p[b].target)?S=p[b].target:S=null,!(C!=null&&S!=null));b++);return n.isContinuous&&this.setCurrentFace(n,C),o.isContinuous&&this.setCurrentFace(o,S),{a:[C,S],theta:d,theta2:v}}},{key:"setCurrentFace",value:function(r,i,e){r.currentFace=i,e&&r.lockedFace!=null&&(r.lockedFace=r.currentFace)}},{key:"lock",value:function(r){r.locked=!0,gt(r)&&(r.lockedFace=r.currentFace)}},{key:"unlock",value:function(r){r.locked=!1,gt(r)&&(r.lockedFace=null)}},{key:"selectAnchorLocation",value:function(r,i){var e=St(r.locations,function(t){return t.x===i.x&&t.y===i.y});return e!==-1?(r.currentLocation=e,!0):!1}},{key:"lockCurrentAxis",value:function(r){r.currentFace!=null&&(r.lockedAxis=r.currentFace===we||r.currentFace===Le?vc:pc)}},{key:"unlockCurrentAxis",value:function(r){r.lockedAxis=null}},{key:"anchorsEqual",value:function(r,i){if(!r||!i)return!1;var e=r.locations[r.currentLocation],t=i.locations[i.currentLocation];return e.x===t.x&&e.y===t.y&&e.offx===t.offx&&e.offy===t.offy&&e.ox===t.ox&&e.oy===t.oy}}]),s}(),Bo={},Xn={get:function(a,r,i){var e=Bo[r];if(e)return new e(a,i);throw{message:"jsPlumb: unknown connector type '"+r+"'"}},register:function(a,r){Bo[a]=r}},Rt=function(s){fe(r,s);var a=de(r);function r(i){var e;return H(this,r),e=a.call(this,i),f(y(e),"length",void 0),f(y(e),"m",void 0),f(y(e),"m2",void 0),f(y(e),"type",r.segmentType),e._setCoordinates({x1:i.x1,y1:i.y1,x2:i.x2,y2:i.y2}),e}return K(r,[{key:"getPath",value:function(e){return(e?"M "+this.x1+" "+this.y1+" ":"")+"L "+this.x2+" "+this.y2}},{key:"_recalc",value:function(){this.length=Math.sqrt(Math.pow(this.x2-this.x1,2)+Math.pow(this.y2-this.y1,2)),this.m=fn({x:this.x1,y:this.y1},{x:this.x2,y:this.y2}),this.m2=-1/this.m,this.extents={xmin:Math.min(this.x1,this.x2),ymin:Math.min(this.y1,this.y2),xmax:Math.max(this.x1,this.x2),ymax:Math.max(this.y1,this.y2)}}},{key:"getLength",value:function(){return this.length}},{key:"getGradient",value:function(){return this.m}},{key:"_setCoordinates",value:function(e){this.x1=e.x1,this.y1=e.y1,this.x2=e.x2,this.y2=e.y2,this._recalc()}},{key:"pointOnPath",value:function(e,t){if(e===0&&!t)return{x:this.x1,y:this.y1};if(e===1&&!t)return{x:this.x2,y:this.y2};var n=t?e>0?e:this.length+e:e*this.length;return Mt({x:this.x1,y:this.y1},{x:this.x2,y:this.y2},n)}},{key:"gradientAtPoint",value:function(e,t){return this.m}},{key:"pointAlongPathFrom",value:function(e,t,n){var o=this.pointOnPath(e,n),l=t<=0?{x:this.x1,y:this.y1}:{x:this.x2,y:this.y2};return t<=0&&Math.abs(t)>1&&(t*=-1),Mt(o,l,t)}},{key:"within",value:function(e,t,n){return n>=Math.min(e,t)&&n<=Math.max(e,t)}},{key:"closest",value:function(e,t,n){return Math.abs(n-e)<Math.abs(n-t)?e:t}},{key:"findClosestPointOnPath",value:function(e,t){var n={d:1/0,x:null,y:null,l:null,x1:this.x1,x2:this.x2,y1:this.y1,y2:this.y2};if(this.m===0)n.y=this.y1,n.x=this.within(this.x1,this.x2,e)?e:this.closest(this.x1,this.x2,e);else if(this.m===1/0||this.m===-1/0)n.x=this.x1,n.y=this.within(this.y1,this.y2,t)?t:this.closest(this.y1,this.y2,t);else{var o=this.y1-this.m*this.x1,l=t-this.m2*e,u=(l-o)/(this.m-this.m2),c=this.m*u+o;n.x=this.within(this.x1,this.x2,u)?u:this.closest(this.x1,this.x2,u),n.y=this.within(this.y1,this.y2,c)?c:this.closest(this.y1,this.y2,c)}var h=ii({x:n.x,y:n.y},{x:this.x1,y:this.y1});return n.d=ii({x:e,y:t},n),n.l=h/length,n}},{key:"_pointLiesBetween",value:function(e,t,n){return n>t?t<=e&&e<=n:t>=e&&e>=n}},{key:"lineIntersection",value:function(e,t,n,o){var l=Math.abs(fn({x:e,y:t},{x:n,y:o})),u=Math.abs(this.m),c=u===1/0?this.x1:this.y1-u*this.x1,h=[],d=l===1/0?e:t-l*e;if(l!==u)if(l===1/0&&u===0)this._pointLiesBetween(e,this.x1,this.x2)&&this._pointLiesBetween(this.y1,t,o)&&h.push({x:e,y:this.y1});else if(l===0&&u===1/0)this._pointLiesBetween(t,this.y1,this.y2)&&this._pointLiesBetween(this.x1,e,n)&&h.push({x:this.x1,y:t});else{var v,p;l===1/0?(v=e,this._pointLiesBetween(v,this.x1,this.x2)&&(p=u*e+c,this._pointLiesBetween(p,t,o)&&h.push({x:v,y:p}))):l===0?(p=t,this._pointLiesBetween(p,this.y1,this.y2)&&(v=(t-c)/u,this._pointLiesBetween(v,e,n)&&h.push({x:v,y:p}))):(v=(d-c)/(u-l),p=u*v+c,this._pointLiesBetween(v,this.x1,this.x2)&&this._pointLiesBetween(p,this.y1,this.y2)&&h.push({x:v,y:p}))}return h}},{key:"boxIntersection",value:function(e,t,n,o){var l=[];return l.push.apply(l,this.lineIntersection(e,t,e+n,t)),l.push.apply(l,this.lineIntersection(e+n,t,e+n,t+o)),l.push.apply(l,this.lineIntersection(e+n,t+o,e,t+o)),l.push.apply(l,this.lineIntersection(e,t+o,e,t)),l}}]),r}(ki);f(Rt,"segmentType","Straight");var Dr=function(s){fe(r,s);var a=de(r);function r(){var i;H(this,r);for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return i=a.call.apply(a,[this].concat(t)),f(y(i),"type",r.type),i}return K(r,[{key:"getDefaultStubs",value:function(){return[0,0]}},{key:"_compute",value:function(e,t){this._addSegment(Rt,{x1:e.sx,y1:e.sy,x2:e.startStubX,y2:e.startStubY}),this._addSegment(Rt,{x1:e.startStubX,y1:e.startStubY,x2:e.endStubX,y2:e.endStubY}),this._addSegment(Rt,{x1:e.endStubX,y1:e.endStubY,x2:e.tx,y2:e.ty}),this.geometry={source:t.sourcePos,target:t.targetPos}}},{key:"transformGeometry",value:function(e,t,n){return{source:this.transformAnchorPlacement(e.source,t,n),target:this.transformAnchorPlacement(e.target,t,n)}}}]),r}(Nr);f(Dr,"type","Straight");function Eh(s,a){for(var r=s.scope.split(/\s/),i=a.scope.split(/\s/),e=0;e<r.length;e++)for(var t=0;t<i.length;t++)if(i[t]===r[e])return!0;return!1}function _t(s,a,r){var i=[],e=function(o){return Ce(o)?o:s.getId(o)};if(a)if(typeof a=="string"){if(a==="*")return a;i.push(a)}else if(r)i=a;else if(a.length!=null){var t;(t=i).push.apply(t,ln(ln(a).map(e)))}else i.push(e(a));return i}function xh(s,a){s!=null&&s.endpoints.push(a)}function Ch(s,a){s!=null&&_e(s.endpoints,function(r){return r===a})}function ir(s,a,r){a!=null&&(a.connections.push(s),a.connections.length===1&&s.instance.addClass(s.source,s.instance.connectedClass)),r!=null&&(a==null||s.sourceId!==s.targetId)&&(r.connections.push(s),r.connections.length===1&&s.instance.addClass(s.target,s.instance.connectedClass))}function or(s,a,r){if(a!=null){var i=a.connections.length;_e(a.connections,function(t){return s.id===t.id}),i>0&&a.connections.length===0&&s.instance.removeClass(s.source,s.instance.connectedClass)}if(r!=null){var e=r.connections.length;(a==null||s.sourceId!==s.targetId)&&_e(r.connections,function(t){return s.id===t.id}),e>0&&r.connections.length===0&&s.instance.removeClass(s.target,s.instance.connectedClass)}}var Sh=function(s){fe(r,s);var a=de(r);function r(i,e){var t;return H(this,r),t=a.call(this),t._instanceIndex=i,f(y(t),"defaults",void 0),f(y(t),"_initialDefaults",{}),f(y(t),"isConnectionBeingDragged",!1),f(y(t),"currentlyDragging",!1),f(y(t),"hoverSuspended",!1),f(y(t),"_suspendDrawing",!1),f(y(t),"_suspendedAt",null),f(y(t),"connectorClass",Pi),f(y(t),"connectorOutlineClass",ll),f(y(t),"connectedClass",ul),f(y(t),"endpointClass",sn),f(y(t),"endpointConnectedClass",cl),f(y(t),"endpointFullClass",hl),f(y(t),"endpointFloatingClass",Ti),f(y(t),"endpointDropAllowedClass",fl),f(y(t),"endpointDropForbiddenClass",dl),f(y(t),"endpointAnchorClassPrefix",vl),f(y(t),"overlayClass",wr),f(y(t),"connections",[]),f(y(t),"endpointsByElement",{}),f(y(t),"endpointsByUUID",new Map),f(y(t),"sourceSelectors",[]),f(y(t),"targetSelectors",[]),f(y(t),"allowNestedGroups",void 0),f(y(t),"_curIdStamp",1),f(y(t),"viewport",new vh(y(t))),f(y(t),"router",void 0),f(y(t),"groupManager",void 0),f(y(t),"_connectionTypes",new Map),f(y(t),"_endpointTypes",new Map),f(y(t),"_container",void 0),f(y(t),"_managedElements",{}),f(y(t),"DEFAULT_SCOPE",void 0),f(y(t),"_zoom",1),t.defaults={anchor:tt.Bottom,anchors:[null,null],connectionsDetachable:!0,connectionOverlays:[],connector:Dr.type,container:null,endpoint:Vt.type,endpointOverlays:[],endpoints:[null,null],endpointStyle:{fill:"#456"},endpointStyles:[null,null],endpointHoverStyle:null,endpointHoverStyles:[null,null],hoverPaintStyle:null,listStyle:{},maxConnections:1,paintStyle:{strokeWidth:2,stroke:"#456"},reattachConnections:!1,scope:"jsplumb_defaultscope",allowNestedGroups:!0},e&&$(t.defaults,e),$(t._initialDefaults,t.defaults),t._initialDefaults[Jt]!=null&&(t._initialDefaults[Jt].strokeWidth=t._initialDefaults[Jt].strokeWidth||2),t.DEFAULT_SCOPE=t.defaults[sh],t.allowNestedGroups=t._initialDefaults[oh]!==!1,t.router=new mh(y(t)),t.groupManager=new uh(y(t)),t.setContainer(t._initialDefaults.container),t}return K(r,[{key:"defaultScope",get:function(){return this.DEFAULT_SCOPE}},{key:"currentZoom",get:function(){return this._zoom}},{key:"areDefaultAnchorsSet",value:function(){return this.validAnchorsSpec(this.defaults.anchors)}},{key:"validAnchorsSpec",value:function(e){return e!=null&&e[0]!=null&&e[1]!=null}},{key:"getContainer",value:function(){return this._container}},{key:"setZoom",value:function(e,t){return this._zoom=e,this.fire(As,this._zoom),t&&this.repaintEverything(),!0}},{key:"_idstamp",value:function(){return""+this._curIdStamp++}},{key:"checkCondition",value:function(e,t){var n=this.getListener(e),o=!0;if(n&&n.length>0){var l=Array.prototype.slice.call(arguments,1);try{for(var u=0,c=n.length;u<c;u++)o=o&&n[u].apply(n[u],l)}catch(h){Oe("cannot check condition ["+e+"]"+h)}}return o}},{key:"getId",value:function(e,t){if(e==null)return null;var n=this.getAttribute(e,yt);return(!n||n==="undefined")&&(arguments.length===2&&arguments[1]!==void 0?n=t:(arguments.length===1||arguments.length===3&&!arguments[2])&&(n="jsplumb-"+this._instanceIndex+"-"+this._idstamp()),this.setAttribute(e,yt,n)),n}},{key:"getConnections",value:function(e,t){e?e.constructor===String&&(e={scope:e}):e={};for(var n=e.scope||this.defaultScope,o=_t(this,n,!0),l=_t(this,e.source),u=_t(this,e.target),c=!t&&o.length>1?{}:[],h=function(x,C){if(!t&&o.length>1){var S=c[x];S==null&&(S=c[x]=[]),S.push(C)}else c.push(C)},d=0,v=this.connections.length;d<v;d++){var p=this.connections[d],m=p.proxies&&p.proxies[0]?p.proxies[0].originalEp.elementId:p.sourceId,g=p.proxies&&p.proxies[1]?p.proxies[1].originalEp.elementId:p.targetId;Ot(o,p.scope)&&Ot(l,m)&&Ot(u,g)&&h(p.scope,p)}return c}},{key:"select",value:function(e){return e=e||{},e.scope=e.scope||"*",new hh(this,e.connections||this.getConnections(e,!0))}},{key:"selectEndpoints",value:function(e){e=e||{},e.scope=e.scope||Lt;var t=!e.element&&!e.source&&!e.target,n=t?Lt:_t(this,e.element),o=t?Lt:_t(this,e.source),l=t?Lt:_t(this,e.target),u=_t(this,e.scope,!0),c=[];for(var h in this.endpointsByElement){var d=Ot(n,h,!0),v=Ot(o,h,!0),p=o!=="*",m=Ot(l,h,!0),g=l!=="*";if(d||v||m)e:for(var E=0,x=this.endpointsByElement[h].length;E<x;E++){var C=this.endpointsByElement[h][E];if(Ot(u,C.scope,!0)){var S=p&&o.length>0&&!C.isSource,b=g&&l.length>0&&!C.isTarget;if(S||b)continue e;c.push(C)}}}return new ch(this,c)}},{key:"setContainer",value:function(e){this._container=e,this.fire(gl,this._container)}},{key:"_set",value:function(e,t,n){var o=[{el:"source",elId:"sourceId"},{el:"target",elId:"targetId"}],l,u=o[n],c=e[u.elId],h,d=e.endpoints[n],v={index:n,originalEndpoint:d,originalSourceId:n===0?c:e.sourceId,newSourceId:e.sourceId,originalTargetId:n===1?c:e.targetId,newTargetId:e.targetId,connection:e,newEndpoint:d};return t instanceof rn?(l=t,l.addConnection(e)):(h=this.getId(t),h===e[u.elId]?l=null:l=e.makeEndpoint(n===0,t,h)),l!=null&&(v.newEndpoint=l,d.detachFromConnection(e),e.endpoints[n]=l,e[u.el]=l.element,e[u.elId]=l.elementId,v[n===0?"newSourceId":"newTargetId"]=l.elementId,this.fireMoveEvent(v),this._paintConnection(e)),v}},{key:"setSource",value:function(e,t){or(e,this._managedElements[e.sourceId]);var n=this._set(e,t,0);ir(e,this._managedElements[n.newSourceId])}},{key:"setTarget",value:function(e,t){or(e,this._managedElements[e.targetId]);var n=this._set(e,t,1);ir(e,this._managedElements[n.newTargetId])}},{key:"setConnectionType",value:function(e,t,n){e.setType(t,n),this._paintConnection(e)}},{key:"isHoverSuspended",value:function(){return this.hoverSuspended}},{key:"setSuspendDrawing",value:function(e,t){var n=this._suspendDrawing;return this._suspendDrawing=e,e?this._suspendedAt=""+new Date().getTime():(this._suspendedAt=null,this.viewport.recomputeBounds()),t&&this.repaintEverything(),n}},{key:"getSuspendedAt",value:function(){return this._suspendedAt}},{key:"batch",value:function(e,t){var n=this._suspendDrawing===!0;n||this.setSuspendDrawing(!0),e(),n||this.setSuspendDrawing(!1,!t)}},{key:"each",value:function(e,t){if(e!=null){if(e.length!=null)for(var n=0;n<e.length;n++)t(e[n]);else t(e);return this}}},{key:"updateOffset",value:function(e){var t=e.elId;return e.recalc?this.viewport.refreshElement(t):this.viewport.getPosition(t)}},{key:"deleteConnection",value:function(e,t){if(e!=null&&e.deleted!==!0&&(t=t||{},t.force||us(!0,!1,[[e.endpoints[0],an,[e]],[e.endpoints[1],an,[e]],[e,an,[e]],[this,xs,[_s,e]]]))){or(e,this._managedElements[e.sourceId],this._managedElements[e.targetId]),this.fireDetachEvent(e,!e.pending&&t.fireEvent!==!1,t.originalEvent);var n=e.endpoints[0],o=e.endpoints[1];return n!==t.endpointToIgnore&&n.detachFromConnection(e,null,!0),o!==t.endpointToIgnore&&o.detachFromConnection(e,null,!0),_e(this.connections,function(l){return e.id===l.id}),e.destroy(),n!==t.endpointToIgnore&&n.deleteOnEmpty&&n.connections.length===0&&this.deleteEndpoint(n),o!==t.endpointToIgnore&&o.deleteOnEmpty&&o.connections.length===0&&this.deleteEndpoint(o),!0}return!1}},{key:"deleteEveryConnection",value:function(e){var t=this;e=e||{};var n=this.connections.length,o=0;return this.batch(function(){for(var l=0;l<n;l++)o+=t.deleteConnection(t.connections[0],e)?1:0}),o}},{key:"deleteConnectionsForElement",value:function(e,t){var n=this.getId(e),o=this._managedElements[n];if(o)for(var l=o.connections.length,u=0;u<l;u++)this.deleteConnection(o.connections[0],t);return this}},{key:"fireDetachEvent",value:function(e,t,n){var o=e.id!=null,l=o?{connection:e,source:e.source,target:e.target,sourceId:e.sourceId,targetId:e.targetId,sourceEndpoint:e.endpoints[0],targetEndpoint:e.endpoints[1]}:e;t&&this.fire(Ss,l,n),this.fire(Di,l,n)}},{key:"fireMoveEvent",value:function(e,t){this.fire(Ai,e,t)}},{key:"manageAll",value:function(e,t){for(var n=Ce(e)?this.getSelector(this.getContainer(),e):e,o=0;o<n.length;o++)this.manage(n[o],null,t)}},{key:"manage",value:function(e,t,n){this.getAttribute(e,yt)==null&&(t=t||this.getAttribute(e,"id")||Ae(),this.setAttribute(e,yt,t));var o=this.getId(e);if(this._managedElements[o])n&&(this._managedElements[o].viewportElement=this.updateOffset({elId:o,timestamp:null,recalc:!0}));else{var l={el:e,endpoints:[],connections:[],rotation:0,data:{}};this._managedElements[o]=l,this._suspendDrawing?l.viewportElement=this.viewport.registerElement(o,!0):l.viewportElement=this.updateOffset({elId:o,recalc:!0}),this.fire(Ps,{el:e})}return this._managedElements[o]}},{key:"getManagedData",value:function(e,t,n){if(this._managedElements[e]){var o=this._managedElements[e].data[t];return o!=null?o[n]:null}}},{key:"setManagedData",value:function(e,t,n,o){this._managedElements[e]&&(this._managedElements[e].data[t]=this._managedElements[e].data[t]||{},this._managedElements[e].data[t][n]=o)}},{key:"getManagedElement",value:function(e){return this._managedElements[e]?this._managedElements[e].el:null}},{key:"unmanage",value:function(e,t){var n=this;this.removeAllEndpoints(e,!0);var o=function(u){var c=n.getId(u);n.removeAttribute(u,yt),delete n._managedElements[c],n.viewport.remove(c),n.fire(Os,{el:u,id:c}),u&&t&&n._removeElement(u)};this._getAssociatedElements(e).map(o),o(e)}},{key:"rotate",value:function(e,t,n){var o=this.getId(e);return this._managedElements[o]&&(this._managedElements[o].rotation=t,this.viewport.rotateElement(o,t),n!==!0)?this.revalidate(e):{c:new Set,e:new Set}}},{key:"_getRotation",value:function(e){var t=this._managedElements[e];return t!=null&&t.rotation||0}},{key:"_getRotations",value:function(e){var t=this,n=[],o=this._managedElements[e],l=function u(c){if(c.group!=null){var h=t._managedElements[c.group];h!=null&&(n.push({r:h.viewportElement.r,c:h.viewportElement.c}),u(h))}};return o!=null&&(n.push({r:o.viewportElement.r||0,c:o.viewportElement.c}),l(o)),n}},{key:"_applyRotations",value:function(e,t){var n=e.slice(),o={x:n[0],y:n[1],cr:0,sr:0};return X(t,function(l){o=gr(o,l.c,l.r)}),o}},{key:"_applyRotationsXY",value:function(e,t){return X(t,function(n){e=gr(e,n.c,n.r)}),e}},{key:"_internal_newEndpoint",value:function(e){var t=$({},e),n=this.manage(t.element);t.elementId=this.getId(t.element),t.id="ep_"+this._idstamp();var o=new rn(this,t);return xh(n,o),e.uuid&&this.endpointsByUUID.set(e.uuid,o),hs(this.endpointsByElement,o.elementId,o),this._suspendDrawing||this._paintEndpoint(o,{timestamp:this._suspendedAt}),o}},{key:"_deriveEndpointAndAnchorSpec",value:function(e,t){for(var n=((t?"":"default ")+e).split(/[\s]/),o=null,l=null,u=null,c=null,h=0;h<n.length;h++){var d=this.getConnectionType(n[h]);d&&(d.endpoints&&(o=d.endpoints),d.endpoint&&(l=d.endpoint),d.anchors&&(c=d.anchors),d.anchor&&(u=d.anchor))}return{endpoints:o||[l,l],anchors:c||[u,u]}}},{key:"revalidate",value:function(e,t){var n=this.getId(e);return this.updateOffset({elId:n,recalc:!0,timestamp:t}),this.repaint(e)}},{key:"repaintEverything",value:function(){var e=Ae(),t;for(t in this._managedElements)this.viewport.refreshElement(t,!0);this.viewport.recomputeBounds();for(t in this._managedElements)this.repaint(this._managedElements[t].el,e,!0);return this}},{key:"setElementPosition",value:function(e,t,n){var o=this.getId(e);return this.viewport.setPosition(o,t,n),this.repaint(e)}},{key:"repaint",value:function(e,t,n){var o={c:new Set,e:new Set},l=function(p){p.c.forEach(function(m){return o.c.add(m)}),p.e.forEach(function(m){return o.e.add(m)})};if(!this._suspendDrawing){var u=this.getId(e);if(e!=null){var c=this._getAssociatedElements(e);if(t==null&&(t=Ae()),!n)for(var h=0;h<c.length;h++)this.updateOffset({elId:this.getId(c[h]),recalc:!0,timestamp:t});if(l(this.router.redraw(u,t,null)),c.length>0)for(var d=0;d<c.length;d++)l(this.router.redraw(this.getId(c[d]),t,null))}}return o}},{key:"unregisterEndpoint",value:function(e){var t=e.getUuid();t&&this.endpointsByUUID.delete(t),Ch(this._managedElements[e.elementId],e);var n=this.endpointsByElement[e.elementId];n!=null&&(this.endpointsByElement[e.elementId]=n.filter(function(o){return o!==e})),this.fire(bs,e)}},{key:"_maybePruneEndpoint",value:function(e){return e.deleteOnEmpty&&e.connections.length===0?(this.deleteEndpoint(e),!0):!1}},{key:"deleteEndpoint",value:function(e){var t=this,n=typeof e=="string"?this.endpointsByUUID.get(e):e;if(n){var o=n.proxiedBy,l=n.connections.slice();X(l,function(u){n.detachFromConnection(u,null,!0)}),this.unregisterEndpoint(n),n.destroy(),X(l,function(u){t.deleteConnection(u,{force:!0,endpointToIgnore:n})}),o!=null&&this.deleteEndpoint(o)}return this}},{key:"addEndpoint",value:function(e,t,n){n=n||{};var o=$({},n);$(o,t||{});var l=$({element:e},o);return this._internal_newEndpoint(l)}},{key:"addEndpoints",value:function(e,t,n){for(var o=[],l=0,u=t.length;l<u;l++)o.push(this.addEndpoint(e,t[l],n));return o}},{key:"reset",value:function(){var e=this;this.silently(function(){e.endpointsByElement={},e._managedElements={},e.endpointsByUUID.clear(),e.viewport.reset(),e.router.reset(),e.groupManager.reset(),e.connections.length=0})}},{key:"destroy",value:function(){this.reset(),this.unbind(),this.sourceSelectors.length=0,this.targetSelectors.length=0,this._connectionTypes.clear(),this._endpointTypes.clear()}},{key:"getEndpoints",value:function(e){return this.endpointsByElement[this.getId(e)]||[]}},{key:"getEndpoint",value:function(e){return this.endpointsByUUID.get(e)}},{key:"setEndpointUuid",value:function(e,t){e.uuid&&this.endpointsByUUID.delete(e.uuid),e.uuid=t,this.endpointsByUUID.set(t,e)}},{key:"connect",value:function(e,t){try{var n=this._prepareConnectionParams(e,t),o=this._newConnection(n);return this._finaliseConnection(o,n),o}catch(l){Oe(l);return}}},{key:"_prepareConnectionParams",value:function(e,t){var n=$({},e);t&&$(n,t);var o=n;if(o.source&&o.source.endpoint&&(o.sourceEndpoint=o.source),o.target&&o.target.endpoint&&(o.targetEndpoint=o.target),e.uuids&&(o.sourceEndpoint=this.getEndpoint(e.uuids[0]),o.targetEndpoint=this.getEndpoint(e.uuids[1])),o.sourceEndpoint!=null){if(o.sourceEndpoint.isFull())throw Dl;if(o.type||(o.type=o.sourceEndpoint.edgeType),o.sourceEndpoint.connectorOverlays){o.overlays=o.overlays||[];for(var l=0,u=o.sourceEndpoint.connectorOverlays.length;l<u;l++)o.overlays.push(o.sourceEndpoint.connectorOverlays[l])}o.sourceEndpoint.scope&&(o.scope=o.sourceEndpoint.scope)}else if(o.source==null)throw Il;if(o.targetEndpoint!=null){if(o.targetEndpoint.isFull())throw _l}else if(o.target==null)throw kl;if(o.sourceEndpoint&&o.targetEndpoint&&!Eh(o.sourceEndpoint,o.targetEndpoint))throw"Cannot establish connection: scopes do not match";return o}},{key:"_newConnection",value:function(e){e.id="con_"+this._idstamp();var t=new Vn(this,e);return ir(t,this._managedElements[t.sourceId],this._managedElements[t.targetId]),this._paintConnection(t),t}},{key:"_finaliseConnection",value:function(e,t,n){t=t||{},e.suspendedEndpoint||this.connections.push(e),e.pending=null,e.endpoints[0].isTemporarySource=!1,this.repaint(e.source);var o={connection:e,source:e.source,target:e.target,sourceId:e.sourceId,targetId:e.targetId,sourceEndpoint:e.endpoints[0],targetEndpoint:e.endpoints[1]};this.fire(Cs,o,n),!t.doNotFireConnectionEvent&&t.fireEvent!==!1&&this.fire(Oi,o,n)}},{key:"removeAllEndpoints",value:function(e,t){var n=this,o=function(u){var c=n.getId(u),h=n.endpointsByElement[c],d,v;if(h)for(d=0,v=h.length;d<v;d++)n.deleteEndpoint(h[d]);delete n.endpointsByElement[c]};return t&&this._getAssociatedElements(e).map(o),o(e),this}},{key:"_createSourceDefinition",value:function(e,t){var n=$({},t);$(n,e),n.edgeType=n.edgeType||xr;var o=this._deriveEndpointAndAnchorSpec(n.edgeType);n.endpoint=n.endpoint||o.endpoints[0],n.anchor=n.anchor||o.anchors[0];var l=n.maxConnections||-1,u={def:$({},n),uniqueEndpoint:n.uniqueEndpoint,maxConnections:l,enabled:!0,endpoint:null};return u}},{key:"addSourceSelector",value:function(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,o=this._createSourceDefinition(t),l=new bo(e,o,n);return this.sourceSelectors.push(l),l}},{key:"removeSourceSelector",value:function(e){_e(this.sourceSelectors,function(t){return t===e})}},{key:"removeTargetSelector",value:function(e){_e(this.targetSelectors,function(t){return t===e})}},{key:"addTargetSelector",value:function(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,o=this._createTargetDefinition(t),l=new bo(e,o,n);return this.targetSelectors.push(l),l}},{key:"_createTargetDefinition",value:function(e,t){var n=$({},t);$(n,e),n.edgeType=n.edgeType||xr;var o=n.maxConnections||-1,l={def:$({},n),uniqueEndpoint:n.uniqueEndpoint,maxConnections:o,enabled:!0,endpoint:null};return l}},{key:"show",value:function(e,t){return this._setVisible(e,ei,t)}},{key:"hide",value:function(e,t){return this._setVisible(e,cn,t)}},{key:"_setVisible",value:function(e,t,n){var o=t===ei,l=null;n&&(l=function(h){h.setVisible(o,!0,!0)});var u=this.getId(e);return this._operation(e,function(c){if(o&&n){var h=c.sourceId===u?1:0;c.endpoints[h].isVisible()&&c.setVisible(!0)}else c.setVisible(o)},l),this}},{key:"toggleVisible",value:function(e,t){var n=null;t&&(n=function(l){var u=l.isVisible();l.setVisible(!u)}),this._operation(e,function(o){var l=o.isVisible();o.setVisible(!l)},n)}},{key:"_operation",value:function(e,t,n){var o=this.getId(e),l=this.endpointsByElement[o];if(l&&l.length)for(var u=0,c=l.length;u<c;u++){for(var h=0,d=l[u].connections.length;h<d;h++){var v=t(l[u].connections[h]);if(v)return}n&&n(l[u])}}},{key:"registerConnectionType",value:function(e,t){if(this._connectionTypes.set(e,$({},t)),t.overlays){for(var n={},o=0;o<t.overlays.length;o++){var l=si(t.overlays[o]);n[l.options.id]=l}this._connectionTypes.get(e).overlays=n}}},{key:"registerConnectionTypes",value:function(e){for(var t in e)this.registerConnectionType(t,e[t])}},{key:"registerEndpointType",value:function(e,t){if(this._endpointTypes.set(e,$({},t)),t.overlays){for(var n={},o=0;o<t.overlays.length;o++){var l=si(t.overlays[o]);n[l.options.id]=l}this._endpointTypes.get(e).overlays=n}}},{key:"registerEndpointTypes",value:function(e){for(var t in e)this.registerEndpointType(t,e[t])}},{key:"getType",value:function(e,t){return t==="connection"?this.getConnectionType(e):this.getEndpointType(e)}},{key:"getConnectionType",value:function(e){return this._connectionTypes.get(e)}},{key:"getEndpointType",value:function(e){return this._endpointTypes.get(e)}},{key:"importDefaults",value:function(e){for(var t in e)this.defaults[t]=e[t];return this.defaults[Jt]!=null&&(this.defaults[Jt].strokeWidth=this.defaults[Jt].strokeWidth||2),e.container&&this.setContainer(e.container),this}},{key:"restoreDefaults",value:function(){return this.defaults=$({},this._initialDefaults),this}},{key:"getManagedElements",value:function(){return this._managedElements}},{key:"proxyConnection",value:function(e,t,n,o,l){var u=e.proxies[t]!=null,c,h=u?e.proxies[t].originalEp.elementId:e.endpoints[t].elementId,d=u?e.proxies[t].originalEp:e.endpoints[t],v=this.getId(n);e.proxies[t]?e.proxies[t].ep.elementId===v?c=e.proxies[t].ep:(e.proxies[t].ep.detachFromConnection(e,t),c=this._internal_newEndpoint({element:n,endpoint:o(e,t),anchor:l(e,t),parameters:{isProxyEndpoint:!0}})):c=this._internal_newEndpoint({element:n,endpoint:o(e,t),anchor:l(e,t),parameters:{isProxyEndpoint:!0}}),c.deleteOnEmpty=!0,e.proxies[t]={ep:c,originalEp:d},this.sourceOrTargetChanged(h,v,e,n,t),d.detachFromConnection(e,null,!0),c.connections=[e],e.endpoints[t]=c,d.proxiedBy=c,d.setVisible(!1),e.setVisible(!0),this.revalidate(n)}},{key:"unproxyConnection",value:function(e,t){if(!(e.proxies==null||e.proxies[t]==null)){var n=e.proxies[t].originalEp.element,o=e.proxies[t].originalEp.elementId,l=e.proxies[t].ep.elementId;e.endpoints[t]=e.proxies[t].originalEp,delete e.proxies[t].originalEp.proxiedBy,this.sourceOrTargetChanged(l,o,e,n,t),e.proxies[t].ep.detachFromConnection(e,null),e.proxies[t].originalEp.addConnection(e),e.isVisible()&&e.proxies[t].originalEp.setVisible(!0),e.proxies[t]=null,St(e.proxies,function(u){return u!=null})===-1&&(e.proxies.length=0)}}},{key:"sourceOrTargetChanged",value:function(e,t,n,o,l){e!==t&&(l===0?(n.sourceId=t,n.source=o):l===1&&(n.targetId=t,n.target=o),or(n,this._managedElements[e]),ir(n,this._managedElements[t]))}},{key:"getGroup",value:function(e){return this.groupManager.getGroup(e)}},{key:"getGroupFor",value:function(e){return this.groupManager.getGroupFor(e)}},{key:"addGroup",value:function(e){return this.groupManager.addGroup(e)}},{key:"addToGroup",value:function(e){for(var t,n=arguments.length,o=new Array(n>1?n-1:0),l=1;l<n;l++)o[l-1]=arguments[l];return(t=this.groupManager).addToGroup.apply(t,[e,!1].concat(o))}},{key:"collapseGroup",value:function(e){this.groupManager.collapseGroup(e)}},{key:"expandGroup",value:function(e){this.groupManager.expandGroup(e)}},{key:"toggleGroup",value:function(e){this.groupManager.toggleGroup(e)}},{key:"removeGroup",value:function(e,t,n,o){return this.groupManager.removeGroup(e,t,n,o)}},{key:"removeAllGroups",value:function(e,t){this.groupManager.removeAllGroups(e,t,!1)}},{key:"removeFromGroup",value:function(e,t,n){this.groupManager.removeFromGroup(e,n,t),this._appendElement(t,this.getContainer()),this.updateOffset({recalc:!0,elId:this.getId(t)})}},{key:"_paintEndpoint",value:function(e,t){function n(C){var S=0;if(t.elementWithPrecedence!=null){for(var b=0;b<C.connections.length;b++)if(C.connections[b].sourceId===t.elementWithPrecedence||C.connections[b].targetId===t.elementWithPrecedence){S=b;break}}return C.connections[S]}t=t||{};var o=t.timestamp,l=t.recalc!==!1;if(!o||e.timestamp!==o){var u=this.viewport.getPosition(e.elementId),c=t.offset?{x:t.offset.x,y:t.offset.y}:{x:u.x,y:u.y};if(c!=null){var h=t.anchorLoc;if(h==null){var d={xy:c,wh:u,element:e,timestamp:o};if(l&&this.router.isDynamicAnchor(e)&&e.connections.length>0){var v=n(e),p=v.endpoints[0]===e?1:0,m=p===0?v.sourceId:v.targetId,g=this.viewport.getPosition(m);d.index=p===0?1:0,d.connection=v,d.txy=g,d.twh=g,d.tElement=v.endpoints[p],d.tRotation=this._getRotations(m)}else e.connections.length>0&&(d.connection=e.connections[0]);d.rotation=this._getRotations(e.elementId),h=this.router.computeAnchorLocation(e._anchor,d)}e.endpoint.compute(h,this.router.getEndpointOrientation(e),e.paintStyleInUse),this.renderEndpoint(e,e.paintStyleInUse),e.timestamp=o;for(var E in e.overlays)if(e.overlays.hasOwnProperty(E)){var x=e.overlays[E];x.isVisible()&&(e.overlayPlacements[E]=this.drawOverlay(x,e.endpoint,e.paintStyleInUse,e.getAbsoluteOverlayPosition(x)),this._paintOverlay(x,e.overlayPlacements[E],{xmin:0,ymin:0}))}}}}},{key:"_paintConnection",value:function(e,t){if(!this._suspendDrawing&&e.visible!==!1){t=t||{};var n=t.timestamp;if(n!=null&&n===e.lastPaintedAt)return;if(n==null||n!==e.lastPaintedAt){this.router.computePath(e,n);var o={xmin:1/0,ymin:1/0,xmax:-1/0,ymax:-1/0};for(var l in e.overlays)if(e.overlays.hasOwnProperty(l)){var u=e.overlays[l];u.isVisible()&&(e.overlayPlacements[l]=this.drawOverlay(u,e.connector,e.paintStyleInUse,e.getAbsoluteOverlayPosition(u)),o.xmin=Math.min(o.xmin,e.overlayPlacements[l].xmin),o.xmax=Math.max(o.xmax,e.overlayPlacements[l].xmax),o.ymin=Math.min(o.ymin,e.overlayPlacements[l].ymin),o.ymax=Math.max(o.ymax,e.overlayPlacements[l].ymax))}var c=parseFloat(""+e.paintStyleInUse.strokeWidth||"1")/2,h=parseFloat(""+e.paintStyleInUse.strokeWidth||"0"),d={xmin:Math.min(e.connector.bounds.xmin-(c+h),o.xmin),ymin:Math.min(e.connector.bounds.ymin-(c+h),o.ymin),xmax:Math.max(e.connector.bounds.xmax+(c+h),o.xmax),ymax:Math.max(e.connector.bounds.ymax+(c+h),o.ymax)};this.paintConnector(e.connector,e.paintStyleInUse,d);for(var v in e.overlays)if(e.overlays.hasOwnProperty(v)){var p=e.overlays[v];p.isVisible()&&this._paintOverlay(p,e.overlayPlacements[v],d)}}e.lastPaintedAt=n}}},{key:"_refreshEndpoint",value:function(e){e._anchor.isFloating||(e.connections.length>0?this.addEndpointClass(e,this.endpointConnectedClass):this.removeEndpointClass(e,this.endpointConnectedClass),e.isFull()?this.addEndpointClass(e,this.endpointFullClass):this.removeEndpointClass(e,this.endpointFullClass))}},{key:"_makeConnector",value:function(e,t,n){return Xn.get(e,t,n)}},{key:"addOverlay",value:function(e,t,n){if(e.addOverlay(t),!n){var o=e instanceof rn?e.element:e.source;this.revalidate(o)}}},{key:"removeOverlay",value:function(e,t){e.removeOverlay(t);var n=e instanceof rn?e.element:e.source;this.revalidate(n)}},{key:"setOutlineColor",value:function(e,t){e.paintStyleInUse.outlineStroke=t,this._paintConnection(e)}},{key:"setOutlineWidth",value:function(e,t){e.paintStyleInUse.outlineWidth=t,this._paintConnection(e)}},{key:"setColor",value:function(e,t){e.paintStyleInUse.stroke=t,this._paintConnection(e)}},{key:"setLineWidth",value:function(e,t){e.paintStyleInUse.strokeWidth=t,this._paintConnection(e)}},{key:"setLineStyle",value:function(e,t){t.lineWidth!=null&&(e.paintStyleInUse.strokeWidth=t.lineWidth),t.outlineWidth!=null&&(e.paintStyleInUse.outlineWidth=t.outlineWidth),t.color!=null&&(e.paintStyleInUse.stroke=t.color),t.outlineColor!=null&&(e.paintStyleInUse.outlineStroke=t.outlineColor),this._paintConnection(e)}},{key:"getPathData",value:function(e){for(var t="",n=0;n<e.segments.length;n++)t+=e.segments[n].getPath(n===0),t+=" ";return t}}]),r}($n),ea={};function Vi(s,a){ea[s]=a}function Uo(s,a,r){var i=a,e=on(a.getBoundingClientRect)!==Ls?a.getBoundingClientRect():{left:0,top:0,width:0,height:0},t=document.body,n=document.documentElement,o=window.pageYOffset||n.scrollTop||t.scrollTop,l=window.pageXOffset||n.scrollLeft||t.scrollLeft,u=n.clientTop||t.clientTop||0,c=n.clientLeft||t.clientLeft||0,h=0,d=0,v=e.top+o-u+h*r,p=e.left+l-c+d*r,m=Cr(s),g=e.width||i.offsetWidth*r,E=e.height||i.offsetHeight*r,x=(m.x-p)/g,C=(m.y-v)/E;return{x,y:C}}function qt(s){return ai(s)||li(s)||ui(s)}function Vo(s,a){s.canvas&&(s.canvas.style.display=a?"block":"none")}function Ho(s){s.canvas&&s.canvas.parentNode.removeChild(s.canvas),delete s.canvas}function _n(s){return s.canvas}function Xe(s){return Bi.getElement(s)}function It(s){return Bi.getElement(s,s.component,function(a){var r=s.create(a);return s.instance.addClass(r,s.instance.overlayClass),r})}function bh(s,a,r,i){var e=s.x,t=s.y;return a._jsPlumbParentGroup&&a._jsPlumbParentGroup.constrain&&(e=Math.max(s.x,0),t=Math.max(s.y,0),e=Math.min(e,r.w-i.w),t=Math.min(t,r.h-i.h)),{x:e,y:t}}var Ph=function(s){fe(r,s);var a=de(r);function r(i,e){var t;if(H(this,r),t=a.call(this,i,e),t._instanceIndex=i,f(y(t),"containerType",null),f(y(t),"dragSelection",void 0),f(y(t),"dragManager",void 0),f(y(t),"_connectorClick",void 0),f(y(t),"_connectorDblClick",void 0),f(y(t),"_connectorTap",void 0),f(y(t),"_connectorDblTap",void 0),f(y(t),"_endpointClick",void 0),f(y(t),"_endpointDblClick",void 0),f(y(t),"_overlayClick",void 0),f(y(t),"_overlayDblClick",void 0),f(y(t),"_overlayTap",void 0),f(y(t),"_overlayDblTap",void 0),f(y(t),"_connectorMouseover",void 0),f(y(t),"_connectorMouseout",void 0),f(y(t),"_endpointMouseover",void 0),f(y(t),"_endpointMouseout",void 0),f(y(t),"_connectorContextmenu",void 0),f(y(t),"_connectorMousedown",void 0),f(y(t),"_connectorMouseup",void 0),f(y(t),"_endpointMousedown",void 0),f(y(t),"_endpointMouseup",void 0),f(y(t),"_overlayMouseover",void 0),f(y(t),"_overlayMouseout",void 0),f(y(t),"_elementClick",void 0),f(y(t),"_elementTap",void 0),f(y(t),"_elementDblTap",void 0),f(y(t),"_elementMouseenter",void 0),f(y(t),"_elementMouseexit",void 0),f(y(t),"_elementMousemove",void 0),f(y(t),"_elementMouseup",void 0),f(y(t),"_elementMousedown",void 0),f(y(t),"_elementContextmenu",void 0),f(y(t),"_resizeObserver",void 0),f(y(t),"eventManager",void 0),f(y(t),"draggingClass","jtk-dragging"),f(y(t),"elementDraggingClass","jtk-element-dragging"),f(y(t),"hoverClass","jtk-hover"),f(y(t),"sourceElementDraggingClass","jtk-source-element-dragging"),f(y(t),"targetElementDraggingClass","jtk-target-element-dragging"),f(y(t),"hoverSourceClass","jtk-source-hover"),f(y(t),"hoverTargetClass","jtk-target-hover"),f(y(t),"dragSelectClass","jtk-drag-select"),f(y(t),"managedElementsSelector",void 0),f(y(t),"elementsDraggable",void 0),f(y(t),"elementDragHandler",void 0),f(y(t),"groupDragOptions",void 0),f(y(t),"elementDragOptions",void 0),f(y(t),"svg",{node:function(o,l){return ct(o,l)},attr:function(o,l){return ut(o,l)},pos:function(o){return ks(o)}}),e=e||{},t.containerType=Qr(t.getContainer()),t.elementsDraggable=e&&e.elementsDraggable!==!1,t.managedElementsSelector=e&&e.managedElementsSelector||me,t.eventManager=new Li,t.dragSelection=new ic(y(t)),t.dragManager=new cc(y(t),t.dragSelection),t.dragManager.addHandler(new To(y(t))),t.groupDragOptions={constrainFunction:bh},t.dragManager.addHandler(new Oo(y(t),t.dragSelection),t.groupDragOptions),t.elementDragHandler=new oi(y(t),t.dragSelection),t.elementDragOptions=e&&e.dragOptions||{},t.dragManager.addHandler(t.elementDragHandler,t.elementDragOptions),e&&e.dragOptions&&e.dragOptions.filter&&t.dragManager.addFilter(e.dragOptions.filter),t._createEventListeners(),t._attachEventDelegates(),e.resizeObserver!==!1)try{t._resizeObserver=new ResizeObserver(function(n){var o=n.filter(function(l){var u=t.getAttribute(l.target,yt);if(u!=null){var c=t.viewport._elementMap.get(u);return c?c.w!==l.contentRect.width||c.h!==l.contentRect.height:!1}else return!1});o.forEach(function(l){return t.revalidate(l.target)})})}catch{Oe("WARN: ResizeObserver could not be attached.")}return t}return K(r,[{key:"fireOverlayMethod",value:function(e,t,n){var o=e.component instanceof Vn?rt:Ht,l=ye(o,t);n._jsPlumbOverlay=e,e.fire(t,{e:n,overlay:e}),this.fire(l,e.component,n)}},{key:"addDragFilter",value:function(e,t){this.dragManager.addFilter(e,t)}},{key:"removeDragFilter",value:function(e){this.dragManager.removeFilter(e)}},{key:"setDragGrid",value:function(e){this.dragManager.setOption(this.elementDragHandler,{grid:e})}},{key:"setDragConstrainFunction",value:function(e){this.dragManager.setOption(this.elementDragHandler,{constrainFunction:e})}},{key:"_removeElement",value:function(e){e.parentNode&&e.parentNode.removeChild(e)}},{key:"_appendElement",value:function(e,t){t&&t.appendChild(e)}},{key:"_appendElementToGroup",value:function(e,t){this.getGroupContentArea(e).appendChild(t)}},{key:"_appendElementToContainer",value:function(e){this._appendElement(e,this.getContainer())}},{key:"_getAssociatedElements",value:function(e){var t=[];if(e.nodeType!==3&&e.nodeType!==8){var n=e.querySelectorAll(me);Array.prototype.push.apply(t,n)}return t.filter(function(o){return o.nodeType!==3&&o.nodeType!==8})}},{key:"shouldFireEvent",value:function(e,t,n){return!0}},{key:"getClass",value:function(e){return Ja(e)}},{key:"addClass",value:function(e,t){kt(e,t)}},{key:"hasClass",value:function(e,t){return Qa(e,t)}},{key:"removeClass",value:function(e,t){Jr(e,t)}},{key:"toggleClass",value:function(e,t){qa(e,t)}},{key:"setAttribute",value:function(e,t,n){e.setAttribute(t,n)}},{key:"getAttribute",value:function(e,t){return e.getAttribute(t)}},{key:"setAttributes",value:function(e,t){for(var n in t)e.setAttribute(n,t[n])}},{key:"removeAttribute",value:function(e,t){e.removeAttribute&&e.removeAttribute(t)}},{key:"on",value:function(e,t,n,o){var l=this,u=function(h){o==null?l.eventManager.on(h,t,n):l.eventManager.on(h,t,n,o)};return jn(e)?X(e,function(c){return u(c)}):u(e),this}},{key:"off",value:function(e,t,n){var o=this;return jn(e)?X(e,function(l){return o.eventManager.off(l,t,n)}):this.eventManager.off(e,t,n),this}},{key:"trigger",value:function(e,t,n,o,l){this.eventManager.trigger(e,t,n,o,l)}},{key:"getOffsetRelativeToRoot",value:function(e){return tn(e)}},{key:"getOffset",value:function(e){for(var t=e,n=this.getContainer(),o=this.getPosition(t),l=e!==n&&t.offsetParent!==n?t.offsetParent:null,u=function(v){v!=null&&v!==document.body&&(v.scrollTop>0||v.scrollLeft>0)&&(o.x-=v.scrollLeft,o.y-=v.scrollTop)};l!=null;)o.x+=l.offsetLeft,o.y+=l.offsetTop,u(l),l=l.offsetParent===n?null:l.offsetParent;if(n!=null&&(n.scrollTop>0||n.scrollLeft>0)){var c=t.offsetParent!=null?this.getStyle(t.offsetParent,lo):ol,h=this.getStyle(t,lo);h!==Fn&&h!==qi&&c!==Fn&&c!==qi&&(o.x-=n.scrollLeft,o.y-=n.scrollTop)}return o}},{key:"getSize",value:function(e){var t=e;if(t.offsetWidth!=null)return el(e);if(t.width&&t.width.baseVal)return tl(t)}},{key:"getPosition",value:function(e){var t=e;if(t.offsetLeft!=null)return{x:parseFloat(t.offsetLeft),y:parseFloat(t.offsetTop)};if(t.x&&t.x.baseVal)return nl(t)}},{key:"getStyle",value:function(e,t){return on(window.getComputedStyle)!==Ls?getComputedStyle(e,null).getPropertyValue(t):e.currentStyle[t]}},{key:"getGroupContentArea",value:function(e){var t=this.getSelector(e.el,pu);return t&&t.length>0?t[0]:e.el}},{key:"getSelector",value:function(e,t){var n=null;if(arguments.length===1){if(!Ce(e)){var o=document.createDocumentFragment();return o.appendChild(e),Zn(o.childNodes)}n=Zn(document.querySelectorAll(e))}else n=Zn(e.querySelectorAll(t));return n}},{key:"setPosition",value:function(e,t){var n=e;n.style.left=t.x+"px",n.style.top=t.y+"px"}},{key:"setDraggable",value:function(e,t){t?this.removeAttribute(e,ur):this.setAttribute(e,ur,ws)}},{key:"isDraggable",value:function(e){var t=this.getAttribute(e,ur);return t==null||t===nn}},{key:"toggleDraggable",value:function(e){var t=this.isDraggable(e);return this.setDraggable(e,!t),!t}},{key:"_createEventListeners",value:function(){var e=function(E,x){if(!x.defaultPrevented&&x._jsPlumbOverlay==null){var C=st(je(x),$e,this.getContainer(),!0);this.fire(E,C.jtk.connector.connection,x)}};this._connectorClick=e.bind(this,ou),this._connectorDblClick=e.bind(this,su),this._connectorTap=e.bind(this,du),this._connectorDblTap=e.bind(this,au);var t=function(E,x){var C=je(x).parentNode;if(C.jtk&&C.jtk.connector){var S=C.jtk.connector,b=S.connection;this.setConnectorHover(S,E),E?(this.addClass(b.source,this.hoverSourceClass),this.addClass(b.target,this.hoverTargetClass)):(this.removeClass(b.source,this.hoverSourceClass),this.removeClass(b.target,this.hoverTargetClass)),this.fire(E?uu:lu,C.jtk.connector.connection,x)}};this._connectorMouseover=t.bind(this,!0),this._connectorMouseout=t.bind(this,!1);var n=function(E,x){var C=je(x).parentNode;C.jtk&&C.jtk.connector&&this.fire(E?cu:hu,C.jtk.connector.connection,x)};this._connectorMouseup=n.bind(this,!0),this._connectorMousedown=n.bind(this,!1),this._connectorContextmenu=(function(g){var E=je(g).parentNode;E.jtk&&E.jtk.connector&&this.fire(fu,E.jtk.connector.connection,g)}).bind(this);var o=function(E,x,C){!x.defaultPrevented&&x._jsPlumbOverlay==null&&this.fire(E,C.jtk.endpoint,x)};this._endpointClick=o.bind(this,ql),this._endpointDblClick=o.bind(this,eu);var l=function(E,x){var C=je(x);C.jtk&&C.jtk.endpoint&&(this.setEndpointHover(C.jtk.endpoint,E),this.fire(E?nu:tu,C.jtk.endpoint,x))};this._endpointMouseover=l.bind(this,!0),this._endpointMouseout=l.bind(this,!1);var u=function(E,x){var C=je(x);C.jtk&&C.jtk.endpoint&&this.fire(E?ru:iu,C.jtk.endpoint,x)};this._endpointMouseup=u.bind(this,!0),this._endpointMousedown=u.bind(this,!1);var c=(function(g,E){var x=st(je(E),ot,this.getContainer(),!0),C=x.jtk.overlay;C&&this.fireOverlayMethod(C,g,E)}).bind(this);this._overlayClick=c.bind(this,Re),this._overlayDblClick=c.bind(this,Fe),this._overlayTap=c.bind(this,Ke),this._overlayDblTap=c.bind(this,We);var h=function(E,x){var C=st(je(x),ot,this.getContainer(),!0),S=C.jtk.overlay;S&&this.setOverlayHover(S,E)};this._overlayMouseover=h.bind(this,!0),this._overlayMouseout=h.bind(this,!1);var d=function(E,x,C){x.defaultPrevented||this.fire(x.detail===1?oo:Xl,C,x)};this._elementClick=d.bind(this,oo);var v=function(E,x,C){x.defaultPrevented||this.fire(ao,C,x)};this._elementTap=v.bind(this,ao);var p=function(E,x,C){x.defaultPrevented||this.fire(so,C,x)};this._elementDblTap=p.bind(this,so);var m=function(E,x){this.fire(E?Kl:Wl,je(x),x)};this._elementMouseenter=m.bind(this,!0),this._elementMouseexit=m.bind(this,!1),this._elementMousemove=(function(g){this.fire(zl,je(g),g)}).bind(this),this._elementMouseup=(function(g){this.fire(Zl,je(g),g)}).bind(this),this._elementMousedown=(function(g){this.fire(Jl,je(g),g)}).bind(this),this._elementContextmenu=(function(g){this.fire(Ql,je(g),g)}).bind(this)}},{key:"_attachEventDelegates",value:function(){var e=this.getContainer();this.eventManager.on(e,Re,ot,this._overlayClick),this.eventManager.on(e,Fe,ot,this._overlayDblClick),this.eventManager.on(e,Ke,ot,this._overlayTap),this.eventManager.on(e,We,ot,this._overlayDblTap),this.eventManager.on(e,Re,$e,this._connectorClick),this.eventManager.on(e,Fe,$e,this._connectorDblClick),this.eventManager.on(e,Ke,$e,this._connectorTap),this.eventManager.on(e,We,$e,this._connectorDblTap),this.eventManager.on(e,Re,At,this._endpointClick),this.eventManager.on(e,Fe,At,this._endpointDblClick),this.eventManager.on(e,Re,this.managedElementsSelector,this._elementClick),this.eventManager.on(e,Ke,this.managedElementsSelector,this._elementTap),this.eventManager.on(e,We,this.managedElementsSelector,this._elementDblTap),this.eventManager.on(e,Ve,$e,this._connectorMouseover),this.eventManager.on(e,Ue,$e,this._connectorMouseout),this.eventManager.on(e,at,$e,this._connectorContextmenu),this.eventManager.on(e,ne,$e,this._connectorMouseup),this.eventManager.on(e,te,$e,this._connectorMousedown),this.eventManager.on(e,Ve,At,this._endpointMouseover),this.eventManager.on(e,Ue,At,this._endpointMouseout),this.eventManager.on(e,ne,At,this._endpointMouseup),this.eventManager.on(e,te,At,this._endpointMousedown),this.eventManager.on(e,Ve,ot,this._overlayMouseover),this.eventManager.on(e,Ue,ot,this._overlayMouseout),this.eventManager.on(e,Ve,me,this._elementMouseenter),this.eventManager.on(e,Ue,me,this._elementMouseexit),this.eventManager.on(e,De,me,this._elementMousemove),this.eventManager.on(e,ne,me,this._elementMouseup),this.eventManager.on(e,te,me,this._elementMousedown),this.eventManager.on(e,at,me,this._elementContextmenu)}},{key:"_detachEventDelegates",value:function(){var e=this.getContainer();e&&(this.eventManager.off(e,Re,this._connectorClick),this.eventManager.off(e,Fe,this._connectorDblClick),this.eventManager.off(e,Ke,this._connectorTap),this.eventManager.off(e,We,this._connectorDblTap),this.eventManager.off(e,Re,this._endpointClick),this.eventManager.off(e,Fe,this._endpointDblClick),this.eventManager.off(e,Re,this._overlayClick),this.eventManager.off(e,Fe,this._overlayDblClick),this.eventManager.off(e,Ke,this._overlayTap),this.eventManager.off(e,We,this._overlayDblTap),this.eventManager.off(e,Re,this._elementClick),this.eventManager.off(e,Ke,this._elementTap),this.eventManager.off(e,We,this._elementDblTap),this.eventManager.off(e,Ve,this._connectorMouseover),this.eventManager.off(e,Ue,this._connectorMouseout),this.eventManager.off(e,at,this._connectorContextmenu),this.eventManager.off(e,ne,this._connectorMouseup),this.eventManager.off(e,te,this._connectorMousedown),this.eventManager.off(e,Ve,this._endpointMouseover),this.eventManager.off(e,Ue,this._endpointMouseout),this.eventManager.off(e,ne,this._endpointMouseup),this.eventManager.off(e,te,this._endpointMousedown),this.eventManager.off(e,Ve,this._overlayMouseover),this.eventManager.off(e,Ue,this._overlayMouseout),this.eventManager.off(e,_i,this._elementMouseenter),this.eventManager.off(e,Ii,this._elementMouseexit),this.eventManager.off(e,De,this._elementMousemove),this.eventManager.off(e,ne,this._elementMouseup),this.eventManager.off(e,te,this._elementMousedown),this.eventManager.off(e,at,this._elementContextmenu))}},{key:"setContainer",value:function(e){var t=this;if(e===document||e===document.body)throw new Error("Cannot set document or document.body as container element");this._detachEventDelegates();var n;this.dragManager!=null&&(n=this.dragManager.reset()),this.setAttribute(e,ro,Ae().replace("-",""));var o=this.getContainer();if(o!=null){o.removeAttribute(ro);var l=Zn(o.childNodes).filter(function(u){return u!=null&&(t.hasClass(u,Pi)||t.hasClass(u,sn)||t.hasClass(u,wr)||u.getAttribute&&u.getAttribute(yt)!=null)});X(l,function(u){e.appendChild(u)})}xe(Ee(r.prototype),"setContainer",this).call(this,e),this.containerType=Qr(e),this.eventManager!=null&&this._attachEventDelegates(),this.dragManager!=null&&(this.dragManager.addHandler(new To(this)),this.dragManager.addHandler(new Oo(this,this.dragSelection),this.groupDragOptions),this.elementDragHandler=new oi(this,this.dragSelection),this.dragManager.addHandler(this.elementDragHandler,this.elementDragOptions),n!=null&&this.dragManager.setFilters(n))}},{key:"reset",value:function(){xe(Ee(r.prototype),"reset",this).call(this),this._resizeObserver&&this._resizeObserver.disconnect();var e=this.getContainer(),t=e.querySelectorAll([me,At,$e,ot].join(","));X(t,function(n){return n.parentNode&&n.parentNode.removeChild(n)})}},{key:"destroy",value:function(){this._detachEventDelegates(),this.dragManager!=null&&this.dragManager.reset(),this.clearDragSelection(),xe(Ee(r.prototype),"destroy",this).call(this)}},{key:"unmanage",value:function(e,t){this._resizeObserver!=null&&this._resizeObserver.unobserve(e),this.removeFromDragSelection(e),xe(Ee(r.prototype),"unmanage",this).call(this,e,t)}},{key:"addToDragSelection",value:function(){for(var e=this,t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];X(n,function(l){return e.dragSelection.add(l)})}},{key:"clearDragSelection",value:function(){this.dragSelection.clear()}},{key:"removeFromDragSelection",value:function(){for(var e=this,t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];X(n,function(l){return e.dragSelection.remove(l)})}},{key:"toggleDragSelection",value:function(){for(var e=this,t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];X(n,function(l){return e.dragSelection.toggle(l)})}},{key:"addToDragGroup",value:function(e){for(var t,n=arguments.length,o=new Array(n>1?n-1:0),l=1;l<n;l++)o[l-1]=arguments[l];(t=this.elementDragHandler).addToDragGroup.apply(t,[e].concat(o))}},{key:"removeFromDragGroup",value:function(){var e;(e=this.elementDragHandler).removeFromDragGroup.apply(e,arguments)}},{key:"setDragGroupState",value:function(e){for(var t,n=arguments.length,o=new Array(n>1?n-1:0),l=1;l<n;l++)o[l-1]=arguments[l];(t=this.elementDragHandler).setDragGroupState.apply(t,[e].concat(o))}},{key:"clearDragGroup",value:function(e){this.elementDragHandler.clearDragGroup(e)}},{key:"consume",value:function(e,t){Gn(e,t)}},{key:"rotate",value:function(e,t,n){var o=this.getId(e);return this._managedElements[o]?(this._managedElements[o].el.style.transform="rotate("+t+"deg)",this._managedElements[o].el.style.transformOrigin="center center",xe(Ee(r.prototype),"rotate",this).call(this,e,t,n)):{c:new Set,e:new Set}}},{key:"addOverlayClass",value:function(e,t){if(dt(e))e.instance.addClass(Xe(e),t);else if(qt(e))e.instance.addClass(wn(e),t);else if(vt(e))e.instance.addClass(It(e),t);else throw"Could not add class to overlay of type ["+e.type+"]"}},{key:"removeOverlayClass",value:function(e,t){if(dt(e))e.instance.removeClass(Xe(e),t);else if(qt(e))e.instance.removeClass(wn(e),t);else if(vt(e))e.instance.removeClass(It(e),t);else throw"Could not remove class from overlay of type ["+e.type+"]"}},{key:"_paintOverlay",value:function(e,t,n){if(dt(e)){Xe(e);var o=e.component.getXY();e.canvas.style.left=o.x+t.d.minx+"px",e.canvas.style.top=o.y+t.d.miny+"px"}else if(qt(e)){var l=isNaN(t.d.cxy.x)||isNaN(t.d.cxy.y)?"M 0 0":"M"+t.d.hxy.x+","+t.d.hxy.y+" L"+t.d.tail[0].x+","+t.d.tail[0].y+" L"+t.d.cxy.x+","+t.d.cxy.y+" L"+t.d.tail[1].x+","+t.d.tail[1].y+" Z";Qc(e,l,t,n)}else if(vt(e)){It(e);var u=e.component.getXY();e.canvas.style.left=u.x+t.d.minx+"px",e.canvas.style.top=u.y+t.d.miny+"px"}else throw"Could not paint overlay of type ["+e.type+"]"}},{key:"setOverlayVisible",value:function(e,t){var n=t?"block":"none";function o(l){l!=null&&(l.style.display=n)}dt(e)?o(Xe(e)):vt(e)?o(It(e)):qt(e)&&o(e.path)}},{key:"reattachOverlay",value:function(e,t){dt(e)?e.instance._appendElement(Xe(e),this.getContainer()):vt(e)?e.instance._appendElement(It(e),this.getContainer()):qt(e)&&this._appendElement(wn(e),t.connector.canvas)}},{key:"setOverlayHover",value:function(e,t){var n;dt(e)?n=Xe(e):vt(e)?n=It(e):qt(e)&&(n=wn(e)),n!=null&&(this.hoverClass!=null&&(t?this.addClass(n,this.hoverClass):this.removeClass(n,this.hoverClass)),this.setHover(e.component,t))}},{key:"destroyOverlay",value:function(e){if(dt(e)){var t=Xe(e);t.parentNode.removeChild(t),delete e.canvas,delete e.cachedDimensions}else if(ai(e)||li(e)||ui(e))qc(e);else if(vt(e)){var n=It(e);n.parentNode.removeChild(n),delete e.canvas,delete e.cachedDimensions}}},{key:"drawOverlay",value:function(e,t,n,o){if(dt(e)||vt(e)){var l=Bi._getDimensions(e);if(l!=null&&l.w!=null&&l.h!=null){var u={x:0,y:0};if(o)u={x:o.x,y:o.y};else if(t instanceof pn){var c=Array.isArray(e.location)?e.location:[e.location,e.location];u={x:c[0]*t.w,y:c[1]*t.h}}else{var h=e.location,d=!1;(Ce(e.location)||e.location<0||e.location>1)&&(h=parseInt(""+e.location,10),d=!0),u=t.pointOnPath(h,d)}var v=u.x-l.w/2,p=u.y-l.h/2;return{component:e,d:{minx:v,miny:p,td:l,cxy:u},xmin:v,xmax:v+l.w,ymin:p,ymax:p+l.h}}else return{xmin:0,xmax:0,ymin:0,ymax:0}}else{if(ai(e)||li(e)||ui(e))return e.draw(t,n,o);throw"Could not draw overlay of type ["+e.type+"]"}}},{key:"updateLabel",value:function(e){if(Nt(e.label)){var t=e.label(this);t!=null?Xe(e).innerText=t:Xe(e).innerText=""}else e.labelText==null&&(e.labelText=e.label,e.labelText!=null?Xe(e).innerText=e.labelText:Xe(e).innerText="")}},{key:"setHover",value:function(e,t){e._hover=t,e instanceof rn&&e.endpoint!=null?this.setEndpointHover(e,t,-1):e instanceof Vn&&e.connector!=null&&this.setConnectorHover(e.connector,t)}},{key:"paintConnector",value:function(e,t,n){eh(this,e,t,n)}},{key:"setConnectorHover",value:function(e,t,n){if(t===!1||!this.currentlyDragging&&!this.isHoverSuspended()){var o=e.canvas;o!=null&&(e.hoverClass!=null&&(t?this.addClass(o,e.hoverClass):this.removeClass(o,e.hoverClass)),t?this.addClass(o,this.hoverClass):this.removeClass(o,this.hoverClass)),e.connection.hoverPaintStyle!=null&&(e.connection.paintStyleInUse=t?e.connection.hoverPaintStyle:e.connection.paintStyle,this._suspendDrawing||this._paintConnection(e.connection)),e.connection.endpoints[0]!==n&&this.setEndpointHover(e.connection.endpoints[0],t,0,!0),e.connection.endpoints[1]!==n&&this.setEndpointHover(e.connection.endpoints[1],t,1,!0)}}},{key:"destroyConnector",value:function(e){e.connector!=null&&Ho(e.connector)}},{key:"addConnectorClass",value:function(e,t){e.canvas&&this.addClass(e.canvas,t)}},{key:"removeConnectorClass",value:function(e,t){e.canvas&&this.removeClass(e.canvas,t)}},{key:"getConnectorClass",value:function(e){return e.canvas?e.canvas.className.baseVal:""}},{key:"setConnectorVisible",value:function(e,t){Vo(e,t)}},{key:"applyConnectorType",value:function(e,t){if(e.canvas&&t.cssClass){var n=Array.isArray(t.cssClass)?t.cssClass:[t.cssClass];this.addClass(e.canvas,n.join(" "))}}},{key:"addEndpointClass",value:function(e,t){var n=_n(e.endpoint);n!=null&&this.addClass(n,t)}},{key:"applyEndpointType",value:function(e,t){if(t.cssClass){var n=_n(e.endpoint);if(n){var o=Array.isArray(t.cssClass)?t.cssClass:[t.cssClass];this.addClass(n,o.join(" "))}}}},{key:"destroyEndpoint",value:function(e){var t=this.endpointAnchorClassPrefix+(e.currentAnchorClass?"-"+e.currentAnchorClass:"");this.removeClass(e.element,t),Ho(e.endpoint)}},{key:"renderEndpoint",value:function(e,t){var n=ea[e.endpoint.type];n!=null?nh.paint(e.endpoint,n,t):Oe("jsPlumb: no endpoint renderer found for type ["+e.endpoint.type+"]")}},{key:"removeEndpointClass",value:function(e,t){var n=_n(e.endpoint);n!=null&&this.removeClass(n,t)}},{key:"getEndpointClass",value:function(e){var t=_n(e.endpoint);return t!=null?t.className:""}},{key:"setEndpointHover",value:function(e,t,n,o){if(e!=null&&(t===!1||!this.currentlyDragging&&!this.isHoverSuspended())){var l=_n(e.endpoint);if(l!=null&&(e.hoverClass!=null&&(t?this.addClass(l,e.hoverClass):this.removeClass(l,e.hoverClass)),n===0||n===1)){var u=n===0?this.hoverSourceClass:this.hoverTargetClass;t?this.addClass(l,u):this.removeClass(l,u)}if(e.hoverPaintStyle!=null&&(e.paintStyleInUse=t?e.hoverPaintStyle:e.paintStyle,this._suspendDrawing||this.renderEndpoint(e,e.paintStyleInUse)),!o)for(var c=0;c<e.connections.length;c++)this.setConnectorHover(e.connections[c].connector,t,e)}}},{key:"setEndpointVisible",value:function(e,t){Vo(e.endpoint,t)}},{key:"setGroupVisible",value:function(e,t){for(var n=e.el.querySelectorAll(me),o=0;o<n.length;o++)t?this.show(n[o],!0):this.hide(n[o],!0)}},{key:"deleteConnection",value:function(e,t){return e!=null&&e.deleted!==!0?(e.endpoints[0].deleted!==!0&&this.setEndpointHover(e.endpoints[0],!1,0,!0),e.endpoints[1].deleted!==!0&&this.setEndpointHover(e.endpoints[1],!1,1,!0),xe(Ee(r.prototype),"deleteConnection",this).call(this,e,t)):!1}},{key:"addSourceSelector",value:function(e,t,n){return this.addDragFilter(e),xe(Ee(r.prototype),"addSourceSelector",this).call(this,e,t,n)}},{key:"removeSourceSelector",value:function(e){this.removeDragFilter(e.selector),xe(Ee(r.prototype),"removeSourceSelector",this).call(this,e)}},{key:"manage",value:function(e,t,n){if(this.containerType===jt.SVG&&!rl(e))throw new Error("ERROR: cannot manage non-svg element when container is an SVG element.");var o=xe(Ee(r.prototype),"manage",this).call(this,e,t,n);return o!=null&&this._resizeObserver!=null&&this._resizeObserver.observe(o.el),o}}]),r}(Sh),Th="circle",Oh=function(){Vi(Vt.type,{makeNode:function(r,i){return ct(Th,{cx:r.w/2,cy:r.h/2,r:r.radius})},updateNode:function(r,i){ut(i,{cx:""+r.w/2,cy:""+r.h/2,r:""+r.radius})}})},Hn=function(s){fe(r,s);var a=de(r);function r(i,e){var t;return H(this,r),t=a.call(this,i,e),f(y(t),"width",void 0),f(y(t),"height",void 0),f(y(t),"type",r.type),e=e||{},t.width=e.width||10,t.height=e.height||10,t}return K(r,null,[{key:"_getParams",value:function(e){return{width:e.width,height:e.height}}}]),r}(pn);f(Hn,"type","Rectangle");var Ah={type:Hn.type,cls:Hn,compute:function(a,r,i,e){var t=e.width||a.width,n=e.height||a.height,o=r.curX-t/2,l=r.curY-n/2;return a.x=o,a.y=l,a.w=t,a.h=n,[o,l,t,n]},getParams:function(a){return{width:a.width,height:a.height}}},Dh="rect",_h=function(){Vi(Hn.type,{makeNode:function(r,i){return ct(Dh,{width:r.w,height:r.h})},updateNode:function(r,i){ut(i,{width:r.w,height:r.h})}})},_r=function(s){fe(r,s);var a=de(r);function r(i,e){var t;return H(this,r),t=a.call(this,i,e),f(y(t),"type",r.type),t}return r}(pn);f(_r,"type","Blank");var Ih={type:_r.type,cls:_r,compute:function(a,r,i,e){return a.x=r.curX,a.y=r.curY,a.w=10,a.h=0,[r.curX,r.curY,10,0]},getParams:function(a){return{}}},Yo={width:10,height:0,fill:"transparent",stroke:"transparent"},kh=function(){Vi(_r.type,{makeNode:function(r,i){return ct("rect",Yo)},updateNode:function(r,i){ut(i,Yo)}})};Oh();kh();_h();var qe;(function(s){s[s.top=0]="top",s[s.bottom=1]="bottom"})(qe||(qe={}));var Hi=new Map;Hi.set(qe.top,[tt.TopRight,tt.TopLeft]);Hi.set(qe.bottom,[tt.BottomRight,tt.BottomLeft]);var Mh={deriveAnchor:function(a,r,i,e){return Hi.get(a)[r]}},Yi="jtk-scrollable-list",Lh=Lr(Yi),$o="scroll";(function(){function s(a,r){var i=this;H(this,s),this.instance=a,f(this,"options",void 0),f(this,"count",void 0),f(this,"lists",void 0),this.count=0,this.lists={},this.options=r||{},this.instance.bind(Ps,function(e){for(var t=i.instance.getSelector(e.el,Lh),n=0;n<t.length;n++)i.addList(t[n])}),this.instance.bind(Os,function(e){i.removeList(e.el)}),this.instance.bind(Oi,function(e,t){if(t==null){var n=i.findParentList(e.target);n!=null&&n.newConnection(e.connection,e.target,1);var o=i.findParentList(e.source);o!=null&&o.newConnection(e.connection,e.source,0)}}),this.instance.bind(Ds,function(e){var t=e.dropEndpoint.element,n=i.findParentList(t);return n==null||t.offsetTop>=n.domElement.scrollTop&&t.offsetTop+t.offsetHeight<=n.domElement.scrollTop+n.domElement.offsetHeight})}return K(s,[{key:"addList",value:function(r,i){var e=$({},Mh);$(e,this.options),i=$(e,i||{});var t=[this.instance._instanceIndex,this.count++].join("_");return this.lists[t]=new wh(this.instance,r,i,t),this.lists[t]}},{key:"getList",value:function(r){var i=this.instance.getAttribute(r,Yi);if(i!=null)return this.lists[i]}},{key:"removeList",value:function(r){var i=this.getList(r);i&&(i.destroy(),delete this.lists[i.id])}},{key:"findParentList",value:function(r){for(var i=r.parentNode,e=this.instance.getContainer(),t;i!=null&&i!==e&&i!==document;){if(t=this.getList(i),t!=null)return t;i=i.parentNode}}}]),s})();var wh=function(){function s(a,r,i,e){H(this,s),this.instance=a,this.el=r,this.options=i,this.id=e,f(this,"_scrollHandler",void 0),f(this,"domElement",void 0),f(this,"elId",void 0),this.domElement=r,this.elId=this.instance.getId(r),a.setAttribute(r,Yi,e),this._scrollHandler=this.scrollHandler.bind(this),this.domElement._jsPlumbScrollHandler=this._scrollHandler,a.on(r,$o,this._scrollHandler),this._scrollHandler()}return K(s,[{key:"deriveAnchor",value:function(r,i,e,t){return this.options.anchor?this.options.anchor:this.options.deriveAnchor(r,i,e,t)}},{key:"deriveEndpoint",value:function(r,i,e,t){return this.options.deriveEndpoint?this.options.deriveEndpoint(r,i,e,t):this.options.endpoint?this.options.endpoint:e.endpoint.type}},{key:"newConnection",value:function(r,i,e){i.offsetTop<this.el.scrollTop?this._proxyConnection(i,r,e,qe.top):i.offsetTop+i.offsetHeight>this.el.scrollTop+this.domElement.offsetHeight&&this._proxyConnection(i,r,e,qe.bottom)}},{key:"scrollHandler",value:function(){for(var r=this,i=this.instance.getSelector(this.el,me),e=function(o){if(i[o].offsetTop<r.el.scrollTop)i[o]._jsPlumbProxies=i[o]._jsPlumbProxies||[],r.instance.select({source:i[o]}).each(function(u){r._proxyConnection(i[o],u,0,qe.top)}),r.instance.select({target:i[o]}).each(function(u){r._proxyConnection(i[o],u,1,qe.top)});else if(i[o].offsetTop+i[o].offsetHeight>r.el.scrollTop+r.domElement.offsetHeight)i[o]._jsPlumbProxies=i[o]._jsPlumbProxies||[],r.instance.select({source:i[o]}).each(function(u){r._proxyConnection(i[o],u,0,qe.bottom)}),r.instance.select({target:i[o]}).each(function(u){r._proxyConnection(i[o],u,1,qe.bottom)});else if(i[o]._jsPlumbProxies){for(var l=0;l<i[o]._jsPlumbProxies.length;l++)r.instance.unproxyConnection(i[o]._jsPlumbProxies[l][0],i[o]._jsPlumbProxies[l][1]);delete i[o]._jsPlumbProxies}r.instance.revalidate(i[o])},t=0;t<i.length;t++)e(t)}},{key:"_proxyConnection",value:function(r,i,e,t){var n=this;this.instance.proxyConnection(i,e,this.domElement,function(o,l){return n.deriveEndpoint(t,l,i.endpoints[l],i)},function(o,l){return n.deriveAnchor(t,l,i.endpoints[l],i)}),r._jsPlumbProxies=r._jsPlumbProxies||[],r._jsPlumbProxies.push([i,e])}},{key:"destroy",value:function(){this.instance.off(this.el,$o,this._scrollHandler),delete this.domElement._jsPlumbScrollHandler;for(var r=this.instance.getSelector(this.el,me),i=0;i<r.length;i++)if(r[i]._jsPlumbProxies){for(var e=0;e<r[i]._jsPlumbProxies.length;e++)this.instance.unproxyConnection(r[i]._jsPlumbProxies[e][0],r[i]._jsPlumbProxies[e][1]);delete r[i]._jsPlumbProxies}}}]),s}(),Xo=1e-10;function Wo(s){var a=Math.floor(s),r=Math.ceil(s);return s-a<Xo?a:r-s<Xo?r:s}var $i=function(s){fe(r,s);var a=de(r);function r(i){var e;H(this,r),e=a.call(this,i),f(y(e),"type",r.segmentType),f(y(e),"cx",void 0),f(y(e),"cy",void 0),f(y(e),"radius",void 0),f(y(e),"anticlockwise",void 0),f(y(e),"startAngle",void 0),f(y(e),"endAngle",void 0),f(y(e),"sweep",void 0),f(y(e),"length",void 0),f(y(e),"circumference",void 0),f(y(e),"frac",void 0),e.cx=i.cx,e.cy=i.cy,e.radius=i.r,e.anticlockwise=i.ac,i.startAngle&&i.endAngle?(e.startAngle=i.startAngle,e.endAngle=i.endAngle,e.x1=e.cx+e.radius*Math.cos(e.startAngle),e.y1=e.cy+e.radius*Math.sin(e.startAngle),e.x2=e.cx+e.radius*Math.cos(e.endAngle),e.y2=e.cy+e.radius*Math.sin(e.endAngle)):(e.startAngle=e._calcAngle(e.x1,e.y1),e.endAngle=e._calcAngle(e.x2,e.y2)),e.endAngle<0&&(e.endAngle+=Dt),e.startAngle<0&&(e.startAngle+=Dt);var t=e.endAngle<e.startAngle?e.endAngle+Dt:e.endAngle;return e.sweep=Math.abs(t-e.startAngle),e.anticlockwise&&(e.sweep=Dt-e.sweep),e.circumference=2*Math.PI*e.radius,e.frac=e.sweep/Dt,e.length=e.circumference*e.frac,e.extents={xmin:e.cx-e.radius,xmax:e.cx+e.radius,ymin:e.cy-e.radius,ymax:e.cy+e.radius},e}return K(r,[{key:"_calcAngle",value:function(e,t){return Gu({x:this.cx,y:this.cy},{x:e,y:t})}},{key:"_calcAngleForLocation",value:function(e,t){if(e.anticlockwise){var n=e.startAngle<e.endAngle?e.startAngle+Dt:e.startAngle,o=Math.abs(n-e.endAngle);return n-o*t}else{var l=e.endAngle<e.startAngle?e.endAngle+Dt:e.endAngle,u=Math.abs(l-e.startAngle);return e.startAngle+u*t}}},{key:"getPath",value:function(e){var t=this.sweep>Math.PI?1:0,n=this.anticlockwise?0:1;return(e?"M"+this.x1+" "+this.y1+" ":"")+"A "+this.radius+" "+this.radius+" 0 "+t+","+n+" "+this.x2+" "+this.y2}},{key:"getLength",value:function(){return this.length}},{key:"pointOnPath",value:function(e,t){if(e===0)return{x:this.x1,y:this.y1,theta:this.startAngle};if(e===1)return{x:this.x2,y:this.y2,theta:this.endAngle};t&&(e=e/length);var n=this._calcAngleForLocation(this,e),o=this.cx+this.radius*Math.cos(n),l=this.cy+this.radius*Math.sin(n);return{x:Wo(o),y:Wo(l),theta:n}}},{key:"gradientAtPoint",value:function(e,t){var n=this.pointOnPath(e,t),o=Nu({x:this.cx,y:this.cy},n);return!this.anticlockwise&&(o===1/0||o===-1/0)&&(o*=-1),o}},{key:"pointAlongPathFrom",value:function(e,t,n){var o=this.pointOnPath(e,n),l=t/this.circumference*2*Math.PI,u=this.anticlockwise?-1:1,c=o.theta+u*l,h=this.cx+this.radius*Math.cos(c),d=this.cy+this.radius*Math.sin(c);return{x:h,y:d}}}]),r}(ki);f($i,"segmentType","Arc");var ta=function(s){fe(r,s);var a=de(r);function r(i,e){var t;return H(this,r),t=a.call(this,i,e),t.connection=i,f(y(t),"showLoopback",void 0),f(y(t),"curviness",void 0),f(y(t),"margin",void 0),f(y(t),"proximityLimit",void 0),f(y(t),"orientation",void 0),f(y(t),"loopbackRadius",void 0),f(y(t),"clockwise",void 0),f(y(t),"isLoopbackCurrently",void 0),f(y(t),"geometry",null),e=e||{},t.showLoopback=e.showLoopback!==!1,t.curviness=e.curviness||10,t.margin=e.margin||5,t.proximityLimit=e.proximityLimit||80,t.clockwise=e.orientation&&e.orientation==="clockwise",t.loopbackRadius=e.loopbackRadius||25,t.isLoopbackCurrently=!1,t}return K(r,[{key:"getDefaultStubs",value:function(){return[0,0]}},{key:"_compute",value:function(e,t){var n=t.sourcePos,o=t.targetPos,l=Math.abs(n.curX-o.curX),u=Math.abs(n.curY-o.curY);if(!this.showLoopback||t.sourceEndpoint.elementId!==t.targetEndpoint.elementId)this.isLoopbackCurrently=!1,this._computeBezier(e,t,n,o,l,u);else{this.isLoopbackCurrently=!0;var c=t.sourcePos.curX,h=t.sourcePos.curY-this.margin,d=c,v=h-this.loopbackRadius,p=d-this.loopbackRadius,m=v-this.loopbackRadius;l=2*this.loopbackRadius,u=2*this.loopbackRadius,e.points[0]=p,e.points[1]=m,e.points[2]=l,e.points[3]=u,this._addSegment($i,{loopback:!0,x1:c-p+4,y1:h-m,startAngle:0,endAngle:2*Math.PI,r:this.loopbackRadius,ac:!this.clockwise,x2:c-p-4,y2:h-m,cx:d-p,cy:v-m})}}},{key:"exportGeometry",value:function(){return this.geometry==null?null:{controlPoints:[$({},this.geometry.controlPoints[0]),$({},this.geometry.controlPoints[1])],source:$({},this.geometry.source),target:$({},this.geometry.target)}}},{key:"transformGeometry",value:function(e,t,n){return{controlPoints:[{x:e.controlPoints[0].x+t,y:e.controlPoints[0].y+n},{x:e.controlPoints[1].x+t,y:e.controlPoints[1].y+n}],source:this.transformAnchorPlacement(e.source,t,n),target:this.transformAnchorPlacement(e.target,t,n)}}},{key:"importGeometry",value:function(e){return e!=null?e.controlPoints==null||e.controlPoints.length!=2?(Oe("jsPlumb Bezier: cannot import geometry; controlPoints missing or does not have length 2"),this.setGeometry(null,!0),!1):e.controlPoints[0].x==null||e.controlPoints[0].y==null||e.controlPoints[1].x==null||e.controlPoints[1].y==null?(Oe("jsPlumb Bezier: cannot import geometry; controlPoints malformed"),this.setGeometry(null,!0),!1):e.source==null||e.source.curX==null||e.source.curY==null?(Oe("jsPlumb Bezier: cannot import geometry; source missing or malformed"),this.setGeometry(null,!0),!1):e.target==null||e.target.curX==null||e.target.curY==null?(Oe("jsPlumb Bezier: cannot import geometry; target missing or malformed"),this.setGeometry(null,!0),!1):(this.setGeometry(e,!1),!0):!1}}]),r}(Nr),et={subtract:function(a,r){return{x:a.x-r.x,y:a.y-r.y}},dotProduct:function(a,r){return a.x*r.x+a.y*r.y},square:function(a){return Math.sqrt(a.x*a.x+a.y*a.y)},scale:function(a,r){return{x:a.x*r,y:a.y*r}}},na=64,Rh=Math.pow(2,-na-1);function Nh(s,a){for(var r=[],i=jh(s,a),e=a.length-1,t=2*e-1,n=ci(i,t,r,0),o=et.subtract(s,a[0]),l=et.square(o),u=0,c,h=0;h<n;h++)o=et.subtract(s,Xi(a,e,r[h],null,null)),c=et.square(o),c<l&&(l=c,u=r[h]);return o=et.subtract(s,a[e]),c=et.square(o),c<l&&(l=c,u=1),{location:u,distance:l}}function Gh(s,a){var r=Nh(s,a);return{point:Xi(a,a.length-1,r.location,null,null),location:r.location}}function jh(s,a){for(var r=a.length-1,i=2*r-1,e=[],t=[],n=[],o=[],l=[[1,.6,.3,.1],[.4,.6,.6,.4],[.1,.3,.6,1]],u=0;u<=r;u++)e[u]=et.subtract(a[u],s);for(var c=0;c<=r-1;c++)t[c]=et.subtract(a[c+1],a[c]),t[c]=et.scale(t[c],3);for(var h=0;h<=r-1;h++)for(var d=0;d<=r;d++)n[h]||(n[h]=[]),n[h][d]=et.dotProduct(t[h],e[d]);for(var v=0;v<=i;v++)o[v]||(o[v]=[]),o[v].y=0,o[v].x=parseFloat(""+v)/i;for(var p=r,m=r-1,g=0;g<=p+m;g++)for(var E=Math.max(0,g-m),x=Math.min(g,p),C=E;C<=x;C++){var S=g-C;o[C+S].y+=n[S][C]*l[S][C]}return o}function ci(s,a,r,i){var e=[],t=[],n,o,l=[],u=[];switch(Fh(s,a)){case 0:return 0;case 1:{if(i>=na)return r[0]=(s[0].x+s[a].x)/2,1;if(Bh(s,a))return r[0]=Uh(s,a),1;break}}Xi(s,a,.5,e,t),n=ci(e,a,l,i+1),o=ci(t,a,u,i+1);for(var c=0;c<n;c++)r[c]=l[c];for(var h=0;h<o;h++)r[h+n]=u[h];return n+o}function Fh(s,a){var r=0,i,e;i=e=yr(s[0].y);for(var t=1;t<=a;t++)i=yr(s[t].y),i!=e&&r++,e=i;return r}function Bh(s,a){var r,i,e,t,n,o,l,u,c,h,d,v,p,m,g,E;o=s[0].y-s[a].y,l=s[a].x-s[0].x,u=s[0].x*s[a].y-s[a].x*s[0].y;var x,C;x=C=0;for(var S=1;S<a;S++){var b=o*s[S].x+l*s[S].y+u;b>x?x=b:b<C&&(C=b)}return d=0,v=1,p=0,m=o,g=l,E=u-x,c=d*g-m*v,h=1/c,i=(v*E-g*p)*h,m=o,g=l,E=u-C,c=d*g-m*v,h=1/c,e=(v*E-g*p)*h,t=Math.min(i,e),n=Math.max(i,e),r=n-t,r<Rh?1:0}function Uh(s,a){var r=1,i=0,e=s[a].x-s[0].x,t=s[a].y-s[0].y,n=s[0].x-0,o=s[0].y-0,l=e*i-t*r,u=1/l,c=(e*o-t*n)*u;return 0+r*c}function Xi(s,a,r,i,e){for(var t=[[]],n=0;n<=a;n++)t[0][n]=s[n];for(var o=1;o<=a;o++)for(var l=0;l<=a-o;l++)t[o]||(t[o]=[]),t[o][l]||(t[o][l]={}),t[o][l].x=(1-r)*t[o-1][l].x+r*t[o-1][l+1].x,t[o][l].y=(1-r)*t[o-1][l].y+r*t[o-1][l+1].y;if(i!=null)for(var u=0;u<=a;u++)i[u]=t[u][0];if(e!=null)for(var c=0;c<=a;c++)e[c]=t[a-c][c];return t[a][0]}function Vh(s,a){var r=[];s--;for(var i=0;i<=s;i++)r.push(Hh(i/s,a));return r}function Hh(s,a){var r={x:0,y:0};if(s===0)return a[0];var i=a.length-1;if(s===1)return a[i];var e=a,t=1-s;if(i===0)return a[0];if(i===1)return{x:t*e[0].x+s*e[1].x,y:t*e[0].y+s*e[1].y};if(4>i){var n=t*t,o=s*s,l=0,u,c,h;return i===2?(e=[e[0],e[1],e[2],r],u=n,c=2*(t*s),h=o):i===3&&(u=n*t,c=3*(n*s),h=3*(t*o),l=s*o),{x:u*e[0].x+c*e[1].x+h*e[2].x+l*e[3].x,y:u*e[0].y+c*e[1].y+h*e[2].y+l*e[3].y}}else return r}function Yh(s){var a=0;if(!ia(s))for(var r=16,i=Vh(r,s),e=0;e<r-1;e++){var t=i[e],n=i[e+1];a+=ra(t,n)}return a}var Ko=new Map;function $h(s){var a=Ko.get(s);if(!a){a=[];var r=function(){return function(v){return Math.pow(v,s)}},i=function(){return function(v){return Math.pow(1-v,s)}},e=function(v){return function(p){return v}},t=function(){return function(v){return v}},n=function(){return function(v){return 1-v}},o=function(v){return function(p){for(var m=1,g=0;g<v.length;g++)m=m*v[g](p);return m}};a.push(r());for(var l=1;l<s;l++){for(var u=[e(s)],c=0;c<s-l;c++)u.push(t());for(var h=0;h<l;h++)u.push(n());a.push(o(u))}a.push(i()),Ko.set(s,a)}return a}function Yn(s,a){for(var r=$h(s.length-1),i=0,e=0,t=0;t<s.length;t++)i=i+s[t].x*r[t](a),e=e+s[t].y*r[t](a);return{x:i,y:e}}function ra(s,a){return Math.sqrt(Math.pow(s.x-a.x,2)+Math.pow(s.y-a.y,2))}function ia(s){return s[0].x===s[1].x&&s[0].y===s[1].y}function oa(s,a,r){if(ia(s))return{point:s[0],location:a};for(var i=Yn(s,a),e=0,t=a,n=r>0?1:-1,o=null;e<Math.abs(r);)t+=.005*n,o=Yn(s,t),e+=ra(o,i),i=o;return{point:o,location:t}}function Xh(s,a,r){return oa(s,a,r).point}function Wh(s,a,r){return oa(s,a,r).location}function Kh(s,a){var r=Yn(s,a),i=Yn(s.slice(0,s.length-1),a),e=i.y-r.y,t=i.x-r.x;return e===0?1/0:Math.atan(e/t)}function zh(s,a,r,i,e){var t=i-a,n=s-r,o=s*(a-i)+a*(r-s),l=Zh(e),u=[t*l[0][0]+n*l[1][0],t*l[0][1]+n*l[1][1],t*l[0][2]+n*l[1][2],t*l[0][3]+n*l[1][3]+o],c=Jh.apply(null,u),h=[];if(c!=null)for(var d=0;d<3;d++){var v=c[d],p=Math.pow(v,2),m=Math.pow(v,3),g={x:l[0][0]*m+l[0][1]*p+l[0][2]*v+l[0][3],y:l[1][0]*m+l[1][1]*p+l[1][2]*v+l[1][3]},E=void 0;r-s!==0?E=(g[0]-s)/(r-s):E=(g[1]-a)/(i-a),v>=0&&v<=1&&E>=0&&E<=1&&h.push(g)}return h}function zo(s,a){return[-s[0][a]+3*s[1][a]+-3*s[2][a]+s[3][a],3*s[0][a]-6*s[1][a]+3*s[2][a],-3*s[0][a]+3*s[1][a],s[0][a]]}function Zh(s){return[zo(s,"x"),zo(s,"y")]}function Jh(s,a,r,i){var e=a/s,t=r/s,n=i/s,o=(3*t-Math.pow(e,2))/9,l=(9*e*t-27*n-2*Math.pow(e,3))/54,u=Math.pow(o,3)+Math.pow(l,2),c,h,d=[0,0,0];if(u>=0)c=yr(l+Math.sqrt(u))*Math.pow(Math.abs(l+Math.sqrt(u)),1/3),h=yr(l-Math.sqrt(u))*Math.pow(Math.abs(l-Math.sqrt(u)),1/3),d[0]=-e/3+(c+h),d[1]=-e/3-(c+h)/2,d[2]=-e/3-(c+h)/2,Math.abs(Math.sqrt(3)*(c-h)/2)!==0&&(d[1]=-1,d[2]=-1);else{var v=Math.acos(l/Math.sqrt(-Math.pow(o,3)));d[0]=2*Math.sqrt(-o)*Math.cos(v/3)-e/3,d[1]=2*Math.sqrt(-o)*Math.cos((v+2*Math.PI)/3)-e/3,d[2]=2*Math.sqrt(-o)*Math.cos((v+4*Math.PI)/3)-e/3}for(var p=0;p<3;p++)(d[p]<0||d[p]>1)&&(d[p]=-1);return d}var Wi=function(s){fe(r,s);var a=de(r);function r(i){var e;return H(this,r),e=a.call(this,i),f(y(e),"curve",void 0),f(y(e),"cp1x",void 0),f(y(e),"cp1y",void 0),f(y(e),"cp2x",void 0),f(y(e),"cp2y",void 0),f(y(e),"length",0),f(y(e),"type",r.segmentType),e.cp1x=i.cp1x,e.cp1y=i.cp1y,e.cp2x=i.cp2x,e.cp2y=i.cp2y,e.x1=i.x1,e.x2=i.x2,e.y1=i.y1,e.y2=i.y2,e.curve=[{x:e.x1,y:e.y1},{x:e.cp1x,y:e.cp1y},{x:e.cp2x,y:e.cp2y},{x:e.x2,y:e.y2}],e.extents={xmin:Math.min(e.x1,e.x2,e.cp1x,e.cp2x),ymin:Math.min(e.y1,e.y2,e.cp1y,e.cp2y),xmax:Math.max(e.x1,e.x2,e.cp1x,e.cp2x),ymax:Math.max(e.y1,e.y2,e.cp1y,e.cp2y)},e}return K(r,[{key:"getPath",value:function(e){return(e?"M "+this.x2+" "+this.y2+" ":"")+"C "+this.cp2x+" "+this.cp2y+" "+this.cp1x+" "+this.cp1y+" "+this.x1+" "+this.y1}},{key:"pointOnPath",value:function(e,t){return e=r._translateLocation(this.curve,e,t),Yn(this.curve,e)}},{key:"gradientAtPoint",value:function(e,t){return e=r._translateLocation(this.curve,e,t),Kh(this.curve,e)}},{key:"pointAlongPathFrom",value:function(e,t,n){return e=r._translateLocation(this.curve,e,n),Xh(this.curve,e,t)}},{key:"getLength",value:function(){return(this.length==null||this.length===0)&&(this.length=Yh(this.curve)),this.length}},{key:"findClosestPointOnPath",value:function(e,t){var n=Gh({x:e,y:t},this.curve);return{d:Math.sqrt(Math.pow(n.point.x-e,2)+Math.pow(n.point.y-t,2)),x:n.point.x,y:n.point.y,l:1-n.location,s:this,x1:null,y1:null,x2:null,y2:null}}},{key:"lineIntersection",value:function(e,t,n,o){return zh(e,t,n,o,this.curve)}}],[{key:"_translateLocation",value:function(e,t,n){return n&&(t=Wh(e,t>0?0:1,t)),t}}]),r}(ki);f(Wi,"segmentType","Bezier");var hi=function(s){fe(r,s);var a=de(r);function r(i,e){var t;return H(this,r),t=a.call(this,i,e),t.connection=i,f(y(t),"type",r.type),f(y(t),"majorAnchor",void 0),f(y(t),"minorAnchor",void 0),e=e||{},t.majorAnchor=e.curviness||150,t.minorAnchor=10,t}return K(r,[{key:"getCurviness",value:function(){return this.majorAnchor}},{key:"_findControlPoint",value:function(e,t,n,o,l){var u=o[0]!==l[0]||o[1]===l[1],c={x:0,y:0};return u?(l[0]===0?c.x=n.curX<t.curX?e.x+this.minorAnchor:e.x-this.minorAnchor:c.x=e.x+this.majorAnchor*l[0],l[1]===0?c.y=n.curY<t.curY?e.y+this.minorAnchor:e.y-this.minorAnchor:c.y=e.y+this.majorAnchor*o[1]):(o[0]===0?c.x=t.curX<n.curX?e.x+this.minorAnchor:e.x-this.minorAnchor:c.x=e.x-this.majorAnchor*o[0],o[1]===0?c.y=t.curY<n.curY?e.y+this.minorAnchor:e.y-this.minorAnchor:c.y=e.y+this.majorAnchor*l[1]),c}},{key:"_computeBezier",value:function(e,t,n,o,l,u){var c,h,d=n.curX<o.curX?l:0,v=n.curY<o.curY?u:0,p=n.curX<o.curX?0:l,m=n.curY<o.curY?0:u;this.edited!==!0?(c=this._findControlPoint({x:d,y:v},n,o,e.so,e.to),h=this._findControlPoint({x:p,y:m},o,n,e.to,e.so)):(c=this.geometry.controlPoints[0],h=this.geometry.controlPoints[1]),this.geometry={controlPoints:[c,h],source:t.sourcePos,target:t.targetPos},this._addSegment(Wi,{x1:d,y1:v,x2:p,y2:m,cp1x:c.x,cp1y:c.y,cp2x:h.x,cp2y:h.y})}}]),r}(ta);f(hi,"type","Bezier");function Qh(s,a,r,i){return s<=r&&i<=a?1:s<=r&&a<=i?2:r<=s&&i>=a?3:4}function qh(s,a,r,i,e,t,n,o,l){if(o<=l)return{x:s,y:a};if(r===1)return i.curY<=0&&e.curY>=1?{x:s+(i.x<.5?-1*t:t),y:a}:i.curX>=1&&e.curX<=0?{x:s,y:a+(i.y<.5?-1*n:n)}:{x:s+-1*t,y:a+-1*n};if(r===2)return i.curY>=1&&e.curY<=0?{x:s+(i.x<.5?-1*t:t),y:a}:i.curX>=1&&e.curX<=0?{x:s,y:a+(i.y<.5?-1*n:n)}:{x:s+t,y:a+-1*n};if(r===3)return i.curY>=1&&e.curY<=0?{x:s+(i.x<.5?-1*t:t),y:a}:i.curX<=0&&e.curX>=1?{x:s,y:a+(i.y<.5?-1*n:n)}:{x:s+-1*t,y:a+-1*n};if(r===4)return i.curY<=0&&e.curY>=1?{x:s+(i.x<.5?-1*t:t),y:a}:i.curX<=0&&e.curX>=1?{x:s,y:a+(i.y<.5?-1*n:n)}:{x:s+t,y:a+-1*n}}var fi=function(s){fe(r,s);var a=de(r);function r(i,e){var t;return H(this,r),t=a.call(this,i,e),t.connection=i,f(y(t),"type",r.type),f(y(t),"_controlPoint",void 0),t.curviness=e.curviness||10,t.margin=e.margin||5,t.proximityLimit=e.proximityLimit||80,t.clockwise=e.orientation&&e.orientation==="clockwise",t}return K(r,[{key:"_computeBezier",value:function(e,t,n,o,l,u){var c=n.curX<o.curX?0:l,h=n.curY<o.curY?0:u,d=n.curX<o.curX?l:0,v=n.curY<o.curY?u:0;if(n.x===0&&(c-=this.margin),n.x===1&&(c+=this.margin),n.y===0&&(h-=this.margin),n.y===1&&(h+=this.margin),o.x===0&&(d-=this.margin),o.x===1&&(d+=this.margin),o.y===0&&(v-=this.margin),o.y===1&&(v+=this.margin),this.edited!==!0){var p=(c+d)/2,m=(h+v)/2,g=Qh(c,h,d,v),E=Math.sqrt(Math.pow(d-c,2)+Math.pow(v-h,2));this._controlPoint=qh(p,m,g,t.sourcePos,t.targetPos,this.curviness,this.curviness,E,this.proximityLimit)}else this._controlPoint=this.geometry.controlPoints[0];var x,C,S,b;x=this._controlPoint.x,C=this._controlPoint.x,S=this._controlPoint.y,b=this._controlPoint.y,this.geometry={controlPoints:[this._controlPoint,this._controlPoint],source:t.sourcePos,target:t.targetPos},this._addSegment(Wi,{x1:d,y1:v,x2:c,y2:h,cp1x:x,cp1y:S,cp2x:C,cp2y:b})}}]),r}(ta);f(fi,"type","StateMachine");Xn.register(hi.type,hi);Xn.register(fi.type,fi);function Zo(s){return s<0?-1:s===0?0:1}function Jo(s){return[Zo(s[2]-s[0]),Zo(s[3]-s[1])]}function Qo(s){return Math.sqrt(Math.pow(s[0]-s[2],2)+Math.pow(s[1]-s[3],2))}function qo(s){var a=[];return a.push.apply(a,s),a}var di=function(s){fe(r,s);var a=de(r);function r(i,e){var t;return H(this,r),t=a.call(this,i,e),t.connection=i,f(y(t),"type",r.type),f(y(t),"internalSegments",[]),f(y(t),"midpoint",void 0),f(y(t),"alwaysRespectStubs",void 0),f(y(t),"cornerRadius",void 0),f(y(t),"lastx",void 0),f(y(t),"lasty",void 0),f(y(t),"lastOrientation",void 0),f(y(t),"loopbackRadius",void 0),f(y(t),"isLoopbackCurrently",void 0),t.midpoint=e.midpoint==null||isNaN(e.midpoint)?.5:e.midpoint,t.cornerRadius=e.cornerRadius!=null?e.cornerRadius:0,t.alwaysRespectStubs=e.alwaysRespectStubs===!0,t.lastx=null,t.lasty=null,t.lastOrientation=null,t.loopbackRadius=e.loopbackRadius||25,t.isLoopbackCurrently=!1,t}return K(r,[{key:"getDefaultStubs",value:function(){return[30,30]}},{key:"addASegment",value:function(e,t,n){if(!(this.lastx===e&&this.lasty===t)){var o=this.lastx==null?n.sx:this.lastx,l=this.lasty==null?n.sy:this.lasty,u=o===e?"v":"h";this.lastx=e,this.lasty=t,this.internalSegments.push([o,l,e,t,u])}}},{key:"writeSegments",value:function(e){for(var t=null,n,o,l,u=0;u<this.internalSegments.length-1;u++){if(t=t||qo(this.internalSegments[u]),n=qo(this.internalSegments[u+1]),o=Jo(t),l=Jo(n),this.cornerRadius>0&&t[4]!==n[4]){var c=Math.min(Qo(t),Qo(n)),h=Math.min(this.cornerRadius,c/2);t[2]-=o[0]*h,t[3]-=o[1]*h,n[0]+=l[0]*h,n[1]+=l[1]*h;var d=o[1]===l[0]&&l[0]===1||o[1]===l[0]&&l[0]===0&&o[0]!==l[1]||o[1]===l[0]&&l[0]===-1,v=n[1]>t[3]?1:-1,p=n[0]>t[2]?1:-1,m=v===p,g=m&&d||!m&&!d?n[0]:t[2],E=m&&d||!m&&!d?t[3]:n[1];this._addSegment(Rt,{x1:t[0],y1:t[1],x2:t[2],y2:t[3]}),this._addSegment($i,{r:h,x1:t[2],y1:t[3],x2:n[0],y2:n[1],cx:g,cy:E,ac:d})}else this._addSegment(Rt,{x1:t[0],y1:t[1],x2:t[2],y2:t[3]});t=n}n!=null&&this._addSegment(Rt,{x1:n[0],y1:n[1],x2:n[2],y2:n[3]})}},{key:"_compute",value:function(e,t){var n=this;this.internalSegments.length=0,this.lastx=null,this.lasty=null,this.lastOrientation=null;var o=function(D){return[e.startStubX,e.startStubY,e.endStubX,e.endStubY]},l={perpendicular:o,orthogonal:o,opposite:function(D){var P=e,_=D==="x"?0:1,L={x:function(){return P.so[_]===1&&(P.startStubX>P.endStubX&&P.tx>P.startStubX||P.sx>P.endStubX&&P.tx>P.sx)||P.so[_]===-1&&(P.startStubX<P.endStubX&&P.tx<P.startStubX||P.sx<P.endStubX&&P.tx<P.sx)},y:function(){return P.so[_]===1&&(P.startStubY>P.endStubY&&P.ty>P.startStubY||P.sy>P.endStubY&&P.ty>P.sy)||P.so[_]===-1&&(P.startStubY<P.endStubY&&P.ty<P.startStubY||P.sy<P.endStubY&&P.ty<P.sy)}};return!n.alwaysRespectStubs&&L[D]()?{x:[(e.sx+e.tx)/2,e.startStubY,(e.sx+e.tx)/2,e.endStubY],y:[e.startStubX,(e.sy+e.ty)/2,e.endStubX,(e.sy+e.ty)/2]}[D]:[e.startStubX,e.startStubY,e.endStubX,e.endStubY]}},u=l[e.anchorOrientation](e.sourceAxis),c=e.sourceAxis==="x"?0:1,h=e.sourceAxis==="x"?1:0,d=u[c],v=u[h],p=u[c+2],m=u[h+2];this.addASegment(u[0],u[1],e);var g=e.startStubX+(e.endStubX-e.startStubX)*this.midpoint,E=e.startStubY+(e.endStubY-e.startStubY)*this.midpoint,x={x:[0,1],y:[1,0]},C={perpendicular:function(D,P,_,L,N){var k=e,I={x:[[[1,2,3,4],null,[2,1,4,3]],null,[[4,3,2,1],null,[3,4,1,2]]],y:[[[3,2,1,4],null,[2,3,4,1]],null,[[4,1,2,3],null,[1,4,3,2]]]},w={x:[[k.startStubX,k.endStubX],null,[k.endStubX,k.startStubX]],y:[[k.startStubY,k.endStubY],null,[k.endStubY,k.startStubY]]},j={x:[[g,k.startStubY],[g,k.endStubY]],y:[[k.startStubX,E],[k.endStubX,E]]},G={x:[[k.endStubX,k.startStubY]],y:[[k.startStubX,k.endStubY]]},V={x:[[k.startStubX,k.endStubY],[k.endStubX,k.endStubY]],y:[[k.endStubX,k.startStubY],[k.endStubX,k.endStubY]]},ce={x:[[k.startStubX,E],[k.endStubX,E],[k.endStubX,k.endStubY]],y:[[g,k.startStubY],[g,k.endStubY],[k.endStubX,k.endStubY]]},ve={x:[k.startStubY,k.endStubY],y:[k.startStubX,k.endStubX]},Pe=x[D][0],pe=x[D][1],F=k.so[Pe]+1,Y=k.to[pe]+1,J=k.to[pe]===-1&&ve[D][1]<ve[D][0]||k.to[pe]===1&&ve[D][1]>ve[D][0],re=w[D][F][0],ee=w[D][F][1],Q=I[D][F][Y];if(k.segment===Q[3]||k.segment===Q[2]&&J)return j[D];if(k.segment===Q[2]&&ee<re)return G[D];if(k.segment===Q[2]&&ee>=re||k.segment===Q[1]&&!J)return ce[D];if(k.segment===Q[0]||k.segment===Q[1]&&J)return V[D]},orthogonal:function(D,P,_,L,N){var k=e,I={x:k.so[0]===-1?Math.min(P,L):Math.max(P,L),y:k.so[1]===-1?Math.min(P,L):Math.max(P,L)}[D];return{x:[[I,_],[I,N],[L,N]],y:[[_,I],[N,I],[N,L]]}[D]},opposite:function(D,P,_,L,N){var k=e,I={x:"y",y:"x"}[D],w={x:"h",y:"w"}[D],j=k["is"+D.toUpperCase()+"GreaterThanStubTimes2"];if(t.sourceEndpoint.elementId===t.targetEndpoint.elementId){var G=_+(1-t.sourceEndpoint._anchor.computedPosition[I])*t.sourceInfo[w]+n.maxStub;return{x:[[P,G],[L,G]],y:[[G,P],[G,L]]}[D]}else{if(!j||k.so[c]===1&&P>L||k.so[c]===-1&&P<L)return{x:[[P,E],[L,E]],y:[[g,P],[g,L]]}[D];if(k.so[c]===1&&P<L||k.so[c]===-1&&P>L)return{x:[[g,k.sy],[g,k.ty]],y:[[k.sx,E],[k.tx,E]]}[D]}}},S=C[e.anchorOrientation](e.sourceAxis,d,v,p,m);if(S)for(var b=0;b<S.length;b++)this.addASegment(S[b][0],S[b][1],e);this.addASegment(u[2],u[3],e),this.addASegment(e.tx,e.ty,e),this.writeSegments(e)}},{key:"transformGeometry",value:function(e,t,n){return e}}]),r}(Nr);f(di,"type","Flowchart");Xn.register(di.type,di);Ct.registerHandler(ah);Ct.registerHandler(Ah);Ct.registerHandler(Ih);Xn.register(Dr.type,Dr);function ef(){var s=Math.floor(Math.random()*2e3),a=Math.floor(Math.random()*2e3);return{clientX:s,clientY:a,screenX:s,screenY:a,pageX:s,pageY:a}}var en={clientX:5e4,clientY:5e4,screenX:5e4,screenY:5e4,pageX:5e4,pageY:5e4};for(var sr=0;sr<256;sr++)(sr<16?"0":"")+sr.toString(16);var tf=1e-11;(function(){function s(a,r,i){H(this,s),this._jsPlumb=a,this.ok=r,this.equal=i,f(this,"_divs",[]),f(this,"mottle",void 0),this.mottle=new Li}return K(s,[{key:"_t",value:function(r,i,e,t){this.mottle.trigger(r,i,{pageX:e,pageY:t,screenX:e,screenY:t,clientX:e,clientY:t})}},{key:"addDiv",value:function(r,i,e,t,n,o,l){var u=document.createElement("div");return u.style.position="absolute",u.innerHTML=r,i?i.appendChild(u):this._jsPlumb.getContainer().appendChild(u),u.setAttribute("id",r),u.style.left=(t??Math.floor(Math.random()*1e3))+"px",u.style.top=(n??Math.floor(Math.random()*1e3))+"px",e&&(u.className=e),o&&(u.style.width=o+"px"),l&&(u.style.height=l+"px"),this._divs.push(r),u}},{key:"addDivs",value:function(r,i){for(var e=0;e<r.length;e++)this.addDiv(r[e],i)}},{key:"assertEndpointCount",value:function(r,i){var e=this._jsPlumb.getEndpoints(r),t=e?e.length:0;this.equal(t,i,r.getAttribute("data-jtk-managed")+" has "+i+(i>1||i==0?" endpoints":" endpoint"))}},{key:"_assertManagedEndpointCount",value:function(r,i){var e=this._jsPlumb.getId(r),t=this._jsPlumb._managedElements[e];this.equal(t.endpoints.length,i,e+" has "+i+" endpoints in managed record")}},{key:"_assertManagedConnectionCount",value:function(r,i){var e=this._jsPlumb.getId(r),t=this._jsPlumb._managedElements[e];this.equal(t.connections.length,i,e+" has "+i+" connections in managed record")}},{key:"_registerDiv",value:function(r){this._divs.push(r)}},{key:"makeDragStartEvt",value:function(r){var i=this.makeEvent(r),e=this._jsPlumb.getContainer();return i.clientX+=e.offsetLeft,i.screenX+=e.offsetLeft,i.pageX+=e.offsetLeft,i.clientY+=e.offsetTop,i.screenY+=e.offsetTop,i.pageY+=e.offsetTop,i}},{key:"getAttribute",value:function(r,i){return r.getAttribute(i)}},{key:"dragNodeBy",value:function(r,i,e,t){t=t||{},t.before&&t.before();var n=this.makeEvent(r);this._jsPlumb.trigger(r,te,n),t.beforeMouseMove&&t.beforeMouseMove(),this._t(document,De,n.pageX+i,n.pageY+e),t.beforeMouseUp&&t.beforeMouseUp(),this.mottle.trigger(document,ne,null),t.after&&t.after()}},{key:"dragNodeTo",value:function(r,i,e,t){t=t||{};var n=this._jsPlumb.viewport.getPosition(this._jsPlumb.getId(r));t.before&&t.before();var o=this.makeEvent(r);this._jsPlumb.trigger(r,te,o);var l=this._jsPlumb.getContainer().getBoundingClientRect();t.beforeMouseMove&&t.beforeMouseMove(),this._t(document,De,l.x+i+n.w/2,l.y+e+n.h/2),t.beforeMouseUp&&t.beforeMouseUp(),this.mottle.trigger(document,ne,null),t.after&&t.after()}},{key:"dragToGroup",value:function(r,i,e){var t=this._jsPlumb.getGroup(i),n=this._jsPlumb.viewport.getPosition(t.elId),o=n.x+n.w/2,l=n.y+n.h/2;this.dragNodeTo(r,o,l,e)}},{key:"aSyncDragNodeBy",value:function(r,i,e,t){var n=this;t=t||{},t.before&&t.before();var o=this.makeEvent(r);this._jsPlumb.trigger(r,te,o),t.beforeMouseMove&&t.beforeMouseMove(),setTimeout(function(){n._t(document,De,o.pageX+i,o.pageY+e),t.beforeMouseUp&&t.beforeMouseUp(),setTimeout(function(){n.mottle.trigger(document,ne,null),t.after&&t.after()},45)},45)}},{key:"dragANodeAround",value:function(r,i,e){this._jsPlumb.trigger(r,te,this.makeEvent(r));for(var t=Math.random()*50,n=0;n<t;n++){var o=ef();r.style.left=o.screenX+"px",r.style.top=o.screenY+"px",this._jsPlumb.trigger(document,De,o)}i&&this.ok(i(),e||"while dragging assert"),this._jsPlumb.trigger(document,ne,en)}},{key:"dragConnection",value:function(r,i,e,t){var n=this.getCanvas(r),o=this.getCanvas(i),l=this.makeEvent(n),u=this.makeEvent(o);t=t||{};var c=this._jsPlumb.select().length;return this._jsPlumb.trigger(n,te,l),t.beforeMouseMove&&t.beforeMouseMove(),this._jsPlumb.trigger(e?o:document,De,u),t.beforeMouseUp&&t.beforeMouseUp(),this._jsPlumb.trigger(e?o:document,ne,u),this._jsPlumb.select().get(c)}},{key:"aSyncDragConnection",value:function(r,i,e){var t=this;e=e||{};var n=this.getCanvas(r),o=this.getCanvas(i),l=this.makeEvent(n),u=this.makeEvent(o),c=this._jsPlumb.select().length;this._jsPlumb.trigger(n,te,l),setTimeout(function(){e.beforeMouseMove&&e.beforeMouseMove(),t._jsPlumb.trigger(document,De,u),setTimeout(function(){e.beforeMouseUp&&e.beforeMouseUp(),t._jsPlumb.trigger(o,ne,u),e.after&&e.after(t._jsPlumb.select().get(c))},5)},5)}},{key:"dragAndAbortConnection",value:function(r){var i=this.getCanvas(r),e=this.makeEvent(i);this._jsPlumb.trigger(i,te,e),this._jsPlumb.trigger(document,De,en),this._jsPlumb.trigger(document,ne,en)}},{key:"detachConnection",value:function(r,i){i=i||{};var e=this.getEndpointCanvas(r),t=this.makeEvent(e);i.before&&i.before(),this._jsPlumb.trigger(e,te,t),i.beforeMouseMove&&i.beforeMouseMove(),this._jsPlumb.trigger(document,De,en),i.beforeMouseUp&&i.beforeMouseUp(),this._jsPlumb.trigger(document,ne,en),i.after&&i.after()}},{key:"detachAndReattachConnection",value:function(r,i){i=i||{};var e=this.getEndpointCanvas(r),t=this.makeEvent(e);i.before&&i.before(),this._jsPlumb.trigger(e,te,t),i.beforeMouseMove&&i.beforeMouseMove(),this._jsPlumb.trigger(document,De,en),this._jsPlumb.trigger(document,De,t),i.beforeMouseUp&&i.beforeMouseUp(),this._jsPlumb.trigger(document,ne,t),i.after&&i.after()}},{key:"detachConnectionByTarget",value:function(r,i){this.detachConnection(r.endpoints[1],i)}},{key:"relocateTarget",value:function(r,i,e){this.relocate(r,1,i,e)}},{key:"relocate",value:function(r,i,e,t){t=t||{},e=this.getCanvas(e);var n=this.getEndpointCanvas(r.endpoints[i]),o=this.makeEvent(n),l=this.makeEvent(e);t.before&&t.before(),this._jsPlumb.trigger(n,te,o),t.beforeMouseMove&&t.beforeMouseMove(),this._jsPlumb.trigger(document,De,l),t.beforeMouseUp&&t.beforeMouseUp(),this._jsPlumb.trigger(e,ne,l),t.after&&t.after()}},{key:"relocateSource",value:function(r,i,e){this.relocate(r,0,i,e)}},{key:"makeEvent",value:function(r){var i=r.getBoundingClientRect(),e=i.x+i.width/2,t=i.y+i.height/2;return{clientX:e,clientY:t,screenX:e,screenY:t,pageX:e,pageY:t}}},{key:"getCanvas",value:function(r){return r.endpoint?this.getEndpointCanvas(r):r}},{key:"getEndpointCanvas",value:function(r){return r.endpoint.canvas}},{key:"getConnectionCanvas",value:function(r){return r.connector.canvas}},{key:"getEndpointCanvasPosition",value:function(r){var i=this.getEndpointCanvas(r);return{x:parseInt(i.style.left,10),y:parseInt(i.style.top,10),w:i.getAttribute("width"),h:i.getAttribute("height")}}},{key:"within",value:function(r,i,e){this.ok(Math.abs(r-i)<tf,e+"[expected: "+i+" got "+r+"] [diff:"+Math.abs(r-i)+"]")}},{key:"assertManagedEndpointCount",value:function(r,i){var e=this._jsPlumb.getId(r),t=this._jsPlumb._managedElements[e];this.equal(t.endpoints.length,i,e+" has "+i+" endpoints in managed record")}},{key:"assertManagedConnectionCount",value:function(r,i){var e=this._jsPlumb.getId(r),t=this._jsPlumb._managedElements[e];this.equal(t.connections.length,i,e+" has "+i+" connections in managed record")}},{key:"fireEventOnEndpoint",value:function(r){for(var i=this.getEndpointCanvas(r),e=0;e<(arguments.length<=1?0:arguments.length-1);e++)this._jsPlumb.trigger(i,e+1<1||arguments.length<=e+1?void 0:arguments[e+1])}},{key:"fireEventOnElement",value:function(r){for(var i=0;i<(arguments.length<=1?0:arguments.length-1);i++)this._jsPlumb.trigger(r,i+1<1||arguments.length<=i+1?void 0:arguments[i+1])}},{key:"fireEventOnConnection",value:function(r){for(var i=this.getConnectionCanvas(r),e=arguments.length,t=new Array(e>1?e-1:0),n=1;n<e;n++)t[n-1]=arguments[n];this.fireEventOnElement.apply(this,[i].concat(t))}},{key:"clickOnConnection",value:function(r){this.fireEventOnConnection(r,Re)}},{key:"dblClickOnConnection",value:function(r){this.fireEventOnConnection(r,Fe)}},{key:"tapOnConnection",value:function(r){this.fireEventOnConnection(r,te),this.fireEventOnConnection(r,ne)}},{key:"dblTapOnConnection",value:function(r){this.fireEventOnConnection(r,te),this.fireEventOnConnection(r,ne),this.fireEventOnConnection(r,te),this.fireEventOnConnection(r,ne)}},{key:"clickOnElement",value:function(r,i){this._jsPlumb.trigger(r,Re,null,null,i??1)}},{key:"dblClickOnElement",value:function(r){this._jsPlumb.trigger(r,Fe)}},{key:"tapOnElement",value:function(r){this._jsPlumb.trigger(r,te),this._jsPlumb.trigger(r,ne)}},{key:"dblTapOnElement",value:function(r){this._jsPlumb.trigger(r,te),this._jsPlumb.trigger(r,ne),this._jsPlumb.trigger(r,te),this._jsPlumb.trigger(r,ne)}},{key:"getOverlayCanvas",value:function(r){return r.canvas||r.path}},{key:"fireEventOnOverlay",value:function(r,i,e){var t=r.getOverlay(i),n=this.getOverlayCanvas(t);this._jsPlumb.trigger(n,e)}},{key:"clickOnOverlay",value:function(r,i){this.fireEventOnOverlay(r,i,Re)}},{key:"dblClickOnOverlay",value:function(r,i){this.fireEventOnOverlay(r,i,Fe)}},{key:"tapOnOverlay",value:function(r,i){this.fireEventOnOverlay(r,i,te),this.fireEventOnOverlay(r,i,ne)}},{key:"dblTapOnOverlay",value:function(r,i){this.fireEventOnOverlay(r,i,te),this.fireEventOnOverlay(r,i,ne),this.fireEventOnOverlay(r,i,te),this.fireEventOnOverlay(r,i,ne)}},{key:"cleanup",value:function(){var r=this._jsPlumb.getContainer();this._jsPlumb.destroy();for(var i in this._divs){var e=document.getElementById(this._divs[i]);e&&e.parentNode.removeChild(e)}this._divs.length=0;var t=this._jsPlumb.select().length,n=this._jsPlumb.selectEndpoints().length,o=r.querySelectorAll(".jtk-endpoint").length,l=r.querySelectorAll(".jtk-connector").length;for(var u in r.__ta)for(var c in r.__ta[u])throw"Container event bindings not empty for key "+u;if(t>0)throw"there are connections in the data model!";if(n>0)throw"there are endpoints in the data model!";if(o>0)throw"there are "+o+" endpoints left in the dom!";if(l>0)throw"there are "+l+" connections left in the dom!"}},{key:"makeContent",value:function(r){var i=document.createElement("div");return i.innerHTML=r,i.firstChild}},{key:"length",value:function(r){var i=0;for(var e in r)r.hasOwnProperty(e)&&i++;return i}},{key:"head",value:function(r){for(var i in r)return r[i]}},{key:"uuid",value:function(){return Ae()}}]),s})();var es=0;function nf(){var s=es+1;return es++,s}function rf(s){return new Ph(nf(),s)}const of={key:1,class:"flex flex-col h-full w-full relative"},sf={class:"flex-grow px-4 py-2"},af={class:"text-md"},lf={class:"text-sm text-gray-500"},uf={class:"absolute top-1 right-2 text-sm text-gray-500"},cf={class:"flex justify-end absolute bottom-0 right-0"},hf=Ir({__name:"LessonCard",props:{lesson:{},loading:{type:Boolean}},emits:["edit","delete"],setup(s,{emit:a}){const r=s,i=a,e=ns();return(t,n)=>{const o=os,l=kr;return Be(),ze("div",{class:"cursor-pointer w-40 h-24 bg-gray-50 rounded-lg border border-gray-200",onClick:n[2]||(n[2]=u=>le(e).push({name:"lesson-edit",params:{id:t.lesson.id}}))},[r.loading?(Be(),ts(o,{key:0,class:"flex justify-center items-center w-10 h-full"})):(Be(),ze("div",of,[Te("div",sf,[Te("div",af,wt(r.lesson.name),1),Te("div",lf,wt(`${r.lesson.stage}`),1)]),Te("div",uf,wt(r.lesson.id),1),Te("div",cf,[ae(l,{icon:"pi pi-pencil",size:"small",severity:"info",variant:"text",onClick:n[0]||(n[0]=Ki(u=>i("edit",r.lesson),["stop"]))}),ae(l,{icon:"pi pi-trash",size:"small",severity:"danger",variant:"text",onClick:n[1]||(n[1]=Ki(u=>i("delete",r.lesson),["stop"]))})])]))])}}}),ff=["id"],df={class:"flex justify-end gap-2"},vf=Ir({__name:"LessonsView",props:{level:{},dependenciesMode:{type:Boolean}},setup(s){const a=s,r=gi(),i=vi(),e=xi(),{isLessonCreating:t,isLessonUpdating:n,isLessonDeleting:o,isOrderUpdating:l,groupedLessons:u,groupedDependencies:c}=pi(e),{createLesson:h,updateLessonById:d,deleteLessonById:v,loadRouteById:p,updateRouteLessonsOrderById:m,createLessonDependency:g,deleteLessonDependency:E,deleteAllLessonDependencies:x}=e,C=he(!1),S=he(!1),b=he(null),T=he(""),D=he(""),P=he("freemium"),_=he("learn");let L;const N=he();rs(async()=>{await da(),L=rf({container:N.value,paintStyle:{strokeWidth:1.5,stroke:"#456"},maxConnections:-1,connector:"Bezier",connectionOverlays:[{type:"Arrow",options:{location:1}}]}),a.dependenciesMode?(k(),w()):I(),L.bind(Ai,async F=>{if(F.originalSourceID.includes("jsplumb"))return;const Y=F.originalSourceId.split("-")[1],J=F.originalTargetId.split("-")[1];await E({depend_on_id:Number(Y),lesson_id:Number(J),route_id:Number(r.params.id)})}),L.bind(Oi,async F=>{if(F.sourceId.includes("jsplumb"))return;const Y=F.sourceId.split("-")[1],J=F.targetId.split("-")[1];await g({depend_on_id:Number(Y),lesson_id:Number(J),route_id:Number(r.params.id)})}),L.bind(Ss,async F=>{if(F.sourceId.includes("jsplumb"))return;const Y=F.sourceId.split("-")[1],J=F.targetId.split("-")[1];await E({depend_on_id:Number(Y),lesson_id:Number(J),route_id:Number(r.params.id)})})});async function k(){for(const F of Object.values(u.value[a.level.id]))for(const Y of F){const J=document.getElementById(`lesson-${Y.id}`);L.addEndpoint(J,{source:!0,anchor:"Top",endpoint:{type:Vt.type}}),L.addEndpoint(J,{target:!0,anchor:"Left",endpoint:{type:Hn.type}})}}async function I(){for(const F of Object.values(u.value[a.level.id]))for(const Y of F){const J=L.getEndpoints(document.getElementById(`lesson-${Y.id}`));for(const re of J)L.deleteEndpoint(re)}}function w(){const F=c.value[a.level.id];for(const Y of F)L.connect({source:document.getElementById(`lesson-${Y.depend_on_id}`),target:document.getElementById(`lesson-${Y.lesson_id}`),anchors:["Top","Left"]})}function j(F){T.value="",D.value="",P.value="freemium",S.value=!0,C.value=!0,_.value=F}function G(F){b.value=F,T.value=F.name,D.value=F.description,P.value=F.accessType,S.value=!1,C.value=!0}async function V(){S.value?await h({name:T.value,description:D.value,access_type:P.value,lesson_type:_.value,level_id:a.level.id,route_id:Number(r.params.id)}):b.value&&await d(b.value.id,{name:T.value,description:D.value,access_type:P.value}),await p(Number(r.params.id)),C.value=!1}function ce(F){b.value=F,i.require({...Ei,message:"Are you sure you want to delete this lesson?",accept:async()=>{await v(F.id),await p(Number(r.params.id))}})}async function ve(F){if(!l.value){if(F.added){const Y=F.added.element.id,J=Pe(Y);if(J){const{levelId:ee,lessonType:Q}=J;if(ee!=F.added.element.levelId&&await x({lesson_id:Number(Y),route_id:Number(r.params.id)}),Q!=F.added.element.lessonType){await d(Y,{lesson_type:Q});const oe=u.value[a.level.id][Q].find(ge=>ge.id===Y);oe&&(oe.lessonType=Q)}}const re=pe();await m(Number(r.params.id),re)}else if(F.moved){const Y=pe();await m(Number(r.params.id),Y)}}}function Pe(F){var Y;for(const[J,re]of Object.entries(u.value))for(const ee of zi)if((Y=re[ee])!=null&&Y.some(Q=>Q.id===F))return{levelId:Number(J),lessonType:ee};return null}function pe(){const F=[];for(const Y in u.value){const J=Number(Y),re=u.value[J],ee=Object.values(re).flat();F.push({level_id:J,lesson_ids:ee.map(Q=>Q.id)})}return{orders:F}}return(F,Y)=>{const J=ba,re=kr,ee=mi,Q=yi;return Be(),ze(ar,null,[Te("div",{ref_key:"lessonsWrapperRef",ref:N,class:"relative flex flex-col gap-4"},[(Be(!0),ze(ar,null,is(le(zi),oe=>(Be(),ze(ar,{key:oe},[ae(J,{severity:oe==="learn"?"success":oe==="practice"?"info":"warn",class:"min-w-fit pr-4",size:"small"},{default:mt(()=>[va(wt(oe.charAt(0).toUpperCase()+oe.slice(1)),1)]),_:2},1032,["severity"]),ae(le(La),{modelValue:le(u)[F.level.id][oe],"onUpdate:modelValue":ge=>le(u)[F.level.id][oe]=ge,group:"lessons","item-key":"id","data-key":`${a.level.id}-${oe}`,class:"flex flex-wrap gap-4 min-h-[5rem]",onChange:ve,disabled:le(l)||F.dependenciesMode},{item:mt(({element:ge})=>{var He;return[Te("div",{id:`lesson-${ge.id}`},[ae(hf,{lesson:ge,loading:((He=b.value)==null?void 0:He.id)===ge.id&&(le(n)||le(o)),onEdit:it=>G(ge),onDelete:it=>ce(ge)},null,8,["lesson","loading","onEdit","onDelete"])],8,ff)]}),footer:mt(()=>[ae(re,{icon:"pi pi-plus",label:"Add",variant:"outlined",class:"w-40 h-24",onClick:ge=>j(oe)},null,8,["onClick"])]),_:2},1032,["modelValue","onUpdate:modelValue","data-key","disabled"])],64))),128))],512),ae(Q,{visible:C.value,"onUpdate:visible":Y[3]||(Y[3]=oe=>C.value=oe),modal:"",header:S.value?"Create Lesson":"Update Lesson",style:{width:"25rem"}},{default:mt(()=>[ae(ee,{modelValue:T.value,"onUpdate:modelValue":Y[0]||(Y[0]=oe=>T.value=oe),class:"w-full mb-4",placeholder:"Name"},null,8,["modelValue"]),ae(ee,{modelValue:D.value,"onUpdate:modelValue":Y[1]||(Y[1]=oe=>D.value=oe),class:"w-full mb-4",placeholder:"Description"},null,8,["modelValue"]),Te("div",df,[ae(re,{label:"Cancel",severity:"secondary",onClick:Y[2]||(Y[2]=oe=>C.value=!1)}),ae(re,{label:S.value?"Create":"Update",loading:le(t)||le(n),disabled:le(t)||le(n),onClick:V},null,8,["label","loading","disabled"])])]),_:1},8,["visible","header"])],64)}}}),pf=Ta(vf,[["__scopeId","data-v-e357f08b"]]),gf={class:"flex flex-col gap-4"},yf={class:"flex items-center gap-2"},mf={class:"flex items-center gap-2"},Ef={class:"text-xl"},xf={class:"flex gap-2 mb-4"},Cf={class:"flex justify-end gap-2"},Sf=Ir({__name:"LevelsView",props:{levels:{}},setup(s){const a=s,r=gi(),i=vi(),e=xi(),{isLevelCreating:t,isLevelUpdating:n,mode:o}=pi(e),{loadRouteById:l,createLevel:u,updateLevelById:c,deleteLevelById:h}=e,d=he(["Order mode","Dependency mode"]),v=he(!1),p=he(!1),m=he(null),g=he(""),E=he(0),x=he(0);function C(){g.value="",p.value=!0,v.value=!0}function S(D){m.value=D,g.value=D.name,E.value=D.learnCount,x.value=D.practiceCount,p.value=!1,v.value=!0}async function b(){p.value?await u({name:g.value}):m.value&&await c(m.value.id,{name:g.value,learn_count:E.value,practice_count:x.value}),await l(Number(r.params.id)),v.value=!1}function T(D){i.require({...Ei,message:"Are you sure you want delete?",accept:async()=>{await h(D),await l(Number(r.params.id))}})}return pa(o,()=>l(Number(r.params.id))),(D,P)=>{const _=Sa,L=kr,N=Ca,k=mi,I=xa,w=yi;return Be(),ze("div",gf,[ae(_,{modelValue:le(o),"onUpdate:modelValue":P[0]||(P[0]=j=>ga(o)?o.value=j:null),options:d.value,size:"small",class:"self-end",allowEmpty:!1},null,8,["modelValue","options"]),(Be(!0),ze(ar,null,is(a.levels,j=>(Be(),ze("div",{key:j.id,class:"flex flex-col gap-4"},[Te("div",yf,[ae(N,{align:"center",type:"dotted",class:"m-0"},{default:mt(()=>[Te("div",mf,[ae(L,{icon:"pi pi-pencil",size:"small",severity:"info",variant:"outlined",onClick:G=>S(j)},null,8,["onClick"]),Te("div",Ef,wt(j.name),1)])]),_:2},1024),ae(L,{icon:"pi pi-trash",size:"small",severity:"danger",variant:"outlined",onClick:G=>T(j.id)},null,8,["onClick"])]),ae(pf,{level:j,dependenciesMode:le(o)=="Dependency mode"},null,8,["level","dependenciesMode"])]))),128)),ae(N,{align:"center",type:"dotted"},{default:mt(()=>[ae(L,{icon:"pi pi-plus",label:"Add level",variant:"outlined",onClick:C})]),_:1}),ae(w,{visible:v.value,"onUpdate:visible":P[5]||(P[5]=j=>v.value=j),modal:"",header:p.value?"Create new level":"Update level",style:{width:"25rem"}},{default:mt(()=>[ae(k,{modelValue:g.value,"onUpdate:modelValue":P[1]||(P[1]=j=>g.value=j),id:"name",class:"w-full mb-4",autocomplete:"off",placeholder:"Name"},null,8,["modelValue"]),Te("div",xf,[ae(I,{modelValue:E.value,"onUpdate:modelValue":P[2]||(P[2]=j=>E.value=j),placeholder:"Min Learn lessons",inputId:"minmax",min:0,max:100,fluid:""},null,8,["modelValue"]),ae(I,{modelValue:x.value,"onUpdate:modelValue":P[3]||(P[3]=j=>x.value=j),placeholder:"Min Practice lessons",inputId:"minmax",min:0,max:100,fluid:""},null,8,["modelValue"])]),Te("div",Cf,[ae(L,{type:"button",label:"Cancel",severity:"secondary",onClick:P[4]||(P[4]=j=>v.value=!1)}),ae(L,{type:"button",label:p.value?"Create":"Update",loading:le(t)||le(n),disabled:le(t)||le(n),onClick:b},null,8,["label","loading","disabled"])])]),_:1},8,["visible","header"])])}}}),bf={class:"flex flex-col items-center h-screen"},Pf={class:"w-full h-full max-w-screen-xl px-4 md:px-28 py-8"},Tf={key:1,class:"flex justify-center"},Of={key:2},Af={class:"flex items-center justify-between mb-2"},Df={class:"flex flex-col"},_f={class:"text-2xl"},If={class:"text-lg text-gray-500"},kf={class:"flex gap-2"},Mf={class:"flex justify-end gap-2"},Jf=Ir({__name:"RouteEditPage",setup(s){const a=gi(),r=ns(),i=vi(),e=xi(),{isRouteLoading:t,isRouteUpdating:n,isRouteDeleting:o,selectedRoute:l}=pi(e),{loadRouteById:u,updateRouteById:c,deleteRouteById:h}=e;function d(){i.require({...Ei,message:"Are you sure you want delete?",accept:async()=>{await h(Number(a.params.id)),r.go(-1)}})}const v=he(!1);async function p(){var m,g;await c(Number(a.params.id),{name:(m=l.value)==null?void 0:m.name,description:(g=l.value)==null?void 0:g.description}),v.value=!1}return rs(()=>u(Number(a.params.id))),(m,g)=>{const E=os,x=kr,C=mi,S=yi;return Be(),ze("div",bf,[ae(le(ya)),Te("div",Pf,[le(t)?(Be(),ts(E,{key:0,class:"flex justify-center"})):le(l)?(Be(),ze("div",Of,[Te("div",Af,[Te("div",Df,[Te("div",_f,wt(le(l).name),1),Te("div",If,wt(le(l).description),1)]),Te("div",kf,[ae(x,{label:"Edit",severity:"info",variant:"outlined",class:"w-fit",onClick:g[0]||(g[0]=b=>v.value=!0)}),ae(x,{label:"Delete",severity:"danger",variant:"outlined",class:"w-fit",loading:le(o),disabled:le(o),onClick:d},null,8,["loading","disabled"]),ae(S,{visible:v.value,"onUpdate:visible":g[4]||(g[4]=b=>v.value=b),modal:"",header:"Update route",style:{width:"25rem"}},{default:mt(()=>[ae(C,{modelValue:le(l).name,"onUpdate:modelValue":g[1]||(g[1]=b=>le(l).name=b),id:"name",class:"w-full mb-4",autocomplete:"off",placeholder:"Name"},null,8,["modelValue"]),ae(C,{modelValue:le(l).description,"onUpdate:modelValue":g[2]||(g[2]=b=>le(l).description=b),id:"description",class:"w-full mb-4",autocomplete:"off",placeholder:"Description"},null,8,["modelValue"]),Te("div",Mf,[ae(x,{type:"button",label:"Cancel",severity:"secondary",onClick:g[3]||(g[3]=b=>v.value=!1)}),ae(x,{type:"button",label:"Update",loading:le(n),disabled:le(n),onClick:p},null,8,["loading","disabled"])])]),_:1},8,["visible"])])]),ae(Sf,{levels:le(l).levels},null,8,["levels"])])):(Be(),ze("div",Tf,"No route found"))])])}}});export{Jf as default};
