import{a as Z,u as I,r as h,R as ee,c as L,o as te,b as o,e as n,f as se,h as r,t as d,g,F as v,k as D,n as S,K as $,A as T}from"./index-n3daKGCc.js";import{h as B}from"./http-BEt-6spR.js";import{_ as ae}from"./AHeader.vue_vue_type_script_setup_true_lang-DwbVwjwX.js";import"./index-eM3voxb6.js";import"./index-Cxe1QBz0.js";import"./logo-D1-3uCnC.js";import"./StudentViewToggle.vue_vue_type_script_setup_true_lang-DQygniFN.js";import"./index-xAwojxg2.js";import"./index-ChwKPPkr.js";import"./index-BTdhpGXM.js";import"./index-BRSnIgLR.js";import"./index-c-XKspjc.js";import"./index-DKyGrjq1.js";import"./index-DHuZLmic.js";import"./index-D57r3cjp.js";import"./index-B39dc3Cm.js";import"./profile-CU0o5RSC.js";import"./index-D4py3QaC.js";import"./index-Bx3v-khi.js";const j={fetchAllBookings:oe,fetchStudentBookings:ne,bookSlot:re,cancelBooking:le,fetchAll:de,fetchMine:ie};async function oe(){const{data:y}=await B.get("/v2/booking");return y}async function ne(y){const{data:f}=await B.get(`/v2/booking/list/student/${y}`);return f}async function re(y){return B.post(`/v2/booking/${y}/student`)}async function le(y){return B.delete(`/v2/booking/${y}/student`)}async function de(){return await B.get("/v2/booking")}async function ie(){return await B.get("/v2/booking/list/student")}const ce={class:"flex flex-col min-h-screen bg-slate-50 gap-6"},ue={class:"flex-grow flex flex-col content-start gap-4 bg-slate-50 px-10 mb-6"},ge={class:"p-6"},pe={class:"text-2xl font-bold mb-4"},ye={class:"hidden md:flex items-center justify-center gap-4 mb-4"},_e={class:"font-semibold text-lg"},ve={class:"md:hidden flex items-center justify-center gap-4 mb-4"},he={class:"font-semibold text-lg"},fe={class:"max-w-6xl mx-auto flex flex-col items-center"},me={class:"hidden md:block overflow-x-auto w-full relative"},xe={class:"min-w-full text-center border border-slate-300"},ke={class:"text-xs text-slate-500"},be={class:"px-2 py-1 font-semibold bg-slate-50 sticky left-0 z-10 border border-slate-300"},we={key:0,class:"text-gray-400"},De={key:0},Se={class:"text-xs font-bold"},$e={key:0,class:"text-xs text-emerald-700 mt-1"},Be={key:1,class:"text-xs text-emerald-700 mt-1"},Ce={class:"flex gap-1 mt-1"},Le=["disabled","onClick"],Me={key:0},Ae={key:1},ze=["disabled","onClick"],Ee={key:0},We={key:1},Te={key:1,class:"text-gray-300 text-xs"},je={class:"md:hidden w-full"},Fe={class:"w-full text-center border border-slate-300"},Ve={class:"text-xs text-slate-500"},Ne={class:"px-2 py-1 font-semibold bg-slate-50 sticky left-0 z-10 border border-slate-300"},Re={key:0,class:"text-gray-400"},Ye={key:0},Ke={class:"text-xs font-bold"},Pe={key:0,class:"text-xs text-emerald-700 mt-1"},qe={key:1,class:"text-xs text-emerald-700 mt-1"},Ge={class:"flex gap-1 mt-1"},He=["disabled","onClick"],Je={key:0},Oe={key:1},Qe=["disabled","onClick"],Ue={key:0},Xe={key:1},Ze={key:1,class:"text-gray-300 text-xs"},mt=Z({__name:"StudentScheduleView",setup(y){const f=I(),M=h([]),N=h([]),A=h(!1),m=h({}),x=h({}),{t:i}=ee();function q(s){const a=new Date(s),t=a.getDay(),e=a.getDate()-(t+6)%7;return new Date(a.setDate(e))}const C=h(q(new Date)),c=h(0);function z(s){const a=new Date(C.value);a.setDate(C.value.getDate()+s*7),C.value=a}function G(){z(-1)}function H(){z(1)}function J(){c.value>0?c.value--:(z(-1),c.value=6)}function O(){c.value<6?c.value++:(z(1),c.value=0)}const u=L(()=>{const s=[];for(let a=0;a<7;a++){const t=new Date(C.value);t.setDate(C.value.getDate()+a),s.push({date:t,label:i(`pages.schedule.weekDay${a+1}`),dateLabel:`${t.getDate().toString().padStart(2,"0")}.${(t.getMonth()+1).toString().padStart(2,"0")}`})}return s}),Q=L(()=>{const s=u.value[0].date,a=u.value[6].date;return`${s.getDate().toString().padStart(2,"0")}.${(s.getMonth()+1).toString().padStart(2,"0")} - ${a.getDate().toString().padStart(2,"0")}.${(a.getMonth()+1).toString().padStart(2,"0")}`}),U=L(()=>{const s=u.value[c.value];return`${s.label}, ${s.dateLabel}`}),R=L(()=>{const s=new Date,a=u.value[c.value].date;return E(s,a)}),Y=L(()=>{const s=u.value[0].date,a=u.value[6].date,t=new Set;return M.value.forEach(e=>{const w=new Date(e.starts_at);if(w>=s&&w<=a){const l=k(e.starts_at);t.add(l)}}),t.size===0&&t.add("09:00"),Array.from(t).sort()});function E(s,a){const t=new Date(s);return t.getFullYear()===a.getFullYear()&&t.getMonth()===a.getMonth()&&t.getDate()===a.getDate()}function W(s,a){return M.value.filter(t=>{const e=new Date(t.starts_at);return E(e,s)&&k(t.starts_at)===a})}function k(s){return new Date(s).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1})}function _(s){const a=M.value.find(t=>t.id===s);return a&&a.my_class===!0?!0:N.value.some(t=>t.booking_id===s)}function p(s){return s.active===!1}function b(s){return new Date(s.starts_at)<new Date}async function F(){var s,a;A.value=!0;try{const{data:t}=await j.fetchAll();M.value=t}catch(t){f.add({severity:"error",summary:((a=(s=t==null?void 0:t.response)==null?void 0:s.data)==null?void 0:a.error)||"Error",life:2e3})}finally{A.value=!1}}async function V(){const{data:s}=await j.fetchMine();N.value=s??[]}te(async()=>{await F(),await V()});async function K(s){var a,t;m.value[s]=!0;try{const{data:e}=await j.bookSlot(s);await F(),await V(),f.add({severity:"success",summary:e.message,life:2e3})}catch(e){f.add({severity:"error",summary:((t=(a=e==null?void 0:e.response)==null?void 0:a.data)==null?void 0:t.error)||"Error",life:2e3})}finally{m.value[s]=!1}}async function P(s){var a,t;x.value[s]=!0;try{await j.cancelBooking(s),await F(),await V()}catch(e){f.add({severity:"error",summary:((t=(a=e==null?void 0:e.response)==null?void 0:a.data)==null?void 0:t.error)||"Error",life:2e3})}finally{x.value[s]=!1}}return(s,a)=>(o(),n("div",ce,[se(ae,{class:"sticky top-0 z-10"}),r("div",ue,[r("div",ge,[r("h2",pe,d(g(i)("pages.teacher.schedule")),1),r("div",ye,[r("button",{onClick:G,class:"px-3 py-1 rounded bg-slate-200 hover:bg-slate-300 text-sm"},d(g(i)("pages.schedule.prevWeek")),1),r("span",_e,d(Q.value),1),r("button",{onClick:H,class:"px-3 py-1 rounded bg-slate-200 hover:bg-slate-300 text-sm"},d(g(i)("pages.schedule.nextWeek")),1)]),r("div",ve,[r("button",{onClick:J,class:"px-3 py-1 rounded bg-slate-200 hover:bg-slate-300 text-sm"},"←"),r("span",he,d(U.value),1),r("button",{onClick:O,class:"px-3 py-1 rounded bg-slate-200 hover:bg-slate-300 text-sm"},"→")]),r("div",fe,[r("div",me,[r("table",xe,[r("thead",null,[r("tr",null,[a[0]||(a[0]=r("th",{class:"px-2 py-1 bg-slate-100 sticky left-0 z-10 border border-slate-300"},null,-1)),(o(!0),n(v,null,D(u.value,(t,e)=>(o(),n("th",{key:e,class:S(["px-2 py-1 border border-slate-300",E(t.date,new Date)?"bg-green-100":"bg-slate-100"])},[r("div",null,d(t.label),1),r("div",ke,d(t.dateLabel),1)],2))),128))])]),r("tbody",null,[(o(!0),n(v,null,D(Y.value,t=>(o(),n("tr",{key:t},[r("td",be,d(t),1),(o(!0),n(v,null,D(u.value,(e,w)=>(o(),n("td",{key:w,class:S(["px-1 py-1 min-w-[120px] border border-slate-300",E(e.date,new Date)?"bg-green-50":""])},[A.value?(o(),n("div",we)):(o(),n(v,{key:1},[W(e.date,t).length?(o(),n("div",De,[(o(!0),n(v,null,D(W(e.date,t),l=>(o(),n("div",{key:l.id,class:S(["mb-1 p-1 rounded flex flex-col items-center justify-center",[p(l)?"bg-red-100 border-red-300":l.my_class===!0?"bg-orange-100 border-orange-300":_(l.id)?"bg-blue-100 border-blue-300":b(l)?"bg-gray-100 border-gray-300":"bg-emerald-50 border-emerald-200"]])},[r("span",Se,d(k(l.starts_at))+"-"+d(k(l.ends_at))+" ("+d(l.count)+"/"+d(l.max_count)+") ",1),l.my_class===!0&&!p(l)?(o(),n("div",$e,d(g(i)("pages.schedule.fixedLesson")),1)):$("",!0),_(l.id)&&!p(l)&&l.my_class!==!0?(o(),n("div",Be,d(g(i)("pages.schedule.freeLesson")),1)):$("",!0),r("div",Ce,[!_(l.id)&&l.count<l.max_count&&!b(l)&&!p(l)?(o(),n("button",{key:0,type:"button",class:"px-2 py-1 rounded bg-emerald-500 text-white hover:bg-emerald-600 text-xs",disabled:m.value[l.id],onClick:T(X=>K(l.id),["stop"])},[m.value[l.id]?(o(),n("span",Me,"...")):(o(),n("span",Ae,d(g(i)("pages.schedule.bookSlot")),1))],8,Le)):l.my_class!==!0&&_(l.id)&&!b(l)&&!p(l)?(o(),n("button",{key:1,type:"button",class:"px-2 py-1 rounded bg-red-500 text-white hover:bg-red-600 text-xs",disabled:x.value[l.id],onClick:T(X=>P(l.id),["stop"])},[x.value[l.id]?(o(),n("span",Ee,"...")):(o(),n("span",We,d(g(i)("pages.schedule.cancelBooking")),1))],8,ze)):$("",!0)])],2))),128))])):(o(),n("div",Te,"—"))],64))],2))),128))]))),128))])])]),r("div",je,[r("table",Fe,[r("thead",null,[r("tr",null,[a[1]||(a[1]=r("th",{class:"px-2 py-1 bg-slate-100 sticky left-0 z-10 w-1/5 border border-slate-300"},null,-1)),r("th",{class:S(["px-2 py-1 border border-slate-300",R.value?"bg-green-100":"bg-slate-100"])},[r("div",null,d(u.value[c.value].label),1),r("div",Ve,d(u.value[c.value].dateLabel),1)],2)])]),r("tbody",null,[(o(!0),n(v,null,D(Y.value,t=>(o(),n("tr",{key:t},[r("td",Ne,d(t),1),r("td",{class:S(["px-1 py-1 border border-slate-300",R.value?"bg-green-50":""])},[A.value?(o(),n("div",Re)):(o(),n(v,{key:1},[W(u.value[c.value].date,t).length?(o(),n("div",Ye,[(o(!0),n(v,null,D(W(u.value[c.value].date,t),e=>(o(),n("div",{key:e.id,class:S(["mb-2 p-2 rounded flex flex-col items-center justify-center",[p(e)?"bg-red-100 border-red-300":e.my_class===!0?"bg-orange-100 border-orange-300":_(e.id)?"bg-blue-100 border-blue-300":b(e)?"bg-gray-100 border-gray-300":"bg-emerald-50 border-emerald-200"]])},[r("span",Ke,d(k(e.starts_at))+"-"+d(k(e.ends_at))+" ("+d(e.count)+"/"+d(e.max_count)+") ",1),e.my_class===!0&&!p(e)?(o(),n("div",Pe,d(g(i)("pages.schedule.fixedLesson")),1)):$("",!0),_(e.id)&&!p(e)&&e.my_class!==!0?(o(),n("div",qe,d(g(i)("pages.schedule.freeLesson")),1)):$("",!0),r("div",Ge,[!_(e.id)&&e.count<e.max_count&&!b(e)&&!p(e)?(o(),n("button",{key:0,type:"button",class:"px-2 py-1 rounded bg-emerald-500 text-white hover:bg-emerald-600 text-xs",disabled:m.value[e.id],onClick:T(w=>K(e.id),["stop"])},[m.value[e.id]?(o(),n("span",Je,"...")):(o(),n("span",Oe,d(g(i)("pages.schedule.bookSlot")),1))],8,He)):e.my_class!==!0&&_(e.id)&&!b(e)&&!p(e)?(o(),n("button",{key:1,type:"button",class:"px-2 py-1 rounded bg-red-500 text-white hover:bg-red-600 text-xs",disabled:x.value[e.id],onClick:T(w=>P(e.id),["stop"])},[x.value[e.id]?(o(),n("span",Ue,"...")):(o(),n("span",Xe,d(g(i)("pages.schedule.cancelBooking")),1))],8,Qe)):$("",!0)])],2))),128))])):(o(),n("div",Ze,"—"))],64))],2)]))),128))])])])])])])]))}});export{mt as default};
