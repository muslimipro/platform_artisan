import{s as Z,S as ee,_ as te,T as se,a as ae}from"./SimulationView-sqNsdZZI.js";import{u as R,a as q,t as le}from"./store-Cu6EZccs.js";import{d as A,ad as E,g as ne,ae as O,a as oe,ac as M,r as D,l as W,y as Y,o as s,c as k,e as u,b as r,f as t,h as f,F as G,k as ie,af as J,w as x,ag as re,t as K,s as Q,ah as ce,u as ue,n as pe,j as I,ai as de}from"./index-DPR03QxN.js";import{s as fe}from"./index-DF40pb3B.js";import{s as me,a as ve,t as _e}from"./types-Dg8sKFfX.js";import{L as ye,s as ge}from"./logo-DXBEFZEz.js";import{_ as he}from"./LocaleSwitcher.vue_vue_type_script_setup_true_lang-1LOZqoIq.js";import{_ as be,a as we,M as xe,b as ke,c as Se}from"./QuestionStep.vue_vue_type_script_setup_true_lang-DM8MBWMF.js";import"./pibody-B70zHXNr.js";import"./http-D1Zy6-RB.js";import"./index-D2ISNsTm.js";const $e={class:"mx-auto flex items-center justify-between p-2 px-6 w-full bg-white"},ze={class:"flex flex-1 items-center"},Ce={key:1,class:"flex items-center gap-1"},je={class:"flex items-center gap-1"},Pe={class:"flex flex-1 justify-end items-center gap-2"},Ie={class:"relative overflow-hidden w-full border-0 bg-transparent flex items-start p-2 pl-4 rounded-none cursor-pointer transition-colors duration-200"},Le={class:"inline-flex flex-col items-start"},Be={class:"font-bold"},Ve={class:"text-sm"},De=A({__name:"LessonHeader",setup(H){const{locale:h}=E(),S=ne(),L=O(),v=oe(),{user:l}=M(v),$=R(),{lesson:b,stepIndex:_,stepLoading:m,firstUncompletedIndex:z}=M($),{changeStep:C,setSteps:e,setStepIndex:N,setFirstUncompletedIndex:T}=$,B=D(!1);function V(a,o){if(o)return"info";if(a!="completed")return a=="attempted"?"warn":(a=="started","secondary")}function U(a,o){if(!o&&a!="completed")return a=="attempted"||a=="started"?"outlined":void 0}function c(a){switch(a){case"article":return"pi pi-align-left";case"code":return"pi pi-code";case"question":return"pi pi-question";case"matching":return"pi pi-arrows-h";case"open":return"pi pi-pencil";default:return"pi pi-align-left"}}async function n(){if(!B.value){B.value=!0;try{const{data:a}=await q.getStudentProjectStepsByID(L.params.id.toString()),o=[];for(const[d,P]of a.steps.entries())if(P.id==a.last_step_id){N(d);const F=await le(P,h.value);o.push(F)}else{const F={id:P.id.toString(),title:"",type:P.step_type,progress:P.status,inner:{contents:[]},answer:{}};o.push(F)}e(o);let j=0;for(let d=0;d<o.length;d++)if(o[d].progress!="completed"||d==o.length-1){j=d;break}T(j)}catch(a){alert(a)}finally{B.value=!1}}}W(n),Y(h,n,{immediate:!1});const i=D(),y=D([{label:"Log out",icon:"pi pi-sign-out",command:()=>{v.logout(),S.replace({name:"login"})}}]),p=a=>{i.value.toggle(a)};return(a,o)=>{const j=ge,d=Q,P=me,F=fe,X=ce;return s(),k("div",$e,[u("div",ze,[r(j,{src:t(ye),width:"32"},null,8,["src"]),o[1]||(o[1]=u("p",{class:"text-xl font-semibold px-2 mr-4"},"Artisan",-1)),r(d,{id:"#projects",icon:"pi pi-angle-left",label:a.$t("projects"),severity:"secondary",variant:"text",onClick:o[0]||(o[0]=g=>t(S).push({name:"projects"})),size:"small"},null,8,["label"])]),B.value||t(b)==null?(s(),f(P,{key:0,shape:"circle",size:"2rem",class:"mr-2"})):(s(),k("div",Ce,[u("div",je,[(s(!0),k(G,null,ie(t(b).steps,(g,w)=>(s(),f(d,{key:g.id,icon:c(g.type),rounded:"",severity:V(g.progress,w==t(_)),variant:U(g.progress,w==t(_)),class:J([{"bg-orange-100":g.progress=="attempted"&&w!=t(_)},"h-8 w-8"]),onClick:Ge=>t(C)(w),disabled:t(m)||g.progress!="completed"&&w!=t(z),loading:w==t(_)&&t(m)},null,8,["icon","severity","variant","class","onClick","disabled","loading"]))),128))])])),u("div",Pe,[r(he),r(d,{type:"button",icon:"pi pi-ellipsis-v",onClick:p,"aria-haspopup":"true","aria-controls":"overlay_menu",size:"small",variant:"outlined",severity:"secondary",class:"border border-slate-300 bg-slate-50",style:{width:"34px"}}),r(F,{ref_key:"menu",ref:i,id:"overlay_menu",model:y.value,popup:!0},{start:x(()=>{var g,w;return[re((s(),k("button",Ie,[u("span",Le,[u("span",Be,K((g=t(l))==null?void 0:g.email),1),u("span",Ve,K((w=t(l))==null?void 0:w.user_type),1)])])),[[X]])]}),_:1},8,["model"])])])}}}),Fe={class:"flex flex-col p-4 gap-4 overflow-scroll h-full justify-between bg-white"},qe={key:0},Ne={key:1,class:"flex"},Te={class:"flex justify-end gap-2"},Ue=A({__name:"LessonDiv",setup(H){const{locale:h}=E(),S=ue(),L=R(),{lesson:v,stepIndex:l,userCode:$,firstUncompletedIndex:b}=M(L),{changeStep:_,updateStatus:m,incrementFirstUncompletedIndex:z}=L,C=D(!1),e=pe(()=>{var c;return l.value==null?null:((c=v.value)==null?void 0:c.steps[l.value])??null});async function N(){l.value!=null&&_(l.value-1)}async function T(){var c,n;if(l.value!=null){if(((c=e.value)==null?void 0:c.type)=="article"&&e.value.progress!="completed")try{const{data:i}=await q.submitStep(((n=e.value)==null?void 0:n.id)??"",h.value,{});m(i.status),z()}catch(i){console.log(i)}l.value+1<=b.value&&_(l.value+1)}}async function B(){var c,n,i;if(l.value!=null){if(((c=e.value)==null?void 0:c.progress)=="completed"){C.value=!0;return}if(((n=e.value)==null?void 0:n.type)=="article")try{const{data:y}=await q.submitStep(((i=e.value)==null?void 0:i.id)??"",h.value,{});m(y.status),C.value=!0}catch(y){console.log(y)}}}const V=D(!1);async function U(){var c,n,i,y;V.value=!0;try{let p;switch((c=e.value)==null?void 0:c.type){case"code":p={code:$.value};break;case"open":p={open:e.value.answer.open};break;case"question":const j=[];(n=e.value.inner.options)==null||n.forEach(d=>{j.push(d.correct)}),p={question:j};break;case"matching":p={match:[{key:"dog",value:"b"},{key:"a",value:"animal"},{key:"c",value:"d"}]};break;default:p={};break}const a=((i=e.value)==null?void 0:i.progress)=="completed",{data:o}=await q.submitStep(((y=e.value)==null?void 0:y.id)??"",h.value,p);a||m(o.status),o.status=="completed"?(a||z(),S.add({severity:"success",summary:"Correct, good job!",detail:"Completed successfully",life:5e3})):o.status=="attempted"&&S.add({severity:"error",summary:"Wrong answer!",detail:"Keep trying",life:5e3}),console.log(o.status)}catch(p){alert(p)}finally{V.value=!1}}return(c,n)=>{const i=Q,y=de;return s(),k(G,null,[u("div",Fe,[e.value?(s(),k("div",qe,[e.value.type=="article"?(s(),f(t(be),{key:0,step:e.value,isPreview:!1},null,8,["step"])):e.value.type=="code"?(s(),f(t(we),{key:1,step:e.value,isPreview:!1},null,8,["step"])):e.value.type=="matching"?(s(),f(t(xe),{key:2,step:e.value,isPreview:!1},null,8,["step"])):e.value.type=="open"?(s(),f(t(ke),{key:3,step:e.value,isPreview:!1},null,8,["step"])):e.value.type=="question"?(s(),f(t(Se),{key:4,step:e.value,isPreview:!1},null,8,["step"])):I("",!0),n[2]||(n[2]=u("br",null,null,-1)),e.value.type!="article"?(s(),f(i,{key:5,label:"Submit",icon:"pi pi-check",iconPos:"right",severity:"info",size:"small",class:"self-start",onClick:U,disabled:V.value,loading:V.value},null,8,["disabled","loading"])):I("",!0)])):I("",!0),t(v)!=null&&t(v).steps!=null&&t(v).steps.length>0&&e.value?(s(),k("div",Ne,[t(l)!==0?(s(),f(i,{key:0,label:"Previous",icon:"pi pi-angle-left",size:"small",onClick:N})):I("",!0),t(l)<t(v).steps.length-1?(s(),f(i,{key:1,label:"Next",icon:"pi pi-angle-right",iconPos:"right",size:"small",class:"ml-auto self-end",onClick:T,disabled:e.value.progress!="completed"&&e.value.type!="article"},null,8,["disabled"])):t(l)==t(v).steps.length-1?(s(),f(i,{key:2,label:"Finish 🥳",size:"small",class:"ml-auto self-end",onClick:B,disabled:e.value.progress!="completed"&&e.value.type!="article"},null,8,["disabled"])):I("",!0)])):I("",!0)]),r(y,{visible:C.value,"onUpdate:visible":n[1]||(n[1]=p=>C.value=p),modal:"",header:"Congratulations🥳🎉",style:{width:"25rem"}},{default:x(()=>[n[3]||(n[3]=u("span",{class:"text-surface-500 dark:text-surface-400 block mb-8"},"You successfully completed this project",-1)),u("div",Te,[r(i,{type:"button",label:"Go to next Project ➡️",onClick:n[0]||(n[0]=p=>C.value=!1)})])]),_:1},8,["visible"])],64)}}}),Me={key:1,class:"h-[51px]"},Re={class:"flex bg-surface-0",style:{height:"calc(100vh - 52px)"}},Ae={class:"flex justify-center h-full"},Ee={class:"max-w-[400px] w-full"},st=A({__name:"LessonView",setup(H){const{locale:h}=E(),S=O(),L=R(),{setLesson:v}=L,l=D(!1);async function $(){if(!l.value){l.value=!0;try{const{data:b}=await ve.getProjectByID(S.params.id.toString()),_=await _e(b,h.value);v(_)}catch(b){alert(b)}finally{l.value=!1}}}return W($),Y(h,$),(b,_)=>{const m=ae,z=Z;return s(),k(G,null,[l.value?(s(),k("div",Me)):(s(),f(De,{key:0})),u("div",Re,[r(z,{class:"w-full rounded-none"},{default:x(()=>[r(m,{size:33,minSize:10,class:"max-w-[467px] w-full"},{default:x(()=>[r(ee)]),_:1}),r(m,{size:34,minSize:10},{default:x(()=>[r(z,{layout:"vertical",class:"h-full w-full"},{default:x(()=>[r(m,{size:65,minSize:10},{default:x(()=>[r(te)]),_:1}),r(m,{size:35,minSize:10},{default:x(()=>[r(se)]),_:1})]),_:1})]),_:1}),r(m,{size:33,minSize:10,class:J(["max-w-md mx-auto",{"animate-fadeinright animate-once animate-duration-1000 animate-ease-in-out":!0}])},{default:x(()=>[u("div",Ae,[u("div",Ee,[l.value?I("",!0):(s(),f(Ue,{key:0}))])])]),_:1})]),_:1})])],64)}}});export{st as default};
