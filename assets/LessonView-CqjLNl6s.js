import{s as ee,S as te,_ as se,T as ae,a as le}from"./SimulationView-C_0RtJxW.js";import{u as R,a as U,t as oe,b as ne,c as ie}from"./store-D12eEpQG.js";import{d as A,ae as G,g as W,af as Y,a as re,ac as T,r as V,l as J,y as Q,o as l,c as x,e as m,b as o,f as s,h as d,F as H,k as ce,ag as X,w,ah as ue,t as O,s as Z,ai as pe,u as de,n as me,j as P,aj as fe,ak as ve}from"./index-2A5d1rMW.js";import{s as _e}from"./index-CKEqp2QD.js";import{s as ye,a as ge,t as he}from"./types-C9nc1UIW.js";import{L as be,s as we}from"./logo-Brxu7FOG.js";import{_ as xe}from"./LocaleSwitcher.vue_vue_type_script_setup_true_lang-DGVTYdP5.js";import{_ as ke,a as Se,M as $e,b as je,c as Ce}from"./QuestionStep.vue_vue_type_script_setup_true_lang-CLdx9mPo.js";import"./pibody-BwAjMvHk.js";import"./http-CjZYp4su.js";import"./index-CaqDq2FH.js";import"./index-DvgMEP-W.js";const ze={class:"mx-auto flex items-center justify-between p-2 px-6 w-full bg-white"},Pe={class:"flex flex-1 items-center"},Ie={key:1,class:"flex items-center gap-1"},Le={class:"flex items-center gap-1"},Be={class:"flex flex-1 justify-end items-center gap-2"},De={class:"relative overflow-hidden w-full border-0 bg-transparent flex items-start p-2 pl-4 rounded-none cursor-pointer transition-colors duration-200"},Ve={class:"inline-flex flex-col items-start"},Fe={class:"font-bold"},Ne={class:"text-sm"},Ue=A({__name:"LessonHeader",setup(K){const{locale:h}=G(),I=W(),L=Y(),j=re(),{user:_}=T(j),n=R(),{lesson:B,stepIndex:k,stepLoading:f,firstUncompletedIndex:C}=T(n),{changeStep:y,setSteps:z,setStepIndex:p,setFirstUncompletedIndex:e}=n,D=V(!1);function q(t,a){if(a)return"info";if(t!="completed")return t=="attempted"?"warn":(t=="started","secondary")}function E(t,a){if(!a&&t!="completed")return t=="attempted"||t=="started"?"outlined":void 0}function S(t){switch(t){case"article":return"pi pi-align-left";case"code":return"pi pi-code";case"question":return"pi pi-question";case"matching":return"pi pi-arrows-h";case"open":return"pi pi-pencil";default:return"pi pi-align-left"}}async function F(){if(!D.value){D.value=!0;try{const{data:t}=await U.getStudentProjectStepsByID(L.params.id.toString()),a=[];for(const[u,v]of t.steps.entries())if(v.id==t.last_step_id){p(u);const $=await oe(v,h.value);a.push($)}else{const $={id:v.id.toString(),title:"",type:v.step_type,progress:v.status,inner:{contents:[]},answer:{}};a.push($)}z(a);let r=0;for(let u=0;u<a.length;u++)if(a[u].progress!="completed"||u==a.length-1){r=u;break}e(r)}catch(t){alert(t)}finally{D.value=!1}}}J(F),Q(h,F,{immediate:!1});const N=V(),c=V([{label:"Log out",icon:"pi pi-sign-out",command:()=>{j.logout(),I.replace({name:"login"})}}]),i=t=>{N.value.toggle(t)};return(t,a)=>{const r=we,u=Z,v=ye,$=_e,M=pe;return l(),x("div",ze,[m("div",Pe,[o(r,{src:s(be),width:"32"},null,8,["src"]),a[1]||(a[1]=m("p",{class:"text-xl font-semibold px-2 mr-4"},"Artisan",-1)),o(u,{id:"#projects",icon:"pi pi-angle-left",label:t.$t("projects"),severity:"secondary",variant:"text",onClick:a[0]||(a[0]=g=>s(I).push({name:"projects"})),size:"small"},null,8,["label"])]),D.value||s(B)==null?(l(),d(v,{key:0,shape:"circle",size:"2rem",class:"mr-2"})):(l(),x("div",Ie,[m("div",Le,[(l(!0),x(H,null,ce(s(B).steps,(g,b)=>(l(),d(u,{key:g.id,icon:S(g.type),rounded:"",severity:q(g.progress,b==s(k)),variant:E(g.progress,b==s(k)),class:X([{"bg-orange-100":g.progress=="attempted"&&b!=s(k)},"h-8 w-8"]),onClick:Oe=>s(y)(b),disabled:s(f)||g.progress!="completed"&&b!=s(C),loading:b==s(k)&&s(f)},null,8,["icon","severity","variant","class","onClick","disabled","loading"]))),128))])])),m("div",Be,[o(xe),o(u,{type:"button",icon:"pi pi-ellipsis-v",onClick:i,"aria-haspopup":"true","aria-controls":"overlay_menu",size:"small",variant:"outlined",severity:"secondary",class:"border border-slate-300 bg-slate-50",style:{width:"34px"}}),o($,{ref_key:"menu",ref:N,id:"overlay_menu",model:c.value,popup:!0},{start:w(()=>{var g,b;return[ue((l(),x("button",De,[m("span",Ve,[m("span",Fe,O((g=s(_))==null?void 0:g.email),1),m("span",Ne,O((b=s(_))==null?void 0:b.user_type),1)])])),[[M]])]}),_:1},8,["model"])])])}}}),qe={class:"flex flex-col p-4 gap-4 overflow-scroll h-full justify-between bg-white"},Ee={key:0},Me={key:1,class:"flex"},Te={class:"flex justify-end gap-2"},Re=A({__name:"LessonDiv",setup(K){const{locale:h}=G(),I=W(),L=de(),j=R(),{lesson:_,stepIndex:n,userCode:B,firstUncompletedIndex:k,submitEnabled:f}=T(j),{changeStep:C,updateStatus:y,incrementFirstUncompletedIndex:z}=j,p=V(!1),e=me(()=>{var c;return n.value==null?null:((c=_.value)==null?void 0:c.steps[n.value])??null});async function D(){n.value!=null&&C(n.value-1)}async function q(){var c,i;if(n.value!=null){if(((c=e.value)==null?void 0:c.type)=="article"&&e.value.progress!="completed")try{const{data:t}=await U.submitStep(((i=e.value)==null?void 0:i.id)??"",h.value,{});y(t.status),z()}catch(t){console.log(t)}n.value+1<=k.value&&C(n.value+1)}}async function E(){var c,i,t;if(n.value!=null){if(((c=e.value)==null?void 0:c.progress)=="completed"){p.value=!0;return}if(((i=e.value)==null?void 0:i.type)=="article")try{const{data:a}=await U.submitStep(((t=e.value)==null?void 0:t.id)??"",h.value,{});y(a.status),p.value=!0}catch(a){console.log(a)}}}const S=V(!1);async function F(){var c,i,t,a;S.value=!0;try{let r;switch((c=e.value)==null?void 0:c.type){case"code":r={code:B.value};break;case"open":r={open:e.value.answer.open};break;case"question":const $=[];(i=e.value.inner.options)==null||i.forEach(M=>{$.push(M.correct)}),r={question:$};break;case"matching":r={match:[{key:"dog",value:"b"},{key:"a",value:"animal"},{key:"c",value:"d"}]};break;default:r={};break}const u=((t=e.value)==null?void 0:t.progress)=="completed",{data:v}=await U.submitStep(((a=e.value)==null?void 0:a.id)??"",h.value,r);u||y(v.status),v.status=="completed"?(u||z(),L.add({severity:"success",summary:"Correct, good job!",detail:"Completed successfully",life:5e3})):v.status=="attempted"&&L.add({severity:"error",summary:"Wrong answer!",detail:"Keep trying",life:5e3}),console.log(v.status)}catch(r){alert(r)}finally{S.value=!1}}function N(){p.value=!1,I.push({name:"projects"})}return(c,i)=>{const t=Z,a=fe;return l(),x(H,null,[m("div",qe,[e.value?(l(),x("div",Ee,[e.value.type=="article"?(l(),d(s(ke),{key:0,step:e.value,isPreview:!1},null,8,["step"])):e.value.type=="code"?(l(),d(s(Se),{key:1,step:e.value,isPreview:!1},null,8,["step"])):e.value.type=="matching"?(l(),d(s($e),{key:2,step:e.value,isPreview:!1},null,8,["step"])):e.value.type=="open"?(l(),d(s(je),{key:3,step:e.value,isPreview:!1},null,8,["step"])):e.value.type=="question"?(l(),d(s(Ce),{key:4,step:e.value,isPreview:!1},null,8,["step"])):P("",!0)])):P("",!0),s(_)!=null&&s(_).steps!=null&&s(_).steps.length>0&&e.value?(l(),x("div",Me,[s(n)!==0?(l(),d(t,{key:0,label:"Previous",icon:"pi pi-angle-left",size:"small",onClick:D})):P("",!0),e.value.type!="article"&&e.value.progress!="completed"?(l(),d(t,{key:1,label:"Submit",icon:"pi pi-check",iconPos:"right",severity:"info",size:"small",class:"ml-auto self-end",onClick:F,disabled:S.value||!s(f),loading:S.value},null,8,["disabled","loading"])):P("",!0),s(n)<s(_).steps.length-1&&(e.value.progress=="completed"||e.value.type=="article")?(l(),d(t,{key:2,label:"Next",icon:"pi pi-angle-right",iconPos:"right",size:"small",class:"ml-auto self-end",onClick:q,disabled:e.value.progress!="completed"&&(e.value.type!="article"||!s(f)),loading:S.value},null,8,["disabled","loading"])):s(n)==s(_).steps.length-1&&(e.value.progress=="completed"||e.value.type=="article")?(l(),d(t,{key:3,label:"Finish 🥳",size:"small",class:"ml-auto self-end",onClick:E,disabled:e.value.progress!="completed"&&(e.value.type!="article"||!s(f)),loading:S.value},null,8,["disabled","loading"])):P("",!0)])):P("",!0)]),o(a,{visible:p.value,"onUpdate:visible":i[0]||(i[0]=r=>p.value=r),modal:"",header:"Congratulations🥳🎉",style:{width:"25rem"}},{default:w(()=>[i[1]||(i[1]=m("span",{class:"text-surface-500 dark:text-surface-400 block mb-8"},"You successfully completed this project",-1)),m("div",Te,[o(t,{type:"button",label:"Go to next Project ➡️",onClick:N})])]),_:1},8,["visible"])],64)}}}),Ae={key:1,class:"h-[51px]"},Ge={class:"flex bg-surface-0",style:{height:"calc(100vh - 52px)"}},He={class:"flex justify-center h-full"},Ke={class:"max-w-[400px] w-full"},nt=A({__name:"LessonView",setup(K){const{locale:h}=G(),I=Y(),L=R(),{setLesson:j}=L,_=ne(),{clearSlots:n}=_,B=ie(),{setCode:k}=B,f=V(!1);async function C(){if(!f.value){f.value=!0;try{const{data:y}=await ge.getProjectByID(I.params.id.toString()),z=await he(y,h.value);j(z)}catch(y){alert(y)}finally{f.value=!1}}}return J(C),Q(h,C),ve(()=>{n(),k("")}),(y,z)=>{const p=le,e=ee;return l(),x(H,null,[f.value?(l(),x("div",Ae)):(l(),d(Ue,{key:0})),m("div",Ge,[o(e,{class:"w-full rounded-none"},{default:w(()=>[o(p,{size:33,minSize:10,class:"max-w-[467px] w-full"},{default:w(()=>[o(te)]),_:1}),o(p,{size:34,minSize:10},{default:w(()=>[o(e,{layout:"vertical",class:"h-full w-full"},{default:w(()=>[o(p,{size:65,minSize:10},{default:w(()=>[o(se)]),_:1}),o(p,{size:35,minSize:10},{default:w(()=>[o(ae)]),_:1})]),_:1})]),_:1}),o(p,{size:33,minSize:10,class:X(["max-w-md mx-auto",{"animate-fadeinright animate-once animate-duration-1000 animate-ease-in-out":!0}])},{default:w(()=>[m("div",He,[m("div",Ke,[f.value?P("",!0):(l(),d(Re,{key:0}))])])]),_:1})]),_:1})])],64)}}});export{nt as default};
