import{s as ae,S as le,_ as oe,T as ne,a as ie}from"./SimulationView-CT1l8Lxb.js";import{u as A,a as q,t as re,b as ce,c as ue}from"./store-E6nFlPMK.js";import{d as G,ae as H,u as J,af as Q,g as pe,ac as T,r as D,l as X,y as Z,o as a,c as S,a as f,b as n,e as s,h as p,F as K,k as de,ag as ee,j as C,w as x,ah as fe,t as Y,s as te,ai as me,f as ve,n as _e,aj as ye,ak as ge}from"./index-F34L02az.js";import{s as he}from"./index-twwGrNCR.js";import{s as be,a as we,t as ke}from"./types-CZZAjvR5.js";import{L as xe,s as Se}from"./logo-B--updIP.js";import{_ as $e}from"./LocaleSwitcher.vue_vue_type_script_setup_true_lang-CgWRzKVT.js";import{_ as je,a as Ce,M as Pe,b as ze,c as Ie}from"./QuestionStep.vue_vue_type_script_setup_true_lang-TTqsdTx2.js";import"./pibody-BwAjMvHk.js";import"./http-QlDMUDB3.js";import"./index-BnP163QL.js";import"./index-cF1vaM8i.js";const Le={class:"mx-auto flex items-center justify-between p-2 px-6 w-full bg-white"},Be={class:"flex flex-1 items-center"},De={key:1,class:"flex items-center gap-1"},Ve={class:"flex items-center gap-1"},Fe={class:"flex flex-1 justify-end items-center gap-2"},Ne={class:"relative overflow-hidden w-full border-0 bg-transparent flex items-start p-2 pl-4 rounded-none cursor-pointer transition-colors duration-200"},Ue={class:"inline-flex flex-col items-start"},qe={class:"font-bold"},Ee={class:"text-sm"},Me=G({__name:"LessonHeader",setup(O){const{locale:h}=H(),V=J(),P=Q(),z=pe(),{user:m}=T(z),i=A(),{lesson:F,stepIndex:$,stepLoading:v,firstUncompletedIndex:I}=T(i),{changeStep:_,setSteps:L,setStepIndex:d,setFirstUncompletedIndex:e}=i,N=D(!1),B=D(!1);function M(t,l){if(l)return"info";if(t!="completed")return t=="attempted"?"warn":(t=="started","secondary")}function j(t,l){if(!l&&t!="completed")return t=="attempted"||t=="started"?"outlined":void 0}function R(t){switch(t){case"article":return"pi pi-align-left";case"code":return"pi pi-code";case"question":return"pi pi-question";case"matching":return"pi pi-arrows-h";case"open":return"pi pi-pencil";default:return"pi pi-align-left"}}async function E(){if(!N.value){N.value=!0;try{const{data:t}=await q.getStudentProjectStepsByID(P.params.id.toString()),l=[];for(const[u,w]of t.steps.entries())if(w.id==t.last_step_id){d(u);const U=await re(w,h.value);l.push(U)}else{const U={id:w.id.toString(),title:"",type:w.step_type,progress:w.status,inner:{contents:[]},answer:{}};l.push(U)}L(l);let b=0;for(let u=0;u<l.length;u++)if(l[u].progress!="completed"||u==l.length-1){b=u;break}e(b)}catch(t){alert(t)}finally{N.value=!1}}}X(E),Z(h,E,{immediate:!1});const r=D(),c=D([{label:"Log out",icon:"pi pi-sign-out",command:()=>{z.logout(),V.replace({name:"login"})}}]),o=t=>{r.value.toggle(t)};async function y(){if(!B.value){B.value=!0;try{await q.resetStepsProgress(P.params.id.toString())}catch(t){alert(t)}finally{B.value=!1}}}return(t,l)=>{var W;const b=Se,u=te,w=be,U=he,se=me;return a(),S("div",Le,[f("div",Be,[n(b,{src:s(xe),width:"32"},null,8,["src"]),l[1]||(l[1]=f("p",{class:"text-xl font-semibold px-2 mr-4"},"Artisan",-1)),n(u,{id:"#projects",icon:"pi pi-angle-left",label:t.$t("projects"),severity:"secondary",variant:"text",onClick:l[0]||(l[0]=g=>s(V).push({name:"projects"})),size:"small"},null,8,["label"])]),N.value||s(F)==null?(a(),p(w,{key:0,shape:"circle",size:"2rem",class:"mr-2"})):(a(),S("div",De,[f("div",Ve,[(a(!0),S(K,null,de(s(F).steps,(g,k)=>(a(),p(u,{key:g.id,icon:R(g.type),rounded:"",severity:M(g.progress,k==s($)),variant:j(g.progress,k==s($)),class:ee([{"bg-orange-100":g.progress=="attempted"&&k!=s($)},"h-8 w-8"]),onClick:Je=>s(_)(k),disabled:s(v)||g.progress!="completed"&&k!=s(I),loading:k==s($)&&s(v)},null,8,["icon","severity","variant","class","onClick","disabled","loading"]))),128))])])),f("div",Fe,[((W=s(m))==null?void 0:W.user_type)=="editor"?(a(),p(u,{key:0,label:"Reset",icon:"pi pi-refresh",severity:"info",variant:"outlined",size:"small",onClick:y,disabled:B.value,loading:B.value},null,8,["disabled","loading"])):C("",!0),n($e),n(u,{type:"button",icon:"pi pi-ellipsis-v",onClick:o,"aria-haspopup":"true","aria-controls":"overlay_menu",size:"small",variant:"outlined",severity:"secondary",class:"border border-slate-300 bg-slate-50",style:{width:"34px"}}),n(U,{ref_key:"menu",ref:r,id:"overlay_menu",model:c.value,popup:!0},{start:x(()=>{var g,k;return[fe((a(),S("button",Ne,[f("span",Ue,[f("span",qe,Y((g=s(m))==null?void 0:g.email),1),f("span",Ee,Y((k=s(m))==null?void 0:k.user_type),1)])])),[[se]])]}),_:1},8,["model"])])])}}}),Re={class:"flex flex-col p-4 gap-4 overflow-scroll h-full justify-between bg-white"},Te={key:0},Ae={key:1,class:"flex"},Ge={class:"flex justify-end gap-2"},He=G({__name:"LessonDiv",setup(O){const{locale:h}=H(),V=J(),P=ve(),z=A(),{lesson:m,stepIndex:i,userCode:F,firstUncompletedIndex:$,submitEnabled:v}=T(z),{changeStep:I,updateStatus:_,incrementFirstUncompletedIndex:L}=z,d=D(!1),e=_e(()=>{var r;return i.value==null?null:((r=m.value)==null?void 0:r.steps[i.value])??null});async function N(){i.value!=null&&I(i.value-1)}async function B(){var r,c;if(i.value!=null){if(((r=e.value)==null?void 0:r.type)=="article"&&e.value.progress!="completed")try{const{data:o}=await q.submitStep(((c=e.value)==null?void 0:c.id)??"",h.value,{});_(o.status),L()}catch(o){console.log(o)}i.value+1<=$.value&&I(i.value+1)}}async function M(){var r,c,o;if(i.value!=null){if(((r=e.value)==null?void 0:r.progress)=="completed"){d.value=!0;return}if(((c=e.value)==null?void 0:c.type)=="article")try{const{data:y}=await q.submitStep(((o=e.value)==null?void 0:o.id)??"",h.value,{});_(y.status),d.value=!0}catch(y){console.log(y)}}}const j=D(!1);async function R(){var r,c,o,y;j.value=!0;try{let t;switch((r=e.value)==null?void 0:r.type){case"code":t={code:F.value};break;case"open":t={open:e.value.answer.open};break;case"question":const u=[];(c=e.value.inner.options)==null||c.forEach(w=>{u.push(w.correct)}),t={question:u};break;case"matching":t={match:[{key:"dog",value:"b"},{key:"a",value:"animal"},{key:"c",value:"d"}]};break;default:t={};break}const l=((o=e.value)==null?void 0:o.progress)=="completed",{data:b}=await q.submitStep(((y=e.value)==null?void 0:y.id)??"",h.value,t);l||_(b.status),b.status=="completed"?(l||L(),P.add({severity:"success",summary:"Correct, good job!",detail:"Completed successfully",life:5e3})):b.status=="attempted"&&P.add({severity:"error",summary:"Wrong answer!",detail:"Keep trying",life:5e3}),console.log(b.status)}catch(t){alert(t)}finally{j.value=!1}}function E(){d.value=!1,V.push({name:"projects"})}return(r,c)=>{const o=te,y=ye;return a(),S(K,null,[f("div",Re,[e.value?(a(),S("div",Te,[e.value.type=="article"?(a(),p(s(je),{key:0,step:e.value,isPreview:!1},null,8,["step"])):e.value.type=="code"?(a(),p(s(Ce),{key:1,step:e.value,isPreview:!1},null,8,["step"])):e.value.type=="matching"?(a(),p(s(Pe),{key:2,step:e.value,isPreview:!1},null,8,["step"])):e.value.type=="open"?(a(),p(s(ze),{key:3,step:e.value,isPreview:!1},null,8,["step"])):e.value.type=="question"?(a(),p(s(Ie),{key:4,step:e.value,isPreview:!1},null,8,["step"])):C("",!0)])):C("",!0),s(m)!=null&&s(m).steps!=null&&s(m).steps.length>0&&e.value?(a(),S("div",Ae,[s(i)!==0?(a(),p(o,{key:0,label:"Previous",icon:"pi pi-angle-left",size:"small",onClick:N})):C("",!0),e.value.type!="article"&&e.value.progress!="completed"?(a(),p(o,{key:1,label:"Submit",icon:"pi pi-check",iconPos:"right",severity:"info",size:"small",class:"ml-auto self-end",onClick:R,disabled:j.value||!s(v),loading:j.value},null,8,["disabled","loading"])):C("",!0),s(i)<s(m).steps.length-1&&(e.value.progress=="completed"||e.value.type=="article")?(a(),p(o,{key:2,label:"Next",icon:"pi pi-angle-right",iconPos:"right",size:"small",class:"ml-auto self-end",onClick:B,disabled:e.value.progress!="completed"&&(e.value.type!="article"||!s(v)),loading:j.value},null,8,["disabled","loading"])):s(i)==s(m).steps.length-1&&(e.value.progress=="completed"||e.value.type=="article")?(a(),p(o,{key:3,label:"Finish 🥳",size:"small",class:"ml-auto self-end",onClick:M,disabled:e.value.progress!="completed"&&(e.value.type!="article"||!s(v)),loading:j.value},null,8,["disabled","loading"])):C("",!0)])):C("",!0)]),n(y,{visible:d.value,"onUpdate:visible":c[0]||(c[0]=t=>d.value=t),modal:"",header:"Congratulations🥳🎉",style:{width:"25rem"}},{default:x(()=>[c[1]||(c[1]=f("span",{class:"text-surface-500 dark:text-surface-400 block mb-8"},"You successfully completed this project",-1)),f("div",Ge,[n(o,{type:"button",label:"Go to next Project ➡️",onClick:E})])]),_:1},8,["visible"])],64)}}}),Ke={key:1,class:"h-[51px]"},Oe={class:"flex bg-surface-0",style:{height:"calc(100vh - 52px)"}},We={class:"flex justify-center h-full"},Ye={class:"max-w-[400px] w-full"},ct=G({__name:"LessonView",setup(O){const{locale:h}=H(),V=Q(),P=A(),{setLesson:z}=P,m=ce(),{clearSlots:i}=m,F=ue(),{setCode:$}=F,v=D(!1);async function I(){if(!v.value){v.value=!0;try{const{data:_}=await we.getProjectByID(V.params.id.toString()),L=await ke(_,h.value);z(L)}catch(_){alert(_)}finally{v.value=!1}}}return X(I),Z(h,I),ge(()=>{i(),$("")}),(_,L)=>{const d=ie,e=ae;return a(),S(K,null,[v.value?(a(),S("div",Ke)):(a(),p(Me,{key:0})),f("div",Oe,[n(e,{class:"w-full rounded-none"},{default:x(()=>[n(d,{size:33,minSize:10,class:"max-w-[467px] w-full"},{default:x(()=>[n(le)]),_:1}),n(d,{size:34,minSize:10},{default:x(()=>[n(e,{layout:"vertical",class:"h-full w-full"},{default:x(()=>[n(d,{size:65,minSize:10},{default:x(()=>[n(oe)]),_:1}),n(d,{size:35,minSize:10},{default:x(()=>[n(ne)]),_:1})]),_:1})]),_:1}),n(d,{size:33,minSize:10,class:ee(["max-w-md mx-auto",{"animate-fadeinright animate-once animate-duration-1000 animate-ease-in-out":!0}])},{default:x(()=>[f("div",We,[f("div",Ye,[v.value?C("",!0):(a(),p(He,{key:0}))])])]),_:1})]),_:1})])],64)}}});export{ct as default};
