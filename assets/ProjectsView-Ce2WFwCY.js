import{s as oe}from"./index-Cf7vG2py.js";import{a as re,U as se,u as ae,R as le,Q as ne,s as ie,r as a,o as ue,E as de,c as G,b as l,e as u,f as n,h as c,w as v,g as C,K as H,F as L,k as $,i as I,l as pe,C as ce,m as me}from"./index-DO_dSR7p.js";import{s as fe}from"./index-_BILDncx.js";import{s as ve}from"./index-qAJpsLJf.js";import{s as ge,a as ye}from"./index-BYH1uDE6.js";import{s as he}from"./index-DMS8NWJq.js";import{_ as we}from"./AHeader.vue_vue_type_script_setup_true_lang-BhjLpsEx.js";import{_ as q}from"./ProjectCard.vue_vue_type_script_setup_true_lang-BcO5YzWt.js";import{a as P}from"./index-DtvP1CIQ.js";import{u as be}from"./editor-store-DVLmS6fn.js";import{t as z}from"./types-81Qs7ZwA.js";import{u as _e,m as xe}from"./useSortable-DIXxLIDV.js";import"./index-DxwSnl9F.js";import"./index-B8uYEmDW.js";import"./index-CBwnmseZ.js";import"./index-C94p-hE4.js";import"./index-CxZ1AjMt.js";import"./index-BXDMLEco.js";import"./index-DRYK6pwp.js";import"./index-DH5-czd4.js";import"./logo-D1-3uCnC.js";import"./StudentViewToggle.vue_vue_type_script_setup_true_lang-BeHW7Fin.js";import"./index-BM6o9DUN.js";import"./index-C7_hQUWQ.js";import"./index-DjxsUYOX.js";import"./index-CThnx5jp.js";import"./index-BvvFgUiF.js";import"./http-7nTq_9Vs.js";import"./profile-O8uFHPcY.js";import"./index-CmdoDykh.js";import"./index-DCuD1EMg.js";import"./index-CBurb-R5.js";import"./pibody-BwAjMvHk.js";import"./v4-CmTdKEVZ.js";import"./sortable.esm-FZSyJVGy.js";const je={class:"flex flex-col min-h-screen bg-slate-50"},Ve={class:"flex items-center py-4 px-4 sm:px-12 gap-8"},ke={class:"flex-grow flex flex-col gap-1 sm:gap-4 bg-slate-50"},Ce={class:"relative flex flex-col justify-between w-[500px] min-h-28 bg-purple-100 border border-gray-100 rounded-3xl p-2 gap-2 shadow-md shadow-purple-300"},Le={class:"absolute right-5 bottom-5"},$e={key:0,class:"flex flex-col sm:flex-row gap-1 sm:gap-4 bg-slate-50 py-0 px-4 sm:px-12 items-end justify-end"},Ie={key:1,class:"border border-dashed rounded-xl border-green-400 overflow-hidden"},Pe={key:0,class:"flex flex-wrap justify-center gap-8 px-4 sm:px-12 pb-8 pt-4"},mt=re({__name:"ProjectsView",setup(Se){const S=se("el"),R=ae(),{locale:K}=le(),T=pe(),O=be(),{addLesson:Q}=O,J=ne(),{user:U}=ie(J),m=a([]),_=a([]),x=a([]),B=a([0,0,0,0,0,0]),E=a([0,0,0,0,0,0]),g=a(!1),y=a(!1),j=a("");_e(S,m,{onUpdate:t=>{xe(m.value,t.oldIndex,t.newIndex,t),ce(async()=>{const e=[];m.value.map(o=>{const i=parseInt(o.id,10);e.push(i)});try{const{data:o}=await P.changeProjectsOrder(e);R.add({severity:"success",summary:o.message,life:2e3})}catch(o){R.add({severity:"error",summary:o.response.data.error,detail:o,life:2e3})}})}});async function h(){if(!g.value){g.value=!0;try{const{data:t}=await P.getProjects();m.value=[],_.value=[],x.value=[],B.value=[0,0,0,0,0,0],E.value=[0,0,0,0,0,0];for(const e of t)e.lego||(e.is_guidable?B.value[e.layer]++:E.value[e.layer]++);for(const e of t){if(e.lego)continue;const o=await z(e);if(e.layer==0){m.value.push(o);const i=o.creator_name??o.created_by;!V.value.includes(i)&&i.length>0&&V.value.push(o.creator_name??o.created_by)}o.is_guidable?_.value.push(o):x.value.push(o)}}catch(t){console.log(t)}finally{g.value=!1}}}ue(h),de(K,h);async function W(){y.value=!0;try{const{data:t}=await P.createProject(),e=await z(t);Q(e),T.push(`/project/${e.id}/edit`)}catch(t){console.log(t)}finally{y.value=!1}}const X=G(()=>{var i,f;const t=new Map,e=new Map;for(const r of _.value)t.has(r.layer)||t.set(r.layer,[]),t.get(r.layer).push(r);for(const r of x.value)e.has(r.layer)||e.set(r.layer,[]),e.get(r.layer).push(r);const o=[];return o.push({id:0,guided:((i=t.get(0))==null?void 0:i.filter(r=>(!p.value.length||p.value.includes(k(r.level)))&&(!d.value||r.title.toLowerCase().includes(d.value.toLowerCase()))))||[],unguided:((f=e.get(0))==null?void 0:f.filter(r=>(!p.value.length||p.value.includes(k(r.level)))&&(!d.value||r.title.toLowerCase().includes(d.value.toLowerCase()))))||[]}),o}),Y=G(()=>m.value.filter(t=>(!b.value.length||b.value.includes(t.creator_name??t.created_by))&&(!w.value.length||w.value.includes(t.stage))&&(!p.value.length||p.value.includes(k(t.level)))&&(!d.value||t.title.toLowerCase().includes(d.value.toLowerCase())))),d=a(""),p=a(""),Z=a(["Easy","Medium","Hard"]),w=a(""),D=a(["prepare_for_submission","waiting_for_review","in_review","rejected","ready_for_publish","published","in_modify"]),b=a(""),V=a([]);function k(t){return t==0?"":t<3?"Easy":t<5?"Medium":t==5?"Hard":""}return(t,e)=>{var A,N;const o=ge,i=he,f=ye,r=ve,ee=fe,M=me,te=oe;return l(),u("div",je,[n(we,{class:"sticky top-0 z-10 mb-4"}),c("div",Ve,[c("div",ke,[n(f,{class:"min-w-60"},{default:v(()=>[n(o,{class:"text-primary border-gray-100"},{default:v(()=>e[6]||(e[6]=[c("i",{class:"pi pi-search"},null,-1)])),_:1}),n(i,{type:"text",modelValue:d.value,"onUpdate:modelValue":e[0]||(e[0]=s=>d.value=s),placeholder:t.$t("pages.projects.search"),variant:"filled",class:"h-fit bg-white border-gray-100 shadow-none"},null,8,["modelValue","placeholder"])]),_:1}),n(f,{class:"min-w-60"},{default:v(()=>[n(o,{class:"text-primary border-gray-100"},{default:v(()=>e[7]||(e[7]=[c("i",{class:"pi pi-filter"},null,-1)])),_:1}),n(r,{modelValue:p.value,"onUpdate:modelValue":e[1]||(e[1]=s=>p.value=s),options:Z.value,placeholder:t.$t("pages.projects.filterByLevel"),display:"chip",variant:"filled",class:"bg-white min-w-0 lg:min-w-80 border-gray-100 shadow-none"},null,8,["modelValue","options","placeholder"])]),_:1})]),c("div",Ce,[n(ee,{modelValue:j.value,"onUpdate:modelValue":e[2]||(e[2]=s=>j.value=s),placeholder:t.$t("pages.creator.placeholder"),variant:"filled",rows:"5",cols:"30",class:"bg-purple-50 w-full rounded-2xl h-28"},null,8,["modelValue","placeholder"]),c("div",Le,[n(M,{label:t.$t("pages.creator.getRoadmapLabel"),severity:"help",class:"rounded-2xl bg-purple-400 border border-purple-400",onClick:e[3]||(e[3]=s=>C(T).push({name:"creator",query:{message:j.value}}))},null,8,["label"])])])]),["editor","contributor"].includes(((A=C(U))==null?void 0:A.user_type)??"")?(l(),u("div",$e,[n(r,{modelValue:w.value,"onUpdate:modelValue":e[4]||(e[4]=s=>w.value=s),options:D.value,placeholder:"Select stage",display:"chip",variant:"filled",class:"bg-white min-w-0 lg:min-w-80 border-gray-100 shadow-none"},null,8,["modelValue","options"]),n(r,{modelValue:b.value,"onUpdate:modelValue":e[5]||(e[5]=s=>b.value=s),options:V.value,placeholder:"Select creator",display:"chip",variant:"filled",class:"bg-white min-w-0 lg:min-w-80 border-gray-100 shadow-none"},null,8,["modelValue","options"])])):H("",!0),["editor","contributor"].includes(((N=C(U))==null?void 0:N.user_type)??"")?(l(),u("div",{key:1,ref_key:"el",ref:S,class:"flex flex-wrap justify-center gap-8 px-4 sm:px-12 pb-8 pt-4"},[(l(!0),u(L,null,$(Y.value,s=>(l(),I(q,{key:s.id,project:s,onAfterRemove:h},null,8,["project"]))),128)),g.value?(l(),I(te,{key:0})):(l(),u("div",Ie,[n(M,{variant:"text",style:{width:"300px",height:"234px"},class:"bg-green-50",onClick:W,loading:y.value,disabled:y.value},{icon:v(()=>e[8]||(e[8]=[c("i",{class:"pi pi-plus text-3xl"},null,-1)])),_:1},8,["loading","disabled"])]))],512)):(l(!0),u(L,{key:2},$(X.value,s=>(l(),u("div",{key:s.id,class:"flex flex-col gap-2"},[s.unguided.length>0?(l(),u("div",Pe,[(l(!0),u(L,null,$(s.unguided,F=>(l(),I(q,{key:F.id,project:F,onAfterRemove:h},null,8,["project"]))),128))])):H("",!0)]))),128))])}}});export{mt as default};
