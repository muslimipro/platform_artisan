import{s as ge,S as he,_ as be,T as ke,a as we}from"./SimulationView-DazxMGgC.js";import{u as O,a as R,t as xe,b as Se,c as $e}from"./store-CDKXuRKq.js";import{d as A,ae as W,u as Q,af as X,g as se,ac as N,r as V,l as Z,y as ee,o as t,c as h,a as _,b as f,e,h as o,F as Y,k as ae,ag as G,j as w,w as D,ah as le,t as K,s as J,ai as ne,f as Pe,n as oe,aj as Ce,ak as ze}from"./index-DMYL65Vg.js";import{s as ie,a as re}from"./index-C6ZoFMA6.js";import{L as ce,s as ue}from"./logo-C8dKf__h.js";import{_ as pe}from"./LocaleSwitcher.vue_vue_type_script_setup_true_lang-DqLnLpbE.js";import{a as je,t as Ie,_ as de,b as fe,M as me,c as ve,d as _e}from"./QuestionStep.vue_vue_type_script_setup_true_lang-DESLwUie.js";import{a as Be,t as Le}from"./types-D41hCPCg.js";import{a as De,t as Ve}from"./types-DKH6yrnu.js";import"./pibody-BwAjMvHk.js";import"./http-Coo5Rocp.js";import"./index-DYLRL3QD.js";import"./index-DtnnG1-M.js";const Me={class:"mx-auto flex items-center justify-between p-2 px-6 w-full bg-white"},qe={class:"flex flex-1 items-center"},Ne={key:1,class:"flex items-center gap-1"},Fe={class:"flex items-center gap-1"},Te={class:"flex flex-1 justify-end items-center gap-2"},Ue={class:"relative overflow-hidden w-full border-0 bg-transparent flex items-start p-2 pl-4 rounded-none cursor-pointer transition-colors duration-200"},Ee={class:"inline-flex flex-col items-start"},Re={class:"font-bold"},Oe={class:"text-sm"},Ae=A({__name:"LessonHeader",setup(H){const{locale:x}=W(),c=Q(),m=X(),S=se(),{user:l}=N(S),u=O(),{lesson:j,stepIndex:b,stepLoading:C,firstUncompletedIndex:I}=N(u),{changeStep:$,setSteps:M,setStepIndex:v,setFirstUncompletedIndex:s}=u,P=V(!1),z=V(!1);function F(a,d){if(d)return"info";if(a!="completed")return a=="attempted"?"warn":(a=="started","secondary")}function k(a,d){if(!d&&a!="completed")return a=="attempted"||a=="started"?"outlined":void 0}function E(a){switch(a){case"article":return"pi pi-align-left";case"code":return"pi pi-code";case"question":return"pi pi-question";case"matching":return"pi pi-arrows-h";case"open":return"pi pi-pencil";default:return"pi pi-align-left"}}async function T(){if(!P.value){P.value=!0;try{const{data:a}=await R.getStudentProjectStepsByID(m.params.id.toString()),d=[];for(const[r,g]of a.steps.entries())if(g.id==a.last_step_id){v(r);const U=await xe(g,x.value);d.push(U)}else{const U={id:g.id.toString(),title:"",type:g.step_type,progress:g.status,inner:{contents:[]},answer:{}};d.push(U)}M(d);let B=0;for(let r=0;r<d.length;r++)if(d[r].progress!="completed"||r==d.length-1){B=r;break}s(B)}catch(a){alert(a)}finally{P.value=!1}}}Z(T),ee(x,T,{immediate:!1});const n=V(),i=V([{label:"Log out",icon:"pi pi-sign-out",command:()=>{S.logout(),c.replace({name:"login"})}}]),p=a=>{n.value.toggle(a)};async function y(){if(!z.value){z.value=!0;try{await R.resetStepsProgress(m.params.id.toString()),window.location.reload()}catch(a){alert(a)}finally{z.value=!1}}}return(a,d)=>{var te;const B=ue,r=J,g=ie,U=re,ye=ne;return t(),h("div",Me,[_("div",qe,[f(B,{src:e(ce),width:"32"},null,8,["src"]),d[1]||(d[1]=_("p",{class:"text-xl font-semibold px-2 mr-4"},"Artisan",-1)),f(r,{icon:"pi pi-angle-left",label:"Back",severity:"secondary",variant:"text",onClick:d[0]||(d[0]=L=>e(c).go(-1)),size:"small"})]),P.value||e(j)==null?(t(),o(g,{key:0,shape:"circle",size:"2rem",class:"mr-2"})):(t(),h("div",Ne,[_("div",Fe,[(t(!0),h(Y,null,ae(e(j).steps,(L,q)=>(t(),o(r,{key:L.id,icon:E(L.type),rounded:"",severity:F(L.progress,q==e(b)),variant:k(L.progress,q==e(b)),class:G([{"bg-orange-100":L.progress=="attempted"&&q!=e(b)},"h-8 w-8"]),onClick:mt=>e($)(q),disabled:e(C)||L.progress!="completed"&&q!=e(I),loading:q==e(b)&&e(C)},null,8,["icon","severity","variant","class","onClick","disabled","loading"]))),128))])])),_("div",Te,[((te=e(l))==null?void 0:te.user_type)=="editor"?(t(),o(r,{key:0,label:"Reset",icon:"pi pi-refresh",severity:"info",variant:"outlined",size:"small",onClick:y,disabled:z.value,loading:z.value},null,8,["disabled","loading"])):w("",!0),f(pe),f(r,{type:"button",icon:"pi pi-ellipsis-v",onClick:p,"aria-haspopup":"true","aria-controls":"overlay_menu",size:"small",variant:"outlined",severity:"secondary",class:"border border-slate-300 bg-slate-50",style:{width:"34px"}}),f(U,{ref_key:"menu",ref:n,id:"overlay_menu",model:i.value,popup:!0},{start:D(()=>{var L,q;return[le((t(),h("button",Ue,[_("span",Ee,[_("span",Re,K((L=e(l))==null?void 0:L.email),1),_("span",Oe,K((q=e(l))==null?void 0:q.user_type),1)])])),[[ye]])]}),_:1},8,["model"])])])}}}),He={class:"mx-auto flex items-center justify-between p-2 px-6 w-full bg-white"},Ge={class:"flex flex-1 items-center"},Ke={key:1,class:"flex items-center gap-1"},We={class:"flex items-center gap-1"},Ye={class:"flex flex-1 justify-end items-center gap-2"},Je={class:"relative overflow-hidden w-full border-0 bg-transparent flex items-start p-2 pl-4 rounded-none cursor-pointer transition-colors duration-200"},Qe={class:"inline-flex flex-col items-start"},Xe={class:"font-bold"},Ze={class:"text-sm"},et=A({__name:"OpenLessonHeader",setup(H){const{locale:x}=W(),c=Q(),m=X(),S=se(),{user:l}=N(S),u=O(),{lesson:j,stepIndex:b,stepLoading:C}=N(u),{changeStep:I,setSteps:$,setStepIndex:M}=u,v=V(!1);function s(n){return n?"info":"secondary"}function P(n){}function z(n){switch(n){case"article":return"pi pi-align-left";case"code":return"pi pi-code";case"question":return"pi pi-question";case"matching":return"pi pi-arrows-h";case"open":return"pi pi-pencil";default:return"pi pi-align-left"}}async function F(){if(!v.value){v.value=!0;try{const{data:n}=await je.getModuleStepsByID(m.params.id.toString()),i=[];for(const[p,y]of n.entries())if(p==0){M(p);const a=await Ie(y,x.value,!1);i.push(a)}else{const a={id:y.id.toString(),title:"",type:y.step_type,progress:"nothing",inner:{contents:[]},answer:{}};i.push(a)}$(i)}catch(n){alert(n)}finally{v.value=!1}}}Z(F),ee(x,F,{immediate:!1});const k=V(),E=V([{label:"Log out",icon:"pi pi-sign-out",command:()=>{S.logout(),c.replace({name:"login"})}}]),T=n=>{k.value.toggle(n)};return(n,i)=>{const p=ue,y=J,a=ie,d=re,B=ne;return t(),h("div",He,[_("div",Ge,[f(p,{src:e(ce),width:"32"},null,8,["src"]),i[1]||(i[1]=_("p",{class:"text-xl font-semibold px-2 mr-4"},"Artisan",-1)),f(y,{icon:"pi pi-angle-left",label:"Back",severity:"secondary",variant:"text",onClick:i[0]||(i[0]=r=>e(c).go(-1)),size:"small"})]),v.value||e(j)==null?(t(),o(a,{key:0,shape:"circle",size:"2rem",class:"mr-2"})):(t(),h("div",Ke,[_("div",We,[(t(!0),h(Y,null,ae(e(j).steps,(r,g)=>(t(),o(y,{key:r.id,icon:z(r.type),rounded:"",severity:s(g==e(b)),variant:(g==e(b),void 0),class:G([{"bg-orange-100":r.progress=="attempted"&&g!=e(b)},"h-8 w-8"]),onClick:U=>e(I)(g),disabled:e(C),loading:g==e(b)&&e(C)},null,8,["icon","severity","variant","class","onClick","disabled","loading"]))),128))])])),_("div",Ye,[f(pe),f(y,{type:"button",icon:"pi pi-ellipsis-v",onClick:T,"aria-haspopup":"true","aria-controls":"overlay_menu",size:"small",variant:"outlined",severity:"secondary",class:"border border-slate-300 bg-slate-50",style:{width:"34px"}}),f(d,{ref_key:"menu",ref:k,id:"overlay_menu",model:E.value,popup:!0},{start:D(()=>{var r,g;return[le((t(),h("button",Je,[_("span",Qe,[_("span",Xe,K((r=e(l))==null?void 0:r.email),1),_("span",Ze,K((g=e(l))==null?void 0:g.user_type),1)])])),[[B]])]}),_:1},8,["model"])])])}}}),tt={class:"flex flex-col p-4 gap-4 overflow-scroll h-full justify-between bg-white"},st={key:0},at={key:1,class:"flex"},lt={class:"flex justify-end gap-2"},nt=A({__name:"LessonDiv",setup(H){const{locale:x}=W(),c=Q(),m=Pe(),S=O(),{lesson:l,stepIndex:u,userCode:j,firstUncompletedIndex:b,submitEnabled:C}=N(S),{changeStep:I,updateStatus:$,incrementFirstUncompletedIndex:M}=S,v=V(!1),s=oe(()=>{var n;return u.value==null?null:((n=l.value)==null?void 0:n.steps[u.value])??null});async function P(){u.value!=null&&I(u.value-1)}async function z(){var n,i;if(u.value!=null){if(((n=s.value)==null?void 0:n.type)=="article"&&s.value.progress!="completed"){k.value=!0;try{const{data:p}=await R.submitStep(((i=s.value)==null?void 0:i.id)??"",x.value,{});$(p.status),M()}catch(p){console.log(p)}finally{k.value=!1}}u.value+1<=b.value&&I(u.value+1)}}async function F(){var n,i,p;if(u.value!=null){if(((n=s.value)==null?void 0:n.progress)=="completed"){v.value=!0;return}if(((i=s.value)==null?void 0:i.type)=="article"){k.value=!0;try{const{data:y}=await R.submitStep(((p=s.value)==null?void 0:p.id)??"",x.value,{});$(y.status),v.value=!0}catch(y){console.log(y)}finally{k.value=!1}}}}const k=V(!1);async function E(){var n,i,p,y;k.value=!0;try{let a;switch((n=s.value)==null?void 0:n.type){case"code":a={code:j.value};break;case"open":a={open:s.value.answer.open};break;case"question":const r=[];(i=s.value.inner.options)==null||i.forEach(g=>{r.push(g.correct)}),a={question:r};break;case"matching":a={match:[{key:"dog",value:"b"},{key:"a",value:"animal"},{key:"c",value:"d"}]};break;default:a={};break}const d=((p=s.value)==null?void 0:p.progress)=="completed",{data:B}=await R.submitStep(((y=s.value)==null?void 0:y.id)??"",x.value,a);d||$(B.status),B.status=="completed"?(d||M(),m.add({severity:"success",summary:"Correct, good job!",detail:"Completed successfully",life:5e3})):B.status=="attempted"&&m.add({severity:"error",summary:"Wrong answer!",detail:"Keep trying",life:5e3}),console.log(B.status)}catch(a){alert(a)}finally{k.value=!1}}function T(){v.value=!1,c.push({name:"projects"})}return(n,i)=>{const p=J,y=Ce;return t(),h(Y,null,[_("div",tt,[s.value?(t(),h("div",st,[s.value.type=="article"?(t(),o(e(de),{key:0,step:s.value,isPreview:!1},null,8,["step"])):s.value.type=="code"?(t(),o(e(fe),{key:1,step:s.value,isPreview:!1},null,8,["step"])):s.value.type=="matching"?(t(),o(e(me),{key:2,step:s.value,isPreview:!1},null,8,["step"])):s.value.type=="open"?(t(),o(e(ve),{key:3,step:s.value,isPreview:!1},null,8,["step"])):s.value.type=="question"?(t(),o(e(_e),{key:4,step:s.value,isPreview:!1},null,8,["step"])):w("",!0)])):w("",!0),e(l)!=null&&e(l).steps!=null&&e(l).steps.length>0&&s.value?(t(),h("div",at,[e(u)!==0?(t(),o(p,{key:0,label:"Previous",icon:"pi pi-angle-left",size:"small",onClick:P})):w("",!0),s.value.type!="article"&&s.value.progress!="completed"?(t(),o(p,{key:1,label:"Submit",icon:"pi pi-check",iconPos:"right",severity:"info",size:"small",class:"ml-auto self-end",onClick:E,disabled:k.value||!e(C),loading:k.value},null,8,["disabled","loading"])):w("",!0),e(u)<e(l).steps.length-1&&(s.value.progress=="completed"||s.value.type=="article")?(t(),o(p,{key:2,label:"Next",icon:"pi pi-angle-right",iconPos:"right",size:"small",class:"ml-auto self-end",onClick:z,disabled:k.value||s.value.progress!="completed"&&(s.value.type!="article"||!e(C)),loading:k.value},null,8,["disabled","loading"])):e(u)==e(l).steps.length-1&&(s.value.progress=="completed"||s.value.type=="article")?(t(),o(p,{key:3,label:"Finish ðŸ¥³",size:"small",class:"ml-auto self-end",onClick:F,disabled:k.value||s.value.progress!="completed"&&(s.value.type!="article"||!e(C)),loading:k.value},null,8,["disabled","loading"])):w("",!0)])):w("",!0)]),f(y,{visible:v.value,"onUpdate:visible":i[0]||(i[0]=a=>v.value=a),modal:"",header:"CongratulationsðŸ¥³ðŸŽ‰",style:{width:"25rem"}},{default:D(()=>[i[1]||(i[1]=_("span",{class:"text-surface-500 dark:text-surface-400 block mb-8"},"You successfully completed this project",-1)),_("div",lt,[f(p,{type:"button",label:"Go to next Project âž¡ï¸",onClick:T})])]),_:1},8,["visible"])],64)}}}),ot={class:"flex flex-col p-4 gap-4 overflow-scroll h-full justify-between bg-white"},it={key:0},rt={key:1,class:"flex"},ct=A({__name:"OpenLessonDiv",setup(H){const x=O(),{lesson:c,stepIndex:m}=N(x),{changeStep:S}=x,l=oe(()=>{var b;return m.value==null?null:((b=c.value)==null?void 0:b.steps[m.value])??null});async function u(){m.value!=null&&S(m.value-1)}async function j(){m.value!=null&&S(m.value+1)}return(b,C)=>{const I=J;return t(),h("div",ot,[l.value?(t(),h("div",it,[l.value.type=="article"?(t(),o(e(de),{key:0,step:l.value,isPreview:!1},null,8,["step"])):l.value.type=="code"?(t(),o(e(fe),{key:1,step:l.value,isPreview:!1},null,8,["step"])):l.value.type=="matching"?(t(),o(e(me),{key:2,step:l.value,isPreview:!1},null,8,["step"])):l.value.type=="open"?(t(),o(e(ve),{key:3,step:l.value,isPreview:!1},null,8,["step"])):l.value.type=="question"?(t(),o(e(_e),{key:4,step:l.value,isPreview:!1},null,8,["step"])):w("",!0)])):w("",!0),e(c)!=null&&e(c).steps!=null&&e(c).steps.length>0&&l.value?(t(),h("div",rt,[e(m)!==0?(t(),o(I,{key:0,label:"Previous",icon:"pi pi-angle-left",size:"small",onClick:u})):w("",!0),e(m)<e(c).steps.length-1?(t(),o(I,{key:1,label:"Next",icon:"pi pi-angle-right",iconPos:"right",size:"small",class:"ml-auto self-end",onClick:j})):w("",!0)])):w("",!0)])}}}),ut={key:0},pt={key:1,class:"h-[51px]"},dt={key:2,class:"flex bg-surface-0",style:{height:"calc(100vh - 52px)"}},ft={class:"flex justify-center h-full"},zt=A({__name:"LessonView",setup(H){const{locale:x}=W(),c=X(),m=O(),{simVisible:S,ideVisible:l}=N(m),{setLesson:u}=m,j=Se(),{clearSlots:b}=j,C=$e(),{setCode:I}=C,$=V(!1);async function M(){if(!$.value){$.value=!0;try{if(c.name=="project"){const{data:v}=await Be.getProjectByID(c.params.id.toString()),s=await Le(v,x.value);u(s)}else if(c.name=="module"){const{data:v}=await De.getModuleByID(c.params.id.toString()),s=await Ve(v,x.value);u(s)}}catch(v){alert(v)}finally{$.value=!1}}}return Z(M),ee(x,M),ze(()=>{b(),I("")}),(v,s)=>{const P=we,z=ge;return t(),h(Y,null,[$.value?(t(),h("div",pt)):(t(),h("div",ut,[e(c).name=="project"?(t(),o(Ae,{key:0})):e(c).name=="module"?(t(),o(et,{key:1})):w("",!0)])),$.value?w("",!0):(t(),h("div",dt,[f(z,{class:"w-full rounded-none"},{default:D(()=>[e(S)?(t(),o(P,{key:0,size:33,minSize:10,class:"max-w-[467px] w-full"},{default:D(()=>[f(he)]),_:1})):w("",!0),e(l)?(t(),o(P,{key:1,size:34,minSize:10},{default:D(()=>[f(z,{layout:"vertical",class:"h-full w-full"},{default:D(()=>[f(P,{size:65,minSize:10},{default:D(()=>[f(be)]),_:1}),f(P,{size:35,minSize:10},{default:D(()=>[f(ke)]),_:1})]),_:1})]),_:1})):w("",!0),f(P,{size:33,minSize:10,class:G(["mx-auto",{"max-w-md":e(S)||e(l)}])},{default:D(()=>[_("div",ft,[_("div",{class:G(["w-full",e(S)||e(l)?"max-w-[400px]":"max-w-4xl"])},[e(c).name=="project"?(t(),o(nt,{key:0})):e(c).name=="module"?(t(),o(ct,{key:1})):w("",!0)],2)])]),_:1},8,["class"])]),_:1})]))],64)}}});export{zt as default};
