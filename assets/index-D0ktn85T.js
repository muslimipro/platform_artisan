import{s as Le,a as Be}from"./index-DuNUk649.js";import{_ as Ne}from"./IdeHeader.vue_vue_type_script_setup_true_lang-CBdFj-Jl.js";import{_ as je}from"./PibodyViewer.vue_vue_type_script_setup_true_lang-DGpvwnZc.js";import{O as R,o as O,v as fe,a as E,M as oe,m as ve,P as ne,p as pe,b as se,d as Ae,I as q,i as U,f as ze,e as Oe,g as $e,h as Ee,j as ge,u as Ge,k as We,l as Je,n as Ke,q as He,r as Xe,s as Qe,t as T,w as Ye,x as Ze,y as ye,R as ae,z as xe}from"./CodeEditorView.vue_vue_type_script_setup_true_lang-DFw57rXk.js";import"./index-WT6RWPBA.js";import{s as re}from"./index-Cx98W21n.js";import{s as et}from"./index-pez8Z9SL.js";import{s as tt}from"./index-BOgksqy0.js";import{a as G,b as o,e as l,g as e,h as s,t as a,J as m,c as de,F as B,D,K as V,k as te,r as F,i as L,w as y,n as ee,f as v,m as Ce,R as st,d as at,u as Pe,B as ot,s as he,o as nt,E as be,q as lt}from"./index-6znFarQA.js";import{s as rt}from"./index-DQjRhnJO.js";import{u as dt}from"./stores-DndeVrM8.js";import{a as it,h as qe}from"./http-2Rpmxk3G.js";import{U as we}from"./unitApi-JlEZ723V.js";import{m as ct}from"./mapUnitFromDto-CYGc5n9V.js";import{u as ut}from"./index-DMM0zgtg.js";import"./index-fQzns-h5.js";import"./index-D_V3hPtc.js";import"./logo-D1-3uCnC.js";import"./index-DjFj6twC.js";import"./pibody-BwAjMvHk.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-DfL6EWoo.js";import"./index-LXk3WpCQ.js";import"./index-LOPIZoFq.js";import"./index-P2JPrWCE.js";import"./index-DbMtR5Qy.js";import"./index-jCxHVeOh.js";import"./index-2yVQEQpg.js";import"./index-CW2vGRKQ.js";const mt={key:0,class:"text-nowrap"},ft={key:0,class:"text-white"},vt={key:1,class:"text-white"},pt={key:2,class:"text-white"},gt={key:3,class:"text-white"},yt={key:4,class:"text-white"},xt={key:5,class:"text-black w-full"},ht={class:"text-center font-mono px-1 text-white bg-black"},bt={key:6,class:"text-black w-full"},wt={class:"text-center font-mono px-1 text-white bg-black"},_t={key:7,class:"text-black w-full p-3"},kt={key:8,class:"text-white w-full"},$t={key:9,class:"text-white w-full"},Ct={key:10,class:"text-white w-full"},Pt={key:11,class:"text-white w-full"},qt={key:12,class:"text-black w-full"},St={class:"text-center font-mono px-1 text-white bg-black"},It={key:13,class:"text-white"},Tt={key:14,class:"text-black w-full"},Ut={key:1,class:"text-center p-3"},le=G({__name:"FeedbackNode",props:{message:{type:Object,required:!0}},setup(t){return(c,u)=>t.message?(o(),l("div",mt,[t.message.command===e(R).PinSetValue?(o(),l("div",ft,[s("div",{style:m({background:e(O)}),class:"text-center font-mono px-1"},"Pin "+a(t.message.request.pin)+" set value",5),s("div",{style:m(e(E)(t.message.request.value)),class:"text-center font-mono px-1"}," Value "+a(e(fe)(t.message.request.value)),5)])):t.message.command===e(R).PinSetMode?(o(),l("div",vt,[s("div",{style:m({background:e(O)}),class:"text-center font-mono px-1"},"Pin "+a(t.message.request.pin)+" set mode",5),s("div",{style:m({background:e(ve)[t.message.request.mode]}),class:"text-center font-mono px-1"}," Mode "+a(e(oe)[t.message.request.mode]),5)])):t.message.command===e(R).PinSetPull?(o(),l("div",pt,[s("div",{style:m({background:e(O)}),class:"text-center font-mono px-1"},"Pin "+a(t.message.request.pin)+" set pull",5),s("div",{style:m({background:e(pe)[t.message.request.pull]}),class:"text-center font-mono px-1"}," Pull "+a(e(ne)[t.message.request.pull]),5)])):t.message.command===e(R).PwmDutyU16?(o(),l("div",gt,[s("div",{style:m({background:e(O)}),class:"text-center font-mono px-1"},"PWM "+a(t.message.request.pin)+" set duty",5),s("div",{style:m(e(E)(t.message.request.duty_u16/e(se))),class:"text-center font-mono px-1"}," u16 "+a(t.message.request.duty_u16),5)])):t.message.command===e(R).PwmFreq?(o(),l("div",yt,[s("div",{style:m({background:e(O)}),class:"text-center font-mono px-1"},"PWM "+a(t.message.request.pin)+" set freq",5),s("div",{style:m(e(E)(t.message.request.freq/e(se))),class:"text-center font-mono px-1"}," Freq "+a(t.message.request.freq),5)])):t.message.command===e(R).Output?(o(),l("div",xt,[u[0]||(u[0]=s("div",{class:"text-center px-1"},"Print",-1)),s("div",ht,a(t.message.request.output),1)])):t.message.command===e(R).Sleep?(o(),l("div",bt,[u[1]||(u[1]=s("div",{class:"text-center px-1"},"Sleep",-1)),s("div",wt,a(t.message.request.time_ms)+" ms",1)])):t.message.command===e(Ae).Timeout?(o(),l("div",_t," Timeout ")):t.message.command===e(q).PinGetValue?(o(),l("div",kt,[s("div",{style:m({background:e(U)}),class:"text-center font-mono px-1"},"Pin "+a(t.message.request.pin)+" get value",5),s("div",{style:m(e(E)(t.message.result)),class:"text-center font-mono px-1"}," Value "+a(e(fe)(t.message.result)),5)])):t.message.command===e(q).PinGetMode?(o(),l("div",$t,[s("div",{style:m({background:e(U)}),class:"text-center font-mono px-1"},"Pin "+a(t.message.request.pin)+" get mode",5),s("div",{style:m({background:e(ve)[t.message.result]}),class:"text-center font-mono px-1"}," Mode "+a(e(oe)[t.message.result]),5)])):t.message.command===e(q).PinGetPull?(o(),l("div",Ct,[s("div",{style:m({background:e(U)}),class:"text-center font-mono px-1"},"Pin "+a(t.message.request.pin)+" get pull",5),s("div",{style:m({background:e(pe)[t.message.result]}),class:"text-center font-mono px-1"}," Pull "+a(e(ne)[t.message.result]),5)])):t.message.command===e(q).AdcReadU16?(o(),l("div",Pt,[s("div",{style:m({background:e(U)}),class:"text-center font-mono px-1"},"ADC "+a(t.message.request.pin)+" read",5),s("div",{style:m(e(E)(t.message.result/e(se))),class:"text-center font-mono px-1"}," u16 "+a(t.message.result),5)])):t.message.command===e(q).Input?(o(),l("div",qt,[u[2]||(u[2]=s("div",{class:"text-center px-1"},"Input",-1)),s("div",St,a(t.message.result),1)])):t.message.command===e(R).NeoPixelWrite?(o(),l("div",It,[s("div",{style:m({background:e(O)}),class:"text-center font-mono px-1"},"Pin "+a(t.message.request.pin)+" write pixels",5),s("div",{style:m(e(E)(0)),class:"text-center font-mono px-1"}," pixels("+a(t.message.request.pixels.length)+") ",5)])):(o(),l("div",Tt," Todo: "+a(t.message.command),1))])):(o(),l("div",Ut," Nothing "))}}),Ft={class:"flex-col overflow-auto"},Mt={class:"flex"},Rt={key:0,class:"flex text-white border-2 border-blue-500"},Vt={class:"text-black text-nowrap"},Dt={key:1,class:"flex text-white border-2 border-blue-500"},Lt={class:"text-black text-nowrap"},Bt={key:2,class:"flex text-white border-2 border-blue-500"},Nt={class:"text-black text-nowrap"},jt={key:3,class:"flex text-white border-2 border-blue-500"},At={class:"text-black text-nowrap"},zt={key:4,class:"flex text-white border-2 border-blue-500"},Ot={class:"text-black text-nowrap"},Et={key:5,class:"flex text-black border-2 border-blue-500"},Se=G({__name:"Inputs",props:{inputs:{}},setup(t){const c=de(()=>{const u=[];for(let[h,i]of t.inputs){const w=ze(h);u.push({...w,result:i})}return u});return(u,h)=>(o(),l(B,null,[c.value.length===0?(o(),l(B,{key:0},[D("Nothing")],64)):V("",!0),s("div",Ft,[(o(!0),l(B,null,te(c.value,i=>(o(),l("div",Mt,[i.command===e(q).PinGetValue?(o(),l("div",Rt,[s("div",{style:m({background:e(U)}),class:"text-center text-nowrap font-mono px-1"},"Pin "+a(i.request.pin)+" get values:",5),s("div",Vt,a(i.result),1)])):i.command===e(q).PinGetMode?(o(),l("div",Dt,[s("div",{style:m({background:e(U)}),class:"text-center text-nowrap font-mono px-1"},"Pin "+a(i.request.pin)+" get values:",5),s("div",Lt,a(i.result.map(w=>e(oe)[w])),1)])):i.command===e(q).PinGetPull?(o(),l("div",Bt,[s("div",{style:m({background:e(U)}),class:"text-center text-nowrap font-mono px-1"},"Pin "+a(i.request.pin)+" get values:",5),s("div",Nt,a(i.result.map(w=>e(ne)[w])),1)])):i.command===e(q).AdcReadU16?(o(),l("div",jt,[s("div",{style:m({background:e(U)}),class:"text-center text-nowrap font-mono px-1"},"ADC "+a(i.request.pin)+" read u16:",5),s("div",At,a(i.result),1)])):i.command===e(q).Input?(o(),l("div",zt,[s("div",{style:m({background:e(U)}),class:"text-center text-nowrap font-mono px-1"},"Console input:",4),s("div",Ot,a(i.result),1)])):(o(),l("div",Et,"TODO: "+a(i.command),1))]))),256))])],64))}}),Gt={class:"flex items-center gap-2"},Wt={class:"font-bold"},Jt={class:"flex"},Kt=["onClick"],Ht={class:"text-center"},Xt={key:0,class:"text-center"},Qt={key:0,class:"flex items-center justify-center h-20"},Yt=G({__name:"FeedbackTimeline",props:{id:{},result:{}},setup(t){const c=t,{selectNode:u,selectedIndex:h,firstError:i}=Oe(c.id,c.result),w=de(()=>$e(c.result.replayed)),n=F(null),N=F([]);return(_,$)=>{const C=Ce,j=re;return o(),L(j,null,{header:y(()=>[s("div",Gt,[s("div",Wt,a(_.$t("result")),1),c.result.success===!1?(o(),L(C,{key:0,severity:"danger",onClick:$[0]||($[0]=p=>e(i)(N.value))},{default:y(()=>[D(a(_.$t("first error")),1)]),_:1})):V("",!0)])]),default:y(()=>[s("div",{ref_key:"scrollContainer",ref:n,class:"flex overflow-auto mb-2"},[(o(!0),l(B,null,te(c.result.feedback,(p,P)=>{var W,A;return o(),l("div",Jt,[s("button",{class:ee(["flex",e(h)===P?"border border-blue-500":""]),onClick:X=>e(u)(P),ref_for:!0,ref:X=>N.value[P]=X},[s("div",Ht,[D(a(p.correct?_.$t("correct"):_.$t("incorrect"))+" ",1),v(le,{message:(W=p.replayed)==null?void 0:W.content,class:ee(["border-4 rounded-md",p.correct?"border-green-500":"border-red-500"])},null,8,["message","class"])]),p.correct?V("",!0):(o(),l("div",Xt,[$[1]||($[1]=D(a("Expected")+" ")),v(le,{message:(A=p.expected)==null?void 0:A.content,class:ee(["border-4 rounded-md",p.correct?"border-red-500":"border-green-500"])},null,8,["message","class"])]))],10,Kt),P+1<c.result.feedback.length?(o(),l("div",Qt,"→")):V("",!0)])}),256))],512),$[2]||($[2]=D(" Input used: ")),v(Se,{inputs:w.value},null,8,["inputs"])]),_:1})}}}),Ie=it.create({baseURL:st,headers:{Accept:"application/json","Content-Type":"application/json"},withCredentials:!0});Ie.interceptors.request.use(Zt,es);Ie.interceptors.response.use(ts,ss);function Zt(t){const c=localStorage.getItem("selectedLanguage")||"en";return t.headers["X-User-Language"]=c,t}async function es(t){return Promise.reject(t)}function ts(t){return t}async function ss(t){return console.log(t),Promise.reject(t)}const Z={uploadFile:as,deleteFile:os};async function as(t,c=""){return await qe.post("v2/lesson/upload-file?prefix="+c,t,{headers:{"Content-Type":"multipart/form-data"}})}async function os(t){return await qe.delete("v2/lesson/delete-file",{params:{url:t}})}const ns={class:"flex overflow-auto mb-2"},ls={class:"text-center"},rs={key:0,class:"flex items-center justify-center h-12"},_e=G({__name:"TestDataTimeline",props:{data:{}},setup(t){const c=de(()=>$e(t.data));return(u,h)=>{const i=re;return o(),L(i,{header:"Expected"},{default:y(()=>[s("div",ns,[(o(!0),l(B,null,te(u.data,(w,n)=>(o(),l("div",{class:"flex",key:n},[s("div",ls,[v(e(le),{message:w.content,class:"border-4 border-blue-500"},null,8,["message"])]),n+1<u.data.length?(o(),l("div",rs,"→")):V("",!0)]))),128))]),h[0]||(h[0]=D(" Inputs: ")),v(e(Se),{inputs:c.value},null,8,["inputs"])]),_:1})}}}),ds=at("tester-store",()=>{const t=Pe(),c=F(null),u=F(!1),h=F(!1),i=F(!1);function w(_){i.value=_}async function n(_,$){try{u.value=!0;const{data:C}=await we.getUnitByIdandLessonId(_,$);c.value=ct(C)}catch(C){t.add({severity:"error",summary:C.response.data.error,life:2e3})}finally{u.value=!1}}async function N(_,$,C){try{h.value=!0,await we.updateUnitByIdandLessonId(_,$,C)}catch(j){t.add({severity:"error",summary:j.response.data.error,life:2e3})}finally{h.value=!1}}return{selectedUnit:c,isUnitLoading:u,setDataSaving:w,loadUnitByIdandLessonId:n,updateUnitByIdandLessonId:N}}),is={class:"h-full flex flex-col"},cs={class:"p-4"},us={class:"flex w-full gap-1"},ms={class:"material-icons"},fs={class:"material-icons"},vs={class:"material-icons"},ps={class:"material-icons"},gs={class:"material-icons"},ys={class:"flex flex-col gap-2 m-2 h-full overflow-auto"},xs={class:"flex gap-2 w-full"},hs=["for"],bs={class:"material-icons"},ws={class:"material-icons"},_s=G({__name:"TesterControls",props:{id:{}},setup(t){const c=t,u=Pe(),h=ot(),i=lt(),w=ds(),{selectedUnit:n}=he(w),{loadUnitByIdandLessonId:N,setDataSaving:_,updateUnitByIdandLessonId:$}=w,C=Number(i.params.lesson_id),j=Number(i.params.unit_id),p=F([]);nt(async()=>{var r;try{await N(j,C);const d=(r=n.value)==null?void 0:r.content;if(M.value=d.answer,Q.setCode(M.value),n.value){if(n.value.data.tests&&(p.value=await Ee(n.value.data.tests)),n.value.data.neededModules){z.addNeededModules(n.value.data.neededModules);for(const x of n.value.data.neededModules)x.module&&x.slot&&z.newModuleToSlot(x.module,x.slot)}else z.addNeededModules([]);n.value.data.includedCommandsForTests=n.value.data.includedCommandsForTests??[...ge]}}catch(d){console.log(d)}});async function P(){if(n.value!=null){_(!0);try{await $(j,C,{content:n.value.content,data:n.value.data})}catch(r){let d="";r instanceof Error?d=r.message:d=String(r),u.add({severity:"error",summary:"Failed to save",detail:d,life:3e3})}finally{_(!1)}}}const W=ut(()=>{P()},1e3,{maxWait:5e3});async function A(r){const d=JSON.stringify(r),x=new Blob([d],{type:"application/json"}),g=new FormData;g.append("file",x,"default.test.json");const{data:I}=await Z.uploadFile(g,"tests");return I.source_url}async function X(){if(n.value!=null)try{const r=await A(S.value);n.value.data.tests?n.value.data.tests.push({name:"",url:r}):(n.value.data.tests=[],n.value.data.tests.push({name:"",url:r})),p.value.push({data:S.value,test:{name:"",url:r}}),S.value=[],await P()}catch(r){u.add({severity:"error",summary:r.response.data.error,life:2e3})}}function Te(r){h.require({message:"Are you sure you want to Delete?",header:"Confirmation",icon:"pi pi-exclamation-triangle",rejectProps:{label:"Cancel",severity:"secondary",outlined:!0},acceptProps:{label:"Delete",severity:"danger"},accept:async()=>{var d,x;try{const g=p.value[r].test.url;await Z.deleteFile(g),(x=(d=n.value)==null?void 0:d.data.tests)==null||x.splice(r,1),p.value.splice(r,1),P()}catch(g){u.add({severity:"error",summary:g.response.data.error,life:2e3})}}})}const{fileContent:M}=he(dt()),z=Ge(c.id),ie=We(c.id),Q=Je(c.id),ce=Ke(c.id),f=He(ie,ie.write,ce.writeText,ce.clearDisplay,z.setPin,z.getPin,z.getI2C),{isLoading:k,isRunning:ue}=f,S=F(ye),Ue=F(ye);be(Q.code,r=>{typeof r=="string"&&r!==M.value&&(M.value=r,n.value&&(n.value.content.answer=r))});function Fe(){f.recorder.start();const r=typeof Q.code.value=="string"?Q.code.value:"";f.run(r);const d=be(f.recorder.state,()=>{(f.replayer.state.value==ae.Finish||f.replayer.state.value==ae.Timeout)&&(f.recorder.stop(),S.value=f.recorder.getRecords()),d.stop()})}function Me(){f.replayer.state.value==ae.Continue?(f.recorder.stop(),f.replayer.stop(),Ue.value=f.recorder.getRecords()):(f.recorder.stop(),S.value=f.recorder.getRecords()),f.stop()}function Y(){var r;return((r=n.value)==null?void 0:r.data.includedCommandsForTests)??ge}const Re=async()=>{if(!(!n.value||!n.value.content.tests)){T.value=!0;for(const[r,d]of p.value.entries()){const x=await xe(f,M.value,d.data,Y());await f.stopPromise();const g=n.value.data.tests[r].url,I=await A(x);n.value.data.tests[r].url=I,p.value[r].test.url=I,p.value[r].data=x;try{await Z.deleteFile(g)}catch(J){u.add({severity:"error",summary:J.response.data.error,life:2e3})}}await P(),T.value=!1}},Ve=async(r,d)=>{if(!n.value||!n.value.data.tests)return;T.value=!0;const x=await xe(f,M.value,r.data,Y());await f.stopPromise();const g=n.value.data.tests[d].url,I=await A(x);n.value.data.tests[d].url=I,p.value[d].test.url=I,p.value[d].data=x,P();try{await Z.deleteFile(g)}catch(J){u.add({severity:"error",summary:J.response.data.error,life:2e3})}T.value=!1};return(r,d)=>{const x=rt,g=Ce,I=tt,J=et,De=re;return o(),l("div",is,[s("div",cs,[d[4]||(d[4]=D(" Include Commands: ")),e(n)?(o(),L(x,{key:0,onChange:e(W),modelValue:e(n).data.includedCommandsForTests,"onUpdate:modelValue":d[0]||(d[0]=b=>e(n).data.includedCommandsForTests=b),options:Xe,filter:"",placeholder:"Select commands",class:"w-full md:w-80 mb-2 mt-1",maxSelectedLabels:3},null,8,["onChange","modelValue","options"])):V("",!0),s("div",us,[v(g,{type:"button",class:"w-9 h-9",severity:"success",rounded:"",onClick:Fe,disabled:e(k)||e(ue)},{default:y(()=>[s("span",ms,a(e(k)?"hourglass_top":"play_arrow"),1)]),_:1},8,["disabled"]),v(g,{type:"button",class:"w-9 h-9",severity:"danger",rounded:"",onClick:Me,disabled:e(k)||!e(ue)},{default:y(()=>[s("span",fs,a(e(k)?"hourglass_top":"stop"),1)]),_:1},8,["disabled"]),v(g,{type:"button",class:"w-9 h-9",severity:"info",rounded:"",onClick:d[1]||(d[1]=b=>X()),disabled:S.value.length<=0||e(n)==null},{default:y(()=>[s("span",vs,a(e(k)?"hourglass_top":"save"),1)]),_:1},8,["disabled"]),v(g,{type:"button",class:"w-9 h-9",severity:"info",rounded:"",onClick:d[2]||(d[2]=b=>e(Qe)(e(f),e(M),p.value,Y())),disabled:e(k)||e(T)},{default:y(()=>[s("span",ps,a(e(k)?"hourglass_top":"bug_report"),1)]),_:1},8,["disabled"]),v(g,{type:"button",class:"w-9 h-9",rounded:"",onClick:d[3]||(d[3]=b=>Re()),disabled:e(k)||!p.value||e(T)},{default:y(()=>[s("span",gs,a(e(k)?"hourglass_top":"restart_alt"),1)]),_:1},8,["disabled"])])]),S.value.length>0?(o(),L(_e,{key:0,data:S.value,class:"mt-2"},null,8,["data"])):V("",!0),s("div",ys,[(o(!0),l(B,null,te(p.value,(b,K)=>{var me;return o(),L(De,{toggleable:"",key:b.test.url,class:ee(["border-4",e(Ze)((me=b.result)==null?void 0:me.success)])},{header:y(()=>[s("div",xs,[v(J,{variant:"on",class:"w-full"},{default:y(()=>[s("label",{for:`name ${K+1}`},"Test "+a(K+1),9,hs),v(I,{id:`name ${K+1}`,onInput:e(W),modelValue:b.test.name,"onUpdate:modelValue":H=>b.test.name=H,class:"w-full",size:"small"},null,8,["id","onInput","modelValue","onUpdate:modelValue"])]),_:2},1024),v(g,{type:"button",class:"w-9 h-9",severity:"info",rounded:"",onClick:H=>e(Ye)(e(f),e(M),b,Y()),disabled:e(k)||e(T)},{default:y(()=>[s("span",bs,a(e(k)?"hourglass_top":"bug_report"),1)]),_:2},1032,["onClick","disabled"]),v(g,{type:"button",class:"w-9 h-9",severity:"danger",rounded:"",onClick:H=>Te(K)},{default:y(()=>d[5]||(d[5]=[s("span",{class:"material-icons"},a("delete_forever"),-1)])),_:2},1032,["onClick"]),v(g,{type:"button",class:"w-9 h-9",rounded:"",onClick:H=>Ve(b,K),disabled:e(k)||!p.value||e(T)},{default:y(()=>[s("span",ws,a(e(k)?"hourglass_top":"restart_alt"),1)]),_:2},1032,["onClick","disabled"]),v(g,{type:"button",class:"w-9 h-9",severity:"warn",rounded:"",onClick:H=>b.result=void 0,disabled:!p.value||e(T)},{default:y(()=>d[6]||(d[6]=[s("span",{class:"material-icons"}," cleaning_services ",-1)])),_:2},1032,["onClick","disabled"])])]),default:y(()=>[v(_e,{data:b.data,class:"mt-2"},null,8,["data"]),b.result?(o(),L(e(Yt),{key:0,result:b.result,id:c.id},null,8,["result","id"])):V("",!0)]),_:2},1032,["class"])}),128))])])}}}),ks={class:"flex bg-surface-0",style:{height:"calc(100vh - 52px)"}},ke="tester",Zs=G({__name:"TesterView",setup(t){return(c,u)=>{const h=Le,i=Be;return o(),l(B,null,[v(Ne),s("div",ks,[v(i,{class:"w-full rounded-none"},{default:y(()=>[v(h,{size:33,minSize:10,class:"max-w-[767px] h-full"},{default:y(()=>[v(_s,{id:ke})]),_:1}),v(h,{size:67,minSize:10,class:"w-full h-full"},{default:y(()=>[v(e(je),{id:ke,class:"w-full h-full",horizontal:!1})]),_:1})]),_:1})])],64)}}});export{Zs as default};
