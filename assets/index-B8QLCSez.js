import{x as u,O as c,R as p,w as g,A as w,B as m}from"./CodeEditorView.vue_vue_type_script_setup_true_lang-Bf0DdBHj.js";import{r as I,E as S}from"./index-Bzt9KOfG.js";import{h as s}from"./http-j2rGyWLF.js";function k(t){return JSON.stringify({command:t.command,request:t.request})}function M(t){const e=[];for(const{content:r}of t)m(r)&&e.push(r);return e}const f=I(!1);function T(t){const e=M(t),r=new Map;for(const o of e){const n=k(o),a=r.get(n);a===void 0?r.set(n,[o.result]):a.push(o.result)}return r}function D(t,e){const r=[];let o=!0;for(let n=0;n<t.length&&n<e.length;n++){const a=P(t[n].content,e[n].content);r.push({correct:a,expected:t[n],replayed:e[n]}),o&&(o=a)}for(let n=e.length;n<t.length;n++)o=!1,r.push({correct:!1,expected:t[n],replayed:null});for(let n=t.length;n<e.length;n++)o=!1,r.push({correct:!1,expected:null,replayed:e[n]});return{feedback:r,success:o}}function P(t,e){if(t.command!==e.command)return!1;const r=w[t.command];return r(t,e)}const $=[u.PinGetValue,u.PinGetPull,u.PinGetMode,u.AdcReadU16,u.I2CScan,u.I2CReadFromMem,u.Input,c.I2CWriteToMem,c.PinSetValue,c.PwmDutyU16,c.PwmFreq,c.Output,c.Sleep,c.DisplayText,c.DisplayClear],B=t=>t.map((e,r)=>({...e,index:r}));async function C(t,e,r,o){f.value=!0;const n=await b(t,e,r.data,o),a=r.data,l=h=>B(h).filter(d=>o?o.includes(d.content.command):!0),{feedback:i,success:y}=D(l(a),l(n));return r.result={code:e,success:y,expected:a,replayed:n,feedback:i,message:""},await t.stopPromise(),f.value=!1,r.result}function N(t){return t!==void 0?t?"border-green-500":"border-red-500":"border-blue-500"}async function W(t,e,r,o=$){for(const n of r)await C(t,e,n,o)}async function z(t){const e=[];for(const r of t){const o=await fetch(r.url).then(n=>n.json());e.push({data:o,test:r})}return e}function b(t,e,r,o){return new Promise(n=>{t.reset(),t.recorder.start(o,r.length);const a=T(r);t.replayer.start(a);const l=S(t.replayer.state,()=>{if(t.replayer.state.value==p.Finish){t.recorder.stop();const i=t.recorder.getRecords();t.stopPromise(),n(i)}else if(t.replayer.state.value==p.Timeout){t.recorder.stop();const i=t.recorder.getRecords();i.push({content:{command:g.Timeout,request:{}},line:-1}),n(i)}l.stop()});t.run(e).then(()=>{t.replayer.restartTimeout()})})}const Q={getSteps:R,createStep:q,getStepByID:v,updateStepByID:F,deleteStepByID:O,getStepTranslationByID:j,updateStepTranslationByID:A,getProjectStepsByID:_,linkStepToProjectByID:G,getModuleStepsByID:x,linkStepToModuleByID:E,uploadFile:U,uploadImage:V,changeStepsOrder:H};async function R(){try{return await s.get("/steps")}catch(t){throw console.log(t),t}}async function q(t){try{return await s.post("/step",{last_edited_by:0,step_type:t,access_type:"freemium",skip_submit:!1})}catch(e){throw console.log(e),e}}async function v(t){try{return await s.get(`/step/${t}`)}catch(e){throw console.log(e),e}}async function F(t,e,r,o){try{return await s.put(`/step/${t}`,{access_type:e,skip_submit:r,step_type:o})}catch(n){throw console.log(n),n}}async function O(t){try{return await s.delete(`/step/${t}`)}catch(e){throw console.log(e),e}}async function j(t){try{return await s.get(`/step/${t}/translation`)}catch(e){throw console.log(e),e}}async function A(t,e,r){try{return await s.put(`/step/${t}/translation`,{content:r,name:e})}catch(o){throw console.log(o),o}}async function _(t){try{return await s.get(`/project/${t}/steps`)}catch(e){throw console.log(e),e}}async function G(t,e){try{return await s.post(`/project/${t}/step/${e}/link`)}catch(r){throw console.log(r),r}}async function x(t){try{return await s.get(`/module/${t}/steps`)}catch(e){throw console.log(e),e}}async function E(t,e){try{return await s.post(`/module/${t}/step/${e}/link`)}catch(r){throw console.log(r),r}}async function U(t){try{return await s.post("/upload-file",t,{headers:{"Content-Type":"multipart/form-data"}})}catch(e){throw console.log(e),e}}async function V(t,e){try{return await s.post(`/upload-image?preview=${e}`,t,{headers:{"Content-Type":"multipart/form-data"}})}catch(r){throw console.log(r),r}}async function H(t){try{return await s.patch("/steps/order",{order:t})}catch(e){throw console.log(e),e}}export{Q as a,C as b,W as c,$ as d,N as e,z as f,f as i,b as r};
