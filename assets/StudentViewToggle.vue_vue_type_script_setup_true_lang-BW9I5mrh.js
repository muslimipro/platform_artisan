import{a as te,Q as oe,s as M,u as me,a0 as _e,r as z,c as P,o as ge,I as ve,b as n,e as C,g as e,i,w as x,f,P as B,h as u,t as T,K as p,W as ee,n as se,F as fe,l as ne,m as ye,bj as be,H as he,p as we,aa as ke}from"./index-6znFarQA.js";import{s as Ce}from"./index-BOgksqy0.js";import{a as xe,s as $e}from"./index-BZaTFWv_.js";import{s as Se}from"./index-BeCy3AVj.js";import{i as Ve}from"./index-DMM0zgtg.js";import{S as E}from"./index-C6mgXhlV.js";import{b as je}from"./http-2Rpmxk3G.js";import{u as ze}from"./profile-BjCiQSat.js";import{T as Te}from"./index-DjFj6twC.js";const Be={class:"relative overflow-hidden w-full border-0 bg-transparent flex items-start p-2 pl-4 rounded-none cursor-pointer transition-colors duration-200"},Ue={class:"inline-flex flex-col items-start"},De={class:"font-bold"},Me={class:"text-sm"},Pe={key:0,class:"flex flex-col gap-1 px-2"},Ee=["href","onClick"],Fe={class:"ml-2"},Ie=["href","target"],Le={class:"ml-2"},Ne={class:"flex justify-between items-center mb-8"},Re={class:"flex justify-end gap-2"},Xe=te({__name:"UserMenu",setup(F){const d=oe(),{user:o}=M(d),_=me(),y=ne(),{t:l}=_e(),c=z(),{width:m}=Ve(),g=P(()=>m.value<640),U=P(()=>{const a=[{label:l("header.menu.settings"),icon:"pi pi-cog",route:"/settings/edit-profile"},{label:l("logOut"),icon:"pi pi-sign-out",command:async()=>{await y.replace({name:"login"}),await je.logout(),d.logout()}}],s=[{label:l("projects"),icon:"pi pi-stop",route:"/projects"},{label:l("modules"),icon:"pi pi-circle",route:"/modules"}];return g.value?[...s,...a]:a}),b=a=>{c.value.toggle(a)};async function h(a){const{data:s}=await E.changeView(a);d.setToken(s),d.setUser(s),window.location.reload()}const $=z(""),w=z(!1),S=z(!1);async function le(){if($.value.length!=0){S.value=!0;try{const{data:a}=await E.joinClass($.value);w.value=!1,window.location.reload(),_.add({severity:"success",summary:a.message,life:2e3})}catch(a){_.add({severity:"error",summary:a.response.data.error,detail:a,life:2e3})}finally{S.value=!1}}}const I=ze(),{fetchProfile:L}=I,{verified:N,profile:R,loading:ae}=M(I),O=()=>{ae.value||L()};return ge(()=>{L(),window.addEventListener("focus",O)}),ve(()=>{window.removeEventListener("focus",O)}),(a,s)=>{const r=ye,ie=Se,re=be,ue=he("router-link"),ce=xe,pe=Ce,de=we,D=ke;return n(),C(fe,null,[e(N)?(n(),i(r,{key:1,type:"button",icon:"pi pi-ellipsis-v",onClick:b,"aria-haspopup":"true","aria-controls":"overlay_menu",size:"small",variant:"outlined",severity:"secondary",class:"border border-slate-300 bg-slate-50",style:{width:"34px"}})):(n(),i(ie,{key:0,value:"1",severity:"danger",size:"small"},{default:x(()=>[f(r,{type:"button",icon:"pi pi-ellipsis-v",onClick:b,"aria-haspopup":"true","aria-controls":"overlay_menu",size:"small",variant:"outlined",severity:"secondary",class:"border border-slate-300 bg-slate-50",style:{width:"34px"}})]),_:1})),f(ce,{ref_key:"menu",ref:c,id:"overlay_menu",model:U.value,popup:!0},{start:x(()=>{var t,k,V,j,W,A,H,K,Q,q,G,J,X,Y;return[B((n(),C("button",Be,[u("span",Ue,[u("span",De,T((t=e(o))==null?void 0:t.email),1),u("span",Me,T((k=e(o))==null?void 0:k.user_type),1)])])),[[D]]),["school_manager","super_admin"].includes(((V=e(o))==null?void 0:V.origin_user_type)??"student")?p("",!0):(n(),C("div",Pe,[((j=e(o))==null?void 0:j.user_type)!="teacher"&&((W=e(o))==null?void 0:W.origin_user_type)!="student"?(n(),i(r,{key:0,label:"Teacher mode",class:"w-full",size:"small",onClick:s[0]||(s[0]=v=>h("teacher"))})):p("",!0),((A=e(o))==null?void 0:A.user_type)!="student"?(n(),i(r,{key:1,label:"Student mode",class:"w-full",size:"small",onClick:s[1]||(s[1]=v=>h("student")),severity:"info"})):p("",!0),!["student","teacher"].includes(((H=e(o))==null?void 0:H.origin_user_type)??"student")&&((K=e(o))==null?void 0:K.user_type)!=((Q=e(o))==null?void 0:Q.origin_user_type)?(n(),i(r,{key:2,label:`${(q=e(o))==null?void 0:q.origin_user_type.replace(/_/g," ").replace(/^./,v=>v.toUpperCase())} mode`,class:"w-full",size:"small",onClick:s[2]||(s[2]=v=>{var Z;return h(((Z=e(o))==null?void 0:Z.origin_user_type)??"student")}),severity:"help"},null,8,["label"])):p("",!0),((G=e(o))==null?void 0:G.origin_user_type)=="student"&&((J=e(R))==null?void 0:J.class_name)==null?(n(),i(r,{key:3,label:e(l)("pages.settings.joinClass"),icon:"pi pi-user-plus",size:"small",variant:"outlined",onClick:s[3]||(s[3]=v=>w.value=!0)},null,8,["label"])):p("",!0),((X=e(o))==null?void 0:X.origin_user_type)=="student"&&((Y=e(R))==null?void 0:Y.class_name)!=null?(n(),i(r,{key:4,label:e(l)("pages.teacher.schedule"),icon:"pi pi-calendar-plus",size:"small",variant:"outlined",onClick:s[4]||(s[4]=v=>a.$router.push("/student/schedule"))},null,8,["label"])):p("",!0)]))]}),item:x(({item:t,props:k})=>[t.route?(n(),i(ue,{key:0,to:t.route},{default:x(({href:V,navigate:j})=>[B((n(),C("a",ee({href:V},k.action,{onClick:j}),[u("span",{class:se(t.icon)},null,2),u("span",Fe,T(t.label),1),!e(N)&&t.route.includes("settings")?(n(),i(re,{key:0,value:"1",severity:"danger",size:"small"})):p("",!0)],16,Ee)),[[D]])]),_:2},1032,["to"])):B((n(),C("a",ee({key:1,href:t.url,target:t.target},k.action),[u("span",{class:se(t.icon)},null,2),u("span",Le,T(t.label),1)],16,Ie)),[[D]])]),_:1},8,["model"]),f(de,{visible:w.value,"onUpdate:visible":s[7]||(s[7]=t=>w.value=t),modal:"",header:e(l)("pages.settings.joinClassByCode"),closable:!1},{default:x(()=>[u("div",Ne,[f(pe,{type:"text",modelValue:$.value,"onUpdate:modelValue":s[5]||(s[5]=t=>$.value=t),placeholder:e(l)("pages.settings.enterCode")},null,8,["modelValue","placeholder"])]),u("div",Re,[f(r,{type:"button",label:e(l)("pages.settings.cancel"),severity:"secondary",onClick:s[6]||(s[6]=t=>w.value=!1)},null,8,["label"]),f(r,{type:"button",label:e(l)("pages.settings.join"),onClick:le,loading:S.value,disabled:S.value},null,8,["label","loading","disabled"])])]),_:1},8,["visible","header"])],64)}}}),Ye=te({__name:"StudentViewToggle",props:{path:{}},setup(F){const d=F,o=ne(),_=oe(),{user:y}=M(_),l=P({get:()=>{var c;return((c=y.value)==null?void 0:c.user_type)==="student"},set:async c=>{var g;const{data:m}=await E.changeView(c?"student":((g=y.value)==null?void 0:g.origin_user_type)??"student");_.setToken(m),_.setUser(m),d.path?o.push({path:d.path}):window.location.reload()}});return(c,m)=>{var b;const g=$e,U=Te;return["editor","contributor"].includes(((b=e(y))==null?void 0:b.origin_user_type)??"")?B((n(),i(g,{key:0,modelValue:l.value,"onUpdate:modelValue":m[0]||(m[0]=h=>l.value=h)},null,8,["modelValue"])),[[U,"Student view"]]):p("",!0)}}});export{Ye as _,Xe as a};
