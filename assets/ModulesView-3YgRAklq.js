import{d as E,ad as q,j as L,ae as T,h as w,o as e,k as c,w as V,a as u,u as x,c as o,m as g,b as j,t as O,Y as D,e as F,s as N,r as H,af as U,i as Y,ag as z,f as G,A as J,F as C,n as M,x as K}from"./index-CMS1yc3C.js";import{s as Q}from"./index-DzvA6v3X.js";import{_ as W}from"./AHeader.vue_vue_type_script_setup_true_lang-BBqDskKJ.js";import{s as X}from"./logo-DRw5w-kc.js";import{a as $,t as P}from"./types-D87C640r.js";import{P as Z}from"./pibody-BwAjMvHk.js";import{u as ee}from"./editor-store-DRhl8HEp.js";import{u as te,m as oe}from"./useSortable-B2mlrFO8.js";import"./LocaleSwitcher.vue_vue_type_script_setup_true_lang-DcdTSe0u.js";import"./index-BEDnrt4i.js";import"./index-xiuM0mGz.js";const se={class:"p-0 w-32 h-40 relative"},ae={key:0,class:"absolute top-0 right-0"},re={key:0,class:"bg-yellow-500 text-white text-sm w-full px-2 py-[1px] rounded-bl-xl rounded-tr-xl"},le={key:1,class:"bg-green-500 text-white text-sm px-2 py-[1px] rounded-bl-xl rounded-tr-xl"},ne={key:1,class:"absolute bottom-8 left-0"},ie={key:0,class:"bg-green-500 text-white text-sm w-full px-2 py-[1px] rounded-bl-xl rounded-tr-xl"},de={key:1,class:"bg-purple-500 text-white text-sm w-full px-2 py-[1px] rounded-bl-xl rounded-tr-xl"},ue={key:2,class:"bg-blue-500 text-white text-sm w-full px-2 py-[1px] rounded-bl-xl rounded-tr-xl"},ce={key:3,class:"bg-red-500 text-white text-sm w-full px-2 py-[1px] rounded-bl-xl rounded-tr-xl"},pe={class:"w-32 h-32 overflow-clip rounded-xl"},me={class:"flex flex-col justify-between items-center px-4 py-1"},fe={class:"pb-1 font-medium text-lg text-center line-clamp-2"},xe={class:"flex"},S=E({__name:"ModuleCard",props:{module:{}},emits:["after-remove"],setup(A,{emit:b}){const k=F(),_=q(),R=L(),{user:p}=T(R),i=w(!1),s=A,B=b;function l(){_.require({message:"Are you sure you want to Delete?",header:"Confirmation",icon:"pi pi-exclamation-triangle",rejectProps:{label:"Cancel",severity:"secondary",outlined:!0},acceptProps:{label:"Delete",severity:"danger"},accept:()=>{v()}})}async function v(){i.value=!0;try{await $.deleteModuleByID(s.module.id),B("after-remove")}catch(d){console.log(d)}finally{i.value=!1}}function m(){k.push(`/module/${s.module.id}/edit`)}return(d,h)=>{const I=X,t=N,a=H("RouterLink");return e(),c(a,{to:i.value?"":`/module/${s.module.id}`},{default:V(()=>{var n,f,y,r;return[u("div",se,[((n=x(p))==null?void 0:n.user_type)=="editor"?(e(),o("div",ae,[s.module.editing_status=="inreview"?(e(),o("div",re," In review")):(e(),o("div",le,"Published"))])):g("",!0),((f=x(p))==null?void 0:f.user_type)=="editor"?(e(),o("div",ne,[s.module.access_type=="freemium"?(e(),o("div",ie,"Free")):s.module.access_type=="premium"?(e(),o("div",de,"Premium")):s.module.access_type=="demo"?(e(),o("div",ue,"Demo")):s.module.access_type=="hackaton"?(e(),o("div",ce,"Hackaton ")):g("",!0)])):g("",!0),u("div",pe,[j(I,{alt:"user header",src:s.module.cover_image.length>0?s.module.cover_image:x(Z),width:"128",height:"128",class:"animate-fadein animate-once animate-duration-1000 animate-ease-in-out"},null,8,["src"])]),u("div",me,[u("div",fe,O(s.module.title),1),u("div",xe,[((y=x(p))==null?void 0:y.user_type)=="editor"?(e(),c(t,{key:0,icon:"pi pi-pen-to-square",severity:"info",variant:"text",rounded:"","aria-label":"Edit",onClick:D(m,["prevent"])})):g("",!0),((r=x(p))==null?void 0:r.user_type)=="editor"?(e(),c(t,{key:1,icon:"pi pi-trash",severity:"danger",variant:"text",rounded:"","aria-label":"Remove",onClick:D(l,["prevent"]),disabled:i.value,loading:i.value},null,8,["disabled","loading"])):g("",!0)])])])]}),_:1},8,["to"])}}}),_e={class:"flex flex-col min-h-screen bg-slate-50"},ve={class:"border border-dashed rounded-xl border-green-400 overflow-hidden h-fit"},he={key:1,class:"flex flex-wrap justify-center gap-8 px-12 py-6"},je=E({__name:"ModulesView",setup(A){const b=U("el"),k=Y(),{locale:_}=z(),R=F(),p=ee(),{addLesson:i}=p,s=L(),{user:B}=T(s),l=w([]),v=w(0),m=w(!1),d=w(!1);te(b,l,{onUpdate:t=>{oe(l.value,t.oldIndex,t.newIndex,t),K(async()=>{const a=[];l.value.map(n=>{const f=parseInt(n.id,10);a.push(f)});try{await $.changeModulesOrder(a),k.add({severity:"success",summary:"Modules order saved!",life:2e3})}catch(n){k.add({severity:"error",summary:"Order set error!",detail:n,life:2e3})}})}});async function h(){if(!m.value){m.value=!0;try{const{data:t}=await $.getModules();m.value=!1,l.value=[],v.value=t.length;for(const a of t){const n=await P(a,_.value);l.value.push(n)}}catch(t){console.log(t)}finally{m.value=!1}}}G(h),J(_,h);async function I(){d.value=!0;try{const{data:t}=await $.createModule(),a=await P(t,_.value);i(a),R.push(`/project/${a.id}/edit`)}catch(t){console.log(t)}finally{d.value=!1}}return(t,a)=>{var y;const n=Q,f=N;return e(),o("div",_e,[j(W),((y=x(B))==null?void 0:y.user_type)=="editor"?(e(),o("div",{key:0,ref_key:"el",ref:b,class:"flex flex-wrap justify-center gap-8 px-12 py-6"},[(e(!0),o(C,null,M(l.value,r=>(e(),c(S,{key:r.id,module:r,onAfterRemove:h},null,8,["module"]))),128)),(e(!0),o(C,null,M(v.value-l.value.length,r=>(e(),c(n,{key:r,width:"128px",height:"128px",class:"rounded-xl shadow-sm"}))),128)),u("div",ve,[j(f,{variant:"text",style:{width:"128px",height:"128px"},class:"bg-green-50",onClick:I,loading:d.value,disabled:d.value},{icon:V(()=>a[0]||(a[0]=[u("i",{class:"pi pi-plus text-xl"},null,-1)])),_:1},8,["loading","disabled"])])],512)):(e(),o("div",he,[(e(!0),o(C,null,M(l.value,r=>(e(),c(S,{key:r.id,module:r,onAfterRemove:h},null,8,["module"]))),128)),(e(!0),o(C,null,M(v.value-l.value.length,r=>(e(),c(n,{key:r,width:"128px",height:"128px",class:"rounded-xl shadow-sm"}))),128))]))])}}});export{je as default};
