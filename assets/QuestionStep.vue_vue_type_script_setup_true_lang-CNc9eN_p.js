import{f as _e,d as he,a as ge}from"./index-DrYnCUiG.js";import{d as ye,q as be,u as xe,s as J,r as g,c as w,a as A,b as r,e as f,F as k,k as B,i as F,h,K as we,H as X,t as S,f as y,w as Se,D as ke,L as $e,M as Ae,E as G,o as Ce}from"./index-DO_dSR7p.js";import{u as Ve,e as Pe,g as Be}from"./CodeEditorView.vue_vue_type_script_setup_true_lang-CxTbsl4I.js";import{s as Ie}from"./index-Mkguro82.js";import{_ as Me}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{s as Ee}from"./index-DMS8NWJq.js";import{s as De}from"./index-CBwnmseZ.js";import{s as Te}from"./index-xXyb7idj.js";import{u as Le}from"./stores-8dtpiGT9.js";import{h as I}from"./http-7nTq_9Vs.js";const je={submitStep:Fe,getStudentProjectStepsByID:Ne,getStudentStepTranslationByID:Re,resetStepsProgress:We,saveStudentStepStateByID:Ue};async function Ne(s){try{return await I.get(`/student/project/${s}/steps`)}catch(n){throw console.log(n),n}}async function Re(s){try{return await I.get(`/student/step/${s}`)}catch(n){throw console.log(n),n}}async function Ue(s,n){try{return await I.put(`/student/step/${s.id}/save`,n)}catch(l){throw console.log(l),l}}async function Fe(s,n){try{return await I.put(`/student/step/${s}/submit`,{student_answer:n})}catch(l){throw console.log(l),l}}async function We(s){try{return await I.delete(`/project/${s}/reset`)}catch(n){throw console.log(n),n}}async function qe(s){const{data:n}=await je.getStudentStepTranslationByID(s.id.toString()),l=n;return{id:s.id.toString(),title:l.name,type:s.step_type,progress:s.status,inner:l.content,answer:l.user_answer,state:l.step_state,access_type:s.access_type,accessibility:s.accessibility,skip_submit:s.skip_submit}}const Y=ye("useLessonStore",()=>{const s=be(),n=xe(),l="emu",o=Ve(l),{newModuleToSlot:m,clearSlots:i,reset:a,slots:u,helpArrows:v,moduleComponents:$}=o;o.addNeededModules([]);const C=Le(),{fileContent:j}=J(C),{setCode:_}=C,V=Pe(l),{setStdout:Z,clear:W}=V,P=Be(l),d=g(null),p=g(null),N=g(!1),R=g(!0),E=g(!0),O=g(!0),ee=w(()=>{if(!b.value||!b.value.inner.tests||b.value.inner.tests.length===0)return!0;let e;for(const c of D.value)if(c.result)if(c.result.success)e=!0;else{e=!1;break}return e}),te=w(()=>R.value&&E.value),q=g(!1),z=g(!1),se=w(()=>j.value),D=g([]),b=w(()=>{var e;return p.value==null?null:((e=d.value)==null?void 0:e.steps[p.value])??null});async function ne(){b.value&&(b.value.inner.tests&&(D.value=await _e(b.value.inner.tests)),b.value.inner.includedCommandsForTests=b.value.inner.includedCommandsForTests??[...he])}let T=0;function oe(e){e!=null&&(d.value=e)}function le(e){d.value!=null&&(d.value.steps=e,p.value!=null&&K(p.value))}function re(e){p.value=e}function ie(e){d.value==null||p.value==null||(d.value.steps[p.value].progress=e)}function ae(e){d.value==null||p.value==null||p.value+1!=d.value.steps.length&&(d.value.steps[p.value+1].accessibility=e)}function ue(e,c){d.value==null||p.value==null||d.value.steps[p.value].inner.options!=null&&(d.value.steps[p.value].inner.options[c].correct=e)}async function K(e){var H,Q;if(d.value==null)return;p.value=e;const c=d.value.steps[p.value];if(c.title==""){N.value=!0;const x=await qe({id:c.id,status:c.progress,step_type:c.type,skip_submit:c.skip_submit,access_type:c.access_type,accessibility:c.accessibility});d.value.steps[e]=x,N.value=!1}const t=d.value.steps[p.value];if(a(),i(),U(),_(""),W(),P.code.value="",z.value=!(((H=t.inner.platformActions)==null?void 0:H.includes("hide-ide"))??!1),q.value=!(((Q=t.inner.platformActions)==null?void 0:Q.includes("hide-sim"))??!1),t.progress=="nothing"||s.name=="module"){if(t.inner.platformActions!=null&&t.inner.platformActions!=null&&t.inner.platformActions.length>0){for(const x of t.inner.platformActions)if(x=="code2ide"&&(_(t.inner.starting??""),P.code.value=t.inner.starting??""),x=="auto-put"&&t.inner.highlights!=null)for(const L of t.inner.highlights)T++,m(L.module,L.slot)}if(t.inner.userActions!=null&&t.inner.userActions!=null&&t.inner.userActions.length>0)for(const x of t.inner.userActions)x=="put-module"&&(R.value=!1,i()),x=="run-code"&&(E.value=!1)}else{if(t.state==null||t.state==null)return;if(t.state.code!=null&&t.state.code!=null&&(t.state.code==""&&(t.state.code=t.inner.starting??""),_(t.state.code),P.code.value=t.state.code),t.state.stdout!=null&&t.state.stdout!=null&&Z(t.state.stdout),t.state.slots!=null&&t.state.slots!=null){t.state.slots.pop();for(const[x,L]of t.state.slots.entries()){const ve=o.slots[x].id;m(L,ve)}}t.state.testsData!=null&&t.state.testsData!=null&&(D.value=t.state.testsData)}}function ce(e){d.value==null||p.value==null||(d.value.steps[p.value].state={code:e.code,stdout:e.stdout,slots:e.slots,testsData:e.testsData})}function de(){if(d.value==null||p.value==null)return;const e=d.value.steps[p.value];if(a(),i(),U(),_(""),W(),P.code.value="",d.value.steps[p.value].state={code:"",stdout:"",slots:[],testsData:[]},e.inner.platformActions!=null&&e.inner.platformActions!=null&&e.inner.platformActions.length>0){for(const c of e.inner.platformActions)if(c=="code2ide"&&(_(e.inner.starting??""),P.code.value=e.inner.starting??""),c=="auto-put"&&e.inner.highlights!=null)for(const t of e.inner.highlights)T++,m(t.module,t.slot)}}function pe(e,c){if(e==="8"||e==="9")v[e].style={color:"rgba(0, 157, 255)"},v[e].visible=!0;else{const t=(e??"A").charCodeAt(0)-65;u[t].style={backgroundColor:"rgba(0, 157, 255, 0.26)",boxShadow:"0 0 15px rgb(0, 157, 255)"}}$.forEach(t=>{if(t.type==c){t.style={animation:"breathing 1s ease-out infinite normal",boxShadow:"0 0 15px rgb(0, 157, 255)",borderRadius:"10px"};return}})}function U(){for(let e=0;e<=5;e++)u[e].class="",u[e].style={};for(const e of $)e.class="",e.style={};for(const e in v){const c=v[e];c.visible=!1,c.style={},c.class=""}}function fe(){E.value=!0}function me(e,c){T<=0?e===c?n.add({severity:"success",summary:"Correct, good job!",detail:"Module has been put successfully",life:3e3}):n.add({severity:"error",summary:"Wrong!",detail:"Keep trying",life:3e3}):T--}return{lesson:d,step:b,stepIndex:p,stepLoading:N,userCode:se,testsData:D,testsSuccess:ee,fetchStepAllTests:ne,submitEnabled:te,modulesWerePut:R,codeWasRun:E,codeWasChecked:O,simVisible:q,ideVisible:z,setLesson:oe,setSteps:le,setStepIndex:re,updateStatus:ie,updateAccess:ae,changeStep:K,runCodePressed:fe,saveOption:ue,lightUp:pe,clearSlotsModulesClasses:U,toastModulePut:me,saveStepStateLocally:ce,restartStep:de}});async function kt(s,n){const{data:l}=await ge.getStepTranslationByID(s.id.toString()),o=l;return{id:s.id.toString(),title:o.name,type:s.step_type,progress:"nothing",inner:n||o.content.contents==null?{contents:[],modules:[]}:o.content,access_type:s.access_type,skip_submit:s.skip_submit}}const ze={class:"flex flex-col gap-2"},Ke={key:1},He={key:0,style:{position:"relative",width:"100%",height:"0","padding-bottom":"56.25%"}},Qe=["src"],Ge={key:1,style:{position:"relative","margin-left":"5%",width:"90%",height:"0","padding-bottom":"160%"}},Je=["src"],Xe={key:2},Ye=["src"],M=A({__name:"ContentsView",props:{contents:{}},setup(s){const n=s;function l(o){return o.replace("shorts","embed")}return(o,m)=>{const i=X("v-md-preview");return r(),f("div",ze,[(r(!0),f(k,null,B(n.contents,a=>{var u;return r(),f("div",{key:a.id},[a.type=="text"?(r(),F(i,{key:0,text:a.text},null,8,["text"])):a.type=="video"?(r(),f("div",Ke,[(u=a.text)!=null&&u.includes("embed")?(r(),f("div",He,[h("iframe",{credentialless:"",src:l(a.text),style:{position:"absolute",top:"0",left:"0",width:"100%",height:"100%"},frameborder:"0",allowfullscreen:"",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",referrerpolicy:"strict-origin-when-cross-origin"},null,8,Qe),m[0]||(m[0]=h("iframe",null,null,-1))])):(r(),f("div",Ge,[h("iframe",{credentialless:"",src:l(a.text??""),style:{position:"absolute",top:"0",left:"0",width:"100%",height:"100%"},frameborder:"0",allowfullscreen:"",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",referrerpolicy:"strict-origin-when-cross-origin"},null,8,Je)]))])):a.type=="tinkercad"?(r(),f("div",Xe,[h("iframe",{credentialless:"",width:"450",height:"287",src:a.text,frameborder:"0",marginwidth:"0",marginheight:"0",scrolling:"no"},null,8,Ye)])):we("",!0)])}),128))])}}}),Ze={class:"text-[33px] font-semibold mb-4 text-center border-b pb-2"},$t=A({__name:"ArticleStep",props:{step:{},isPreview:{type:Boolean}},setup(s){const n=s;return(l,o)=>(r(),f(k,null,[h("div",Ze,S(n.step.title),1),y(M,{contents:n.step.inner.contents},null,8,["contents"])],64))}}),Oe={class:"text-[33px] font-semibold mb-4 text-center border-b pb-2"},At=A({__name:"CodeStep",props:{step:{},isPreview:{type:Boolean}},setup(s){const n=Y();J(n);const l=s;return g(0),(o,m)=>(r(),f(k,null,[h("div",Oe,S(l.step.title),1),y(M,{contents:l.step.inner.contents},null,8,["contents"])],64))}}),et={class:"flex flex-col gap-4"},tt={class:"text-[33px] font-semibold mb-4 text-center border-b pb-2"},st={class:"flex w-full justify-between"},nt={class:"flex flex-col gap-2"},ot={class:"w-40 mb-[29px] border rounded-lg h-[40px] place-items-center bg-white",draggable:"true"},lt={class:"content-center h-full"},rt={class:"flex flex-col gap-2"},it=A({__name:"MatchStep",props:{step:{},isPreview:{type:Boolean}},setup(s){const n=s,l=w(()=>{var m;return(m=n.step.inner.pairs)==null?void 0:m.map(i=>i.key)}),o=w(()=>{var m;return(m=n.step.inner.pairs)==null?void 0:m.map(i=>i.value)});return(m,i)=>{const a=Ie;return r(),f("div",et,[h("div",tt,S(n.step.title),1),y(M,{contents:n.step.inner.contents},null,8,["contents"]),h("div",st,[h("div",nt,[(r(!0),f(k,null,B(l.value,u=>(r(),f("div",{key:u,class:"flex flex-col"},[h("div",ot,[h("div",lt,S(u),1)])]))),128))]),h("div",rt,[(r(!0),f(k,null,B(o.value,u=>(r(),f("div",{key:u,class:"flex flex-col"},[i[0]||(i[0]=h("div",{class:"w-40 h-10 border-dashed border-gray-300 rounded-border border-x border-y"},null,-1)),y(a,{size:"small",severity:"warn",variant:"simple",class:"mb-2"},{default:Se(()=>[ke(S(u.length>0?u:"..."),1)]),_:2},1024)]))),128))])])])}}}),Ct=Me(it,[["__scopeId","data-v-265024ce"]]),at={class:"flex flex-col gap-4"},ut={class:"text-[33px] font-semibold mb-4 text-center border-b pb-2"},Vt=A({__name:"OpenStep",props:$e({step:{},isPreview:{type:Boolean}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(s){const n=Ae(s,"modelValue"),l=s,o=g(null);return(m,i)=>{const a=Ee;return r(),f("div",at,[h("div",ut,S(l.step.title),1),y(M,{contents:l.step.inner.contents},null,8,["contents"]),l.isPreview?(r(),F(a,{key:0,type:"text",modelValue:o.value,"onUpdate:modelValue":i[0]||(i[0]=u=>o.value=u),size:"small",placeholder:"Enter your answer"},null,8,["modelValue"])):(r(),F(a,{key:1,type:"text",modelValue:n.value,"onUpdate:modelValue":i[1]||(i[1]=u=>n.value=u),size:"small",placeholder:"Enter your answer"},null,8,["modelValue"]))])}}}),ct={class:"flex flex-col gap-4"},dt={class:"text-[33px] font-semibold mb-4 text-center border-b pb-2"},pt={key:0,class:"flex flex-col gap-4 ml-4"},ft={key:1,class:"flex flex-col gap-4 ml-4"},Pt=A({__name:"QuestionStep",props:{step:{},isPreview:{type:Boolean}},setup(s){const n=Y(),{saveOption:l}=n,o=s,m=w(()=>o.step.inner.single),i=g(null),a=g([]);return G([a],()=>{if(!o.isPreview&&o.step.inner.options!=null&&!o.step.inner.single)for(const[u,v]of o.step.inner.options.entries())l(a.value.some($=>$==v.text),u)}),G([i],()=>{if(!o.isPreview&&o.step.inner.options!=null&&o.step.inner.single)for(const[u,v]of o.step.inner.options.entries())l(i.value==v.text,u)}),Ce(()=>{if(!o.isPreview&&o.step.inner.options!=null&&(i.value=null,a.value=[],o.step.answer.question))for(const[u,v]of o.step.inner.options.entries())o.step.answer.question[u]&&(a.value.push(v.text),i.value=v.text)}),(u,v)=>{const $=Te,C=X("v-md-preview"),j=De;return r(),f("div",ct,[h("div",dt,S(o.step.title),1),y(M,{contents:o.step.inner.contents},null,8,["contents"]),m.value?(r(),f("div",pt,[(r(!0),f(k,null,B(o.step.inner.options,_=>(r(),f("div",{key:_.id,class:"flex gap-2"},[y($,{modelValue:i.value,"onUpdate:modelValue":v[0]||(v[0]=V=>i.value=V),inputId:_.id,name:"dynamic",value:_.text,class:"mt-1"},null,8,["modelValue","inputId","value"]),y(C,{text:_.text},null,8,["text"])]))),128))])):(r(),f("div",ft,[(r(!0),f(k,null,B(o.step.inner.options,_=>(r(),f("div",{key:_.id,class:"flex gap-2"},[y(j,{modelValue:a.value,"onUpdate:modelValue":v[1]||(v[1]=V=>a.value=V),inputId:_.id,name:"option",value:_.text,class:"mt-1"},null,8,["modelValue","inputId","value"]),y(C,{text:_.text},null,8,["text"])]))),128))]))])}}});export{Ct as M,$t as _,je as a,kt as b,At as c,Vt as d,Pt as e,qe as t,Y as u};
