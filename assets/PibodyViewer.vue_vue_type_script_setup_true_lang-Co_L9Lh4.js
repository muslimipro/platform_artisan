import{n as ce,o as fe,A as ee,m as ve,M as xe,B as he,C as we,u as Y,D as ye,E as me,F as ge,G as be,H as _e,_ as te,T as se}from"./CodeEditorView.vue_vue_type_script_setup_true_lang-DLz_v5Qt.js";import{T as Me}from"./index-B2qWy8WJ.js";import{a as z,r as D,E,o as G,C as $e,b as f,e as y,h as r,J as _,g as e,t as T,F as C,k as A,n as L,S as de,f as k,K as j,i as S,U as pe,c as W,A as X,I as ke,L as Pe,M as oe,P as B,w as ne,V as N,W as O,X as le,m as Se,N as Le,G as ie}from"./index-CTzBRDkF.js";import{s as Ce}from"./index-UttTpJwS.js";import{P as Ie}from"./pibody-BwAjMvHk.js";import{_ as q}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{a as Fe}from"./index-CWSLGCMt.js";const De=["width","height"],F=12,Ee=z({__name:"DisplayView",props:{id:{default:"default"}},setup(m){const o=m,t=D(112),x=D(160),w=D(null),p=D(null),i=D(0),u=ce(o.id);u.text.value||(u.text.value="");function a(l){const v=l.deltaY>0?1:-1;i.value+=v*F,i.value=Math.max(0,i.value);const{lines:g,visibleLines:h}=s();i.value=Math.min(g.length*F,i.value),n(g,h)}function s(){const l=[];let v=0;return p.value&&u.text.value&&(String(u.text.value).split(`
`).forEach(h=>{let b="";h.split(" ").forEach(M=>{const c=b+M+" ";p.value.measureText(c).width>t.value?(l.push(b),b=M+" "):b=c}),l.push(b)}),v=Math.ceil(x.value/F)),{lines:l,visibleLines:v}}function n(l,v){if(p.value){p.value.fillStyle="#FFFFFF",p.value.fillRect(0,0,t.value,x.value),p.value.fillStyle=String(u.textColor.value)||"#000000",p.value.font="12px Monaco";const g=Math.floor(i.value/F);for(let h=0;h<v;h++){const b=g+h;if(b<l.length){const $=(h+1)*F-i.value%F;p.value.fillText(l[b],0,$)}}}}return E([u.text,u.textColor],()=>{const{lines:l,visibleLines:v}=s();i.value=Math.max(0,(l.length-v)*F),n(l,v)}),G(async()=>{if(await $e(),!!w.value&&(p.value=w.value.getContext("2d"),p.value)){p.value.fillStyle="#FFFFFF",p.value.fillRect(0,0,t.value,x.value);const{lines:l,visibleLines:v}=s();i.value=0,n(l,v)}}),(l,v)=>(f(),y("div",{class:"display-container",onWheel:a},[r("canvas",{ref_key:"canvas",ref:w,width:t.value,height:x.value,style:{border:"1px solid black",width:"112px",height:"160px"}},null,8,De)],32))}}),ze=q(Ee,[["__scopeId","data-v-0149e8f3"]]),ae=z({__name:"PinInfo",props:{pin:{},withPin:{},isLeft:{type:Boolean}},setup(m){return(o,t)=>(f(),y(C,null,[r("div",{class:L(["flex",o.isLeft?"flex-row":"flex-row-reverse"])},[r("div",{style:_({background:e(fe)}),class:"text-center font-mono px-1 mr-1"},T(e(ee)[o.pin.id].name),5),(f(!0),y(C,null,A(e(ee)[o.pin.id].able,x=>(f(),y("div",{style:_({background:x.color}),class:"text-center font-mono px-1 mr-1"},T(x.name),5))),256))],2),r("div",{class:L(["flex my-1 mb-3",o.isLeft?"flex-row":"flex-row-reverse"])},[r("div",{style:_({background:`${e(ve)[o.pin.mode]}`}),class:"text-center px-4 mr-1 rounded-lg"},T(e(xe)[o.pin.mode]),5),r("div",{style:_(e(he)(o.pin,o.withPin)),class:"text-center px-4 mr-1 rounded-lg bg-black"},T(e(we)(o.pin,o.withPin)),5)],2)],64))}}),Be=["id"],Te=z({__name:"SlotView",props:{slot:{},index:{},id:{}},setup(m){const{isOutside:o}=Fe(de("theref")),t=Y(m.id),{maxAreaIndex:x,fromSlotIndex:w,settings:p}=t,i=m.index<3;return(u,a)=>{var s;return f(),y(C,null,[r("div",{id:`slot-${u.slot.id}`,ref:"theref",class:L(["absolute w-20 h-20 rounded-lg text-center",[{"bg-green-200/[0.5]":e(x)==u.index,"bg-blue-200/[0.5]":e(w)==u.index},u.slot.class]]),style:_([u.slot.style,e(ye)(u.slot)])},[!e(o)&&((s=e(p))!=null&&s.showPinInfo)?(f(),y("div",{key:0,class:"absolute w-fit whitespace-nowrap text-white flex flex-col text-xs bg-black/70",style:_(i?"left:100%":"right:100%")},[k(ae,{pin:u.slot.pin2,withPin:u.slot.with.pin2,isLeft:i},null,8,["pin","withPin"]),k(ae,{pin:u.slot.pin3,withPin:u.slot.with.pin3,isLeft:i},null,8,["pin","withPin"])],4)):j("",!0)],14,Be),e(o)?j("",!0):(f(),S(pe,{key:0,to:`#pibody-${u.id}`},null,8,["to"]))],64)}}}),Ae=["width","height"],Ue=["points","stroke"],H=3,re=14,U=10,Ve=z({__name:"Connector",props:{start:{},end:{},style:{},id:{}},setup(m){const o=m,t=Y(o.id),x=W(()=>{const{start:a,end:s}=o,n=40,l=[{x:a.x,y:a.y}];return l.push({x:a.x,y:a.y-n}),l.push({x:(s.x+a.x)/2,y:a.y-n}),l.push({x:(s.x+a.x)/2,y:s.y-s.yOffset}),l.push({x:s.x,y:s.y-s.yOffset}),l.push({x:s.x,y:s.y}),l}),w=[{color:"orange",offset:-H,end:-re/2},{color:"red",offset:0,end:0},{color:"saddlebrown",offset:H,end:re/2}],p=W(()=>{const a=x.value,s=[];return w.forEach(n=>{const l=n.offset,v=n.end;let g="";for(let $=0;$<a.length-2;$++){const M=a[$];g+=`${M.x-i.value.x-l},${M.y-i.value.y-l} `}const h=a[a.length-2];g+=`${h.x-i.value.x+l},${h.y-i.value.y-l} `;const b=a[a.length-1];g+=`${b.x-i.value.x+v},${b.y-i.value.y+3} `,s.push({color:n.color,points:g})}),s}),i=W(()=>{const a=[],s=[];for(const h of x.value)a.push(h.x),s.push(h.y);const n=Math.min(...a)-U,l=Math.min(...s)-U,v=Math.max(...a)+U,g=Math.max(...s)+U;return{x:n,y:l,w:v-n,h:g-l}}),u=a=>{o.end.at!==t.pinNone&&t.moveConnectorEnd(o,a)};return(a,s)=>(f(),y(C,null,[r("div",{class:"absolute bg-black cursor-move",style:_([o.style,{left:o.end.x-12+"px",top:o.end.y+"px",width:o.end.w+"px",height:o.end.h+"px"}]),onPointerdown:[s[0]||(s[0]=X(n=>n.preventDefault(),["prevent"])),u]},null,36),r("div",{class:"absolute pointer-events-none",style:_([o.style,e(me)(i.value)])},[(f(),y("svg",{xmlns:"http://www.w3.org/2000/svg",width:i.value.w,height:i.value.h},[(f(!0),y(C,null,A(p.value,(n,l)=>(f(),y("polyline",{key:l,points:n.points,stroke:n.color,fill:"none","stroke-width":H,"stroke-linejoin":"round","stroke-linecap":"round"},null,8,Ue))),128))],8,Ae))],4)],64))}}),Re=q(Ve,[["__scopeId","data-v-9a0ab2fc"]]),We=z({__name:"Canvas",setup(m){const o=de("canvasEl");return G(async()=>{o.value&&(await ge(o.value),requestAnimationFrame(be))}),ke(()=>{o.value&&_e(o.value)}),(t,x)=>(f(),y("canvas",{ref_key:"canvasEl",ref:o},null,512))}}),Ne=["id"],Oe=["id"],He={class:"absolute top-4 right-1 flex flex-col gap-1"},je={class:"material-icons"},Xe=["id"],Ye={class:"max-h-fit w-full overflow-auto flex flex-wrap gap-2 justify-center items-start mt-2",style:{"touch-action":"none",padding:"15px 0 15px 0"}},Ge=z({__name:"SimulationView",props:Pe({id:{},horizontal:{type:Boolean}},{neededModules:{default:[]},neededModulesModifiers:{},slots:{default:[]},slotsModifiers:{}}),emits:["update:neededModules","update:slots"],setup(m){const o=m,t=Y(o.id,o.horizontal),{toDelete:x,slots:w,modules:p,isConnect8or9:i,chosenPin8or9:u,pin8:a,pin9:s,settings:n,clearSlotsModulesClasses:l,modulesWerePut:v,lightUp:g}=t,h=oe(m,"neededModules"),b=oe(m,"slots");G(()=>{t.putModuleList(b.value)});function $(M){if(v.value=!0,l(),!!h.value)for(const c of h.value){if(!c.slot||!c.module)continue;if(t.getSlotPinWith(c.slot).type!==c.module){g(c.slot,c.module),v.value=!1;break}}}E([t.slotHasList],()=>{b.value=t.slotHasList()});for(const M of t.slots)E(()=>M.with.type,()=>{$()},{immediate:!0});return E(()=>t.pin8.with.type,()=>{$(t.pin8)},{immediate:!0}),E(()=>t.pin9.with.type,()=>{$(t.pin9)},{immediate:!0}),E(h,()=>{for(const M of t.slots)$()}),(M,c)=>{var Q,Z;const R=Ce,J=Se,K=Me;return f(),y("div",{id:`emulator-${o.id}`,class:L({"h-[450px] flex flex-row":M.horizontal,"h-full flex flex-col":!M.horizontal,"parent relative items-stretch border-t border-surface overflow-hidden select-none":!0})},[r("div",{id:`pibody-${o.id}`,class:"relative h-[450px] flex-shrink-0 overflow-x-hidden overflow-y-auto w-[450px]"},[k(R,{src:e(Ie),width:"384px",draggable:"false",class:"absolute pt-4 min-w-[384px]",style:{left:"32px",top:"0px"}},null,8,["src"]),k(ze,{class:"absolute top-[217px] left-[168px] w-[112px] h-[160px]",id:`${o.id}`},null,8,["id"]),r("div",He,[B((f(),S(J,{type:"button",class:L(["w-9 h-9 mr-1",(Q=e(n))!=null&&Q.showPinInfo?"bg-green-500":"bg-gray-500"]),rounded:"",onClick:c[0]||(c[0]=d=>{var P;return e(t).setSettings({showPinInfo:!((P=e(n))!=null&&P.showPinInfo)})})},{default:ne(()=>{var d;return[r("span",je,T(((d=e(n))!=null&&d.showPinInfo,"help_center")),1)]}),_:1},8,["class"])),[[K,`Pin Information: ${(Z=e(n))!=null&&Z.showPinInfo?"On":"Off"}`,void 0,{left:!0}]]),B((f(),S(J,{type:"button",class:"w-9 h-9 mr-1 bg-gray-500",rounded:"",onClick:c[1]||(c[1]=d=>e(t).reset())},{default:ne(()=>c[4]||(c[4]=[r("span",{class:"material-icons"},"restart_alt",-1)])),_:1})),[[K,"Reset pibody",void 0,{left:!0}]])]),(f(!0),y(C,null,A(e(w),(d,P)=>(f(),S(Te,{key:P,slot:d,index:P,id:o.id},null,8,["slot","index","id"]))),128)),r("div",{class:"absolute bg-black",style:_({left:e(t).usb.x+"px",top:e(t).usb.y-70+"px",width:e(t).usb.w+"px",height:e(t).usb.h+50+"px"})},null,4),r("div",{class:"absolute",style:_({left:e(t).onLED.x+"px",top:e(t).onLED.y+"px",width:e(t).onLED.w+"px",height:e(t).onLED.h+"px"})},null,4),B(r("div",{class:"absolute flex items-center justify-center animate-bounce-up z-10 pointer-events-none",style:_({left:e(t).helpArrows[8].x+"px",top:e(t).helpArrows[8].y+"px"})},[r("span",{class:L(["icon-arrow-down text-5xl",[e(u)===e(a)?"text-green-500":"text-gray-500",e(t).helpArrows[8].class]]),style:_(e(t).helpArrows[8].style)},null,6),c[5]||(c[5]=r("span",{class:"absolute text-white font-bold -mt-2"},"8",-1))],4),[[N,e(t).helpArrows[8].visible||e(i)]]),B(r("div",{class:"absolute flex items-center justify-center animate-bounce-down z-10 pointer-events-none",style:_({left:e(s).x-10+"px",top:e(s).y+8+"px"})},[r("span",{class:L(["icon-arrow-up text-5xl",e(u)===e(s)?"text-green-500":"text-gray-500"]),style:_(e(t).helpArrows[9].style)},null,6),c[6]||(c[6]=r("span",{class:"absolute text-white font-bold -mt-2"},"9",-1))],4),[[N,e(t).helpArrows[9].visible||e(i)]]),k(We,{class:"absolute top-0 left-0 z-10 w-full h-full pointer-events-none",id:o.id},null,8,["id"])],8,Oe),r("div",{id:`module-list-${o.id}`,class:"relative h-full flex-1 overflow-auto overflow-x-hidden w-[450px]"},[r("div",Ye,[(f(!0),y(C,null,A(e(t).neededModules,(d,P)=>(f(),S(le(d.is),O({key:P,class:d.class,style:d.style,ref_for:!0},d,{onPointerdown:[I=>e(t).startDragFromModuleList(d,I),c[2]||(c[2]=X(I=>I.preventDefault(),["prevent"]))],class:"flex-none w-20 h-20 cursor-move"}),null,16,["class","style","onPointerdown"]))),128)),B(r("div",{class:L(["absolute top-0 left-0 h-full w-full",{"bg-red-500/[0.8]":e(x)}])},c[7]||(c[7]=[r("div",{class:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2"},[r("span",{class:"material-icons",style:{"font-size":"100px"}},"delete")],-1)]),2),[[N,e(x)]])])],8,Xe),(f(!0),y(C,null,A(e(p),(d,P)=>(f(),S(pe,{defer:"",to:d.dragging?`#emulator-${o.id}`:`#pibody-${o.id}`,key:d.id},[d.putOn8or9&&d.connector.end.x!==0&&d.connector.end.y!==0?(f(),S(Re,O({key:0,ref_for:!0},d.connector,{id:o.id}),null,16,["id"])):j("",!0),(f(),S(le(d.is),O({class:d.class,style:[d.style,{left:d.x+"px",top:d.y+"px"}],ref_for:!0},d,{onPointerdown:[I=>e(t).startDragFromSlot(d,P,d.on,I),c[3]||(c[3]=X(I=>I.preventDefault(),["prevent"]))],class:"absolute w-20 h-20 rounded-xl cursor-move",style:{"touch-action":"none"}}),null,16,["class","style","onPointerdown"]))],8,["to"]))),128))],10,Ne)}}}),ue=q(Ge,[["__scopeId","data-v-6ef59b11"]]),qe={key:0,class:"flex flex-col w-full"},Je={class:"h-[500px] flex flex-col w-full",style:{border:"0.1px solid #808080",borderRadius:"12px",overflow:"hidden"}},Ke={key:1,class:"flex flex-row w-full"},Qe={class:"flex flex-col w-1/2"},V=!0,it=z({__name:"PibodyViewer",props:{id:{},content:{},data:{},state:{},starting:{type:Boolean,default:!0},horizontal:{type:Boolean,default:!0}},emits:["save-answer"],setup(m,{emit:o}){var u;const t=m,x=o,w=D(""),p=D([]),i=((u=t.data)==null?void 0:u.neededModules)??[];return Le(()=>{var a,s,n,l,v;w.value=t.starting?(a=t.content)==null?void 0:a.starting:((n=(s=t.state)==null?void 0:s.answer)==null?void 0:n.code)??"",p.value=((v=(l=t.state)==null?void 0:l.answer)==null?void 0:v.slots)??[]}),E([w,p],()=>{x("save-answer",{code:w.value,slots:p.value})}),(a,s)=>t.horizontal?(f(),y("div",qe,[k(e(ue),{class:"w-full",slots:p.value,"onUpdate:slots":s[0]||(s[0]=n=>p.value=n),autoPut:!0,neededModules:e(i),"onUpdate:neededModules":s[1]||(s[1]=n=>ie(i)?i.value=n:null),id:t.id,horizontal:!0},null,8,["slots","neededModules","id"]),r("div",Je,[k(te,{code:w.value,"onUpdate:code":s[2]||(s[2]=n=>w.value=n),connectbuttons:V,"onUpdate:connectbuttons":s[3]||(s[3]=n=>V=n),id:t.id},null,8,["code","id"]),k(e(se),{id:t.id,class:"flex-grow max-h-40"},null,8,["id"])])])):(f(),y("div",Ke,[r("div",Qe,[k(te,{code:w.value,"onUpdate:code":s[4]||(s[4]=n=>w.value=n),connectbuttons:V,"onUpdate:connectbuttons":s[5]||(s[5]=n=>V=n),id:t.id},null,8,["code","id"]),k(e(se),{id:t.id,class:"flex-grow max-h-96"},null,8,["id"])]),k(e(ue),{class:"max-w-[467px] w-1/2",slots:p.value,"onUpdate:slots":s[6]||(s[6]=n=>p.value=n),autoPut:!0,neededModules:e(i),"onUpdate:neededModules":s[7]||(s[7]=n=>ie(i)?i.value=n:null),id:t.id,horizontal:!1},null,8,["slots","neededModules","id"])]))}});export{it as _};
