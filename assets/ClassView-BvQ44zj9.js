import{T as fe}from"./index-C4uQBDlA.js";import{s as me}from"./index-bzgAK5Mg.js";import{s as ge}from"./index-Cq3sBVi5.js";import{d as he,u as ve,z as ye,G as _e,r as u,A as be,I as $e,m as xe,o,f as h,w as t,c as f,t as n,e as r,b as a,g as v,j as I,h as w,F as C,i as D,L as we,C as O,n as Ce,k as ke,aF as Te,s as ze,M as Fe}from"./index-CvXDlvni.js";import{s as je,a as Se}from"./index-yNNRFSWc.js";import{s as De}from"./index-BKSVg22X.js";import{s as Ve,a as Ne}from"./index-BWHE24M0.js";import{s as Pe}from"./index-CBf9SASP.js";import{s as Ie}from"./index-0lIf6O9I.js";import{a as Be,s as Me}from"./index-BtOIGHPq.js";import{s as Re}from"./index-uzz1oX1u.js";import{s as Ue}from"./index-Cv4Foupa.js";import{u as Ae,S as k}from"./useSchoolStore-Df1G3RZK.js";import{a as Le}from"./index-BFFggUiy.js";import"./index-CwAQA0fP.js";import"./index-B3J6cNgh.js";import"./index-CRYd2dgD.js";import"./index-dYV8A7MW.js";import"./index-D3suYYug.js";import"./index-C2klbU81.js";import"./index-Cx2Z2ntV.js";const Ge={key:1},He={key:2,class:"flex flex-col items-start px-8 pb-4 gap-4"},qe={class:"flex items-center justify-between gap-2 w-full"},Oe={class:"flex flex-col gap-2"},Ee={class:"text-3xl"},Ke={class:"text-sm"},Je={class:"flex items-center px-4 self-end"},Qe={class:"text-xl mr-2"},We={class:"text-gray-500"},Xe={class:"flex items-center"},Ye={class:"flex-grow flex gap-2 items-center"},Ze={class:"text-xl text-gray-500"},es={class:"w-4 h-4 rounded-md text-[10px] font-semibold flex justify-center items-center bg-gray-300"},ss={class:"flex flex-col"},as={class:"text-[10px] text-gray-500"},ts={class:"flex justify-center text-[124px]"},ls={class:"flex justify-between items-center mb-8"},os={class:"flex justify-end gap-2"},js=he({__name:"ClassView",setup(rs){const T=ve(),B=ye(),y=Ce(),M=ke(),{t:d}=_e(),E=u(),_=u();(()=>{_.value={global:{value:null,matchMode:Te.CONTAINS}}})();const R=Ae(),{teachers:U,school:K}=be(R),{loadClasses:J}=R,g=u(null),A=u([]),z=u([]),F=u(!1),j=u(!1),S=u(!1),V=u(!1),b=u(!1),$=u(null);async function N(){if(!F.value){F.value=!0;try{const{data:e}=await k.getClass(Number(y.params.id));g.value=e??null,$.value=U.value.find(l=>{var p;return l.teacher_id==((p=g.value)==null?void 0:p.creator)})??null}catch(e){console.log(e)}finally{F.value=!1}}}async function Q(){if(!j.value){j.value=!0;try{const{data:e}=await k.getClassStudents(Number(y.params.id));A.value=e??null}catch(e){console.log(e)}finally{j.value=!1}}}async function W(){try{const{data:e}=await Le.getProjects();z.value=e}catch(e){console.log(e)}}const X=["secondary","success","info","warn","danger","contrast"],L=$e(()=>{const e={};for(const l of z.value){let p=l.layer;p==0&&(p=999);const m=l.is_guidable?"learn":"practice";e[p]||(e[p]={learn:0,practice:0}),e[p][m]++}return e});xe(()=>{N(),W(),Q()});function Y(){B.require({message:d("pages.school.confirmDeleteClass"),header:d("pages.school.confirmHeader"),icon:"pi pi-exclamation-triangle",rejectProps:{label:d("pages.school.confirmCancel"),severity:"secondary",outlined:!0},acceptProps:{label:d("pages.school.confirmDeleteBtn"),severity:"danger"},accept:()=>{Z(Number(y.params.id))}})}async function Z(e){try{await k.deleteClass(e),await J(),M.go(-1),T.add({severity:"success",summary:d("pages.school.classRemoved"),life:2e3})}catch(l){T.add({severity:"error",summary:d("pages.school.removeClassFailed"),detail:l,life:2e3})}}async function ee(){if($.value){S.value=!0;try{await k.assignTeacherToClass(Number(y.params.id),$.value.teacher_id),await N()}catch(e){console.log(e)}finally{S.value=!1,b.value=!1}}}function se(){B.require({message:d("pages.school.confirmDeleteTeacher"),header:d("pages.school.confirmHeader"),icon:"pi pi-exclamation-triangle",rejectProps:{label:d("pages.school.confirmCancel"),severity:"secondary",outlined:!0},acceptProps:{label:d("pages.school.confirmDeleteBtn"),severity:"danger"},accept:()=>{ae()}})}async function ae(){try{await k.assignTeacherToClass(Number(y.params.id)),await N(),T.add({severity:"success",summary:d("pages.school.teacherRemoved"),life:2e3})}catch(e){T.add({severity:"error",summary:d("pages.school.removeTeacherFailed"),detail:e,life:2e3})}}return(e,l)=>{const p=Ue,m=ze,te=Be,le=Re,oe=Me,i=je,re=Ie,P=Ve,G=Pe,ne=Ne,ie=De,ce=Se,H=Fe,de=ge,ue=me,pe=fe;return o(),h(ue,{class:"min-w-0 flex-grow flex flex-col gap-2"},{default:t(()=>{var q;return[F.value?(o(),h(p,{key:0,class:"flex justify-center"})):g.value?(o(),f("div",He,[r("div",qe,[r("div",Oe,[r("div",Ee,n(g.value.name),1),r("div",Ke,n(e.$t("pages.school.since"))+" "+n(g.value.created_time.split("T")[0]),1)]),a(m,{icon:"pi pi-hashtag",label:e.$t("pages.school.classCode"),severity:"info",onClick:l[0]||(l[0]=s=>V.value=!0)},null,8,["label"])]),r("div",Je,[r("div",Qe,[r("span",We,n(e.$t("pages.school.classTeacher")),1),v(": "+n(g.value.creator_name),1)]),a(m,{icon:"pi pi-pencil",severity:"info",variant:"text",rounded:"",onClick:l[1]||(l[1]=s=>b.value=!0)}),g.value.creator!=((q=I(K))==null?void 0:q.manager_id)?(o(),h(m,{key:0,icon:"pi pi-trash",severity:"danger",variant:"text",rounded:"",onClick:se})):w("",!0)]),a(ce,{ref_key:"dt",ref:E,filters:_.value,"onUpdate:filters":l[3]||(l[3]=s=>_.value=s),value:A.value,dataKey:"id",loading:j.value,scrollable:"",globalFilterFields:["name","email"],class:"overflow-hidden w-full",paginator:"",rows:25,rowsPerPageOptions:[5,10,25],groupHeader:!0,showGridlines:""},{header:t(()=>[r("div",Xe,[r("div",Ye,[r("div",Ze,n(e.$t("pages.school.students")),1)]),a(oe,null,{default:t(()=>[a(te,null,{default:t(()=>l[8]||(l[8]=[r("i",{class:"pi pi-search"},null,-1)])),_:1}),a(le,{modelValue:_.value.global.value,"onUpdate:modelValue":l[2]||(l[2]=s=>_.value.global.value=s),placeholder:e.$t("pages.school.search")},null,8,["modelValue","placeholder"])]),_:1})])]),empty:t(()=>[v(n(e.$t("pages.school.noStudentsFound")),1)]),loading:t(()=>[v(n(e.$t("pages.school.loadingStudents")),1)]),default:t(()=>[a(ne,{type:"header"},{default:t(()=>[a(P,null,{default:t(()=>[a(i,{header:e.$t("pages.school.projects"),rowspan:2,colspan:2,frozen:!0,alignFrozen:"left"},null,8,["header"]),(o(!0),f(C,null,D(L.value,(s,c)=>(o(),h(i,{key:c,colspan:s.learn+s.practice},{header:t(()=>[a(re,{class:"w-full text-md px-2",severity:c==999?"secondary":X[c]},{default:t(()=>[v(n(c==999?e.$t("pages.school.other"):`${e.$t("pages.school.level")} ${c}`),1)]),_:2},1032,["severity"])]),_:2},1032,["colspan"]))),128)),a(i,{header:"",rowspan:2,colspan:2,frozen:!0,alignFrozen:"right"})]),_:1}),a(P,null,{default:t(()=>[(o(!0),f(C,null,D(L.value,(s,c)=>(o(),f(C,{key:c},[s.learn>0?(o(),h(i,{key:0,colspan:s.learn},{header:t(()=>[a(G,{class:"w-full flex justify-center",size:"small",severity:"success"},{default:t(()=>[v(n(e.$t("pages.projects.learn")),1)]),_:1})]),_:2},1032,["colspan"])):w("",!0),s.practice>0?(o(),h(i,{key:1,colspan:s.practice},{header:t(()=>[a(G,{class:"w-full flex justify-center",size:"small",severity:"info"},{default:t(()=>[v(n(e.$t("pages.projects.practice")),1)]),_:1})]),_:2},1032,["colspan"])):w("",!0)],64))),128))]),_:1}),a(P,null,{default:t(()=>[a(i,{header:e.$t("pages.school.avatar"),frozen:!0,alignFrozen:"left"},null,8,["header"]),a(i,{header:e.$t("pages.school.name"),frozen:!0,alignFrozen:"left",sortable:"",field:"name"},null,8,["header"]),(o(!0),f(C,null,D(z.value,(s,c)=>(o(),h(i,{key:s.id,field:s.id},{header:t(()=>[we((o(),f("div",es,[v(n(c+1),1)])),[[pe,{value:s.name.toString()},void 0,{top:!0}]])]),body:t(({data:x})=>[x.projects[c].student_progress>0?(o(),f("div",{key:0,class:O(["w-4 h-4 mx-4 rounded-full text-[10px] flex justify-center items-center text-white",x.projects[c].student_progress==100?"bg-green-400":"bg-orange-400"])},null,2)):w("",!0)]),_:2},1032,["field"]))),128)),a(i,{header:e.$t("pages.school.xp"),frozen:!0,alignFrozen:"right",sortable:"",field:"xp"},null,8,["header"]),a(i,{header:"",frozen:!0,alignFrozen:"right"})]),_:1})]),_:1}),a(i,{field:"small_avatar_url",header:e.$t("pages.school.avatar"),sortable:"",frozen:!0,alignFrozen:"left"},{body:t(({data:s})=>[a(ie,{image:s.small_avatar_url},null,8,["image"])]),_:1},8,["header"]),a(i,{field:"name",header:e.$t("pages.school.name"),sortable:"",frozen:!0,alignFrozen:"left"},{body:t(({data:s})=>[r("div",ss,[r("div",null,n(`${s.name.length>0?s.name:s.email}`),1),r("div",as,n(`Last visited: ${s.last_activity_time.split("T")[0]}`),1)])]),_:1},8,["header"]),(o(!0),f(C,null,D(z.value,(s,c)=>(o(),h(i,{key:s.id,field:s.id},{body:t(({data:x})=>[x.projects[c].student_progress>0?(o(),f("div",{key:0,class:O(["w-4 h-4 rounded-full text-[10px] flex justify-center items-center text-white",x.projects[c].student_progress==100?"bg-green-400":"bg-orange-400"])},null,2)):w("",!0)]),_:2},1032,["field"]))),128)),a(i,{field:"xp",header:e.$t("pages.school.xp"),sortable:"",frozen:!0,alignFrozen:"right"},{body:t(({data:s})=>[r("div",null,n(`${s.xp}xp`),1)]),_:1},8,["header"]),a(i,{exportable:!1,frozen:!0,alignFrozen:"right"},{body:t(({data:s})=>[a(m,{icon:"pi pi-angle-right",outlined:"",rounded:"",severity:"info",onClick:c=>I(M).push({name:"school-student",params:{id:s.id}})},null,8,["onClick"])]),_:1})]),_:1},8,["filters","value","loading"]),a(m,{icon:"pi pi-trash",label:e.$t("pages.school.remove"),severity:"danger",onClick:Y,class:"self-end"},null,8,["label"])])):(o(),f("div",Ge,n(e.$t("pages.school.noData")),1)),a(H,{visible:V.value,"onUpdate:visible":l[4]||(l[4]=s=>V.value=s),modal:"",header:e.$t("pages.school.classCode")},{default:t(()=>{var s;return[r("div",ts,n((s=g.value)==null?void 0:s.code),1)]}),_:1},8,["visible","header"]),a(H,{visible:b.value,"onUpdate:visible":l[7]||(l[7]=s=>b.value=s),modal:"",header:e.$t("pages.school.assignTeacher"),closable:!1},{default:t(()=>[r("div",ls,[a(de,{modelValue:$.value,"onUpdate:modelValue":l[5]||(l[5]=s=>$.value=s),options:I(U),"option-label":"email",placeholder:e.$t("pages.school.selectTeacher")},null,8,["modelValue","options","placeholder"])]),r("div",os,[a(m,{type:"button",label:e.$t("pages.school.cancel"),severity:"secondary",onClick:l[6]||(l[6]=s=>b.value=!1)},null,8,["label"]),a(m,{type:"button",label:e.$t("pages.school.assign"),onClick:ee,loading:S.value,disabled:S.value},null,8,["label","loading","disabled"])])]),_:1},8,["visible","header"])]}),_:1})}}});export{js as default};
