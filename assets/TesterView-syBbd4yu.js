import{S as Ce,_ as Pe,T as Se,s as qe,a as Te}from"./SimulationView-Ct9XOriO.js";import{_ as Fe}from"./IdeHeader.vue_vue_type_script_setup_true_lang-BTUdDvZ6.js";import{s as se}from"./index-C7X-J-Qf.js";import{s as Re}from"./index-D33CKrbu.js";import{s as Ie}from"./index-dDCPORGv.js";import{d as z,o as c,c as i,j as e,e as s,t as r,a9 as p,I as ae,F,g as D,h as R,i as E,f as j,w as g,C as H,b as m,u as Me,z as Ve,A as ce,r as B,m as je,v as De,n as ze,H as ue,s as Oe}from"./index-DcyBeJgC.js";import{_ as Ae,s as Be}from"./SavedCloud.vue_vue_type_script_setup_true_lang-CsHEMnm4.js";import{O as b,o as G,s as ie,c as N,M as Z,m as de,P as ee,p as me,d as X,I as _,i as T,f as Ge,e as Ne,g as oe,u as Ue,b as Le,h as We,n as fe,R as U,j as ve,w as He}from"./pibody-DqOzv7Z7.js";import{u as Ee}from"./editor-store-B_XCwIiV.js";import{a as Y}from"./index-CD2e-UIx.js";import{a as Je}from"./index-Co_6RbC6.js";import{t as Ke}from"./types-CG_ifl2b.js";import{c as Qe}from"./index-ClYcSkZ_.js";import"./index-CwC5BdXP.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-D9bkqAe8.js";import"./logo-Cr9YRutO.js";import"./index-BS_i5v3E.js";import"./pibody-BwAjMvHk.js";import"./index-C5SrmfWd.js";import"./index-BHfeFhRm.js";import"./index-BauW75GO.js";import"./index-Dzo9KCOb.js";import"./index-N8YLxu86.js";import"./index-rNlVQhAp.js";import"./index-DmQEPo33.js";import"./index-seXcSKnd.js";const Xe={key:0},Ye={key:0,class:"text-white"},Ze={key:1,class:"text-white"},et={key:2,class:"text-white"},tt={key:3,class:"text-white"},st={key:4,class:"text-white"},at={key:5,class:"text-black w-full"},ot={class:"text-center font-mono px-1 text-white bg-black"},nt={key:6,class:"text-black w-full"},lt={class:"text-center font-mono px-1 text-white bg-black text-nowrap"},rt={key:7,class:"text-white w-full"},ct={key:8,class:"text-white w-full"},ut={key:9,class:"text-white w-full"},it={key:10,class:"text-white w-full"},dt={key:11,class:"text-black w-full"},mt={key:1,class:"text-center p-3"},te=z({__name:"FeedbackNode",props:{message:{type:Object,required:!0}},setup(a){return($,y)=>a.message?(c(),i("div",Xe,[a.message.command===e(b).PinSetValue?(c(),i("div",Ye,[s("div",{style:p({background:e(G)}),class:"text-center text-nowrap font-mono px-1"},"Pin "+r(a.message.request.pin)+" set value",5),s("div",{style:p(e(N)(a.message.request.value)),class:"text-center text-nowrap font-mono px-1"}," Value "+r(e(ie)(a.message.request.value)),5)])):a.message.command===e(b).PinSetMode?(c(),i("div",Ze,[s("div",{style:p({background:e(G)}),class:"text-center text-nowrap font-mono px-1"},"Pin "+r(a.message.request.pin)+" set mode",5),s("div",{style:p({background:e(de)[a.message.request.mode]}),class:"text-center text-nowrap font-mono px-1"}," Mode "+r(e(Z)[a.message.request.mode]),5)])):a.message.command===e(b).PinSetPull?(c(),i("div",et,[s("div",{style:p({background:e(G)}),class:"text-center text-nowrap font-mono px-1"},"Pin "+r(a.message.request.pin)+" set pull",5),s("div",{style:p({background:e(me)[a.message.request.pull]}),class:"text-center text-nowrap font-mono px-1"}," Pull "+r(e(ee)[a.message.request.pull]),5)])):a.message.command===e(b).PwmDutyU16?(c(),i("div",tt,[s("div",{style:p({background:e(G)}),class:"text-center text-nowrap font-mono px-1"},"PWM "+r(a.message.request.pin)+" set duty",5),s("div",{style:p(e(N)(a.message.request.duty_u16/e(X))),class:"text-center text-nowrap font-mono px-1"}," u16 "+r(a.message.request.duty_u16),5)])):a.message.command===e(b).PwmFreq?(c(),i("div",st,[s("div",{style:p({background:e(G)}),class:"text-center text-nowrap font-mono px-1"},"PWM "+r(a.message.request.pin)+" set freq",5),s("div",{style:p(e(N)(a.message.request.freq/e(X))),class:"text-center text-nowrap font-mono px-1"}," Freq "+r(a.message.request.freq),5)])):a.message.command===e(b).Output?(c(),i("div",at,[y[0]||(y[0]=s("div",{class:"text-center text-nowrap px-1"},"Print",-1)),s("div",ot,r(a.message.request.output),1)])):a.message.command===e(b).Sleep?(c(),i("div",nt,[y[1]||(y[1]=s("div",{class:"text-center text-nowrap px-1"},"Sleep",-1)),s("div",lt,r(a.message.request.time_ms)+" ms",1)])):a.message.command===e(_).PinGetValue?(c(),i("div",rt,[s("div",{style:p({background:e(T)}),class:"text-center text-nowrap font-mono px-1"},"Pin "+r(a.message.request.pin)+" get value",5),s("div",{style:p(e(N)(a.message.result)),class:"text-center text-nowrap font-mono px-1"}," Value "+r(e(ie)(a.message.result)),5)])):a.message.command===e(_).PinGetMode?(c(),i("div",ct,[s("div",{style:p({background:e(T)}),class:"text-center text-nowrap font-mono px-1"},"Pin "+r(a.message.request.pin)+" get mode",5),s("div",{style:p({background:e(de)[a.message.result]}),class:"text-center text-nowrap font-mono px-1"}," Mode "+r(e(Z)[a.message.result]),5)])):a.message.command===e(_).PinGetPull?(c(),i("div",ut,[s("div",{style:p({background:e(T)}),class:"text-center text-nowrap font-mono px-1"},"Pin "+r(a.message.request.pin)+" get pull",5),s("div",{style:p({background:e(me)[a.message.result]}),class:"text-center text-nowrap font-mono px-1"}," Pull "+r(e(ee)[a.message.result]),5)])):a.message.command===e(_).AdcReadU16?(c(),i("div",it,[s("div",{style:p({background:e(T)}),class:"text-center text-nowrap font-mono px-1"},"ADC "+r(a.message.request.pin)+" read",5),s("div",{style:p(e(N)(a.message.result/e(X))),class:"text-center text-nowrap font-mono px-1"}," u16 "+r(a.message.result),5)])):(c(),i("div",dt," Todo: "+r(a.message.command),1))])):(c(),i("div",mt," Nothing "))}}),ft={class:"flex-col overflow-auto"},vt={class:"flex"},pt={key:0,class:"flex text-white border-2 border-blue-500"},gt={class:"text-black text-nowrap"},xt={key:1,class:"flex text-white border-2 border-blue-500"},ht={class:"text-black text-nowrap"},yt={key:2,class:"flex text-white border-2 border-blue-500"},wt={class:"text-black text-nowrap"},bt={key:3,class:"flex text-white border-2 border-blue-500"},_t={class:"text-black text-nowrap"},kt={key:4,class:"flex text-black border-2 border-blue-500"},ge=z({__name:"Inputs",props:{inputs:{}},setup(a){const $=ae(()=>{const y=[];for(let[h,v]of a.inputs){const n=Ge(h);y.push({...n,result:v})}return y});return(y,h)=>(c(),i(F,null,[$.value.length===0?(c(),i(F,{key:0},[D("Nothing")],64)):R("",!0),s("div",ft,[(c(!0),i(F,null,E($.value,v=>(c(),i("div",vt,[v.command===e(_).PinGetValue?(c(),i("div",pt,[s("div",{style:p({background:e(T)}),class:"text-center text-nowrap font-mono px-1"},"Pin "+r(v.request.pin)+" get values:",5),s("div",gt,r(v.result),1)])):v.command===e(_).PinGetMode?(c(),i("div",xt,[s("div",{style:p({background:e(T)}),class:"text-center text-nowrap font-mono px-1"},"Pin "+r(v.request.pin)+" get values:",5),s("div",ht,r(v.result.map(n=>e(Z)[n])),1)])):v.command===e(_).PinGetPull?(c(),i("div",yt,[s("div",{style:p({background:e(T)}),class:"text-center text-nowrap font-mono px-1"},"Pin "+r(v.request.pin)+" get values:",5),s("div",wt,r(v.result.map(n=>e(ee)[n])),1)])):v.command===e(_).AdcReadU16?(c(),i("div",bt,[s("div",{style:p({background:e(T)}),class:"text-center text-nowrap font-mono px-1"},"ADC "+r(v.request.pin)+" read u16:",5),s("div",_t,r(v.result),1)])):(c(),i("div",kt,"TODO: "+r(v.command),1))]))),256))])],64))}}),$t={class:"flex overflow-auto mb-2"},Ct={class:"flex"},Pt=["onClick"],St={class:"text-center"},qt={key:0,class:"text-center"},Tt={key:0,class:"flex items-center justify-center h-20"},Ft=z({__name:"FeedbackTimeline",props:{code:{},success:{type:Boolean},message:{},feedback:{},replayed:{},expected:{}},setup(a){const $=a,{selectNode:y,selectedIndex:h}=Ne($),v=ae(()=>oe($.replayed));return(n,x)=>{const J=se;return c(),j(J,{header:"Feedback"},{default:g(()=>[s("div",$t,[(c(!0),i(F,null,E($.feedback,(C,I)=>{var M,L;return c(),i("div",Ct,[s("button",{class:H(["flex",e(h)===I?"border border-blue-500":""]),onClick:ne=>e(y)(I)},[s("div",St,[D(r(C.correct?"Correct":"Incorrect")+" ",1),m(te,{message:(M=C.replayed)==null?void 0:M.content,class:H(["border-4 rounded-md",C.correct?"border-green-500":"border-red-500"])},null,8,["message","class"])]),C.correct?R("",!0):(c(),i("div",qt,[x[0]||(x[0]=D(r("Expected")+" ")),m(te,{message:(L=C.expected)==null?void 0:L.content,class:H(["border-4 rounded-md",C.correct?"border-red-500":"border-green-500"])},null,8,["message","class"])]))],10,Pt),I+1<n.feedback.length?(c(),i("div",Tt,"→")):R("",!0)])}),256))]),x[1]||(x[1]=D(" Input used: ")),m(ge,{inputs:v.value},null,8,["inputs"])]),_:1})}}}),Rt={class:"flex overflow-auto mb-2"},It={class:"flex"},Mt={class:"text-center"},Vt={key:0,class:"flex items-center justify-center h-12"},pe=z({__name:"TestDataTimeline",props:{data:{}},setup(a){const $=ae(()=>oe(a.data));return(y,h)=>{const v=se;return c(),j(v,{header:"Expected"},{default:g(()=>[s("div",Rt,[(c(!0),i(F,null,E(y.data,(n,x)=>(c(),i("div",It,[s("div",Mt,[m(te,{message:n.content,class:"border-4 border-blue-500"},null,8,["message"])]),x+1<y.data.length?(c(),i("div",Vt,"→")):R("",!0)]))),256))]),h[0]||(h[0]=D(" Inputs: ")),m(ge,{inputs:$.value},null,8,["inputs"])]),_:1})}}}),jt={class:"h-full flex flex-col"},Dt={class:"p-4"},zt={class:"flex w-full"},Ot={class:"material-icons"},At={class:"material-icons"},Bt={class:"material-icons"},Gt={class:"material-icons"},Nt={class:"material-icons"},Ut={class:"flex flex-col gap-2 m-2 h-full overflow-auto"},Lt={class:"flex gap-2 w-full"},Wt=["for"],Ht={class:"material-icons"},Et={class:"material-icons"},Jt="return await check(test)",Kt=z({__name:"TesterControls",setup(a){const $=Me(),y=Ve(),h=Ee(),v=ce(h),n=B(null),x=B([]),J=[_.PinGetValue,_.PinGetPull,_.PinGetMode,_.AdcReadU16,_.I2CScan,_.I2CReadFromMem,b.I2CWriteToMem,b.PinSetValue,b.PwmDutyU16,b.PwmFreq,b.Output,b.Sleep,b.DisplayText,b.DisplayClear];je(async()=>{const o=ze();try{const t=o.params.lesson_id;if(!v.lesson.value||v.lesson.value.id!=t){const{data:l}=await Je.getProjectByID(t.toString()),P=await Ke(l);h.setLesson(P)}const{data:f}=await Y.getStepTranslationByID(o.params.step_id.toString());if(n.value=f,W.value=n.value.content.solution??W.value,n.value.content.highlights)for(const l of n.value.content.highlights)l.module&&l.slot&&u.newModuleToSlot(l.module,l.slot);const d=[];if(n.value&&n.value.content.tests){for(const l of n.value.content.tests){const P=await fetch(l.url).then(Q=>Q.json());d.push({data:P,test:l})}n.value.content.includedCommandsForTests=n.value.content.includedCommandsForTests??[...J]}x.value=d}catch(t){console.log(t)}});async function C(){if(n.value!=null){h.setStepSaving(!0);try{await Y.updateStepTranslationByID(n.value.step,n.value.name,n.value.content)}catch(o){let t="";o instanceof Error?t=o.message:t=String(o),$.add({severity:"error",summary:"Failed to save",detail:t,life:3e3})}finally{h.setStepSaving(!1)}}}const I=Qe(()=>{C()},1e3,{maxWait:5e3});async function M(o){const t=JSON.stringify(o),f=new Blob([t],{type:"application/json"}),d=new FormData;d.append("file",f,"default.test.json");const{data:l}=await Y.uploadFile(d);return l.presigned_url}async function L(){if(n.value==null)return;const o=await M(S.value);n.value.content.tests?n.value.content.tests.push({name:"",url:o}):(n.value.content.tests=[],n.value.content.tests.push({name:"",url:o})),x.value.push({data:S.value,test:{name:"",url:o}}),S.value=[],C()}function ne(o){y.require({message:"Are you sure you want to Delete?",header:"Confirmation",icon:"pi pi-exclamation-triangle",rejectProps:{label:"Cancel",severity:"secondary",outlined:!0},acceptProps:{label:"Delete",severity:"danger"},accept:()=>{var t,f;(f=(t=n.value)==null?void 0:t.content.tests)==null||f.splice(o,1),x.value.splice(o,1),C()}})}const{fileContent:W}=ce(Ue()),u=Le(),{isLoading:k,isRunning:le}=u,S=B(fe),V=B(fe),q=B(!1);function xe(){u.recorder.start(),u.run();const o=ue(u.recorder.state,()=>{(u.replayer.state.value==U.Finish||u.replayer.state.value==U.Timeout)&&(u.recorder.stop(),S.value=u.recorder.getRecords()),o.stop()})}function K(o){return new Promise(t=>{u.reset(),u.recorder.start(o.length);const f=oe(o);u.replayer.start(f);const d=ue(u.replayer.state,()=>{if(u.replayer.state.value==U.Finish){u.recorder.stop();const l=u.recorder.getRecords();t(l)}else if(u.replayer.state.value==U.Timeout){u.recorder.stop();const l=u.recorder.getRecords();t(l)}d.stop()});u.run()})}function he(){u.replayer.state.value==U.Continue?(u.recorder.stop(),u.replayer.stop(),V.value=u.recorder.getRecords()):(u.recorder.stop(),S.value=u.recorder.getRecords()),u.stop()}function ye(o,t){const f=[];let d=!0;o=o.filter(l=>n.value&&n.value.content.includedCommandsForTests?n.value.content.includedCommandsForTests.includes(l.content.command):!0),t=t.filter(l=>n.value&&n.value.content.includedCommandsForTests?n.value.content.includedCommandsForTests.includes(l.content.command):!0);for(let l=0;l<o.length&&l<t.length;l++){const P=we(o[l].content,t[l].content);f.push({correct:P,expected:o[l],replayed:t[l]}),d&&(d=P)}for(let l=t.length;l<o.length;l++)d=!1,f.push({correct:!1,expected:o[l],replayed:null});for(let l=o.length;l<t.length;l++)d=!1,f.push({correct:!1,expected:null,replayed:t[l]});return{feedback:f,success:d}}function we(o,t){if(o.command!==t.command)return!1;const f=He[o.command];return f(o,t)}async function be(o,t){V.value=await K(o.data),await u.stopPromise();let f=o.data;t&&(f=t(o.data),V.value=t(V.value));const{feedback:d,success:l}=ye(f,V.value);return{code:W.value,success:l,expected:f,replayed:V.value,feedback:d,message:""}}async function re(o){const t=Object.getPrototypeOf(async()=>{}).constructor,f=`{ ${Object.keys(ve).join(", ")}, answerCode, test, check, pibody }`,d={...ve,answerCode:W.value,test:o,check:be,pibody:u},l=new t(f,Jt);o.result=await l(d)}async function _e(){for(const o of x.value)await re(o)}const ke=async()=>{if(!(!n.value||!n.value.content.tests)){q.value=!0;for(const[o,t]of x.value.entries()){const f=await K(t.data);await u.stopPromise();const d=await M(f);n.value.content.tests[o].url=d,x.value[o].test.url=d,x.value[o].data=f}await C(),q.value=!1}},$e=async(o,t)=>{if(!n.value||!n.value.content.tests)return;q.value=!0;const f=await K(o.data);await u.stopPromise();const d=await M(f);n.value.content.tests[t].url=d,x.value[t].test.url=d,x.value[t].data=f,C(),q.value=!1};return(o,t)=>{const f=Be,d=Oe,l=Ie,P=Re,Q=se;return c(),i("div",jt,[s("div",Dt,[t[3]||(t[3]=D(" Include Commands: ")),n.value?(c(),j(f,{key:0,onChange:e(I),modelValue:n.value.content.includedCommandsForTests,"onUpdate:modelValue":t[0]||(t[0]=w=>n.value.content.includedCommandsForTests=w),options:We,filter:"",placeholder:"Select commands",class:"w-full md:w-80",maxSelectedLabels:3},null,8,["onChange","modelValue","options"])):R("",!0),s("div",zt,[m(d,{type:"button",class:"w-9 h-9 mr-1",severity:"success",rounded:"",onClick:xe,disabled:e(k)||e(le)},{default:g(()=>[s("span",Ot,r(e(k)?"hourglass_top":"play_arrow"),1)]),_:1},8,["disabled"]),m(d,{type:"button",class:"w-9 h-9 mr-1",severity:"danger",rounded:"",onClick:he,disabled:e(k)||!e(le)},{default:g(()=>[s("span",At,r(e(k)?"hourglass_top":"stop"),1)]),_:1},8,["disabled"]),m(d,{type:"button",class:"w-9 h-9",severity:"info",rounded:"",onClick:t[1]||(t[1]=w=>L()),disabled:S.value.length<=0||n.value==null},{default:g(()=>[s("span",Bt,r(e(k)?"hourglass_top":"save"),1)]),_:1},8,["disabled"]),m(d,{type:"button",class:"w-9 h-9",severity:"info",rounded:"",onClick:_e,disabled:e(k)||q.value},{default:g(()=>[s("span",Gt,r(e(k)?"hourglass_top":"bug_report"),1)]),_:1},8,["disabled"]),m(d,{type:"button",class:"w-9 h-9",rounded:"",onClick:t[2]||(t[2]=w=>ke()),disabled:e(k)||!x.value||q.value},{default:g(()=>[s("span",Nt,r(e(k)?"hourglass_top":"restart_alt"),1)]),_:1},8,["disabled"]),m(Ae)])]),S.value.length>0?(c(),j(pe,{key:0,data:S.value,class:"mt-2"},null,8,["data"])):R("",!0),s("div",Ut,[(c(!0),i(F,null,E(x.value,(w,O)=>(c(),j(Q,{toggleable:"",key:w.test.url,class:H(["border-4",w.result?w.result.success?"border-green-500":"border-red-500":"border-blue-500"])},{header:g(()=>[s("div",Lt,[m(P,{variant:"on",class:"w-full"},{default:g(()=>[s("label",{for:`name${O}`},"Test "+r(O),9,Wt),m(l,{id:`name${O}`,onInput:e(I),modelValue:w.test.name,"onUpdate:modelValue":A=>w.test.name=A,class:"w-full",size:"small"},null,8,["id","onInput","modelValue","onUpdate:modelValue"])]),_:2},1024),m(d,{type:"button",class:"w-9 h-9",severity:"info",rounded:"",onClick:A=>re(w),disabled:e(k)||q.value},{default:g(()=>[s("span",Ht,r(e(k)?"hourglass_top":"bug_report"),1)]),_:2},1032,["onClick","disabled"]),m(d,{type:"button",class:"w-9 h-9",severity:"danger",rounded:"",onClick:A=>ne(O)},{default:g(()=>t[4]||(t[4]=[s("span",{class:"material-icons"},r("delete_forever"),-1)])),_:2},1032,["onClick"]),m(d,{type:"button",class:"w-9 h-9",rounded:"",onClick:A=>$e(w,O),disabled:e(k)||!x.value||q.value},{default:g(()=>[s("span",Et,r(e(k)?"hourglass_top":"restart_alt"),1)]),_:2},1032,["onClick","disabled"]),m(d,{type:"button",class:"w-9 h-9",severity:"warn",rounded:"",onClick:A=>w.result=void 0,disabled:!x.value||q.value},{default:g(()=>t[5]||(t[5]=[s("span",{class:"material-icons"}," cleaning_services ",-1)])),_:2},1032,["onClick","disabled"])])]),default:g(()=>[m(pe,{data:w.data,class:"mt-2"},null,8,["data"]),w.result?(c(),j(Ft,De({key:0,ref_for:!0},w.result),null,16)):R("",!0)]),_:2},1032,["class"]))),128))])])}}}),Qt={class:"flex bg-surface-0",style:{height:"calc(100vh - 52px)"}},$s=z({__name:"TesterView",setup(a){return($,y)=>{const h=qe,v=Te;return c(),i(F,null,[m(Fe),s("div",Qt,[m(v,{class:"w-full rounded-none"},{default:g(()=>[m(h,{size:50,minSize:10,class:"max-w-[467px] w-full"},{default:g(()=>[m(Ce)]),_:1}),m(h,{size:50,minSize:10},{default:g(()=>[m(v,{layout:"vertical",class:"h-full w-full"},{default:g(()=>[m(h,{size:65,minSize:10},{default:g(()=>[m(Pe)]),_:1}),m(h,{size:35,minSize:10},{default:g(()=>[m(Se)]),_:1})]),_:1})]),_:1}),m(h,{size:50,minSize:10,class:"h-full"},{default:g(()=>[m(Kt)]),_:1})]),_:1})])],64)}}});export{$s as default};
