import{s as H}from"./index-Gc46Whfq.js";import{s as U}from"./index-DT-EUPkV.js";import{s as Y}from"./index-CilaYyg5.js";import{s as J}from"./index-CS_MPzE8.js";import{a as K,a7 as Q,u as W,a6 as X,Y as Z,s as D,r as l,o as ee,G as se,c as te,b as s,e as i,f as c,g as oe,F as d,j as p,k as m,w as x,h as re,i as j,t as b,l as g,n as ne,p as ie,E as ae,q as le}from"./index-CpNfsgee.js";import{s as ce}from"./index-BFlIjYqR.js";import{_ as ue}from"./AHeader.vue_vue_type_script_setup_true_lang-Dn7QzKyw.js";import{_ as $}from"./ProjectCard.vue_vue_type_script_setup_true_lang-BuuTQeUR.js";import{a as P}from"./index-CRr2K8Aa.js";import{u as de}from"./editor-store-BMJmdfoO.js";import{t as z}from"./types-81Qs7ZwA.js";import{u as pe,m as me}from"./useSortable-DTNumnwa.js";import"./index-Dl1GEnYT.js";import"./index-CLdqn1Ns.js";import"./logo-D1-3uCnC.js";import"./StudentViewToggle.vue_vue_type_script_setup_true_lang-Bj0eSa9K.js";import"./index-r12sdB34.js";import"./index-CtINQhxX.js";import"./index-CzVNyT2P.js";import"./index-DD6M-OEO.js";import"./index-Btm1kpXS.js";import"./index-D5xNLMSZ.js";import"./index-CLAD8cH4.js";import"./index-Dk2SSfKv.js";import"./index-BNclWPK1.js";import"./http-uAg3sWem.js";import"./profile-Bb7Lrb0h.js";import"./index-B4xzPjgi.js";import"./index-Bcfs32aN.js";import"./index-DylnDvu2.js";import"./pibody-BwAjMvHk.js";import"./v4-CmTdKEVZ.js";import"./sortable.esm-FZSyJVGy.js";const fe={class:"flex flex-col min-h-screen bg-slate-50"},ge={key:1,class:"border border-dashed rounded-xl border-green-400 overflow-hidden"},ve={key:0,class:"flex px-4 sm:px-12"},he={key:1,class:"flex px-4 sm:px-12"},xe={key:3,class:"flex px-4 sm:px-12"},_e={key:4,class:"flex flex-wrap justify-center gap-8 px-4 sm:px-12 pb-8"},es=K({__name:"HomePage",setup(ye){const S=Q("el"),C=W(),{locale:A}=X(),E=ie(),I=de(),{addLesson:M}=I,N=Z(),{user:V}=D(N),u=l([]),_=l([]),y=l([]),k=l([0,0,0,0,0,0]),w=l([0,0,0,0,0,0]),f=l(!1),v=l(!1);pe(S,u,{onUpdate:t=>{me(u.value,t.oldIndex,t.newIndex,t),ae(async()=>{const e=[];u.value.map(n=>{const r=parseInt(n.id,10);e.push(r)});try{const{data:n}=await P.changeProjectsOrder(e);C.add({severity:"success",summary:n.message,life:2e3})}catch(n){C.add({severity:"error",summary:n.response.data.error,detail:n,life:2e3})}})}});async function h(){if(!f.value){f.value=!0;try{const{data:t}=await P.getProjects();f.value=!1,u.value=[],_.value=[],y.value=[],k.value=[0,0,0,0,0,0],w.value=[0,0,0,0,0,0];for(const e of t)e.lego||(e.is_guidable?k.value[e.layer]++:w.value[e.layer]++);for(const e of t){if(e.lego)continue;const n=await z(e);e.layer>0&&u.value.push(n),n.is_guidable?_.value.push(n):y.value.push(n)}}catch(t){console.log(t)}finally{f.value=!1}}}ee(h),se(A,h);async function F(){console.log("addProject"),v.value=!0;try{const{data:t}=await P.createProject(),e=await z(t);M(e),E.push(`/project/${e.id}/edit`)}catch(t){console.log(t)}finally{v.value=!1}}const O=te(()=>{const t=new Map,e=new Map;for(const r of _.value)t.has(r.layer)||t.set(r.layer,[]),t.get(r.layer).push(r);for(const r of y.value)e.has(r.layer)||e.set(r.layer,[]),e.get(r.layer).push(r);const n=[];for(let r=1;r<=5;r++)n.push({id:r,guided:t.get(r)||[],unguided:e.get(r)||[]});return n}),q=["secondary","success","info","warn","danger","contrast"];return(t,e)=>{var R;const n=ce,r=le,T=J,G=Y,B=U,L=H;return s(),i("div",fe,[c(ue,{class:"sticky top-0 z-10 mb-4"}),["editor","contributor"].includes(((R=oe(V))==null?void 0:R.user_type)??"")?(s(),i("div",{key:0,ref_key:"el",ref:S,class:"flex flex-wrap justify-center gap-8 px-4 sm:px-12 py-8"},[(s(!0),i(d,null,p(u.value,o=>(s(),m($,{key:o.id,project:o,onAfterRemove:h},null,8,["project"]))),128)),f.value?(s(),m(n,{key:0})):(s(),i("div",ge,[c(r,{variant:"text",style:{width:"300px",height:"234px"},class:"bg-green-50",onClick:F,loading:v.value,disabled:v.value},{icon:x(()=>e[0]||(e[0]=[re("i",{class:"pi pi-plus text-3xl"},null,-1)])),_:1},8,["loading","disabled"])]))],512)):(s(!0),i(d,{key:1},p(O.value,o=>(s(),i("div",{key:o.id,class:"flex flex-col gap-2"},[o.guided.length>0||o.unguided.length>0?(s(),i("div",ve,[c(T),c(G,{class:"min-w-fit text-2xl px-4",severity:q[o.id]},{default:x(()=>[j(b(o.id>0?`Level -
          ${o.id-1}`:"Other"),1)]),_:2},1032,["severity"]),c(T)])):g("",!0),o.guided.length>0?(s(),i("div",he,[c(B,{class:"min-w-fit pr-4",size:"small",severity:"success"},{default:x(()=>[j(b(t.$t("pages.projects.learn")),1)]),_:1})])):g("",!0),o.guided.length>0?(s(),i("div",{key:2,class:ne(["flex flex-wrap justify-center gap-8 px-4 sm:px-12",{"pb-8":o.unguided.length==0}])},[(s(!0),i(d,null,p(o.guided,a=>(s(),m($,{key:a.id,project:a,id:a.id},null,8,["project","id"]))),128)),(s(!0),i(d,null,p(k.value[o.id]-o.guided.length,a=>(s(),m(L,{key:a,width:"300px",height:"234px",class:"rounded-xl shadow-sm"}))),128))],2)):g("",!0),o.unguided.length>0?(s(),i("div",xe,[c(B,{class:"min-w-fit pr-4",size:"small",severity:"info"},{default:x(()=>[j(b(t.$t("pages.projects.practice")),1)]),_:1})])):g("",!0),o.unguided.length>0?(s(),i("div",_e,[(s(!0),i(d,null,p(o.unguided,a=>(s(),m($,{key:a.id,project:a,onAfterRemove:h},null,8,["project"]))),128)),(s(!0),i(d,null,p(w.value[o.id]-o.unguided.length,a=>(s(),m(L,{key:a,width:"300px",height:"234px",class:"rounded-xl shadow-sm"}))),128))])):g("",!0)]))),128))])}}});export{es as default};
