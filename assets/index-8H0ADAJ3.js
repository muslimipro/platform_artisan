import{I as Fe,Z as _e,J as He,K as We,L as qe,M as Ze,N as Ye,q as fe,O as Xe,P as Je,Q as Se,R as Qe,b as a,k as B,w as T,e as d,S as U,f as k,T as pe,U as Ae,V as oe,F,h,n as et,t as tt,l as I,W as nt,X as st,d as ot,u as at,r as f,Y as Be,s as ie,c as M,a as z,o as ve,G as H,j as me,x as Re,_ as rt,g as o,$ as $e,E as it,i as Ce,D as lt,a0 as ut,H as ae,a1 as ct,p as dt}from"./index-DHVnmQPM.js";import{s as Ee}from"./index-COm9ynAh.js";import{s as pt}from"./index-DhqsrCfS.js";import{u as Ve,L as ft,_ as vt,d as mt}from"./defaultConfirmDeleteOptions-CO4VAVxT.js";import{u as De,c as ht,a as wt}from"./CodeEditorView.vue_vue_type_script_setup_true_lang-DhEu2zYO.js";import{S as gt}from"./SimulationView-fq8-2VoV.js";import{_ as yt}from"./CodeViewer.vue_vue_type_script_setup_true_lang-BcIHfCne.js";import"./http-Dcz7Gd9U.js";import{m as bt}from"./mapLessonFromDto-BxEkOMg4.js";import{U as re}from"./unitApi-BdRQtE7l.js";import{m as kt}from"./mapUnitFromDto-BXFFFlEW.js";import{T as xt}from"./index-D-99ObJy.js";import{s as _t}from"./index-BQXR58SR.js";import{s as Ct}from"./index-D3Cxxuxn.js";import{s as Lt}from"./index-B7xbQbD6.js";import{u as Pe}from"./index-CG6SXWyB.js";import{_ as St}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-BUJyY_Tq.js";import"./index-HGiDyU5z.js";import"./index-BOWzKnTG.js";import"./index-C4F8jACC.js";import"./index-Cr72xZbi.js";import"./index-PBST-dQM.js";import"./index-DimdtQOL.js";var $t=function(e){var n=e.dt;return`
.p-drawer {
    display: flex;
    flex-direction: column;
    transform: translate3d(0px, 0px, 0px);
    position: relative;
    transition: transform 0.3s;
    background: `.concat(n("drawer.background"),`;
    color: `).concat(n("drawer.color"),`;
    border: 1px solid `).concat(n("drawer.border.color"),`;
    box-shadow: `).concat(n("drawer.shadow"),`;
}

.p-drawer-content {
    overflow-y: auto;
    flex-grow: 1;
    padding: `).concat(n("drawer.content.padding"),`;
}

.p-drawer-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    flex-shrink: 0;
    padding: `).concat(n("drawer.header.padding"),`;
}

.p-drawer-footer {
    padding: `).concat(n("drawer.footer.padding"),`;
}

.p-drawer-title {
    font-weight: `).concat(n("drawer.title.font.weight"),`;
    font-size: `).concat(n("drawer.title.font.size"),`;
}

.p-drawer-full .p-drawer {
    transition: none;
    transform: none;
    width: 100vw !important;
    height: 100vh !important;
    max-height: 100%;
    top: 0px !important;
    left: 0px !important;
    border-width: 1px;
}

.p-drawer-left .p-drawer-enter-from,
.p-drawer-left .p-drawer-leave-to {
    transform: translateX(-100%);
}

.p-drawer-right .p-drawer-enter-from,
.p-drawer-right .p-drawer-leave-to {
    transform: translateX(100%);
}

.p-drawer-top .p-drawer-enter-from,
.p-drawer-top .p-drawer-leave-to {
    transform: translateY(-100%);
}

.p-drawer-bottom .p-drawer-enter-from,
.p-drawer-bottom .p-drawer-leave-to {
    transform: translateY(100%);
}

.p-drawer-full .p-drawer-enter-from,
.p-drawer-full .p-drawer-leave-to {
    opacity: 0;
}

.p-drawer-full .p-drawer-enter-active,
.p-drawer-full .p-drawer-leave-active {
    transition: opacity 400ms cubic-bezier(0.25, 0.8, 0.25, 1);
}

.p-drawer-left .p-drawer {
    width: 20rem;
    height: 100%;
    border-inline-end-width: 1px;
}

.p-drawer-right .p-drawer {
    width: 20rem;
    height: 100%;
    border-inline-start-width: 1px;
}

.p-drawer-top .p-drawer {
    height: 10rem;
    width: 100%;
    border-block-end-width: 1px;
}

.p-drawer-bottom .p-drawer {
    height: 10rem;
    width: 100%;
    border-block-start-width: 1px;
}

.p-drawer-left .p-drawer-content,
.p-drawer-right .p-drawer-content,
.p-drawer-top .p-drawer-content,
.p-drawer-bottom .p-drawer-content {
    width: 100%;
    height: 100%;
}

.p-drawer-open {
    display: flex;
}

.p-overlay-mask:dir(rtl) {
    flex-direction: row-reverse;
}
`)},Bt={mask:function(e){var n=e.position,u=e.modal;return{position:"fixed",height:"100%",width:"100%",left:0,top:0,display:"flex",justifyContent:n==="left"?"flex-start":n==="right"?"flex-end":"center",alignItems:n==="top"?"flex-start":n==="bottom"?"flex-end":"center",pointerEvents:u?"auto":"none"}},root:{pointerEvents:"auto"}},Et={mask:function(e){var n=e.instance,u=e.props,r=["left","right","top","bottom"],c=r.find(function(g){return g===u.position});return["p-drawer-mask",{"p-overlay-mask p-overlay-mask-enter":u.modal,"p-drawer-open":n.containerVisible,"p-drawer-full":n.fullScreen},c?"p-drawer-".concat(c):""]},root:function(e){var n=e.instance;return["p-drawer p-component",{"p-drawer-full":n.fullScreen}]},header:"p-drawer-header",title:"p-drawer-title",pcCloseButton:"p-drawer-close-button",content:"p-drawer-content",footer:"p-drawer-footer"},It=Fe.extend({name:"drawer",theme:$t,classes:Et,inlineStyles:Bt}),Dt={name:"BaseDrawer",extends:st,props:{visible:{type:Boolean,default:!1},position:{type:String,default:"left"},header:{type:null,default:null},baseZIndex:{type:Number,default:0},autoZIndex:{type:Boolean,default:!0},dismissable:{type:Boolean,default:!0},showCloseIcon:{type:Boolean,default:!0},closeButtonProps:{type:Object,default:function(){return{severity:"secondary",text:!0,rounded:!0}}},closeIcon:{type:String,default:void 0},modal:{type:Boolean,default:!0},blockScroll:{type:Boolean,default:!1}},style:It,provide:function(){return{$pcDrawer:this,$parentInstance:this}}},Te={name:"Drawer",extends:Dt,inheritAttrs:!1,emits:["update:visible","show","after-show","hide","after-hide"],data:function(){return{containerVisible:this.visible}},container:null,mask:null,content:null,headerContainer:null,footerContainer:null,closeButton:null,outsideClickListener:null,documentKeydownListener:null,watch:{dismissable:function(e){e?this.enableDocumentSettings():this.disableDocumentSettings()}},updated:function(){this.visible&&(this.containerVisible=this.visible)},beforeUnmount:function(){this.disableDocumentSettings(),this.mask&&this.autoZIndex&&_e.clear(this.mask),this.container=null,this.mask=null},methods:{hide:function(){this.$emit("update:visible",!1)},onEnter:function(){this.$emit("show"),this.focus(),this.bindDocumentKeyDownListener(),this.autoZIndex&&_e.set("modal",this.mask,this.baseZIndex||this.$primevue.config.zIndex.modal)},onAfterEnter:function(){this.enableDocumentSettings(),this.$emit("after-show")},onBeforeLeave:function(){this.modal&&!this.isUnstyled&&He(this.mask,"p-overlay-mask-leave")},onLeave:function(){this.$emit("hide")},onAfterLeave:function(){this.autoZIndex&&_e.clear(this.mask),this.unbindDocumentKeyDownListener(),this.containerVisible=!1,this.disableDocumentSettings(),this.$emit("after-hide")},onMaskClick:function(e){this.dismissable&&this.modal&&this.mask===e.target&&this.hide()},focus:function(){var e=function(r){return r&&r.querySelector("[autofocus]")},n=this.$slots.header&&e(this.headerContainer);n||(n=this.$slots.default&&e(this.container),n||(n=this.$slots.footer&&e(this.footerContainer),n||(n=this.closeButton))),n&&We(n)},enableDocumentSettings:function(){this.dismissable&&!this.modal&&this.bindOutsideClickListener(),this.blockScroll&&qe()},disableDocumentSettings:function(){this.unbindOutsideClickListener(),this.blockScroll&&Ze()},onKeydown:function(e){e.code==="Escape"&&this.hide()},containerRef:function(e){this.container=e},maskRef:function(e){this.mask=e},contentRef:function(e){this.content=e},headerContainerRef:function(e){this.headerContainer=e},footerContainerRef:function(e){this.footerContainer=e},closeButtonRef:function(e){this.closeButton=e?e.$el:void 0},bindDocumentKeyDownListener:function(){this.documentKeydownListener||(this.documentKeydownListener=this.onKeydown,document.addEventListener("keydown",this.documentKeydownListener))},unbindDocumentKeyDownListener:function(){this.documentKeydownListener&&(document.removeEventListener("keydown",this.documentKeydownListener),this.documentKeydownListener=null)},bindOutsideClickListener:function(){var e=this;this.outsideClickListener||(this.outsideClickListener=function(n){e.isOutsideClicked(n)&&e.hide()},document.addEventListener("click",this.outsideClickListener))},unbindOutsideClickListener:function(){this.outsideClickListener&&(document.removeEventListener("click",this.outsideClickListener),this.outsideClickListener=null)},isOutsideClicked:function(e){return this.container&&!this.container.contains(e.target)}},computed:{fullScreen:function(){return this.position==="full"},closeAriaLabel:function(){return this.$primevue.config.locale.aria?this.$primevue.config.locale.aria.close:void 0}},directives:{focustrap:Ye},components:{Button:fe,Portal:Xe,TimesIcon:Je}},At=["aria-modal"];function Rt(t,e,n,u,r,c){var g=Se("Button"),$=Se("Portal"),y=Qe("focustrap");return a(),B($,null,{default:T(function(){return[r.containerVisible?(a(),d("div",U({key:0,ref:c.maskRef,onMousedown:e[0]||(e[0]=function(){return c.onMaskClick&&c.onMaskClick.apply(c,arguments)}),class:t.cx("mask"),style:t.sx("mask",!0,{position:t.position,modal:t.modal})},t.ptm("mask")),[k(pe,U({name:"p-drawer",onEnter:c.onEnter,onAfterEnter:c.onAfterEnter,onBeforeLeave:c.onBeforeLeave,onLeave:c.onLeave,onAfterLeave:c.onAfterLeave,appear:""},t.ptm("transition")),{default:T(function(){return[t.visible?Ae((a(),d("div",U({key:0,ref:c.containerRef,class:t.cx("root"),style:t.sx("root"),role:"complementary","aria-modal":t.modal},t.ptmi("root")),[t.$slots.container?oe(t.$slots,"container",{key:0,closeCallback:c.hide}):(a(),d(F,{key:1},[h("div",U({ref:c.headerContainerRef,class:t.cx("header")},t.ptm("header")),[oe(t.$slots,"header",{class:et(t.cx("title"))},function(){return[t.header?(a(),d("div",U({key:0,class:t.cx("title")},t.ptm("title")),tt(t.header),17)):I("",!0)]}),t.showCloseIcon?(a(),B(g,U({key:0,ref:c.closeButtonRef,type:"button",class:t.cx("pcCloseButton"),"aria-label":c.closeAriaLabel,unstyled:t.unstyled,onClick:c.hide},t.closeButtonProps,{pt:t.ptm("pcCloseButton"),"data-pc-group-section":"iconcontainer"}),{icon:T(function(i){return[oe(t.$slots,"closeicon",{},function(){return[(a(),B(nt(t.closeIcon?"span":"TimesIcon"),U({class:[t.closeIcon,i.class]},t.ptm("pcCloseButton").icon),null,16,["class"]))]})]}),_:3},16,["class","aria-label","unstyled","onClick","pt"])):I("",!0)],16),h("div",U({ref:c.contentRef,class:t.cx("content")},t.ptm("content")),[oe(t.$slots,"default")],16),t.$slots.footer?(a(),d("div",U({key:0,ref:c.footerContainerRef,class:t.cx("footer")},t.ptm("footer")),[oe(t.$slots,"footer")],16)):I("",!0)],64))],16,At)),[[y]]):I("",!0)]}),_:3},16,["onEnter","onAfterEnter","onBeforeLeave","onLeave","onAfterLeave"])],16)):I("",!0)]}),_:3})}Te.render=Rt;async function Le(t){const n=new TextEncoder().encode(t),u=await crypto.subtle.digest("SHA-256",n);return Array.from(new Uint8Array(u)).map(g=>g.toString(16).padStart(2,"0")).join("")}function Vt(t){let e="",n=!1;for(let u=0;u<t.length;u++){const r=t[u];if(r==="#"&&(n=!0),n)if(r===`
`)n=!1;else continue;r!==" "&&r!=="	"&&r!==`
`&&r!=="\r"&&(e+=r)}return e}function Pt(t,e){if(t.length!==e.length)return!1;const n=[...t].sort(),u=[...e].sort();return n.every((r,c)=>r===u[c])}const he=ot("lesson-store",()=>{const t=at(),e=f(null),n=f(!1),u=f(!1),r=f(!1),c=f(!1),g=f(!1),$=f(0),y=f(0),i=f([]),x=f(0),b=f(new Map),D=f(new Map),v=f([]),l=f("continue"),C=f(!1),_=f(!1),L=f(!1),N=f(!0),P=f(""),X=f(null),J=f(null),Q=f([]),ee=f([]),we=Be(),ge=Ve(),{lang:ye}=ie(ge),O=f(void 0),te=M(()=>{var s;return L.value&&(((s=X.value)==null?void 0:s.modulesWerePut)??!0)&&N.value});async function be(s,w){try{n.value=!0,b.value.clear(),D.value.clear(),O.value=we.userRole==="editor"?ye.value:void 0;const{data:m}=await ft.getLessonById(s,w,O.value);e.value=bt(m),le()}catch(m){t.add({severity:"error",summary:m.response.data.error,life:2e3})}finally{n.value=!1}}async function le(){if(e.value)try{g.value=!0,$.value=0,b.value.clear();const s=[];e.value.pages.forEach(S=>{S.groups.forEach(A=>{A.units.forEach(se=>{s.push({id:se.id,lessonId:e.value.id})})})});const w=s.length,m=5;for(let S=0;S<s.length;S+=m){const se=s.slice(S,S+m).map(async({id:ke,lessonId:je})=>{try{const{data:xe}=await re.getUnitByIdandLessonId(ke,je,O.value);b.value.set(ke,xe)}catch(xe){console.warn(`Failed to preload unit ${ke}:`,xe)}});await Promise.all(se),$.value=Math.round(Math.min(S+m,w)/w*100)}}catch(s){console.error("Error preloading units:",s)}finally{g.value=!1}}async function K(s,w){if(b.value.has(s))return b.value.get(s);try{u.value=!0;const{data:m}=await re.getUnitByIdandLessonId(s,w,O.value);return b.value.set(s,m),m}catch(m){t.add({severity:"error",summary:m.response.data.error,life:2e3})}finally{u.value=!1}}async function j(){if(e.value!=null){r.value=!0,i.value=[],y.value=0,x.value=0,v.value=[],P.value="",ee.value=[],_.value=!1;for(let s=0;s<e.value.pages.length;s++)v.value.push(0);l.value="continue",i.value.push(e.value.pages[y.value].groups[x.value]),await W(e.value.id),r.value=!1}}function ne(s,w){let m="";if(P.value==""||w.content.starting!=""){m=`emulator-${w.id}`;const S=w.content.starting;J.value=De(m),J.value.setCode(S)}P.value=m??P.value,s=="pibody"&&(X.value=wt(P.value),Q.value=w.data.neededModules,X.value.addNeededModules(Q.value),m!=""&&(ee.value=[]))}async function W(s){L.value=!1,C.value=!1;for(let w=0;w<i.value[x.value].units.length;w++){const m=i.value[x.value].units[w];["options","open","code","pibody"].includes(m.unitType)&&(l.value="check",C.value=!0);const S=await K(m.id,s);if(S){const A=kt(S);i.value[x.value].units[w].content=A==null?void 0:A.content,i.value[x.value].units[w].data=A==null?void 0:A.data,i.value[x.value].units[w].studentState=A==null?void 0:A.studentState,["code","pibody"].includes(m.unitType)&&(A.content.answer==""&&A.data.tests.lenght==0||(N.value=!1),ne(m.unitType,A))}}l.value=="continue"&&await ue()}async function ue(){if(e.value!=null)try{c.value=!0,_.value=!1;for(const s of i.value[i.value.length-1].units){if(D.value.set(s.id,s.studentState.answer),["code","pibody"].includes(s.unitType)){const w=De(P.value).code.value;if(s.data.tests.lenght>0){const m=await ht(`${s.unitType}-${s.id}`,w,s.data.tests,s.data.includedCommands);_.value=m.correct}else if(!s.content.hashed_answer)_.value=!0;else{const m=Vt(w),S=await Le(m);_.value=s.content.hashed_answer===S}}else if(s.unitType=="open"){const m=String(s.studentState.answer.open??"").replace(/ /g,"").toLowerCase(),S=await Le(m);_.value=s.content.hashed_answer===S}else if(s.unitType=="options"){let w=s.studentState.answer.options;const m=[];for(const S of w)m.push(await Le(S));_.value=Pt(s.content.hashed_answer,m)}else _.value=!0;if(_.value==!1)break}_.value?(v.value[y.value]++,x.value>=e.value.pages[y.value].groups.length-1?y.value<e.value.pages.length-1?l.value="continue":l.value="finish":l.value="continue"):l.value="try-again"}finally{c.value=!1}}async function V(){if(e.value!=null){if(x.value>=e.value.pages[y.value].groups.length-1){await Ie(),E();return}r.value=!0,x.value++,i.value.push(e.value.pages[y.value].groups[x.value]),await W(e.value.id),r.value=!1}}async function p(s){const w=i.value[i.value.length-1].id;l.value="continue",v.value[y.value]--,x.value--,i.value.pop(),w==s?y.value==0&&i.value.length==0?await j():await V():await p(s)}function R(s,w){if(e.value!=null){for(const[m,S]of i.value.entries())for(const[A,se]of S.units.entries())if(se.id==s){i.value[m].units[A].studentState.answer=w;break}}}async function q(){e.value!=null&&(l.value="check")}async function Z(){e.value!=null&&(await Ie(),l.value="completed")}function ce(){b.value.clear(),$.value=0,g.value=!1}async function E(){e.value!=null&&(r.value=!0,y.value++,i.value=[],x.value=0,l.value="continue",i.value.push(e.value.pages[y.value].groups[x.value]),await W(e.value.id),r.value=!1)}function de(s){L.value=s}function Ue(){N.value=!0}async function Ne(s){if(P.value=="")return;const w=Number(P.value.split("-")[1]);R(w,s),await re.saveUnitByIdandLessonId(w,e.value.id,{answer:s})}async function Ie(){if(r.value=!0,e.value==null)return;const s=Array.from(D.value.entries()).map(([m,S])=>({id:m,student_answer:S})),{data:w}=await re.submitUnitsByLessonId(e.value.id,s);_.value=w.correct,D.value=new Map,r.value=!1}const G=M(()=>e.value?e.value.pages[y.value]??null:null),Y=M(()=>G.value?G.value.groups[x.value]??null:null),Ge=M({get:()=>{var s;return((s=Y.value)==null?void 0:s.pibodyDrawerVisible)??!1},set:s=>{Y.value&&(Y.value.pibodyDrawerVisible=s)}}),Me=M({get:()=>{var s;return((s=Y.value)==null?void 0:s.codeDrawerVisible)??!1},set:s=>{Y.value&&(Y.value.codeDrawerVisible=s)}}),Oe=M({get:()=>{var s;return((s=G.value)==null?void 0:s.showPibody)??!1},set:s=>{G.value&&(G.value.showPibody=s)}}),Ke=M({get:()=>{var s;return((s=G.value)==null?void 0:s.showCode)??!1},set:s=>{G.value&&(G.value.showCode=s)}});return{selectedLesson:e,isLessonLoading:n,isUnitLoading:u,groups:i,groupIndex:x,isGroupLoading:r,isSubmitLoading:c,isPreloadingUnits:g,preloadingProgress:$,groupStatus:l,submitExist:C,correct:_,submitEnabled:te,pageProgress:v,emulatorID:P,neededModules:Q,slots:ee,pibodyDrawerVisible:Ge,codeDrawerVisible:Me,showPibody:Oe,showCode:Ke,setSubmitable:de,loadLessonById:be,loadUnitByIdandLessonId:K,preloadAllUnits:le,clearUnitsCache:ce,loadInitialGroup:j,submitGroup:ue,nextGroup:V,saveAnswer:R,tryAgain:q,finishLesson:Z,runCodePressed:Ue,saveStudentIdeState:Ne,resetGroup:p}}),ze=z({__name:"MdViewer",props:{text:{}},setup(t){const e=t;return(n,u)=>{const r=Se("v-md-preview");return a(),B(r,{text:e.text},null,8,["text"])}}}),Tt=z({__name:"ArticleViewer",props:{article:{}},setup(t){const e=t;return(n,u)=>(a(),B(ze,{text:e.article.text},null,8,["text"]))}}),zt={class:"flex flex-col gap-4 pl-4"},Ut=z({__name:"OptionsViewer",props:{optionsData:{},state:{}},emits:["save-answer"],setup(t,{emit:e}){const n=t,u=e,r=f(!1),c=f(!1),g=f(!1),$=f([]),y=f([]),i=f();return ve(()=>{var x,b,D,v,l,C;r.value=((x=n.optionsData)==null?void 0:x.shuffle)??!1,c.value=((b=n.optionsData)==null?void 0:b.feedback)??!1,g.value=((D=n.optionsData)==null?void 0:D.single)??!1,$.value=((v=n.optionsData)==null?void 0:v.options)??[],y.value=((l=n.state.answer)==null?void 0:l.options)??[],i.value=n.state.answer&&n.state.answer.options&&n.state.answer.options.length>0?(C=n.state)==null?void 0:C.answer.options[0]:void 0}),H([i,y,c],()=>{g.value&&i.value?u("save-answer",{options:[i.value],feedback:c.value}):u("save-answer",{options:y.value,feedback:c.value})},{deep:!0}),(x,b)=>{const D=Ct,v=_t;return a(),d("div",zt,[(a(!0),d(F,null,me($.value,l=>(a(),d("div",{key:l.id,class:"flex gap-2 items-center"},[g.value?(a(),B(D,{key:0,modelValue:i.value,"onUpdate:modelValue":b[0]||(b[0]=C=>i.value=C),value:l.id},null,8,["modelValue","value"])):(a(),B(v,{key:1,modelValue:y.value,"onUpdate:modelValue":b[1]||(b[1]=C=>y.value=C),value:l.id},null,8,["modelValue","value"])),k(ze,{text:l.text},null,8,["text"])]))),128))])}}}),Nt=z({__name:"OpenViewer",props:{state:{}},emits:["save-answer"],setup(t,{emit:e}){const n=t,u=e,r=f("");return ve(()=>{r.value=n.state.answer.open}),H(r,()=>{u("save-answer",{open:r.value})}),(c,g)=>{const $=Lt;return a(),B($,{type:"text",modelValue:r.value,"onUpdate:modelValue":g[0]||(g[0]=y=>r.value=y),class:"w-full",size:"small"},null,8,["modelValue"])}}}),Gt={key:0,style:{position:"relative",width:"100%",height:"0","padding-bottom":"56.25%"}},Mt=["src"],Ot={key:1,style:{position:"relative","margin-left":"5%",width:"90%",height:"0","padding-bottom":"160%"}},Kt=["src"],jt=z({__name:"VideoViewer",props:{video:{}},setup(t){const e=t;function n(u){return u.replace("shorts","embed")}return(u,r)=>e.video.url.includes("embed")?(a(),d("div",Gt,[h("iframe",{credentialless:"",src:n(e.video.url),style:{position:"absolute",top:"0",left:"0",width:"100%",height:"100%"},frameborder:"0",allowfullscreen:"",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",referrerpolicy:"strict-origin-when-cross-origin"},null,8,Mt)])):(a(),d("div",Ot,[h("iframe",{credentialless:"",src:n(e.video.url??""),style:{position:"absolute",top:"0",left:"0",width:"100%",height:"100%"},frameborder:"0",allowfullscreen:"",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",referrerpolicy:"strict-origin-when-cross-origin"},null,8,Kt)]))}}),Ft={key:1,class:"flex-grow px-4 py-2"},Ht=z({__name:"UnitCard",props:{unit:{},loading:{type:Boolean}},setup(t){const e=t,n=Re(),u=he(),{saveAnswer:r,setSubmitable:c}=u;function g(i){e.unit.unitType=="options"?c(i.options.length>0):e.unit.unitType=="open"&&c(i.open.length>0),r(e.unit.id,i),$(i)}const $=Pe(i=>{y(i)},1e3,{maxWait:5e3});async function y(i){await re.saveUnitByIdandLessonId(e.unit.id,Number(n.params.id),{answer:i})}return(i,x)=>{const b=Ee;return a(),d("div",null,[i.loading?(a(),B(b,{key:0,class:"flex justify-center items-center w-10 h-full"})):(a(),d("div",Ft,[e.unit.unitType=="article"?(a(),B(Tt,{key:0,article:e.unit.content},null,8,["article"])):e.unit.unitType=="options"?(a(),B(Ut,{key:1,"options-data":e.unit.content,state:e.unit.studentState,onSaveAnswer:g},null,8,["options-data","state"])):e.unit.unitType=="open"?(a(),B(Nt,{key:2,state:e.unit.studentState,onSaveAnswer:g},null,8,["state"])):e.unit.unitType=="video"?(a(),B(jt,{key:3,video:e.unit.content},null,8,["video"])):I("",!0)]))])}}}),Wt={key:1,class:"flex flex-col h-full w-full"},qt={class:"flex-grow flex flex-col gap-4 px-4 py-2"},Zt=z({__name:"GroupCard",props:{group:{},loading:{type:Boolean}},setup(t){const e=t,n=f(null);return H(()=>e.loading,u=>{u===!1&&n.value&&requestAnimationFrame(()=>{var r;(r=n.value)==null||r.scrollIntoView({behavior:"smooth",block:"start"})})}),(u,r)=>{const c=Ee;return a(),d("div",{ref_key:"groupRef",ref:n},[u.loading?(a(),B(c,{key:0,class:"flex justify-center items-center w-10 h-full"})):(a(),d("div",Wt,[h("div",qt,[(a(!0),d(F,null,me(u.group.units,g=>(a(),B(Ht,{key:g.id,unit:g},null,8,["unit"]))),128))])]))],512)}}}),Yt={key:0,class:"absolute right-0"},Xt=z({__name:"UnitsView",props:{pages:{}},setup(t){const e=he(),{groups:n,isGroupLoading:u}=ie(e),{loadInitialGroup:r,resetGroup:c}=e,g=Be(),$=f(null),y=f(null),i=f(0);function x(v){let l=v;for(;l&&l.parentElement;){const C=l.parentElement,L=getComputedStyle(C).overflowY;if(L==="auto"||L==="scroll")return C;l=C}return null}async function b(){await it();const v=x($.value),l=y.value;if(!v||!l){i.value=0;return}const C=v.clientHeight,_=l.getBoundingClientRect().height,L=Math.max(0,C-_);i.value=L}function D(v,l){var L;const C=(L=n.value[n.value.length-1])==null?void 0:L.id;let _=null;v&&(v instanceof Element?_=v:v.$el instanceof Element&&(_=v.$el)),y.value=l.id===C?_:null}return ve(()=>{r(),b(),window.addEventListener("resize",b)}),rt(()=>{window.removeEventListener("resize",b)}),H(()=>n.value.length,async()=>{await b()}),H(()=>u.value,async(v,l)=>{l===!0&&v===!1&&await b()}),(v,l)=>{const C=fe,_=xt;return a(),d("div",{ref_key:"rootEl",ref:$,class:"flex flex-col gap-8"},[(a(!0),d(F,null,me(o(n),L=>(a(),d("div",{key:L.id,ref_for:!0,ref:N=>D(N,L),class:"relative"},[!o(u)&&o(g).userRole=="editor"?(a(),d("div",Yt,[Ae((a(),B(C,{type:"button",class:"w-9 h-9 mr-8 mt-2",rounded:"",severity:"secondary",variant:"text",onClick:N=>o(c)(L.id)},{default:T(()=>l[0]||(l[0]=[h("span",{class:"material-icons"},"restart_alt",-1)])),_:2},1032,["onClick"])),[[_,"Reset step",void 0,{left:!0}]])])):I("",!0),k(Zt,{group:L,loading:o(u)&&L.id==o(n)[o(n).length-1].id},null,8,["group","loading"])]))),128)),h("div",{style:$e({height:i.value+"px"})},null,4)],512)}}}),Jt={key:0,class:"flex justify-center items-center w-full min-h-24 px-8 gap-8"},Qt={key:1},en={key:"correct",class:"flex justify-center items-center w-full min-h-24 px-8 gap-8 bg-green-100"},tn={key:"incorrect",class:"flex justify-center items-center w-full min-h-24 px-8 gap-8 bg-red-100"},nn={key:"no-submit",class:"flex justify-center items-center w-full min-h-24 px-8 gap-8"},sn={key:"try-again",class:"flex justify-center items-center w-full min-h-24 px-8 gap-8 bg-gray-50"},on={key:2},an={key:"correct",class:"flex justify-center items-center w-full min-h-24 px-8 gap-8 bg-green-100"},rn={key:1,class:"flex justify-center items-center w-full min-h-24 px-8 gap-8"},ln=z({__name:"NavigationBar",setup(t){const e=he(),{isSubmitLoading:n,groupStatus:u,isGroupLoading:r,submitExist:c,correct:g,submitEnabled:$}=ie(e),{submitGroup:y,nextGroup:i,tryAgain:x,finishLesson:b}=e;return(D,v)=>{const l=fe;return a(),d(F,null,[o(u)=="check"?(a(),d("div",Jt,[k(l,{label:"CHECK",icon:"pi pi-check","icon-pos":"right",size:"large",severity:"contrast",class:"w-56 rounded-3xl",onClick:o(y),loading:o(n),disabled:o(n)||!o($)},null,8,["onClick","loading","disabled"])])):I("",!0),o(u)=="continue"?(a(),d("div",Qt,[k(pe,{name:"pop",appear:"",mode:"out-in"},{default:T(()=>[o(c)&&o(g)?(a(),d("div",en,[v[0]||(v[0]=h("div",{class:"text-lg font-bold flex items-center gap-2"},[h("span",{class:"text-3xl"},"🎉"),Ce(" Correct!")],-1)),k(l,{label:"CONTINUE",icon:"pi pi-arrow-right","icon-pos":"right",size:"large",class:"w-56 rounded-3xl",onClick:o(i),loading:o(r),disabled:o(r)},null,8,["onClick","loading","disabled"])])):o(c)&&!o(g)?(a(),d("div",tn,[k(l,{label:"CONTINUE",icon:"pi pi-arrow-right","icon-pos":"right",size:"large",severity:"contrast",class:"w-56 rounded-3xl",onClick:o(i),loading:o(r),disabled:o(r)},null,8,["onClick","loading","disabled"])])):(a(),d("div",nn,[k(l,{label:"CONTINUE",icon:"pi pi-arrow-right","icon-pos":"right",size:"large",severity:"contrast",class:"w-56 rounded-3xl",onClick:o(i),loading:o(r),disabled:o(r)},null,8,["onClick","loading","disabled"])]))]),_:1})])):I("",!0),k(pe,{name:"shake",appear:""},{default:T(()=>[o(u)=="try-again"?(a(),d("div",sn,[v[1]||(v[1]=h("div",{class:"text-lg font-bold flex items-center gap-2"},[h("span",{class:"text-3xl"},"⚠️"),Ce(" Incorrect!")],-1)),k(l,{label:"TRY AGAIN",icon:"pi pi-arrow-right","icon-pos":"right",size:"large",severity:"contrast",class:"w-56 rounded-3xl",onClick:o(x)},null,8,["onClick"])])):I("",!0)]),_:1}),o(u)=="finish"?(a(),d("div",on,[o(c)&&o(g)?(a(),d("div",an,[v[2]||(v[2]=h("div",{class:"text-lg font-bold flex items-center gap-2"},[h("span",{class:"text-3xl"},"🎉"),Ce(" Correct!")],-1)),k(l,{label:"FINISH",icon:"pi pi-arrow-right","icon-pos":"right",size:"large",class:"w-56 rounded-3xl",onClick:o(b),loading:o(r),disabled:o(r)},null,8,["onClick","loading","disabled"])])):(a(),d("div",rn,[k(l,{label:"FINISH",icon:"pi pi-arrow-right","icon-pos":"right",size:"large",class:"w-56 rounded-3xl",onClick:o(b)},null,8,["onClick"])]))])):I("",!0)],64)}}}),un=St(ln,[["__scopeId","data-v-fdc42d8d"]]),cn={key:0,class:"h-screen flex flex-col items-center overflow-hidden relative"},dn={class:"fixed top-0 left-0 right-0 z-50 bg-white border-b border-gray-200 shadow-md max-w-[1920px] mx-auto"},pn={class:"flex justify-between items-center w-full min-h-16 px-8 gap-8"},fn={class:"flex items-center gap-4"},vn={key:0,class:"flex flex-grow max-w-screen-lg items-center gap-4"},mn={class:"w-10"},hn={class:"flex-1 overflow-y-auto mt-16 mb-24 w-full"},wn={key:1,class:"flex justify-center"},gn={key:2},yn={key:3,class:"fixed top-32 right-0 pl-2 pr-4 py-2 bg-white rounded-tl-lg rounded-bl-lg shadow-md z-50 border border-gray-200 flex flex-col items-center gap-4"},bn={key:4,class:"fixed top-20 right-4 bg-white rounded-lg shadow-md z-50 border border-gray-200 p-4 min-w-64"},kn={class:"flex items-center gap-3 mb-2"},xn={class:"fixed bottom-0 left-0 right-0 z-50 bg-white shadow-md max-w-[1920px] mx-auto"},_n={key:0,class:"absolute left-0 top-1/2 -translate-y-1/2"},Cn={class:"relative h-full"},Ln={class:"absolute -right-0 top-1/2 -translate-y-1/2 w-5 h-10 z-10"},Sn={key:1,class:"absolute right-0 top-1/2 -translate-y-1/2"},$n={class:"relative h-full"},Bn={class:"absolute -left-0 top-1/2 -translate-y-1/2 w-5 h-10 z-10"},En={key:0,class:"h-screen flex flex-col items-center justify-center overflow-hidden gap-10"},es=z({__name:"LessonPage",setup(t){const e=Re(),n=dt(),u=lt(),r=Be(),c=Ve(),{lang:g}=ie(c);H(g,async(V,p)=>{V!==p&&i.value&&await J(Number(e.params.id),(e.query.route_id??"").toString())});const $=he(),{isLessonLoading:y,selectedLesson:i,pageProgress:x,groupStatus:b,emulatorID:D,neededModules:v,slots:l,pibodyDrawerVisible:C,codeDrawerVisible:_,showPibody:L,showCode:N,isPreloadingUnits:P,preloadingProgress:X}=ie($),{loadLessonById:J,runCodePressed:Q,saveStudentIdeState:ee,setSubmitable:we}=$;function ge(){u.require({...mt,header:"Close lesson",message:"Are you sure you want to exit lesson. All progress will be lost!",acceptProps:{label:"Close",severity:"danger"},accept:()=>O()})}function ye(V){var R;const p=((R=i.value)==null?void 0:R.pages.reduce((q,Z)=>q+Z.groups.length,0))||1;return V/p*100}function O(){e.query.route_id&&e.query.route_id!=""?n.push("/v2/route/"+e.query.route_id):window.history.length>2?n.go(-1):n.push("/v2")}const te=f("");H([te,l],()=>{we(!0),be({code:te.value,slots:l.value})});const be=Pe(V=>{ee(V)},1e3,{maxWait:5e3});function le(V){te.value=V.code}const K=f(window.innerWidth),j=f(16);function ne(){if(K.value=window.innerWidth,K.value<=1300){j.value=16;return}const p=452-(K.value-1024)/2;j.value=p>16?p:16}ve(()=>{b.value="continue",ne(),J(Number(e.params.id),(e.query.route_id??"").toString()),window.addEventListener("resize",ne)}),ut(()=>{window.removeEventListener("resize",ne)});const W=M(()=>K.value<=1920?{}:"calc((-100vw + 1920px) / 2)"),ue=()=>{n.push(`${e.path}/edit`)};return(V,p)=>{const R=fe,q=pt,Z=Ee,ce=Te;return a(),d(F,null,[o(b)!="completed"?(a(),d("div",cn,[h("div",dn,[h("div",pn,[h("div",fn,[k(R,{icon:"pi pi-times",variant:"text",severity:"contrast",onClick:ge})]),o(i)?(a(),d("div",vn,[(a(!0),d(F,null,me(o(i).pages,(E,de)=>(a(),d("div",{key:de,class:"h-full",style:$e({width:ye(E.groups.length)+"%"})},[k(q,{value:o(x)[de]/E.groups.length*100,"show-value":!1,class:"w-full rounded-full h-3"},null,8,["value"])],4))),128))])):I("",!0),h("div",mn,[k(R,{icon:"pi pi-pencil",variant:"text",severity:"contrast",onClick:ue})])])]),h("div",hn,[h("div",{class:"w-full h-full max-w-screen-lg mx-auto py-8",style:$e({paddingLeft:j.value+"px",paddingRight:j.value+"px"})},[o(y)?(a(),B(Z,{key:0,class:"flex justify-center"})):o(i)?(a(),d("div",gn,[k(Xt,{pages:o(i).pages},null,8,["pages"])])):(a(),d("div",wn,"No lesson found")),o(r).userRole=="editor"?(a(),d("div",yn,[k(o(vt))])):I("",!0),o(P)?(a(),d("div",bn,[h("div",kn,[k(Z,{style:{width:"20px",height:"20px"}}),p[9]||(p[9]=h("span",{class:"text-sm font-medium"},"Preloading units...",-1))]),k(q,{value:o(X),"show-value":!0,class:"h-2"},null,8,["value"])])):I("",!0)],4)]),h("div",xn,[k(un)]),o(L)?(a(),d("div",_n,[k(R,{icon:"pi pi-microchip",severity:"secondary",onClick:p[0]||(p[0]=E=>C.value=!0),class:"w-8 rounded-tl-none rounded-bl-none rounded-tr-lg rounded-br-lg mt-16"}),k(ce,{visible:o(C),"onUpdate:visible":p[4]||(p[4]=E=>ae(C)?C.value=E:null),modal:!1,dismissable:!1,closeOnEscape:!1,class:"h-[calc(100vh-64px)] w-fit mt-16",pt:{root:{style:`right: ${W.value}`}}},{header:T(()=>p[10]||(p[10]=[h("div",null,null,-1)])),container:T(()=>[h("div",Cn,[h("div",Ln,[k(R,{icon:"pi pi-chevron-left",severity:"secondary",onClick:p[1]||(p[1]=E=>C.value=!1),class:"w-5 rounded-tl-lg rounded-bl-lg rounded-tr-none rounded-br-none"})]),(a(),B(o(gt),{id:o(D),key:o(D),slots:o(l),"onUpdate:slots":p[2]||(p[2]=E=>ae(l)?l.value=E:null),neededModules:o(v),"onUpdate:neededModules":p[3]||(p[3]=E=>ae(v)?v.value=E:null),class:"w-full",horizontal:!1,autoPut:!0},null,8,["id","slots","neededModules"]))])]),_:1},8,["visible","pt"])])):I("",!0),o(N)?(a(),d("div",Sn,[k(R,{icon:"pi pi-code",severity:"secondary",onClick:p[5]||(p[5]=E=>_.value=!0),class:"w-8 rounded-tl-lg rounded-bl-lg rounded-tr-none rounded-br-none mt-16"}),k(ce,{visible:o(_),"onUpdate:visible":p[8]||(p[8]=E=>ae(_)?_.value=E:null),header:"Drawer",modal:!1,dismissable:!1,closeOnEscape:!1,position:"right",class:"h-[calc(100vh-64px)] w-[452px] mt-16",pt:{root:{style:`left: ${W.value}`}}},{header:T(()=>p[11]||(p[11]=[h("div",null,null,-1)])),container:T(()=>[h("div",$n,[h("div",Bn,[k(R,{icon:"pi pi-chevron-right",severity:"secondary",onClick:p[6]||(p[6]=E=>_.value=!1),class:"w-5 rounded-tl-none rounded-bl-none rounded-tr-lg rounded-br-lg"})]),(a(),B(ct,null,[(a(),B(o(yt),{id:o(D),key:o(D),connectbuttons:o(L),"onUpdate:connectbuttons":p[7]||(p[7]=E=>ae(L)?L.value=E:null),onRun:o(Q),onSaveAnswer:le},null,8,["id","connectbuttons","onRun"]))],1024))])]),_:1},8,["visible","pt"])])):I("",!0)])):I("",!0),k(pe,{"enter-active-class":"transition duration-500 ease-out","enter-from-class":"opacity-0 scale-90","enter-to-class":"opacity-100 scale-100","leave-active-class":"transition duration-300 ease-in","leave-from-class":"opacity-100 scale-100","leave-to-class":"opacity-0 scale-90"},{default:T(()=>[o(b)=="completed"?(a(),d("div",En,[p[12]||(p[12]=h("div",{class:"text-5xl"},"⚡️",-1)),p[13]||(p[13]=h("div",{class:"flex flex-col items-center"},[h("div",{class:"text-4xl font-bold mb-8"},"Good work!"),h("div",{class:"text-md text-gray-500"},"TOTAL XP"),h("div",{class:"text-3xl font-bold"},"35")],-1)),h("div",null,[k(R,{label:"Continue",class:"rounded-full w-56 text-xl",onClick:O})])])):I("",!0)]),_:1})],64)}}});export{es as default};
